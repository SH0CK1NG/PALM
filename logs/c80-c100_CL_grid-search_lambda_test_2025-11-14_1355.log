nohup: ignoring input
[Grid Search Continual] Searching over: lambda_pcon(0.1) × lrs(0.001) × epochs(1) × lora_r(8)
[Grid Search Continual] Stages: 0,8,11,40,51 66,67,88,94,57 59,58,44,93,10 64,22,42,9,90

==========================================
[Run] lambda_pcon=0.1 lr=0.001 epochs=1 lora_r=8
==========================================
[info] Removing old curve file: evaluation_results/inc_curve_CIFAR-110_resnet34_top5-palm-cache6-ema0.999-b128-e1-lr0.001-wd1e-4-ltboth-bfmnone-pcon0.1-lora_r8a32d0.05-temp0.08-ol1-continual-from-c80-to-CIFAR-110-palm_mle_all-pcon_split.json
==== Stage 1: inc={0,8,11,40,51}; seen={}; all(union)={0,8,9,10,11,22,40,42,44,51,57,58,59,64,66,67,88,90,93,94} ====
/home/shaokun/anaconda3/envs/CILPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/CILPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
/home/shaokun/PALM/main.py:61: FutureWarning: `torch.cuda.amp.GradScaler(args...)` is deprecated. Please use `torch.amp.GradScaler('cuda', args...)` instead.
  scaler = torch.cuda.amp.GradScaler()
Namespace(in_dataset='CIFAR-110', out_datasets=['inat', 'sun50', 'places50', 'dtd'], backbone='resnet34', method='top5-palm-cache6-ema0.999', seed=1, gpu='0', epochs=1, batch_size=128, lr=0.001, weight_decay=0.0001, print_every=50, fine_tune=False, temp=0.08, cosine=True, warm=False, lr_decay_epochs='700,800,900', lr_decay_rate=0.1, layers=100, depth=40, width=4, growth=12, droprate=0.0, save_path='CIFAR-10-ResNet18.pt', load_path='checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-upper-retain-c80.pt', reduce=0.5, score='mahalanobis', threshold=1.0, k=5, momentum=0.9, proto_m=0.999, cache_size=6, nviews=2, lambda_pcon=0.1, epsilon=0.05, palm_enable=True, palm_mle_mode='all', palm_retain_only=False, pcon_inc='split', incremental=True, use_lora=True, lora_impl='peft', lora_r=8, lora_alpha=32, lora_dropout=0.05, lora_target='both', adapter_save_path='checkpoints/CIFAR-110-resnet34-top5-palm-cache6-ema0.999-b128-e1-lr0.001-wd1e-4-ltboth-bfmnone-pcon0.1-lora_r8a32d0.05-temp0.08-ol1-continual-from-c80-to-CIFAR-110-palm_mle_all-pcon_split-stack/stage1', adapter_load_path=None, lora_stack=False, lora_orth_enable=False, lora_orth_lambda=0.1, lora_orth_ref_paths=None, forget_classes='0,8,9,10,11,22,40,42,44,51,57,58,59,64,66,67,88,90,93,94', forget_list_path=None, forget_classes_inc='0,8,11,40,51', forget_classes_seen=None, retain_exclude_csv=None, forget_csv=None, forget_lambda=0.0, forget_margin=100.0, forget_strategy='proto', centers_path=None, precision_path=None, batch_forget_mode='none', forget_proto_enable=False, forget_attr_w=1.0, forget_proto_rep_w=1.0, forget_avgproto_enable=False, forget_avgproto_w=1.0, umap_enable=False, umap_by='domain', umap_max_points=20000, umap_neighbors=15, umap_min_dist=0.05, umap_metric='cosine', umap_save_path=None, umap_rf_only=False, keep_cache=False, argument=True)
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-upper-retain-c80.pt
resnet34-top5-palm-cache6-ema0.999: Number of model parameters: 21843904
[debug] trainable_count = 16
[debug] trainable: base_model.model.encoder.layer4.0.conv1.lora_A.default.weight
[debug] trainable: base_model.model.encoder.layer4.0.conv1.lora_B.default.weight
[debug] trainable: base_model.model.encoder.layer4.0.conv2.lora_A.default.weight
[debug] trainable: base_model.model.encoder.layer4.0.conv2.lora_B.default.weight
[debug] trainable: base_model.model.encoder.layer4.0.shortcut.0.lora_A.default.weight
[debug] trainable: base_model.model.encoder.layer4.0.shortcut.0.lora_B.default.weight
[debug] trainable: base_model.model.encoder.layer4.1.conv1.lora_A.default.weight
[debug] trainable: base_model.model.encoder.layer4.1.conv1.lora_B.default.weight
[debug] trainable: base_model.model.encoder.layer4.1.conv2.lora_A.default.weight
[debug] trainable: base_model.model.encoder.layer4.1.conv2.lora_B.default.weight
[debug] trainable: base_model.model.encoder.layer4.2.conv1.lora_A.default.weight
[debug] trainable: base_model.model.encoder.layer4.2.conv1.lora_B.default.weight
[debug] trainable: base_model.model.encoder.layer4.2.conv2.lora_A.default.weight
[debug] trainable: base_model.model.encoder.layer4.2.conv2.lora_B.default.weight
[debug] trainable: base_model.model.head.2.lora_A.default.weight
[debug] trainable: base_model.model.head.2.lora_B.default.weight
[debug][warn] non-LoRA trainables detected: ['base_model.model.encoder.layer4.0.conv1.lora_A.default.weight', 'base_model.model.encoder.layer4.0.conv1.lora_B.default.weight', 'base_model.model.encoder.layer4.0.conv2.lora_A.default.weight', 'base_model.model.encoder.layer4.0.conv2.lora_B.default.weight', 'base_model.model.encoder.layer4.0.shortcut.0.lora_A.default.weight', 'base_model.model.encoder.layer4.0.shortcut.0.lora_B.default.weight', 'base_model.model.encoder.layer4.1.conv1.lora_A.default.weight', 'base_model.model.encoder.layer4.1.conv1.lora_B.default.weight', 'base_model.model.encoder.layer4.1.conv2.lora_A.default.weight', 'base_model.model.encoder.layer4.1.conv2.lora_B.default.weight']
[trainable] param_count=238592 tensors=16
[incremental] resumed from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-upper-retain-c80.pt
  0%|          | 0/1 [00:00<?, ?it/s]/home/shaokun/PALM/trainer.py:167: FutureWarning: `torch.cuda.amp.autocast(args...)` is deprecated. Please use `torch.amp.autocast('cuda', args...)` instead.
  with torch.cuda.amp.autocast():
100%|██████████| 1/1 [00:16<00:00, 16.91s/it]100%|██████████| 1/1 [00:16<00:00, 16.91s/it]
[loss] ep 0 it 0 total=4.6430 mle=4.0804 pcon=0.5626 forget=0.0000 orth=0.0000 favg=0.0000 nr=122 nf=6 protos=None fproto_sim=NA
[loss] ep 0 it 50 total=5.0013 mle=4.4385 pcon=0.5628 forget=0.0000 orth=0.0000 favg=0.0000 nr=123 nf=5 protos=None fproto_sim=NA
[loss] ep 0 it 100 total=5.0626 mle=4.4997 pcon=0.5629 forget=0.0000 orth=0.0000 favg=0.0000 nr=123 nf=5 protos=None fproto_sim=NA
[loss] ep 0 it 150 total=5.6153 mle=5.0522 pcon=0.5631 forget=0.0000 orth=0.0000 favg=0.0000 nr=124 nf=4 protos=None fproto_sim=NA
[loss] ep 0 it 200 total=4.3043 mle=3.7410 pcon=0.5634 forget=0.0000 orth=0.0000 favg=0.0000 nr=118 nf=10 protos=None fproto_sim=NA
[loss] ep 0 it 250 total=4.8996 mle=4.3361 pcon=0.5635 forget=0.0000 orth=0.0000 favg=0.0000 nr=124 nf=4 protos=None fproto_sim=NA
[loss] ep 0 it 300 total=4.5205 mle=3.9568 pcon=0.5637 forget=0.0000 orth=0.0000 favg=0.0000 nr=120 nf=8 protos=None fproto_sim=NA
[loss] ep 0 it 350 total=4.9444 mle=4.3806 pcon=0.5638 forget=0.0000 orth=0.0000 favg=0.0000 nr=117 nf=11 protos=None fproto_sim=NA
[loss] ep 0 it 400 total=4.8929 mle=4.3289 pcon=0.5640 forget=0.0000 orth=0.0000 favg=0.0000 nr=117 nf=11 protos=None fproto_sim=NA
[peft] adapter saved to checkpoints/CIFAR-110-resnet34-top5-palm-cache6-ema0.999-b128-e1-lr0.001-wd1e-4-ltboth-bfmnone-pcon0.1-lora_r8a32d0.05-temp0.08-ol1-continual-from-c80-to-CIFAR-110-palm_mle_all-pcon_split-stack/stage1
/home/shaokun/anaconda3/envs/CILPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/CILPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-upper-retain-c80.pt
[peft] adapter loaded from checkpoints/CIFAR-110-resnet34-top5-palm-cache6-ema0.999-b128-e1-lr0.001-wd1e-4-ltboth-bfmnone-pcon0.1-lora_r8a32d0.05-temp0.08-ol1-continual-from-c80-to-CIFAR-110-palm_mle_all-pcon_split-stack/stage1
[peft] active adapters set to: default
resnet34-top5-palm-cache6-ema0.999-b128-e1-lr0.001-wd1e-4-ltboth-bfmnone-pcon0.1-lora_r8a32d0.05-temp0.08-ol1-continual-from-c80-to-CIFAR-110-palm_mle_all-pcon_split-stage1-seen-inc: Number of model parameters: 21843904
Processing in-distribution CIFAR-110 images
  0%|          | 0/430 [00:00<?, ?it/s]  0%|          | 1/430 [00:00<03:48,  1.88it/s]  3%|▎         | 11/430 [00:00<00:18, 22.45it/s]  5%|▍         | 21/430 [00:00<00:10, 39.85it/s]  7%|▋         | 31/430 [00:00<00:07, 53.84it/s] 10%|▉         | 41/430 [00:00<00:05, 64.94it/s] 12%|█▏        | 51/430 [00:01<00:05, 73.25it/s] 14%|█▍        | 61/430 [00:01<00:04, 78.93it/s] 17%|█▋        | 71/430 [00:01<00:04, 83.61it/s] 19%|█▉        | 81/430 [00:01<00:04, 86.95it/s] 21%|██        | 91/430 [00:01<00:03, 89.48it/s] 23%|██▎       | 101/430 [00:01<00:03, 91.34it/s] 26%|██▌       | 111/430 [00:01<00:03, 92.77it/s] 28%|██▊       | 121/430 [00:01<00:03, 93.74it/s] 30%|███       | 131/430 [00:01<00:03, 94.39it/s] 33%|███▎      | 141/430 [00:02<00:03, 94.31it/s] 35%|███▌      | 151/430 [00:02<00:02, 94.71it/s] 37%|███▋      | 161/430 [00:02<00:02, 95.04it/s] 40%|███▉      | 171/430 [00:02<00:02, 95.37it/s] 42%|████▏     | 181/430 [00:02<00:02, 94.80it/s] 44%|████▍     | 191/430 [00:02<00:02, 95.17it/s] 47%|████▋     | 201/430 [00:02<00:02, 95.31it/s] 49%|████▉     | 211/430 [00:02<00:02, 95.67it/s] 51%|█████▏    | 221/430 [00:02<00:02, 95.59it/s] 54%|█████▎    | 231/430 [00:02<00:02, 95.53it/s] 56%|█████▌    | 241/430 [00:03<00:01, 95.47it/s] 58%|█████▊    | 251/430 [00:03<00:01, 95.55it/s] 61%|██████    | 261/430 [00:03<00:01, 95.42it/s] 63%|██████▎   | 271/430 [00:03<00:01, 95.23it/s] 65%|██████▌   | 281/430 [00:03<00:01, 95.09it/s] 68%|██████▊   | 291/430 [00:03<00:01, 82.78it/s] 70%|███████   | 301/430 [00:03<00:01, 85.95it/s] 72%|███████▏  | 311/430 [00:03<00:01, 88.65it/s] 75%|███████▍  | 321/430 [00:03<00:01, 90.48it/s] 77%|███████▋  | 331/430 [00:04<00:01, 91.77it/s] 79%|███████▉  | 341/430 [00:04<00:00, 92.81it/s] 82%|████████▏ | 351/430 [00:04<00:00, 93.55it/s] 84%|████████▍ | 361/430 [00:04<00:00, 94.01it/s] 86%|████████▋ | 371/430 [00:04<00:00, 94.43it/s] 89%|████████▊ | 381/430 [00:04<00:00, 94.77it/s] 91%|█████████ | 391/430 [00:04<00:00, 95.14it/s] 93%|█████████▎| 401/430 [00:04<00:00, 94.78it/s] 96%|█████████▌| 411/430 [00:04<00:00, 95.69it/s] 98%|█████████▊| 421/430 [00:04<00:00, 96.37it/s]100%|██████████| 430/430 [00:05<00:00, 84.51it/s]
55000 images processed, 5.124227523803711 seconds used

Processing in-distribution CIFAR-110 images
  0%|          | 0/86 [00:00<?, ?it/s]  1%|          | 1/86 [00:00<00:39,  2.14it/s] 12%|█▏        | 10/86 [00:00<00:03, 22.39it/s] 23%|██▎       | 20/86 [00:00<00:01, 40.92it/s] 35%|███▍      | 30/86 [00:00<00:01, 55.41it/s] 47%|████▋     | 40/86 [00:00<00:00, 66.22it/s] 58%|█████▊    | 50/86 [00:00<00:00, 74.36it/s] 70%|██████▉   | 60/86 [00:01<00:00, 80.57it/s] 81%|████████▏ | 70/86 [00:01<00:00, 85.34it/s] 93%|█████████▎| 80/86 [00:01<00:00, 88.77it/s]100%|██████████| 86/86 [00:01<00:00, 62.62it/s]
11000 images processed, 1.386995553970337 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:56,  1.74it/s]  5%|▍         | 10/204 [00:00<00:10, 19.06it/s] 10%|▉         | 20/204 [00:00<00:05, 36.25it/s] 15%|█▍        | 30/204 [00:00<00:03, 50.19it/s] 20%|█▉        | 40/204 [00:01<00:02, 61.68it/s] 24%|██▍       | 49/204 [00:01<00:02, 68.51it/s] 28%|██▊       | 58/204 [00:01<00:01, 74.02it/s] 33%|███▎      | 67/204 [00:01<00:01, 75.55it/s] 38%|███▊      | 77/204 [00:01<00:01, 80.53it/s] 43%|████▎     | 87/204 [00:01<00:01, 83.52it/s] 48%|████▊     | 97/204 [00:01<00:01, 86.30it/s] 52%|█████▏    | 107/204 [00:01<00:01, 88.36it/s] 57%|█████▋    | 117/204 [00:01<00:00, 89.95it/s] 62%|██████▏   | 127/204 [00:01<00:00, 90.30it/s] 67%|██████▋   | 137/204 [00:02<00:00, 91.14it/s] 72%|███████▏  | 147/204 [00:02<00:00, 91.77it/s] 77%|███████▋  | 157/204 [00:02<00:00, 91.94it/s] 82%|████████▏ | 167/204 [00:02<00:00, 92.38it/s] 87%|████████▋ | 177/204 [00:02<00:00, 93.37it/s] 92%|█████████▏| 187/204 [00:02<00:00, 94.46it/s] 97%|█████████▋| 197/204 [00:02<00:00, 95.19it/s]100%|██████████| 204/204 [00:02<00:00, 73.20it/s]
26032 images processed, 2.8231360912323 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<01:06,  1.18it/s] 14%|█▍        | 11/79 [00:00<00:04, 15.36it/s] 24%|██▍       | 19/79 [00:01<00:02, 26.32it/s] 37%|███▋      | 29/79 [00:01<00:01, 40.34it/s] 49%|████▉     | 39/79 [00:01<00:00, 52.38it/s] 62%|██████▏   | 49/79 [00:01<00:00, 62.71it/s] 75%|███████▍  | 59/79 [00:01<00:00, 70.89it/s] 87%|████████▋ | 69/79 [00:01<00:00, 77.56it/s]100%|██████████| 79/79 [00:02<00:00, 22.24it/s]100%|██████████| 79/79 [00:02<00:00, 29.14it/s]
10000 images processed, 2.7318575382232666 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:54,  1.43it/s]  9%|▉         | 7/79 [00:00<00:06, 11.30it/s] 15%|█▌        | 12/79 [00:00<00:03, 18.80it/s] 24%|██▍       | 19/79 [00:01<00:02, 29.43it/s] 32%|███▏      | 25/79 [00:01<00:01, 35.64it/s] 42%|████▏     | 33/79 [00:01<00:01, 45.67it/s] 54%|█████▍    | 43/79 [00:01<00:00, 58.74it/s] 67%|██████▋   | 53/79 [00:01<00:00, 68.85it/s] 80%|███████▉  | 63/79 [00:01<00:00, 76.61it/s] 92%|█████████▏| 73/79 [00:01<00:00, 82.34it/s]100%|██████████| 79/79 [00:01<00:00, 46.44it/s]
10000 images processed, 1.719442367553711 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:37,  1.82it/s] 14%|█▍        | 10/70 [00:00<00:02, 20.02it/s] 29%|██▊       | 20/70 [00:00<00:01, 37.79it/s] 43%|████▎     | 30/70 [00:00<00:00, 52.31it/s] 57%|█████▋    | 40/70 [00:00<00:00, 63.78it/s] 71%|███████▏  | 50/70 [00:01<00:00, 72.73it/s] 86%|████████▌ | 60/70 [00:01<00:00, 79.39it/s]100%|██████████| 70/70 [00:01<00:00, 82.67it/s]100%|██████████| 70/70 [00:01<00:00, 54.61it/s]
8925 images processed, 1.3124239444732666 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:01<00:49,  1.14s/it]  4%|▍         | 2/45 [00:01<00:27,  1.55it/s] 27%|██▋       | 12/45 [00:01<00:02, 12.80it/s] 38%|███▊      | 17/45 [00:01<00:01, 16.13it/s] 47%|████▋     | 21/45 [00:01<00:01, 16.52it/s] 58%|█████▊    | 26/45 [00:02<00:00, 21.48it/s] 73%|███████▎  | 33/45 [00:02<00:00, 19.62it/s] 82%|████████▏ | 37/45 [00:02<00:00, 22.30it/s]100%|██████████| 45/45 [00:02<00:00, 16.94it/s]
5640 images processed, 2.6750025749206543 seconds used

19.434813499450684
/home/shaokun/anaconda3/envs/CILPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/CILPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           3.55  99.04  73.57
places365     49.40  89.47  51.32
LSUN          25.68  95.16  75.96
iSUN          25.80  95.00  73.65
dtd           24.45  94.42  71.69
AVG           25.78  94.62  69.23
[incremental] Overall: 0.8500 New: 0.8500 Old: nan
[incremental] Final(Top-1): 0.8500  Average: 0.8500
3.975959062576294
==== Stage 2: inc={66,67,88,94,57}; seen={0,8,11,40,51}; all(union)={0,8,9,10,11,22,40,42,44,51,57,58,59,64,66,67,88,90,93,94} ====
/home/shaokun/anaconda3/envs/CILPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/CILPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
/home/shaokun/PALM/main.py:61: FutureWarning: `torch.cuda.amp.GradScaler(args...)` is deprecated. Please use `torch.amp.GradScaler('cuda', args...)` instead.
  scaler = torch.cuda.amp.GradScaler()
Namespace(in_dataset='CIFAR-110', out_datasets=['inat', 'sun50', 'places50', 'dtd'], backbone='resnet34', method='top5-palm-cache6-ema0.999', seed=1, gpu='0', epochs=1, batch_size=128, lr=0.001, weight_decay=0.0001, print_every=50, fine_tune=False, temp=0.08, cosine=True, warm=False, lr_decay_epochs='700,800,900', lr_decay_rate=0.1, layers=100, depth=40, width=4, growth=12, droprate=0.0, save_path='CIFAR-10-ResNet18.pt', load_path='checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-upper-retain-c80.pt', reduce=0.5, score='mahalanobis', threshold=1.0, k=5, momentum=0.9, proto_m=0.999, cache_size=6, nviews=2, lambda_pcon=0.1, epsilon=0.05, palm_enable=True, palm_mle_mode='all', palm_retain_only=False, pcon_inc='split', incremental=True, use_lora=True, lora_impl='peft', lora_r=8, lora_alpha=32, lora_dropout=0.05, lora_target='both', adapter_save_path='checkpoints/CIFAR-110-resnet34-top5-palm-cache6-ema0.999-b128-e1-lr0.001-wd1e-4-ltboth-bfmnone-pcon0.1-lora_r8a32d0.05-temp0.08-ol1-continual-from-c80-to-CIFAR-110-palm_mle_all-pcon_split-stack/stage2', adapter_load_path='checkpoints/CIFAR-110-resnet34-top5-palm-cache6-ema0.999-b128-e1-lr0.001-wd1e-4-ltboth-bfmnone-pcon0.1-lora_r8a32d0.05-temp0.08-ol1-continual-from-c80-to-CIFAR-110-palm_mle_all-pcon_split-stack/stage1', lora_stack=False, lora_orth_enable=True, lora_orth_lambda=1.0, lora_orth_ref_paths='checkpoints/CIFAR-110-resnet34-top5-palm-cache6-ema0.999-b128-e1-lr0.001-wd1e-4-ltboth-bfmnone-pcon0.1-lora_r8a32d0.05-temp0.08-ol1-continual-from-c80-to-CIFAR-110-palm_mle_all-pcon_split-stack/stage1', forget_classes='0,8,9,10,11,22,40,42,44,51,57,58,59,64,66,67,88,90,93,94', forget_list_path=None, forget_classes_inc='66,67,88,94,57', forget_classes_seen='0,8,11,40,51', retain_exclude_csv=None, forget_csv=None, forget_lambda=0.0, forget_margin=100.0, forget_strategy='proto', centers_path=None, precision_path=None, batch_forget_mode='none', forget_proto_enable=False, forget_attr_w=1.0, forget_proto_rep_w=1.0, forget_avgproto_enable=False, forget_avgproto_w=1.0, umap_enable=False, umap_by='domain', umap_max_points=20000, umap_neighbors=15, umap_min_dist=0.05, umap_metric='cosine', umap_save_path=None, umap_rf_only=False, keep_cache=False, argument=True)
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-upper-retain-c80.pt
[peft] adapter loaded from checkpoints/CIFAR-110-resnet34-top5-palm-cache6-ema0.999-b128-e1-lr0.001-wd1e-4-ltboth-bfmnone-pcon0.1-lora_r8a32d0.05-temp0.08-ol1-continual-from-c80-to-CIFAR-110-palm_mle_all-pcon_split-stack/stage1
[peft] active adapters set to: default
resnet34-top5-palm-cache6-ema0.999: Number of model parameters: 21843904
[debug] trainable_count = 16
[debug] trainable: base_model.model.encoder.layer4.0.conv1.lora_A.default.weight
[debug] trainable: base_model.model.encoder.layer4.0.conv1.lora_B.default.weight
[debug] trainable: base_model.model.encoder.layer4.0.conv2.lora_A.default.weight
[debug] trainable: base_model.model.encoder.layer4.0.conv2.lora_B.default.weight
[debug] trainable: base_model.model.encoder.layer4.0.shortcut.0.lora_A.default.weight
[debug] trainable: base_model.model.encoder.layer4.0.shortcut.0.lora_B.default.weight
[debug] trainable: base_model.model.encoder.layer4.1.conv1.lora_A.default.weight
[debug] trainable: base_model.model.encoder.layer4.1.conv1.lora_B.default.weight
[debug] trainable: base_model.model.encoder.layer4.1.conv2.lora_A.default.weight
[debug] trainable: base_model.model.encoder.layer4.1.conv2.lora_B.default.weight
[debug] trainable: base_model.model.encoder.layer4.2.conv1.lora_A.default.weight
[debug] trainable: base_model.model.encoder.layer4.2.conv1.lora_B.default.weight
[debug] trainable: base_model.model.encoder.layer4.2.conv2.lora_A.default.weight
[debug] trainable: base_model.model.encoder.layer4.2.conv2.lora_B.default.weight
[debug] trainable: base_model.model.head.2.lora_A.default.weight
[debug] trainable: base_model.model.head.2.lora_B.default.weight
[debug][warn] non-LoRA trainables detected: ['base_model.model.encoder.layer4.0.conv1.lora_A.default.weight', 'base_model.model.encoder.layer4.0.conv1.lora_B.default.weight', 'base_model.model.encoder.layer4.0.conv2.lora_A.default.weight', 'base_model.model.encoder.layer4.0.conv2.lora_B.default.weight', 'base_model.model.encoder.layer4.0.shortcut.0.lora_A.default.weight', 'base_model.model.encoder.layer4.0.shortcut.0.lora_B.default.weight', 'base_model.model.encoder.layer4.1.conv1.lora_A.default.weight', 'base_model.model.encoder.layer4.1.conv1.lora_B.default.weight', 'base_model.model.encoder.layer4.1.conv2.lora_A.default.weight', 'base_model.model.encoder.layer4.1.conv2.lora_B.default.weight']
[trainable] param_count=238592 tensors=16
[incremental] resumed from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-upper-retain-c80.pt
  0%|          | 0/1 [00:00<?, ?it/s]/home/shaokun/PALM/trainer.py:167: FutureWarning: `torch.cuda.amp.autocast(args...)` is deprecated. Please use `torch.amp.autocast('cuda', args...)` instead.
  with torch.cuda.amp.autocast():
/home/shaokun/PALM/trainer.py:271: FutureWarning: `torch.cuda.amp.autocast(args...)` is deprecated. Please use `torch.amp.autocast('cuda', args...)` instead.
  with torch.cuda.amp.autocast(enabled=False):
100%|██████████| 1/1 [00:21<00:00, 21.30s/it]100%|██████████| 1/1 [00:21<00:00, 21.30s/it]
[loss] ep 0 it 0 total=5.9809 mle=4.0775 pcon=0.8978 forget=0.0000 orth=1.0056 favg=0.0000 nr=117 nf=5 protos=None fproto_sim=NA
[loss] ep 0 it 50 total=6.3370 mle=4.4333 pcon=0.8980 forget=0.0000 orth=1.0056 favg=0.0000 nr=118 nf=5 protos=None fproto_sim=NA
[loss] ep 0 it 100 total=6.4000 mle=4.4962 pcon=0.8983 forget=0.0000 orth=1.0056 favg=0.0000 nr=114 nf=9 protos=None fproto_sim=NA
[loss] ep 0 it 150 total=6.9516 mle=5.0476 pcon=0.8984 forget=0.0000 orth=1.0056 favg=0.0000 nr=118 nf=6 protos=None fproto_sim=NA
[loss] ep 0 it 200 total=5.6404 mle=3.7363 pcon=0.8985 forget=0.0000 orth=1.0056 favg=0.0000 nr=117 nf=1 protos=None fproto_sim=NA
[loss] ep 0 it 250 total=6.2340 mle=4.3298 pcon=0.8987 forget=0.0000 orth=1.0055 favg=0.0000 nr=116 nf=8 protos=None fproto_sim=NA
[loss] ep 0 it 300 total=5.8552 mle=3.9509 pcon=0.8988 forget=0.0000 orth=1.0055 favg=0.0000 nr=114 nf=6 protos=None fproto_sim=NA
[loss] ep 0 it 350 total=6.2799 mle=4.3756 pcon=0.8989 forget=0.0000 orth=1.0055 favg=0.0000 nr=110 nf=7 protos=None fproto_sim=NA
[loss] ep 0 it 400 total=6.2262 mle=4.3218 pcon=0.8989 forget=0.0000 orth=1.0054 favg=0.0000 nr=109 nf=8 protos=None fproto_sim=NA
[peft] adapter saved to checkpoints/CIFAR-110-resnet34-top5-palm-cache6-ema0.999-b128-e1-lr0.001-wd1e-4-ltboth-bfmnone-pcon0.1-lora_r8a32d0.05-temp0.08-ol1-continual-from-c80-to-CIFAR-110-palm_mle_all-pcon_split-stack/stage2
/home/shaokun/anaconda3/envs/CILPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/CILPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-upper-retain-c80.pt
[peft] adapter loaded from checkpoints/CIFAR-110-resnet34-top5-palm-cache6-ema0.999-b128-e1-lr0.001-wd1e-4-ltboth-bfmnone-pcon0.1-lora_r8a32d0.05-temp0.08-ol1-continual-from-c80-to-CIFAR-110-palm_mle_all-pcon_split-stack/stage2
[peft] active adapters set to: default
resnet34-top5-palm-cache6-ema0.999-b128-e1-lr0.001-wd1e-4-ltboth-bfmnone-pcon0.1-lora_r8a32d0.05-temp0.08-ol1-continual-from-c80-to-CIFAR-110-palm_mle_all-pcon_split-stage2-seen-inc: Number of model parameters: 21843904
Processing in-distribution CIFAR-110 images
  0%|          | 0/430 [00:00<?, ?it/s]  0%|          | 1/430 [00:01<11:16,  1.58s/it]  2%|▏         | 9/430 [00:01<00:58,  7.20it/s]  4%|▍         | 19/430 [00:01<00:24, 16.93it/s]  7%|▋         | 29/430 [00:01<00:14, 27.47it/s]  9%|▉         | 39/430 [00:02<00:10, 38.42it/s] 11%|█▏        | 49/430 [00:02<00:07, 48.95it/s] 14%|█▎        | 59/430 [00:02<00:06, 58.84it/s] 16%|█▌        | 69/430 [00:02<00:05, 67.30it/s] 18%|█▊        | 79/430 [00:02<00:04, 73.86it/s] 21%|██        | 89/430 [00:02<00:04, 79.49it/s] 23%|██▎       | 99/430 [00:02<00:03, 83.89it/s] 25%|██▌       | 109/430 [00:02<00:03, 87.19it/s] 28%|██▊       | 119/430 [00:02<00:03, 89.42it/s] 30%|███       | 129/430 [00:02<00:03, 90.64it/s] 32%|███▏      | 139/430 [00:03<00:03, 92.19it/s] 35%|███▍      | 149/430 [00:03<00:03, 93.00it/s] 37%|███▋      | 159/430 [00:03<00:02, 93.34it/s] 39%|███▉      | 169/430 [00:03<00:02, 93.90it/s] 42%|████▏     | 179/430 [00:03<00:02, 94.65it/s] 44%|████▍     | 189/430 [00:03<00:02, 95.29it/s] 46%|████▋     | 199/430 [00:03<00:02, 95.14it/s] 49%|████▊     | 209/430 [00:03<00:02, 95.33it/s] 51%|█████     | 219/430 [00:03<00:02, 95.21it/s] 53%|█████▎    | 229/430 [00:03<00:02, 95.27it/s] 56%|█████▌    | 239/430 [00:04<00:02, 95.44it/s] 58%|█████▊    | 249/430 [00:04<00:01, 95.21it/s] 60%|██████    | 259/430 [00:04<00:01, 95.48it/s] 63%|██████▎   | 269/430 [00:04<00:01, 94.80it/s] 65%|██████▍   | 279/430 [00:04<00:01, 95.14it/s] 67%|██████▋   | 289/430 [00:04<00:01, 95.38it/s] 70%|██████▉   | 299/430 [00:04<00:01, 94.67it/s] 72%|███████▏  | 309/430 [00:04<00:01, 94.88it/s] 74%|███████▍  | 319/430 [00:04<00:01, 94.96it/s] 77%|███████▋  | 329/430 [00:05<00:01, 95.20it/s] 79%|███████▉  | 339/430 [00:05<00:00, 95.61it/s] 81%|████████  | 349/430 [00:05<00:00, 95.55it/s] 83%|████████▎ | 359/430 [00:05<00:00, 95.84it/s] 86%|████████▌ | 369/430 [00:05<00:00, 95.88it/s] 88%|████████▊ | 379/430 [00:05<00:00, 95.84it/s] 90%|█████████ | 389/430 [00:05<00:00, 95.95it/s] 93%|█████████▎| 399/430 [00:05<00:00, 95.46it/s] 95%|█████████▌| 409/430 [00:05<00:00, 96.17it/s] 97%|█████████▋| 419/430 [00:06<00:00, 89.97it/s]100%|█████████▉| 429/430 [00:06<00:00, 84.66it/s]100%|██████████| 430/430 [00:06<00:00, 69.35it/s]
55000 images processed, 6.258606672286987 seconds used

Processing in-distribution CIFAR-110 images
  0%|          | 0/86 [00:00<?, ?it/s]  1%|          | 1/86 [00:00<00:37,  2.26it/s] 12%|█▏        | 10/86 [00:00<00:03, 23.30it/s] 23%|██▎       | 20/86 [00:00<00:01, 42.02it/s] 33%|███▎      | 28/86 [00:00<00:01, 50.42it/s] 42%|████▏     | 36/86 [00:00<00:00, 55.99it/s] 52%|█████▏    | 45/86 [00:00<00:00, 62.63it/s] 64%|██████▍   | 55/86 [00:01<00:00, 71.33it/s] 76%|███████▌  | 65/86 [00:01<00:00, 78.53it/s] 87%|████████▋ | 75/86 [00:01<00:00, 83.76it/s] 99%|█████████▉| 85/86 [00:01<00:00, 87.55it/s]100%|██████████| 86/86 [00:01<00:00, 60.00it/s]
11000 images processed, 1.4489903450012207 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:34,  2.16it/s]  5%|▍         | 10/204 [00:00<00:08, 22.35it/s] 10%|▉         | 20/204 [00:00<00:04, 40.57it/s] 15%|█▍        | 30/204 [00:00<00:03, 54.76it/s] 20%|█▉        | 40/204 [00:00<00:02, 65.24it/s] 25%|██▍       | 50/204 [00:01<00:02, 73.52it/s] 29%|██▉       | 60/204 [00:01<00:01, 79.59it/s] 34%|███▍      | 70/204 [00:01<00:01, 83.55it/s] 39%|███▉      | 80/204 [00:01<00:01, 86.19it/s] 44%|████▍     | 90/204 [00:01<00:01, 88.46it/s] 49%|████▉     | 100/204 [00:01<00:01, 90.27it/s] 54%|█████▍    | 110/204 [00:01<00:01, 85.10it/s] 58%|█████▊    | 119/204 [00:01<00:01, 82.90it/s] 63%|██████▎   | 129/204 [00:01<00:00, 85.48it/s] 68%|██████▊   | 139/204 [00:02<00:00, 87.99it/s] 73%|███████▎  | 149/204 [00:02<00:00, 89.58it/s] 78%|███████▊  | 159/204 [00:02<00:00, 90.93it/s] 83%|████████▎ | 169/204 [00:02<00:00, 91.19it/s] 88%|████████▊ | 179/204 [00:02<00:00, 92.10it/s] 93%|█████████▎| 189/204 [00:02<00:00, 93.46it/s] 98%|█████████▊| 199/204 [00:02<00:00, 94.43it/s]100%|██████████| 204/204 [00:02<00:00, 75.69it/s]
26032 images processed, 2.744586229324341 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<01:06,  1.17it/s] 11%|█▏        | 9/79 [00:00<00:05, 12.41it/s] 24%|██▍       | 19/79 [00:01<00:02, 26.99it/s] 37%|███▋      | 29/79 [00:01<00:01, 40.22it/s] 49%|████▉     | 39/79 [00:01<00:00, 52.37it/s] 62%|██████▏   | 49/79 [00:01<00:00, 62.54it/s] 75%|███████▍  | 59/79 [00:01<00:00, 70.98it/s] 87%|████████▋ | 69/79 [00:01<00:00, 62.27it/s] 97%|█████████▋| 77/79 [00:01<00:00, 61.75it/s]100%|██████████| 79/79 [00:01<00:00, 42.60it/s]
10000 images processed, 1.8821117877960205 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:43,  1.78it/s] 14%|█▍        | 11/79 [00:00<00:03, 21.33it/s] 27%|██▋       | 21/79 [00:00<00:01, 38.30it/s] 39%|███▉      | 31/79 [00:00<00:00, 52.32it/s] 52%|█████▏    | 41/79 [00:00<00:00, 63.47it/s] 65%|██████▍   | 51/79 [00:01<00:00, 72.10it/s] 77%|███████▋  | 61/79 [00:01<00:00, 78.89it/s] 90%|████████▉ | 71/79 [00:01<00:00, 83.99it/s]100%|██████████| 79/79 [00:01<00:00, 55.58it/s]
10000 images processed, 1.4903068542480469 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:32,  2.10it/s]  7%|▋         | 5/70 [00:00<00:06, 10.66it/s] 21%|██▏       | 15/70 [00:00<00:01, 31.76it/s] 36%|███▌      | 25/70 [00:00<00:00, 47.96it/s] 50%|█████     | 35/70 [00:00<00:00, 60.65it/s] 64%|██████▍   | 45/70 [00:01<00:00, 70.45it/s] 79%|███████▊  | 55/70 [00:01<00:00, 77.86it/s] 93%|█████████▎| 65/70 [00:01<00:00, 83.25it/s]100%|██████████| 70/70 [00:01<00:00, 54.72it/s]
8925 images processed, 1.3117940425872803 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:01<00:44,  1.00s/it] 16%|█▌        | 7/45 [00:01<00:04,  8.05it/s] 31%|███       | 14/45 [00:01<00:02, 15.32it/s] 40%|████      | 18/45 [00:01<00:01, 15.01it/s] 51%|█████     | 23/45 [00:01<00:01, 18.96it/s] 67%|██████▋   | 30/45 [00:01<00:00, 23.55it/s] 76%|███████▌  | 34/45 [00:02<00:00, 17.62it/s] 96%|█████████▌| 43/45 [00:02<00:00, 27.46it/s]100%|██████████| 45/45 [00:02<00:00, 18.28it/s]
5640 images processed, 2.4829344749450684 seconds used

19.359119415283203
/home/shaokun/anaconda3/envs/CILPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/CILPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           3.79  98.86  78.72
places365     52.74  85.08  47.05
LSUN          44.66  89.26  61.90
iSUN          35.83  91.28  65.27
dtd           32.80  92.10  73.34
AVG           33.96  91.32  65.25
[incremental] Overall: 0.7410 New: 0.7220 Old: 0.7600
[incremental] Final(Top-1): 0.7410  Average: 0.7955
3.3927218914031982
==== Stage 3: inc={59,58,44,93,10}; seen={0,8,11,40,51,66,67,88,94,57}; all(union)={0,8,9,10,11,22,40,42,44,51,57,58,59,64,66,67,88,90,93,94} ====
/home/shaokun/anaconda3/envs/CILPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/CILPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
/home/shaokun/PALM/main.py:61: FutureWarning: `torch.cuda.amp.GradScaler(args...)` is deprecated. Please use `torch.amp.GradScaler('cuda', args...)` instead.
  scaler = torch.cuda.amp.GradScaler()
Namespace(in_dataset='CIFAR-110', out_datasets=['inat', 'sun50', 'places50', 'dtd'], backbone='resnet34', method='top5-palm-cache6-ema0.999', seed=1, gpu='0', epochs=1, batch_size=128, lr=0.001, weight_decay=0.0001, print_every=50, fine_tune=False, temp=0.08, cosine=True, warm=False, lr_decay_epochs='700,800,900', lr_decay_rate=0.1, layers=100, depth=40, width=4, growth=12, droprate=0.0, save_path='CIFAR-10-ResNet18.pt', load_path='checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-upper-retain-c80.pt', reduce=0.5, score='mahalanobis', threshold=1.0, k=5, momentum=0.9, proto_m=0.999, cache_size=6, nviews=2, lambda_pcon=0.1, epsilon=0.05, palm_enable=True, palm_mle_mode='all', palm_retain_only=False, pcon_inc='split', incremental=True, use_lora=True, lora_impl='peft', lora_r=8, lora_alpha=32, lora_dropout=0.05, lora_target='both', adapter_save_path='checkpoints/CIFAR-110-resnet34-top5-palm-cache6-ema0.999-b128-e1-lr0.001-wd1e-4-ltboth-bfmnone-pcon0.1-lora_r8a32d0.05-temp0.08-ol1-continual-from-c80-to-CIFAR-110-palm_mle_all-pcon_split-stack/stage3', adapter_load_path='checkpoints/CIFAR-110-resnet34-top5-palm-cache6-ema0.999-b128-e1-lr0.001-wd1e-4-ltboth-bfmnone-pcon0.1-lora_r8a32d0.05-temp0.08-ol1-continual-from-c80-to-CIFAR-110-palm_mle_all-pcon_split-stack/stage2', lora_stack=False, lora_orth_enable=True, lora_orth_lambda=1.0, lora_orth_ref_paths='checkpoints/CIFAR-110-resnet34-top5-palm-cache6-ema0.999-b128-e1-lr0.001-wd1e-4-ltboth-bfmnone-pcon0.1-lora_r8a32d0.05-temp0.08-ol1-continual-from-c80-to-CIFAR-110-palm_mle_all-pcon_split-stack/stage1,checkpoints/CIFAR-110-resnet34-top5-palm-cache6-ema0.999-b128-e1-lr0.001-wd1e-4-ltboth-bfmnone-pcon0.1-lora_r8a32d0.05-temp0.08-ol1-continual-from-c80-to-CIFAR-110-palm_mle_all-pcon_split-stack/stage2', forget_classes='0,8,9,10,11,22,40,42,44,51,57,58,59,64,66,67,88,90,93,94', forget_list_path=None, forget_classes_inc='59,58,44,93,10', forget_classes_seen='0,8,11,40,51,66,67,88,94,57', retain_exclude_csv=None, forget_csv=None, forget_lambda=0.0, forget_margin=100.0, forget_strategy='proto', centers_path=None, precision_path=None, batch_forget_mode='none', forget_proto_enable=False, forget_attr_w=1.0, forget_proto_rep_w=1.0, forget_avgproto_enable=False, forget_avgproto_w=1.0, umap_enable=False, umap_by='domain', umap_max_points=20000, umap_neighbors=15, umap_min_dist=0.05, umap_metric='cosine', umap_save_path=None, umap_rf_only=False, keep_cache=False, argument=True)
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-upper-retain-c80.pt
[peft] adapter loaded from checkpoints/CIFAR-110-resnet34-top5-palm-cache6-ema0.999-b128-e1-lr0.001-wd1e-4-ltboth-bfmnone-pcon0.1-lora_r8a32d0.05-temp0.08-ol1-continual-from-c80-to-CIFAR-110-palm_mle_all-pcon_split-stack/stage2
[peft] active adapters set to: default
resnet34-top5-palm-cache6-ema0.999: Number of model parameters: 21843904
[debug] trainable_count = 16
[debug] trainable: base_model.model.encoder.layer4.0.conv1.lora_A.default.weight
[debug] trainable: base_model.model.encoder.layer4.0.conv1.lora_B.default.weight
[debug] trainable: base_model.model.encoder.layer4.0.conv2.lora_A.default.weight
[debug] trainable: base_model.model.encoder.layer4.0.conv2.lora_B.default.weight
[debug] trainable: base_model.model.encoder.layer4.0.shortcut.0.lora_A.default.weight
[debug] trainable: base_model.model.encoder.layer4.0.shortcut.0.lora_B.default.weight
[debug] trainable: base_model.model.encoder.layer4.1.conv1.lora_A.default.weight
[debug] trainable: base_model.model.encoder.layer4.1.conv1.lora_B.default.weight
[debug] trainable: base_model.model.encoder.layer4.1.conv2.lora_A.default.weight
[debug] trainable: base_model.model.encoder.layer4.1.conv2.lora_B.default.weight
[debug] trainable: base_model.model.encoder.layer4.2.conv1.lora_A.default.weight
[debug] trainable: base_model.model.encoder.layer4.2.conv1.lora_B.default.weight
[debug] trainable: base_model.model.encoder.layer4.2.conv2.lora_A.default.weight
[debug] trainable: base_model.model.encoder.layer4.2.conv2.lora_B.default.weight
[debug] trainable: base_model.model.head.2.lora_A.default.weight
[debug] trainable: base_model.model.head.2.lora_B.default.weight
[debug][warn] non-LoRA trainables detected: ['base_model.model.encoder.layer4.0.conv1.lora_A.default.weight', 'base_model.model.encoder.layer4.0.conv1.lora_B.default.weight', 'base_model.model.encoder.layer4.0.conv2.lora_A.default.weight', 'base_model.model.encoder.layer4.0.conv2.lora_B.default.weight', 'base_model.model.encoder.layer4.0.shortcut.0.lora_A.default.weight', 'base_model.model.encoder.layer4.0.shortcut.0.lora_B.default.weight', 'base_model.model.encoder.layer4.1.conv1.lora_A.default.weight', 'base_model.model.encoder.layer4.1.conv1.lora_B.default.weight', 'base_model.model.encoder.layer4.1.conv2.lora_A.default.weight', 'base_model.model.encoder.layer4.1.conv2.lora_B.default.weight']
[trainable] param_count=238592 tensors=16
[incremental] resumed from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-upper-retain-c80.pt
  0%|          | 0/1 [00:00<?, ?it/s]/home/shaokun/PALM/trainer.py:167: FutureWarning: `torch.cuda.amp.autocast(args...)` is deprecated. Please use `torch.amp.autocast('cuda', args...)` instead.
  with torch.cuda.amp.autocast():
/home/shaokun/PALM/trainer.py:271: FutureWarning: `torch.cuda.amp.autocast(args...)` is deprecated. Please use `torch.amp.autocast('cuda', args...)` instead.
  with torch.cuda.amp.autocast(enabled=False):
100%|██████████| 1/1 [00:18<00:00, 18.19s/it]100%|██████████| 1/1 [00:18<00:00, 18.20s/it]
[loss] ep 0 it 0 total=6.0454 mle=4.0714 pcon=0.9689 forget=0.0000 orth=1.0052 favg=0.0000 nr=112 nf=5 protos=None fproto_sim=NA
[loss] ep 0 it 50 total=6.3981 mle=4.4238 pcon=0.9691 forget=0.0000 orth=1.0052 favg=0.0000 nr=111 nf=7 protos=None fproto_sim=NA
[loss] ep 0 it 100 total=6.4635 mle=4.4890 pcon=0.9694 forget=0.0000 orth=1.0052 favg=0.0000 nr=109 nf=5 protos=None fproto_sim=NA
[loss] ep 0 it 150 total=7.0127 mle=5.0380 pcon=0.9696 forget=0.0000 orth=1.0051 favg=0.0000 nr=107 nf=11 protos=None fproto_sim=NA
[loss] ep 0 it 200 total=5.7034 mle=3.7286 pcon=0.9698 forget=0.0000 orth=1.0051 favg=0.0000 nr=109 nf=8 protos=None fproto_sim=NA
[loss] ep 0 it 250 total=6.2928 mle=4.3178 pcon=0.9699 forget=0.0000 orth=1.0051 favg=0.0000 nr=111 nf=5 protos=None fproto_sim=NA
[loss] ep 0 it 300 total=5.9135 mle=3.9384 pcon=0.9701 forget=0.0000 orth=1.0051 favg=0.0000 nr=107 nf=7 protos=None fproto_sim=NA
[loss] ep 0 it 350 total=6.3396 mle=4.3644 pcon=0.9701 forget=0.0000 orth=1.0050 favg=0.0000 nr=105 nf=5 protos=None fproto_sim=NA
[loss] ep 0 it 400 total=6.2795 mle=4.3043 pcon=0.9702 forget=0.0000 orth=1.0049 favg=0.0000 nr=106 nf=3 protos=None fproto_sim=NA
[peft] adapter saved to checkpoints/CIFAR-110-resnet34-top5-palm-cache6-ema0.999-b128-e1-lr0.001-wd1e-4-ltboth-bfmnone-pcon0.1-lora_r8a32d0.05-temp0.08-ol1-continual-from-c80-to-CIFAR-110-palm_mle_all-pcon_split-stack/stage3
/home/shaokun/anaconda3/envs/CILPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/CILPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-upper-retain-c80.pt
[peft] adapter loaded from checkpoints/CIFAR-110-resnet34-top5-palm-cache6-ema0.999-b128-e1-lr0.001-wd1e-4-ltboth-bfmnone-pcon0.1-lora_r8a32d0.05-temp0.08-ol1-continual-from-c80-to-CIFAR-110-palm_mle_all-pcon_split-stack/stage3
[peft] active adapters set to: default
resnet34-top5-palm-cache6-ema0.999-b128-e1-lr0.001-wd1e-4-ltboth-bfmnone-pcon0.1-lora_r8a32d0.05-temp0.08-ol1-continual-from-c80-to-CIFAR-110-palm_mle_all-pcon_split-stage3-seen-inc: Number of model parameters: 21843904
Processing in-distribution CIFAR-110 images
  0%|          | 0/430 [00:00<?, ?it/s]  0%|          | 1/430 [00:00<03:46,  1.89it/s]  3%|▎         | 11/430 [00:00<00:18, 22.44it/s]  5%|▍         | 21/430 [00:00<00:10, 39.71it/s]  7%|▋         | 31/430 [00:00<00:07, 53.71it/s] 10%|▉         | 41/430 [00:00<00:06, 64.14it/s] 12%|█▏        | 51/430 [00:01<00:05, 71.29it/s] 14%|█▍        | 61/430 [00:01<00:04, 77.42it/s] 17%|█▋        | 71/430 [00:01<00:04, 82.27it/s] 19%|█▉        | 81/430 [00:01<00:04, 86.04it/s] 21%|██        | 91/430 [00:01<00:03, 88.90it/s] 23%|██▎       | 101/430 [00:01<00:03, 90.91it/s] 26%|██▌       | 111/430 [00:01<00:03, 91.78it/s] 28%|██▊       | 121/430 [00:01<00:03, 92.60it/s] 30%|███       | 131/430 [00:01<00:03, 93.19it/s] 33%|███▎      | 141/430 [00:02<00:03, 93.86it/s] 35%|███▌      | 151/430 [00:02<00:02, 94.20it/s] 37%|███▋      | 161/430 [00:02<00:02, 94.57it/s] 40%|███▉      | 171/430 [00:02<00:02, 94.71it/s] 42%|████▏     | 181/430 [00:02<00:02, 94.80it/s] 44%|████▍     | 191/430 [00:02<00:02, 94.02it/s] 47%|████▋     | 201/430 [00:02<00:02, 94.42it/s] 49%|████▉     | 211/430 [00:02<00:02, 94.62it/s] 51%|█████▏    | 221/430 [00:02<00:02, 94.80it/s] 54%|█████▎    | 231/430 [00:02<00:02, 94.81it/s] 56%|█████▌    | 241/430 [00:03<00:01, 95.10it/s] 58%|█████▊    | 251/430 [00:03<00:01, 94.75it/s] 61%|██████    | 261/430 [00:03<00:01, 94.79it/s] 63%|██████▎   | 271/430 [00:03<00:01, 93.72it/s] 65%|██████▌   | 281/430 [00:03<00:01, 94.17it/s] 68%|██████▊   | 291/430 [00:03<00:01, 94.36it/s] 70%|███████   | 301/430 [00:03<00:01, 94.56it/s] 72%|███████▏  | 311/430 [00:03<00:01, 93.55it/s] 75%|███████▍  | 321/430 [00:03<00:01, 93.39it/s] 77%|███████▋  | 331/430 [00:04<00:01, 93.39it/s] 79%|███████▉  | 341/430 [00:04<00:00, 93.77it/s] 82%|████████▏ | 351/430 [00:04<00:00, 93.82it/s] 84%|████████▍ | 361/430 [00:04<00:00, 94.36it/s] 86%|████████▋ | 371/430 [00:04<00:00, 93.32it/s] 89%|████████▊ | 381/430 [00:04<00:00, 91.78it/s] 91%|█████████ | 391/430 [00:04<00:00, 92.73it/s] 93%|█████████▎| 401/430 [00:04<00:00, 92.44it/s] 96%|█████████▌| 411/430 [00:04<00:00, 93.83it/s] 98%|█████████▊| 421/430 [00:04<00:00, 94.94it/s]100%|██████████| 430/430 [00:05<00:00, 84.36it/s]
55000 images processed, 5.16711950302124 seconds used

Processing in-distribution CIFAR-110 images
  0%|          | 0/86 [00:00<?, ?it/s]  1%|          | 1/86 [00:00<00:45,  1.87it/s] 13%|█▎        | 11/86 [00:00<00:03, 22.20it/s] 23%|██▎       | 20/86 [00:00<00:01, 37.66it/s] 35%|███▍      | 30/86 [00:00<00:01, 52.19it/s] 47%|████▋     | 40/86 [00:00<00:00, 62.94it/s] 58%|█████▊    | 50/86 [00:01<00:00, 71.51it/s] 70%|██████▉   | 60/86 [00:01<00:00, 78.13it/s] 81%|████████▏ | 70/86 [00:01<00:00, 83.23it/s] 93%|█████████▎| 80/86 [00:01<00:00, 87.09it/s]100%|██████████| 86/86 [00:01<00:00, 59.42it/s]
11000 images processed, 1.4646928310394287 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:57,  1.73it/s]  5%|▌         | 11/204 [00:00<00:09, 20.74it/s] 10%|█         | 21/204 [00:00<00:04, 37.41it/s] 15%|█▌        | 31/204 [00:00<00:03, 51.30it/s] 20%|██        | 41/204 [00:01<00:02, 62.44it/s] 25%|██▌       | 51/204 [00:01<00:02, 70.96it/s] 30%|██▉       | 61/204 [00:01<00:01, 76.82it/s] 35%|███▍      | 71/204 [00:01<00:01, 81.36it/s] 40%|███▉      | 81/204 [00:01<00:01, 84.87it/s] 45%|████▍     | 91/204 [00:01<00:01, 87.59it/s] 50%|████▉     | 101/204 [00:01<00:01, 89.39it/s] 54%|█████▍    | 111/204 [00:01<00:01, 90.59it/s] 59%|█████▉    | 121/204 [00:01<00:00, 91.42it/s] 64%|██████▍   | 131/204 [00:01<00:00, 91.76it/s] 69%|██████▉   | 141/204 [00:02<00:00, 90.73it/s] 74%|███████▍  | 151/204 [00:02<00:00, 90.89it/s] 79%|███████▉  | 161/204 [00:02<00:00, 91.46it/s] 84%|████████▍ | 171/204 [00:02<00:00, 90.70it/s] 89%|████████▊ | 181/204 [00:02<00:00, 92.05it/s] 94%|█████████▎| 191/204 [00:02<00:00, 93.25it/s] 99%|█████████▊| 201/204 [00:02<00:00, 94.18it/s]100%|██████████| 204/204 [00:02<00:00, 73.73it/s]
26032 images processed, 2.808706760406494 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:01<01:18,  1.00s/it] 14%|█▍        | 11/79 [00:01<00:05, 13.28it/s] 23%|██▎       | 18/79 [00:01<00:02, 21.55it/s] 32%|███▏      | 25/79 [00:01<00:02, 24.23it/s] 44%|████▍     | 35/79 [00:01<00:01, 36.60it/s] 57%|█████▋    | 45/79 [00:01<00:00, 48.14it/s] 70%|██████▉   | 55/79 [00:01<00:00, 58.48it/s] 82%|████████▏ | 65/79 [00:01<00:00, 67.29it/s] 95%|█████████▍| 75/79 [00:01<00:00, 74.58it/s]100%|██████████| 79/79 [00:02<00:00, 38.64it/s]
10000 images processed, 2.0698776245117188 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:37,  2.10it/s] 14%|█▍        | 11/79 [00:00<00:02, 24.46it/s] 25%|██▌       | 20/79 [00:00<00:01, 40.18it/s] 38%|███▊      | 30/79 [00:00<00:00, 54.60it/s] 51%|█████     | 40/79 [00:00<00:00, 65.73it/s] 63%|██████▎   | 50/79 [00:01<00:00, 73.94it/s] 76%|███████▌  | 60/79 [00:01<00:00, 80.43it/s] 89%|████████▊ | 70/79 [00:01<00:00, 85.16it/s]100%|██████████| 79/79 [00:01<00:00, 60.98it/s]
10000 images processed, 1.3175537586212158 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:42,  1.62it/s]  9%|▊         | 6/70 [00:00<00:06, 10.61it/s] 23%|██▎       | 16/70 [00:00<00:01, 29.09it/s] 37%|███▋      | 26/70 [00:00<00:00, 44.82it/s] 51%|█████▏    | 36/70 [00:01<00:00, 57.57it/s] 66%|██████▌   | 46/70 [00:01<00:00, 67.73it/s] 80%|████████  | 56/70 [00:01<00:00, 75.66it/s] 94%|█████████▍| 66/70 [00:01<00:00, 81.57it/s]100%|██████████| 70/70 [00:01<00:00, 50.12it/s]
8925 images processed, 1.426448106765747 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:01<00:48,  1.10s/it]  4%|▍         | 2/45 [00:01<00:24,  1.79it/s] 27%|██▋       | 12/45 [00:01<00:02, 14.43it/s] 38%|███▊      | 17/45 [00:01<00:01, 15.38it/s] 47%|████▋     | 21/45 [00:01<00:01, 17.12it/s] 53%|█████▎    | 24/45 [00:02<00:01, 16.90it/s] 73%|███████▎  | 33/45 [00:02<00:00, 21.25it/s] 80%|████████  | 36/45 [00:02<00:00, 15.18it/s]100%|██████████| 45/45 [00:02<00:00, 24.51it/s]100%|██████████| 45/45 [00:02<00:00, 15.56it/s]
5640 images processed, 2.9110114574432373 seconds used

18.971018075942993
