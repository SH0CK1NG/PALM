nohup: ignoring input
Namespace(in_dataset='CIFAR-100', out_datasets=['inat', 'sun50', 'places50', 'dtd'], backbone='resnet34', method='top5-palm-cache6-ema0.999', seed=1, gpu='0', epochs=100, batch_size=512, lr=0.5, weight_decay=1e-06, print_every=50, fine_tune=False, temp=0.1, cosine=True, warm=True, lr_decay_epochs='700,800,900', lr_decay_rate=0.1, layers=100, depth=40, width=4, growth=12, droprate=0.0, save_path='CIFAR-10-ResNet18.pt', load_path='/home/shaokun/PALM/checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt', reduce=0.5, score='mahalanobis', threshold=1.0, k=5, momentum=0.9, proto_m=0.999, cache_size=6, nviews=2, lambda_pcon=1.0, epsilon=0.05, incremental=False, use_lora=True, lora_r=8, lora_alpha=32, lora_dropout=0.05, lora_target='encoder', adapter_save_path='checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-retain_0.1_0to9.projector_adapter.pt', adapter_load_path=None, forget_classes='0,1,2,3,4,5,6,7,8,9', forget_list_path=None, forget_center_set='retain', forget_lambda=0.1, centers_path='cache/resnet34-top5-palm-cache6-ema0.999/CIFAR-100/class_centers.pt', precision_path='cache/resnet34-top5-palm-cache6-ema0.999/CIFAR-100/precision.pt', batch_forget_mode='balanced', argument=True, warmup_from=0.01, warm_epochs=10, warmup_to=0.4877763649447146)
Files already downloaded and verified
resnet34-top5-palm-cache6-ema0.999: Number of model parameters: 21652416
  0%|          | 0/100 [00:00<?, ?it/s]  0%|          | 0/100 [00:01<?, ?it/s]
Traceback (most recent call last):
  File "/home/shaokun/PALM/main.py", line 138, in <module>
    main()
  File "/home/shaokun/PALM/main.py", line 69, in main
    loss = trainer(args, train_loader, model, criterion, optimizer, epoch, scaler=scaler)
  File "/home/shaokun/PALM/trainer.py", line 76, in train_palm
    f_perm = f_idx[torch.randperm(len(f_idx), generator=g)[:k]]
RuntimeError: Expected a 'cpu' device type for generator but found 'cuda'
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from /home/shaokun/PALM/checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[lora] loaded 2 LoRA tensors from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-retain_0.1_0to9.projector_adapter.pt
resnet34-top5-palm-cache6-ema0.999-ltencoder-bfmbalanced-fcsretain-fl0.1-lora_r8a32d0.05: Number of model parameters: 21610432
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<01:03,  6.10it/s]  3%|▎         | 12/391 [00:00<00:06, 54.15it/s]  6%|▌         | 22/391 [00:00<00:05, 68.92it/s]  9%|▊         | 34/391 [00:00<00:04, 85.61it/s] 12%|█▏        | 46/391 [00:00<00:03, 95.89it/s] 15%|█▍        | 58/391 [00:00<00:03, 102.46it/s] 18%|█▊        | 70/391 [00:00<00:03, 106.71it/s] 21%|██        | 82/391 [00:00<00:02, 109.19it/s] 24%|██▍       | 94/391 [00:01<00:02, 110.87it/s] 27%|██▋       | 106/391 [00:01<00:02, 112.04it/s] 30%|███       | 118/391 [00:01<00:02, 112.82it/s] 33%|███▎      | 130/391 [00:01<00:02, 112.99it/s] 36%|███▋      | 142/391 [00:01<00:02, 113.18it/s] 39%|███▉      | 154/391 [00:01<00:02, 113.31it/s] 42%|████▏     | 166/391 [00:01<00:01, 113.24it/s] 46%|████▌     | 178/391 [00:01<00:01, 113.34it/s] 49%|████▊     | 190/391 [00:01<00:01, 113.48it/s] 52%|█████▏    | 202/391 [00:01<00:01, 113.43it/s] 55%|█████▍    | 214/391 [00:02<00:01, 113.41it/s] 58%|█████▊    | 226/391 [00:02<00:01, 113.61it/s] 61%|██████    | 238/391 [00:02<00:01, 113.74it/s] 64%|██████▍   | 250/391 [00:02<00:01, 113.80it/s] 67%|██████▋   | 262/391 [00:02<00:01, 113.84it/s] 70%|███████   | 274/391 [00:02<00:01, 113.94it/s] 73%|███████▎  | 286/391 [00:02<00:00, 113.77it/s] 76%|███████▌  | 298/391 [00:02<00:00, 113.88it/s] 79%|███████▉  | 310/391 [00:02<00:00, 113.65it/s] 82%|████████▏ | 322/391 [00:03<00:00, 113.39it/s] 85%|████████▌ | 334/391 [00:03<00:00, 113.45it/s] 88%|████████▊ | 346/391 [00:03<00:00, 113.70it/s] 92%|█████████▏| 358/391 [00:03<00:00, 113.73it/s] 95%|█████████▍| 370/391 [00:03<00:00, 113.89it/s] 98%|█████████▊| 382/391 [00:03<00:00, 113.91it/s]100%|██████████| 391/391 [00:03<00:00, 107.05it/s]
50000 images processed, 3.724736213684082 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  4%|▍         | 3/79 [00:00<00:02, 26.49it/s] 14%|█▍        | 11/79 [00:00<00:01, 56.24it/s] 29%|██▉       | 23/79 [00:00<00:00, 82.18it/s] 44%|████▍     | 35/79 [00:00<00:00, 94.19it/s] 59%|█████▉    | 47/79 [00:00<00:00, 101.08it/s] 75%|███████▍  | 59/79 [00:00<00:00, 105.04it/s] 90%|████████▉ | 71/79 [00:00<00:00, 107.52it/s]100%|██████████| 79/79 [00:01<00:00, 70.34it/s] 
10000 images processed, 1.1727371215820312 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<00:22,  8.85it/s]  6%|▌         | 12/204 [00:00<00:03, 62.58it/s] 11%|█▏        | 23/204 [00:00<00:02, 82.13it/s] 17%|█▋        | 35/204 [00:00<00:01, 93.64it/s] 23%|██▎       | 47/204 [00:00<00:01, 100.34it/s] 29%|██▉       | 59/204 [00:00<00:01, 104.64it/s] 35%|███▍      | 71/204 [00:00<00:01, 106.99it/s] 41%|████      | 83/204 [00:00<00:01, 108.81it/s] 47%|████▋     | 95/204 [00:00<00:00, 110.25it/s] 52%|█████▏    | 107/204 [00:01<00:00, 111.14it/s] 58%|█████▊    | 119/204 [00:01<00:00, 111.84it/s] 64%|██████▍   | 131/204 [00:01<00:00, 112.30it/s] 70%|███████   | 143/204 [00:01<00:00, 112.61it/s] 76%|███████▌  | 155/204 [00:01<00:00, 112.84it/s] 82%|████████▏ | 167/204 [00:01<00:00, 113.03it/s] 88%|████████▊ | 179/204 [00:01<00:00, 113.07it/s] 94%|█████████▎| 191/204 [00:01<00:00, 112.91it/s]100%|█████████▉| 203/204 [00:01<00:00, 113.09it/s]100%|██████████| 204/204 [00:01<00:00, 102.81it/s]
26032 images processed, 2.019758462905884 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:18,  4.12it/s]  6%|▋         | 5/79 [00:00<00:04, 15.61it/s] 11%|█▏        | 9/79 [00:00<00:03, 21.04it/s] 16%|█▋        | 13/79 [00:00<00:02, 24.14it/s] 22%|██▏       | 17/79 [00:00<00:02, 26.15it/s] 27%|██▋       | 21/79 [00:00<00:02, 27.44it/s] 32%|███▏      | 25/79 [00:01<00:01, 28.21it/s] 37%|███▋      | 29/79 [00:01<00:01, 28.75it/s] 42%|████▏     | 33/79 [00:01<00:01, 29.19it/s] 47%|████▋     | 37/79 [00:01<00:01, 29.32it/s] 52%|█████▏    | 41/79 [00:01<00:01, 29.82it/s] 57%|█████▋    | 45/79 [00:01<00:01, 29.97it/s] 62%|██████▏   | 49/79 [00:01<00:00, 30.21it/s] 67%|██████▋   | 53/79 [00:01<00:00, 30.33it/s] 72%|███████▏  | 57/79 [00:02<00:00, 30.15it/s] 77%|███████▋  | 61/79 [00:02<00:00, 30.25it/s] 82%|████████▏ | 65/79 [00:02<00:00, 30.47it/s] 87%|████████▋ | 69/79 [00:02<00:00, 30.51it/s] 92%|█████████▏| 73/79 [00:02<00:00, 30.54it/s] 97%|█████████▋| 77/79 [00:02<00:00, 30.45it/s]100%|██████████| 79/79 [00:02<00:00, 28.02it/s]
10000 images processed, 2.859076738357544 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:08,  9.52it/s] 13%|█▎        | 10/79 [00:00<00:01, 55.63it/s] 27%|██▋       | 21/79 [00:00<00:00, 79.91it/s] 41%|████      | 32/79 [00:00<00:00, 91.14it/s] 56%|█████▌    | 44/79 [00:00<00:00, 98.88it/s] 71%|███████   | 56/79 [00:00<00:00, 104.01it/s] 86%|████████▌ | 68/79 [00:00<00:00, 107.13it/s]100%|██████████| 79/79 [00:00<00:00, 91.93it/s] 
10000 images processed, 0.8761343955993652 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:07,  9.70it/s] 13%|█▎        | 9/70 [00:00<00:01, 48.77it/s] 29%|██▊       | 20/70 [00:00<00:00, 73.78it/s] 44%|████▍     | 31/70 [00:00<00:00, 87.16it/s] 60%|██████    | 42/70 [00:00<00:00, 95.02it/s] 76%|███████▌  | 53/70 [00:00<00:00, 99.80it/s] 91%|█████████▏| 64/70 [00:00<00:00, 103.01it/s]100%|██████████| 70/70 [00:00<00:00, 85.54it/s] 
8925 images processed, 0.8357152938842773 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:00<00:23,  1.91it/s]  4%|▍         | 2/45 [00:00<00:12,  3.44it/s] 11%|█         | 5/45 [00:00<00:05,  6.84it/s] 13%|█▎        | 6/45 [00:01<00:06,  6.32it/s] 20%|██        | 9/45 [00:01<00:03,  9.56it/s] 24%|██▍       | 11/45 [00:01<00:03,  8.58it/s] 29%|██▉       | 13/45 [00:01<00:03, 10.40it/s] 33%|███▎      | 15/45 [00:02<00:04,  6.84it/s] 40%|████      | 18/45 [00:02<00:03,  7.09it/s] 47%|████▋     | 21/45 [00:02<00:02,  9.41it/s] 51%|█████     | 23/45 [00:03<00:02,  8.12it/s] 58%|█████▊    | 26/45 [00:03<00:02,  7.64it/s] 67%|██████▋   | 30/45 [00:03<00:01,  7.84it/s] 73%|███████▎  | 33/45 [00:04<00:01,  9.21it/s] 78%|███████▊  | 35/45 [00:04<00:01,  7.71it/s] 84%|████████▍ | 38/45 [00:04<00:00,  8.62it/s] 93%|█████████▎| 42/45 [00:05<00:00,  7.65it/s]100%|██████████| 45/45 [00:05<00:00,  8.07it/s]
5640 images processed, 5.593705415725708 seconds used

18.24129056930542
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
Evaluating forget
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.15  99.49
places365     70.01  80.31
LSUN          17.24  96.38
iSUN          73.12  82.24
dtd           32.20  93.12
forget        95.70  47.22
AVG           48.40  83.13
Forget-Acc: 0.7530 | Retain-Acc: 0.7433
Forget-as-OOD (retain known vs forget novel):
  FPR: 95.70 AUROC: 47.22 AUIN: 88.80
4.199481248855591
