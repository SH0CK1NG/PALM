[re-eval] manifest: evaluation_results/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-fullgrid_runs.csv
[re-eval] forget_csv: 0,8,11,40,51,66,67,88,94,57 | score: mahalanobis
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid
epochs=5 | cache=6 | flambda=1.0 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21843904
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<02:09,  3.01it/s]  2%|▏         | 8/391 [00:00<00:17, 22.50it/s]  4%|▍         | 16/391 [00:00<00:09, 38.78it/s]  7%|▋         | 26/391 [00:00<00:06, 55.83it/s]  9%|▉         | 36/391 [00:00<00:05, 67.58it/s] 12%|█▏        | 46/391 [00:00<00:04, 75.87it/s] 14%|█▍        | 56/391 [00:00<00:04, 81.76it/s] 17%|█▋        | 66/391 [00:01<00:03, 85.79it/s] 19%|█▉        | 76/391 [00:01<00:03, 88.50it/s] 22%|██▏       | 86/391 [00:01<00:03, 90.47it/s] 25%|██▍       | 96/391 [00:01<00:03, 91.72it/s] 27%|██▋       | 106/391 [00:01<00:03, 92.68it/s] 30%|██▉       | 116/391 [00:01<00:02, 93.49it/s] 32%|███▏      | 126/391 [00:01<00:02, 93.83it/s] 35%|███▍      | 136/391 [00:01<00:02, 94.01it/s] 37%|███▋      | 146/391 [00:01<00:02, 94.32it/s] 40%|███▉      | 156/391 [00:02<00:02, 92.31it/s] 42%|████▏     | 166/391 [00:02<00:02, 92.15it/s] 45%|████▌     | 176/391 [00:02<00:02, 93.06it/s] 48%|████▊     | 186/391 [00:02<00:02, 93.65it/s] 50%|█████     | 196/391 [00:02<00:02, 94.06it/s] 53%|█████▎    | 206/391 [00:02<00:01, 94.43it/s] 55%|█████▌    | 216/391 [00:02<00:01, 94.93it/s] 58%|█████▊    | 226/391 [00:02<00:01, 94.88it/s] 60%|██████    | 236/391 [00:02<00:01, 95.16it/s] 63%|██████▎   | 246/391 [00:02<00:01, 95.36it/s] 65%|██████▌   | 256/391 [00:03<00:01, 95.28it/s] 68%|██████▊   | 266/391 [00:03<00:01, 95.18it/s] 71%|███████   | 276/391 [00:03<00:01, 94.87it/s] 73%|███████▎  | 286/391 [00:03<00:01, 94.84it/s] 76%|███████▌  | 296/391 [00:03<00:01, 94.53it/s] 78%|███████▊  | 306/391 [00:03<00:00, 93.47it/s] 81%|████████  | 316/391 [00:03<00:00, 92.54it/s] 83%|████████▎ | 326/391 [00:03<00:00, 93.08it/s] 86%|████████▌ | 336/391 [00:03<00:00, 92.62it/s] 88%|████████▊ | 346/391 [00:04<00:00, 92.80it/s] 91%|█████████ | 356/391 [00:04<00:00, 93.00it/s] 94%|█████████▎| 366/391 [00:04<00:00, 93.00it/s] 96%|█████████▌| 376/391 [00:04<00:00, 93.06it/s] 99%|█████████▊| 386/391 [00:04<00:00, 94.28it/s]100%|██████████| 391/391 [00:04<00:00, 86.14it/s]
50000 images processed, 4.62454628944397 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:22,  3.39it/s] 14%|█▍        | 11/79 [00:00<00:01, 34.32it/s] 27%|██▋       | 21/79 [00:00<00:01, 53.22it/s] 38%|███▊      | 30/79 [00:00<00:00, 64.17it/s] 51%|█████     | 40/79 [00:00<00:00, 73.23it/s] 63%|██████▎   | 50/79 [00:00<00:00, 78.98it/s] 76%|███████▌  | 60/79 [00:00<00:00, 83.32it/s] 89%|████████▊ | 70/79 [00:01<00:00, 86.96it/s]100%|██████████| 79/79 [00:01<00:00, 69.33it/s]
10000 images processed, 1.160301923751831 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<00:56,  3.59it/s]  5%|▍         | 10/204 [00:00<00:06, 32.01it/s] 10%|▉         | 20/204 [00:00<00:03, 52.36it/s] 15%|█▍        | 30/204 [00:00<00:02, 65.13it/s] 20%|█▉        | 40/204 [00:00<00:02, 73.61it/s] 25%|██▍       | 50/204 [00:00<00:01, 79.17it/s] 29%|██▉       | 60/204 [00:00<00:01, 83.58it/s] 34%|███▍      | 70/204 [00:01<00:01, 86.73it/s] 39%|███▉      | 80/204 [00:01<00:01, 88.96it/s] 44%|████▍     | 90/204 [00:01<00:01, 90.24it/s] 49%|████▉     | 100/204 [00:01<00:01, 90.85it/s] 54%|█████▍    | 110/204 [00:01<00:01, 90.92it/s] 59%|█████▉    | 120/204 [00:01<00:00, 91.50it/s] 64%|██████▎   | 130/204 [00:01<00:00, 91.82it/s] 69%|██████▊   | 140/204 [00:01<00:00, 92.45it/s] 74%|███████▎  | 150/204 [00:01<00:00, 92.79it/s] 78%|███████▊  | 160/204 [00:02<00:00, 92.74it/s] 83%|████████▎ | 170/204 [00:02<00:00, 92.98it/s] 88%|████████▊ | 180/204 [00:02<00:00, 92.84it/s] 93%|█████████▎| 190/204 [00:02<00:00, 92.50it/s] 98%|█████████▊| 200/204 [00:02<00:00, 91.03it/s]100%|██████████| 204/204 [00:02<00:00, 81.38it/s]
26032 images processed, 2.5520105361938477 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:39,  2.00it/s] 11%|█▏        | 9/79 [00:00<00:04, 16.93it/s] 22%|██▏       | 17/79 [00:00<00:02, 27.80it/s] 32%|███▏      | 25/79 [00:00<00:01, 35.56it/s] 42%|████▏     | 33/79 [00:01<00:01, 40.84it/s] 52%|█████▏    | 41/79 [00:01<00:00, 44.71it/s] 62%|██████▏   | 49/79 [00:01<00:00, 47.50it/s] 71%|███████   | 56/79 [00:01<00:00, 51.56it/s] 78%|███████▊  | 62/79 [00:01<00:00, 48.48it/s] 86%|████████▌ | 68/79 [00:01<00:00, 46.57it/s] 96%|█████████▌| 76/79 [00:01<00:00, 48.39it/s]100%|██████████| 79/79 [00:01<00:00, 39.94it/s]
10000 images processed, 2.011457681655884 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:27,  2.82it/s] 14%|█▍        | 11/79 [00:00<00:02, 30.28it/s] 27%|██▋       | 21/79 [00:00<00:01, 49.62it/s] 39%|███▉      | 31/79 [00:00<00:00, 63.20it/s] 52%|█████▏    | 41/79 [00:00<00:00, 72.28it/s] 65%|██████▍   | 51/79 [00:00<00:00, 78.42it/s] 77%|███████▋  | 61/79 [00:00<00:00, 82.95it/s] 90%|████████▉ | 71/79 [00:01<00:00, 86.26it/s]100%|██████████| 79/79 [00:01<00:00, 66.92it/s]
10000 images processed, 1.2089240550994873 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:33,  2.05it/s] 16%|█▌        | 11/70 [00:00<00:02, 23.76it/s] 30%|███       | 21/70 [00:00<00:01, 41.59it/s] 44%|████▍     | 31/70 [00:00<00:00, 55.67it/s] 59%|█████▊    | 41/70 [00:00<00:00, 66.42it/s] 73%|███████▎  | 51/70 [00:01<00:00, 74.53it/s] 87%|████████▋ | 61/70 [00:01<00:00, 80.65it/s]100%|██████████| 70/70 [00:01<00:00, 57.18it/s]
8925 images processed, 1.2619123458862305 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:00<00:43,  1.01it/s]  4%|▍         | 2/45 [00:01<00:20,  2.06it/s] 20%|██        | 9/45 [00:01<00:04,  8.95it/s] 24%|██▍       | 11/45 [00:01<00:03,  8.61it/s] 38%|███▊      | 17/45 [00:02<00:02, 11.89it/s] 42%|████▏     | 19/45 [00:02<00:02, 11.36it/s] 49%|████▉     | 22/45 [00:02<00:01, 13.47it/s] 56%|█████▌    | 25/45 [00:02<00:01, 13.38it/s] 60%|██████    | 27/45 [00:02<00:01, 12.04it/s] 67%|██████▋   | 30/45 [00:03<00:01, 13.40it/s] 73%|███████▎  | 33/45 [00:03<00:01, 11.34it/s] 78%|███████▊  | 35/45 [00:03<00:00, 10.16it/s] 91%|█████████ | 41/45 [00:03<00:00, 14.42it/s] 96%|█████████▌| 43/45 [00:04<00:00, 10.43it/s]100%|██████████| 45/45 [00:04<00:00, 10.45it/s]
5640 images processed, 4.326473712921143 seconds used

18.920812606811523
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.53  99.36
places365     67.96  81.19
LSUN          17.51  96.09
iSUN          72.25  81.77
dtd           37.91  91.39
AVG           39.63  89.96
Retain-Acc: 0.7406
Forget-as-OOD (retain known vs forget novel):
  FPR: 79.50 AUROC: 86.90 AUIN: 98.36
17.461601734161377
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e10-lr0.001-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid
epochs=10 | cache=6 | flambda=1.0 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e10-lr0.001-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e10-lr0.001-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e10-lr0.001-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21843904
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<02:44,  2.38it/s]  3%|▎         | 11/391 [00:00<00:14, 26.70it/s]  5%|▌         | 21/391 [00:00<00:08, 44.73it/s]  8%|▊         | 31/391 [00:00<00:06, 58.05it/s] 10%|█         | 41/391 [00:00<00:05, 67.97it/s] 13%|█▎        | 51/391 [00:00<00:04, 74.36it/s] 16%|█▌        | 61/391 [00:01<00:04, 79.52it/s] 18%|█▊        | 71/391 [00:01<00:03, 83.24it/s] 21%|██        | 81/391 [00:01<00:03, 86.34it/s] 23%|██▎       | 91/391 [00:01<00:03, 88.52it/s] 26%|██▌       | 101/391 [00:01<00:03, 89.76it/s] 28%|██▊       | 111/391 [00:01<00:03, 90.77it/s] 31%|███       | 121/391 [00:01<00:02, 91.17it/s] 34%|███▎      | 131/391 [00:01<00:02, 91.35it/s] 36%|███▌      | 141/391 [00:01<00:02, 90.94it/s] 39%|███▊      | 151/391 [00:02<00:02, 81.10it/s] 41%|████      | 160/391 [00:02<00:02, 79.89it/s] 43%|████▎     | 170/391 [00:02<00:02, 83.06it/s] 46%|████▌     | 180/391 [00:02<00:02, 85.68it/s] 49%|████▊     | 190/391 [00:02<00:02, 88.49it/s] 51%|█████     | 200/391 [00:02<00:02, 89.93it/s] 54%|█████▎    | 210/391 [00:02<00:01, 91.43it/s] 56%|█████▋    | 220/391 [00:02<00:01, 92.30it/s] 59%|█████▉    | 230/391 [00:02<00:01, 91.62it/s] 61%|██████▏   | 240/391 [00:03<00:01, 91.32it/s] 64%|██████▍   | 250/391 [00:03<00:01, 92.25it/s] 66%|██████▋   | 260/391 [00:03<00:01, 92.73it/s] 69%|██████▉   | 270/391 [00:03<00:01, 91.93it/s] 72%|███████▏  | 280/391 [00:03<00:01, 92.65it/s] 74%|███████▍  | 290/391 [00:03<00:01, 92.25it/s] 77%|███████▋  | 300/391 [00:03<00:01, 89.92it/s] 79%|███████▉  | 310/391 [00:03<00:00, 91.46it/s] 82%|████████▏ | 320/391 [00:03<00:00, 92.57it/s] 84%|████████▍ | 330/391 [00:04<00:00, 93.28it/s] 87%|████████▋ | 340/391 [00:04<00:00, 93.70it/s] 90%|████████▉ | 350/391 [00:04<00:00, 94.07it/s] 92%|█████████▏| 360/391 [00:04<00:00, 93.73it/s] 95%|█████████▍| 370/391 [00:04<00:00, 92.89it/s] 97%|█████████▋| 380/391 [00:04<00:00, 93.24it/s]100%|█████████▉| 390/391 [00:04<00:00, 94.36it/s]100%|██████████| 391/391 [00:04<00:00, 83.11it/s]
50000 images processed, 4.773307800292969 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:22,  3.48it/s] 14%|█▍        | 11/79 [00:00<00:01, 34.88it/s] 27%|██▋       | 21/79 [00:00<00:01, 54.51it/s] 39%|███▉      | 31/79 [00:00<00:00, 67.17it/s] 52%|█████▏    | 41/79 [00:00<00:00, 75.64it/s] 65%|██████▍   | 51/79 [00:00<00:00, 81.27it/s] 77%|███████▋  | 61/79 [00:00<00:00, 84.54it/s] 90%|████████▉ | 71/79 [00:01<00:00, 87.66it/s]100%|██████████| 79/79 [00:01<00:00, 70.26it/s]
10000 images processed, 1.145470142364502 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:27,  2.33it/s]  5%|▌         | 11/204 [00:00<00:07, 26.07it/s] 10%|█         | 21/204 [00:00<00:04, 44.18it/s] 15%|█▌        | 31/204 [00:00<00:02, 57.83it/s] 20%|██        | 41/204 [00:00<00:02, 68.00it/s] 25%|██▌       | 51/204 [00:00<00:02, 75.40it/s] 30%|██▉       | 61/204 [00:01<00:01, 80.73it/s] 35%|███▍      | 71/204 [00:01<00:01, 84.44it/s] 40%|███▉      | 81/204 [00:01<00:01, 87.28it/s] 45%|████▍     | 91/204 [00:01<00:01, 89.24it/s] 50%|████▉     | 101/204 [00:01<00:01, 90.66it/s] 54%|█████▍    | 111/204 [00:01<00:01, 91.66it/s] 59%|█████▉    | 121/204 [00:01<00:00, 92.17it/s] 64%|██████▍   | 131/204 [00:01<00:00, 92.45it/s] 69%|██████▉   | 141/204 [00:01<00:00, 92.71it/s] 74%|███████▍  | 151/204 [00:02<00:00, 92.76it/s] 79%|███████▉  | 161/204 [00:02<00:00, 92.71it/s] 84%|████████▍ | 171/204 [00:02<00:00, 92.09it/s] 89%|████████▊ | 181/204 [00:02<00:00, 92.18it/s] 94%|█████████▎| 191/204 [00:02<00:00, 92.64it/s] 99%|█████████▊| 201/204 [00:02<00:00, 93.51it/s]100%|██████████| 204/204 [00:02<00:00, 78.02it/s]
26032 images processed, 2.659670114517212 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:44,  1.76it/s] 11%|█▏        | 9/79 [00:00<00:04, 15.56it/s] 22%|██▏       | 17/79 [00:00<00:02, 25.63it/s] 32%|███▏      | 25/79 [00:01<00:01, 32.84it/s] 42%|████▏     | 33/79 [00:01<00:01, 37.76it/s] 52%|█████▏    | 41/79 [00:01<00:00, 41.20it/s] 62%|██████▏   | 49/79 [00:01<00:00, 43.65it/s] 71%|███████   | 56/79 [00:01<00:00, 48.48it/s] 78%|███████▊  | 62/79 [00:01<00:00, 46.38it/s] 85%|████████▍ | 67/79 [00:01<00:00, 43.59it/s] 92%|█████████▏| 73/79 [00:02<00:00, 46.99it/s]100%|██████████| 79/79 [00:02<00:00, 37.20it/s]
10000 images processed, 2.1635608673095703 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:29,  2.67it/s] 14%|█▍        | 11/79 [00:00<00:02, 28.92it/s] 27%|██▋       | 21/79 [00:00<00:01, 47.72it/s] 39%|███▉      | 31/79 [00:00<00:00, 61.10it/s] 52%|█████▏    | 41/79 [00:00<00:00, 70.49it/s] 65%|██████▍   | 51/79 [00:00<00:00, 76.94it/s] 77%|███████▋  | 61/79 [00:01<00:00, 81.77it/s] 90%|████████▉ | 71/79 [00:01<00:00, 85.48it/s]100%|██████████| 79/79 [00:01<00:00, 65.51it/s]
10000 images processed, 1.2262616157531738 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:24,  2.78it/s] 14%|█▍        | 10/70 [00:00<00:02, 27.47it/s] 29%|██▊       | 20/70 [00:00<00:01, 47.17it/s] 43%|████▎     | 30/70 [00:00<00:00, 60.75it/s] 57%|█████▋    | 40/70 [00:00<00:00, 70.30it/s] 71%|███████▏  | 50/70 [00:00<00:00, 76.90it/s] 86%|████████▌ | 60/70 [00:01<00:00, 81.57it/s]100%|██████████| 70/70 [00:01<00:00, 83.23it/s]100%|██████████| 70/70 [00:01<00:00, 62.54it/s]
8925 images processed, 1.1508772373199463 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:00<00:36,  1.19it/s]  4%|▍         | 2/45 [00:01<00:21,  1.96it/s] 20%|██        | 9/45 [00:01<00:03, 11.32it/s] 27%|██▋       | 12/45 [00:01<00:03,  8.62it/s] 31%|███       | 14/45 [00:01<00:03,  9.53it/s] 40%|████      | 18/45 [00:02<00:02,  9.64it/s] 49%|████▉     | 22/45 [00:02<00:02, 10.87it/s] 58%|█████▊    | 26/45 [00:02<00:01, 11.22it/s] 67%|██████▋   | 30/45 [00:03<00:01, 10.82it/s] 76%|███████▌  | 34/45 [00:03<00:01, 10.19it/s] 93%|█████████▎| 42/45 [00:04<00:00,  9.62it/s]100%|██████████| 45/45 [00:04<00:00,  9.63it/s]
5640 images processed, 4.697485446929932 seconds used

19.519794702529907
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.55  99.35
places365     68.17  81.15
LSUN          17.19  96.14
iSUN          71.75  81.93
dtd           38.33  91.32
AVG           39.60  89.98
Retain-Acc: 0.7397
Forget-as-OOD (retain known vs forget novel):
  FPR: 78.50 AUROC: 87.02 AUIN: 98.38
17.864563703536987
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e20-lr0.001-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid
epochs=20 | cache=6 | flambda=1.0 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e20-lr0.001-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e20-lr0.001-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e20-lr0.001-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21843904
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<01:35,  4.09it/s]  3%|▎         | 11/391 [00:00<00:09, 38.59it/s]  5%|▌         | 21/391 [00:00<00:06, 58.54it/s]  8%|▊         | 31/391 [00:00<00:05, 71.03it/s] 10%|█         | 41/391 [00:00<00:04, 79.00it/s] 13%|█▎        | 51/391 [00:00<00:04, 84.20it/s] 16%|█▌        | 61/391 [00:00<00:03, 87.83it/s] 18%|█▊        | 71/391 [00:00<00:03, 90.28it/s] 21%|██        | 81/391 [00:01<00:03, 91.68it/s] 23%|██▎       | 91/391 [00:01<00:03, 92.85it/s] 26%|██▌       | 101/391 [00:01<00:03, 81.73it/s] 28%|██▊       | 110/391 [00:01<00:03, 80.28it/s] 31%|███       | 120/391 [00:01<00:03, 84.31it/s] 33%|███▎      | 130/391 [00:01<00:02, 87.38it/s] 36%|███▌      | 140/391 [00:01<00:02, 89.76it/s] 38%|███▊      | 150/391 [00:01<00:02, 91.47it/s] 41%|████      | 160/391 [00:01<00:02, 91.66it/s] 43%|████▎     | 170/391 [00:02<00:02, 92.82it/s] 46%|████▌     | 180/391 [00:02<00:02, 93.73it/s] 49%|████▊     | 190/391 [00:02<00:02, 94.32it/s] 51%|█████     | 200/391 [00:02<00:02, 94.92it/s] 54%|█████▎    | 210/391 [00:02<00:01, 93.42it/s] 56%|█████▋    | 220/391 [00:02<00:01, 92.25it/s] 59%|█████▉    | 230/391 [00:02<00:01, 92.93it/s] 61%|██████▏   | 240/391 [00:02<00:01, 93.38it/s] 64%|██████▍   | 250/391 [00:02<00:01, 92.20it/s] 66%|██████▋   | 260/391 [00:03<00:01, 92.78it/s] 69%|██████▉   | 270/391 [00:03<00:01, 93.30it/s] 72%|███████▏  | 280/391 [00:03<00:01, 93.54it/s] 74%|███████▍  | 290/391 [00:03<00:01, 94.26it/s] 77%|███████▋  | 300/391 [00:03<00:00, 94.61it/s] 79%|███████▉  | 310/391 [00:03<00:00, 94.71it/s] 82%|████████▏ | 320/391 [00:03<00:00, 95.00it/s] 84%|████████▍ | 330/391 [00:03<00:00, 95.26it/s] 87%|████████▋ | 340/391 [00:03<00:00, 95.35it/s] 90%|████████▉ | 350/391 [00:04<00:00, 95.40it/s] 92%|█████████▏| 360/391 [00:04<00:00, 95.22it/s] 95%|█████████▍| 370/391 [00:04<00:00, 95.27it/s] 97%|█████████▋| 380/391 [00:04<00:00, 95.01it/s]100%|█████████▉| 390/391 [00:04<00:00, 95.76it/s]100%|██████████| 391/391 [00:04<00:00, 88.01it/s]
50000 images processed, 4.5234949588775635 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:24,  3.21it/s] 14%|█▍        | 11/79 [00:00<00:02, 33.09it/s] 27%|██▋       | 21/79 [00:00<00:01, 52.58it/s] 39%|███▉      | 31/79 [00:00<00:00, 65.74it/s] 52%|█████▏    | 41/79 [00:00<00:00, 74.68it/s] 65%|██████▍   | 51/79 [00:00<00:00, 80.46it/s] 77%|███████▋  | 61/79 [00:00<00:00, 84.53it/s] 90%|████████▉ | 71/79 [00:01<00:00, 87.88it/s]100%|██████████| 79/79 [00:01<00:00, 68.97it/s]
10000 images processed, 1.1667513847351074 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:01,  3.29it/s]  5%|▌         | 11/204 [00:00<00:05, 33.32it/s] 10%|█         | 21/204 [00:00<00:03, 52.64it/s] 15%|█▌        | 31/204 [00:00<00:02, 65.43it/s] 20%|██        | 41/204 [00:00<00:02, 74.05it/s] 25%|██▌       | 51/204 [00:00<00:01, 79.79it/s] 30%|██▉       | 61/204 [00:00<00:01, 83.66it/s] 35%|███▍      | 71/204 [00:01<00:01, 86.53it/s] 40%|███▉      | 81/204 [00:01<00:01, 88.10it/s] 45%|████▍     | 91/204 [00:01<00:01, 89.73it/s] 50%|████▉     | 101/204 [00:01<00:01, 90.68it/s] 54%|█████▍    | 111/204 [00:01<00:01, 91.43it/s] 59%|█████▉    | 121/204 [00:01<00:00, 91.88it/s] 64%|██████▍   | 131/204 [00:01<00:00, 92.60it/s] 69%|██████▉   | 141/204 [00:01<00:00, 92.16it/s] 74%|███████▍  | 151/204 [00:01<00:00, 92.54it/s] 79%|███████▉  | 161/204 [00:02<00:00, 92.87it/s] 84%|████████▍ | 171/204 [00:02<00:00, 93.11it/s] 89%|████████▊ | 181/204 [00:02<00:00, 93.32it/s] 94%|█████████▎| 191/204 [00:02<00:00, 93.82it/s] 99%|█████████▊| 201/204 [00:02<00:00, 94.58it/s]100%|██████████| 204/204 [00:02<00:00, 82.05it/s]
26032 images processed, 2.5319957733154297 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:36,  2.12it/s] 11%|█▏        | 9/79 [00:00<00:03, 17.86it/s] 22%|██▏       | 17/79 [00:00<00:02, 28.17it/s] 32%|███▏      | 25/79 [00:00<00:01, 34.70it/s] 42%|████▏     | 33/79 [00:01<00:01, 39.43it/s] 52%|█████▏    | 41/79 [00:01<00:00, 42.43it/s] 62%|██████▏   | 49/79 [00:01<00:00, 45.38it/s] 72%|███████▏  | 57/79 [00:01<00:00, 46.46it/s] 82%|████████▏ | 65/79 [00:01<00:00, 47.27it/s] 92%|█████████▏| 73/79 [00:01<00:00, 47.76it/s]100%|██████████| 79/79 [00:01<00:00, 40.01it/s]
10000 images processed, 2.006274461746216 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:24,  3.15it/s] 14%|█▍        | 11/79 [00:00<00:02, 32.49it/s] 27%|██▋       | 21/79 [00:00<00:01, 51.47it/s] 39%|███▉      | 31/79 [00:00<00:00, 63.84it/s] 52%|█████▏    | 41/79 [00:00<00:00, 72.84it/s] 65%|██████▍   | 51/79 [00:00<00:00, 79.17it/s] 77%|███████▋  | 61/79 [00:00<00:00, 83.50it/s] 90%|████████▉ | 71/79 [00:01<00:00, 86.81it/s]100%|██████████| 79/79 [00:01<00:00, 68.77it/s]
10000 images processed, 1.1731340885162354 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:29,  2.37it/s] 16%|█▌        | 11/70 [00:00<00:02, 26.66it/s] 30%|███       | 21/70 [00:00<00:01, 45.28it/s] 44%|████▍     | 31/70 [00:00<00:00, 59.21it/s] 59%|█████▊    | 41/70 [00:00<00:00, 69.50it/s] 73%|███████▎  | 51/70 [00:00<00:00, 76.33it/s] 87%|████████▋ | 61/70 [00:01<00:00, 81.90it/s]100%|██████████| 70/70 [00:01<00:00, 60.53it/s]
8925 images processed, 1.187748670578003 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:00<00:39,  1.12it/s]  4%|▍         | 2/45 [00:01<00:20,  2.13it/s] 20%|██        | 9/45 [00:01<00:03,  9.77it/s] 24%|██▍       | 11/45 [00:01<00:03,  9.03it/s] 38%|███▊      | 17/45 [00:01<00:02, 12.59it/s] 42%|████▏     | 19/45 [00:02<00:02, 11.51it/s] 51%|█████     | 23/45 [00:02<00:01, 15.41it/s] 58%|█████▊    | 26/45 [00:02<00:01, 11.28it/s] 67%|██████▋   | 30/45 [00:02<00:01, 13.79it/s] 73%|███████▎  | 33/45 [00:03<00:00, 12.19it/s] 78%|███████▊  | 35/45 [00:03<00:00, 10.75it/s] 91%|█████████ | 41/45 [00:03<00:00, 14.51it/s] 96%|█████████▌| 43/45 [00:04<00:00,  9.51it/s]100%|██████████| 45/45 [00:04<00:00, 10.50it/s]
5640 images processed, 4.306110620498657 seconds used

18.66643214225769
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           3.42  99.22
places365     72.26  79.69
LSUN          23.24  95.39
iSUN          73.49  81.09
dtd           41.47  90.44
AVG           42.78  89.17
Retain-Acc: 0.7392
Forget-as-OOD (retain known vs forget novel):
  FPR: 58.00 AUROC: 88.68 AUIN: 98.56
8.850484609603882
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e50-lr0.001-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid
epochs=50 | cache=6 | flambda=1.0 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e50-lr0.001-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e50-lr0.001-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e50-lr0.001-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21843904
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<02:21,  2.76it/s]  3%|▎         | 11/391 [00:00<00:12, 29.53it/s]  5%|▍         | 19/391 [00:00<00:08, 42.97it/s]  7%|▋         | 26/391 [00:00<00:07, 49.06it/s]  9%|▉         | 35/391 [00:00<00:06, 59.33it/s] 11%|█▏        | 44/391 [00:00<00:05, 67.66it/s] 14%|█▎        | 53/391 [00:00<00:04, 74.00it/s] 16%|█▌        | 62/391 [00:01<00:04, 67.61it/s] 18%|█▊        | 71/391 [00:01<00:04, 71.63it/s] 20%|██        | 80/391 [00:01<00:04, 76.00it/s] 23%|██▎       | 90/391 [00:01<00:03, 80.70it/s] 25%|██▌       | 99/391 [00:01<00:03, 76.91it/s] 27%|██▋       | 107/391 [00:01<00:03, 73.54it/s] 30%|██▉       | 117/391 [00:01<00:03, 78.30it/s] 32%|███▏      | 125/391 [00:01<00:03, 73.78it/s] 34%|███▍      | 133/391 [00:02<00:03, 71.31it/s] 36%|███▋      | 142/391 [00:02<00:03, 75.15it/s] 38%|███▊      | 150/391 [00:02<00:03, 71.63it/s] 40%|████      | 158/391 [00:02<00:03, 70.11it/s] 43%|████▎     | 168/391 [00:02<00:02, 75.55it/s] 45%|████▌     | 177/391 [00:02<00:02, 79.13it/s] 47%|████▋     | 185/391 [00:02<00:02, 72.07it/s] 49%|████▉     | 193/391 [00:02<00:02, 72.88it/s] 52%|█████▏    | 203/391 [00:03<00:02, 77.45it/s] 54%|█████▍    | 212/391 [00:03<00:02, 80.33it/s] 57%|█████▋    | 221/391 [00:03<00:02, 73.80it/s] 59%|█████▉    | 230/391 [00:03<00:02, 76.06it/s] 61%|██████    | 239/391 [00:03<00:01, 78.55it/s] 63%|██████▎   | 248/391 [00:03<00:01, 81.02it/s] 66%|██████▌   | 257/391 [00:03<00:01, 74.90it/s] 68%|██████▊   | 265/391 [00:03<00:01, 75.07it/s] 70%|███████   | 275/391 [00:03<00:01, 80.00it/s] 73%|███████▎  | 284/391 [00:04<00:01, 80.92it/s] 75%|███████▍  | 293/391 [00:04<00:01, 74.38it/s] 77%|███████▋  | 302/391 [00:04<00:01, 76.45it/s] 80%|███████▉  | 311/391 [00:04<00:01, 78.72it/s] 82%|████████▏ | 321/391 [00:04<00:00, 81.99it/s] 84%|████████▍ | 330/391 [00:04<00:00, 81.50it/s] 87%|████████▋ | 339/391 [00:04<00:00, 74.10it/s] 89%|████████▉ | 348/391 [00:04<00:00, 77.72it/s] 92%|█████████▏| 358/391 [00:04<00:00, 81.48it/s] 94%|█████████▍| 368/391 [00:05<00:00, 84.02it/s] 96%|█████████▋| 377/391 [00:05<00:00, 80.75it/s] 99%|█████████▊| 386/391 [00:05<00:00, 77.21it/s]100%|██████████| 391/391 [00:05<00:00, 71.98it/s]
50000 images processed, 5.515422582626343 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:27,  2.84it/s] 10%|█         | 8/79 [00:00<00:03, 22.10it/s] 18%|█▊        | 14/79 [00:00<00:02, 32.44it/s] 29%|██▉       | 23/79 [00:00<00:01, 47.72it/s] 42%|████▏     | 33/79 [00:00<00:00, 60.72it/s] 54%|█████▍    | 43/79 [00:00<00:00, 70.00it/s] 65%|██████▍   | 51/79 [00:01<00:00, 68.59it/s] 75%|███████▍  | 59/79 [00:01<00:00, 68.37it/s] 87%|████████▋ | 69/79 [00:01<00:00, 76.06it/s] 99%|█████████▊| 78/79 [00:01<00:00, 78.13it/s]100%|██████████| 79/79 [00:01<00:00, 57.85it/s]
10000 images processed, 1.3894634246826172 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:06,  3.05it/s]  4%|▍         | 9/204 [00:00<00:07, 25.80it/s]  9%|▉         | 18/204 [00:00<00:04, 44.49it/s] 12%|█▏        | 25/204 [00:00<00:03, 50.13it/s] 16%|█▌        | 32/204 [00:00<00:03, 52.97it/s] 21%|██        | 42/204 [00:00<00:02, 64.70it/s] 25%|██▍       | 50/204 [00:00<00:02, 68.82it/s] 28%|██▊       | 58/204 [00:01<00:02, 66.46it/s] 32%|███▏      | 66/204 [00:01<00:01, 69.02it/s] 37%|███▋      | 75/204 [00:01<00:01, 73.35it/s] 41%|████      | 83/204 [00:01<00:01, 69.35it/s] 45%|████▍     | 91/204 [00:01<00:01, 69.62it/s] 50%|████▉     | 101/204 [00:01<00:01, 75.40it/s] 54%|█████▍    | 110/204 [00:01<00:01, 79.22it/s] 58%|█████▊    | 119/204 [00:01<00:01, 71.90it/s] 62%|██████▏   | 127/204 [00:02<00:01, 72.36it/s] 67%|██████▋   | 136/204 [00:02<00:00, 76.71it/s] 71%|███████   | 145/204 [00:02<00:00, 77.46it/s] 75%|███████▌  | 153/204 [00:02<00:00, 73.57it/s] 79%|███████▉  | 161/204 [00:02<00:00, 73.74it/s] 84%|████████▍ | 171/204 [00:02<00:00, 79.20it/s] 88%|████████▊ | 180/204 [00:02<00:00, 80.02it/s] 93%|█████████▎| 189/204 [00:02<00:00, 75.89it/s] 97%|█████████▋| 197/204 [00:02<00:00, 72.76it/s]100%|██████████| 204/204 [00:03<00:00, 67.18it/s]
26032 images processed, 3.0817134380340576 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:33,  2.35it/s] 11%|█▏        | 9/79 [00:00<00:03, 20.06it/s] 19%|█▉        | 15/79 [00:00<00:02, 29.28it/s] 25%|██▌       | 20/79 [00:00<00:01, 34.14it/s] 33%|███▎      | 26/79 [00:00<00:01, 40.18it/s] 39%|███▉      | 31/79 [00:00<00:01, 41.29it/s] 49%|████▉     | 39/79 [00:01<00:00, 50.74it/s] 57%|█████▋    | 45/79 [00:01<00:00, 48.32it/s] 65%|██████▍   | 51/79 [00:01<00:00, 47.05it/s] 72%|███████▏  | 57/79 [00:01<00:00, 47.52it/s] 82%|████████▏ | 65/79 [00:01<00:00, 49.24it/s] 91%|█████████ | 72/79 [00:01<00:00, 53.46it/s] 99%|█████████▊| 78/79 [00:01<00:00, 48.82it/s]100%|██████████| 79/79 [00:01<00:00, 41.24it/s]
10000 images processed, 1.9484479427337646 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:29,  2.64it/s] 11%|█▏        | 9/79 [00:00<00:02, 23.65it/s] 20%|██        | 16/79 [00:00<00:01, 34.97it/s] 30%|███       | 24/79 [00:00<00:01, 46.36it/s] 43%|████▎     | 34/79 [00:00<00:00, 60.42it/s] 56%|█████▌    | 44/79 [00:00<00:00, 69.55it/s] 66%|██████▌   | 52/79 [00:01<00:00, 71.07it/s] 76%|███████▌  | 60/79 [00:01<00:00, 66.48it/s] 89%|████████▊ | 70/79 [00:01<00:00, 74.53it/s]100%|██████████| 79/79 [00:01<00:00, 58.11it/s]
10000 images processed, 1.3856394290924072 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:24,  2.87it/s] 11%|█▏        | 8/70 [00:00<00:02, 21.50it/s] 23%|██▎       | 16/70 [00:00<00:01, 37.74it/s] 37%|███▋      | 26/70 [00:00<00:00, 53.94it/s] 49%|████▊     | 34/70 [00:00<00:00, 61.12it/s] 60%|██████    | 42/70 [00:00<00:00, 59.95it/s] 73%|███████▎  | 51/70 [00:01<00:00, 67.22it/s] 86%|████████▌ | 60/70 [00:01<00:00, 72.15it/s]100%|██████████| 70/70 [00:01<00:00, 76.38it/s]100%|██████████| 70/70 [00:01<00:00, 56.18it/s]
8925 images processed, 1.2828691005706787 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:00<00:40,  1.10it/s]  4%|▍         | 2/45 [00:01<00:20,  2.15it/s] 20%|██        | 9/45 [00:01<00:03, 10.38it/s] 24%|██▍       | 11/45 [00:01<00:03,  8.61it/s] 36%|███▌      | 16/45 [00:01<00:02, 14.17it/s] 42%|████▏     | 19/45 [00:02<00:02, 11.70it/s] 49%|████▉     | 22/45 [00:02<00:01, 13.36it/s] 56%|█████▌    | 25/45 [00:02<00:01, 14.13it/s] 60%|██████    | 27/45 [00:02<00:01, 12.86it/s] 67%|██████▋   | 30/45 [00:02<00:01, 14.27it/s] 73%|███████▎  | 33/45 [00:03<00:01, 11.16it/s] 87%|████████▋ | 39/45 [00:03<00:00, 17.41it/s] 93%|█████████▎| 42/45 [00:03<00:00, 11.65it/s]100%|██████████| 45/45 [00:03<00:00, 13.64it/s]100%|██████████| 45/45 [00:03<00:00, 11.35it/s]
5640 images processed, 3.9892778396606445 seconds used

20.305115222930908
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           5.29  98.85
places365     76.41  78.83
LSUN          28.52  94.81
iSUN          76.95  80.03
dtd           46.90  89.39
AVG           46.81  88.38
Retain-Acc: 0.7362
Forget-as-OOD (retain known vs forget novel):
  FPR: 46.20 AUROC: 91.25 AUIN: 98.86
11.12125539779663
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e5-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid
epochs=5 | cache=6 | flambda=1.0 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21843904
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<02:28,  2.63it/s]  3%|▎         | 11/391 [00:00<00:13, 28.86it/s]  5%|▍         | 19/391 [00:00<00:08, 42.85it/s]  7%|▋         | 29/391 [00:00<00:06, 58.33it/s]  9%|▉         | 37/391 [00:00<00:05, 63.54it/s] 12%|█▏        | 45/391 [00:00<00:05, 61.84it/s] 14%|█▍        | 55/391 [00:01<00:04, 70.66it/s] 16%|█▋        | 64/391 [00:01<00:04, 74.67it/s] 19%|█▉        | 74/391 [00:01<00:03, 80.33it/s] 21%|██        | 83/391 [00:01<00:04, 73.20it/s] 23%|██▎       | 91/391 [00:01<00:04, 73.34it/s] 26%|██▌       | 101/391 [00:01<00:03, 79.05it/s] 28%|██▊       | 110/391 [00:01<00:03, 81.00it/s] 30%|███       | 119/391 [00:01<00:03, 78.32it/s] 32%|███▏      | 127/391 [00:01<00:03, 71.69it/s] 35%|███▌      | 137/391 [00:02<00:03, 78.00it/s] 38%|███▊      | 147/391 [00:02<00:02, 81.68it/s] 40%|████      | 157/391 [00:02<00:02, 85.44it/s] 42%|████▏     | 166/391 [00:02<00:02, 84.40it/s] 45%|████▍     | 175/391 [00:02<00:02, 76.60it/s] 47%|████▋     | 185/391 [00:02<00:02, 81.18it/s] 50%|████▉     | 195/391 [00:02<00:02, 84.71it/s] 52%|█████▏    | 204/391 [00:02<00:02, 85.75it/s] 54%|█████▍    | 213/391 [00:02<00:02, 84.35it/s] 57%|█████▋    | 222/391 [00:03<00:02, 83.53it/s] 59%|█████▉    | 231/391 [00:03<00:01, 83.24it/s] 61%|██████▏   | 240/391 [00:03<00:01, 82.89it/s] 64%|██████▎   | 249/391 [00:03<00:01, 82.58it/s] 66%|██████▌   | 258/391 [00:03<00:01, 82.56it/s] 68%|██████▊   | 267/391 [00:03<00:01, 82.65it/s] 71%|███████   | 276/391 [00:03<00:01, 82.77it/s] 73%|███████▎  | 285/391 [00:03<00:01, 82.48it/s] 75%|███████▌  | 294/391 [00:03<00:01, 82.53it/s] 78%|███████▊  | 304/391 [00:04<00:01, 85.39it/s] 80%|████████  | 314/391 [00:04<00:00, 86.98it/s] 83%|████████▎ | 323/391 [00:04<00:00, 87.54it/s] 85%|████████▍ | 332/391 [00:04<00:00, 87.13it/s] 87%|████████▋ | 341/391 [00:04<00:00, 84.80it/s] 90%|████████▉ | 350/391 [00:04<00:00, 75.44it/s] 92%|█████████▏| 358/391 [00:04<00:00, 76.36it/s] 94%|█████████▍| 367/391 [00:04<00:00, 79.27it/s] 96%|█████████▌| 376/391 [00:04<00:00, 81.86it/s] 99%|█████████▊| 386/391 [00:05<00:00, 86.32it/s]100%|██████████| 391/391 [00:05<00:00, 76.21it/s]
50000 images processed, 5.2196221351623535 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:28,  2.78it/s] 13%|█▎        | 10/79 [00:00<00:02, 26.96it/s] 22%|██▏       | 17/79 [00:00<00:01, 38.10it/s] 32%|███▏      | 25/79 [00:00<00:01, 49.00it/s] 44%|████▍     | 35/79 [00:00<00:00, 61.89it/s] 56%|█████▌    | 44/79 [00:00<00:00, 69.40it/s] 68%|██████▊   | 54/79 [00:01<00:00, 76.57it/s] 81%|████████  | 64/79 [00:01<00:00, 81.41it/s] 94%|█████████▎| 74/79 [00:01<00:00, 85.49it/s]100%|██████████| 79/79 [00:01<00:00, 61.77it/s]
10000 images processed, 1.303771734237671 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:13,  2.75it/s]  5%|▍         | 10/204 [00:00<00:07, 27.26it/s] 10%|▉         | 20/204 [00:00<00:03, 47.27it/s] 14%|█▎        | 28/204 [00:00<00:03, 52.38it/s] 17%|█▋        | 35/204 [00:00<00:02, 56.95it/s] 22%|██▏       | 45/204 [00:00<00:02, 67.93it/s] 26%|██▋       | 54/204 [00:01<00:02, 72.03it/s] 31%|███▏      | 64/204 [00:01<00:01, 77.58it/s] 36%|███▋      | 74/204 [00:01<00:01, 81.42it/s] 41%|████      | 83/204 [00:01<00:01, 74.40it/s] 45%|████▍     | 91/204 [00:01<00:01, 74.45it/s] 50%|████▉     | 101/204 [00:01<00:01, 79.22it/s] 54%|█████▍    | 110/204 [00:01<00:01, 81.25it/s] 59%|█████▉    | 120/204 [00:01<00:01, 83.92it/s] 63%|██████▎   | 129/204 [00:01<00:00, 80.84it/s] 68%|██████▊   | 138/204 [00:02<00:00, 74.05it/s] 73%|███████▎  | 148/204 [00:02<00:00, 79.50it/s] 77%|███████▋  | 157/204 [00:02<00:00, 80.66it/s] 82%|████████▏ | 167/204 [00:02<00:00, 84.52it/s] 87%|████████▋ | 177/204 [00:02<00:00, 87.73it/s] 91%|█████████ | 186/204 [00:02<00:00, 87.83it/s] 96%|█████████▌| 195/204 [00:02<00:00, 77.67it/s]100%|██████████| 204/204 [00:02<00:00, 79.47it/s]100%|██████████| 204/204 [00:02<00:00, 71.19it/s]
26032 images processed, 2.9131975173950195 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:49,  1.59it/s] 11%|█▏        | 9/79 [00:00<00:05, 13.92it/s] 22%|██▏       | 17/79 [00:01<00:02, 22.09it/s] 30%|███       | 24/79 [00:01<00:01, 30.24it/s] 37%|███▋      | 29/79 [00:01<00:01, 33.59it/s] 43%|████▎     | 34/79 [00:01<00:01, 33.39it/s] 52%|█████▏    | 41/79 [00:01<00:01, 37.30it/s] 62%|██████▏   | 49/79 [00:01<00:00, 40.82it/s] 70%|██████▉   | 55/79 [00:01<00:00, 44.75it/s] 77%|███████▋  | 61/79 [00:01<00:00, 48.20it/s] 85%|████████▍ | 67/79 [00:02<00:00, 46.06it/s] 92%|█████████▏| 73/79 [00:02<00:00, 46.35it/s]100%|██████████| 79/79 [00:02<00:00, 35.19it/s]
10000 images processed, 2.290675640106201 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:38,  2.05it/s]  9%|▉         | 7/79 [00:00<00:04, 14.77it/s] 18%|█▊        | 14/79 [00:00<00:02, 27.43it/s] 30%|███       | 24/79 [00:00<00:01, 44.73it/s] 41%|████      | 32/79 [00:00<00:00, 52.75it/s] 49%|████▉     | 39/79 [00:01<00:00, 53.80it/s] 59%|█████▉    | 47/79 [00:01<00:00, 60.28it/s] 71%|███████   | 56/79 [00:01<00:00, 68.07it/s] 82%|████████▏ | 65/79 [00:01<00:00, 72.26it/s] 95%|█████████▍| 75/79 [00:01<00:00, 78.69it/s]100%|██████████| 79/79 [00:01<00:00, 52.45it/s]
10000 images processed, 1.5310208797454834 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:33,  2.06it/s] 14%|█▍        | 10/70 [00:00<00:02, 21.93it/s] 27%|██▋       | 19/70 [00:00<00:01, 38.45it/s] 37%|███▋      | 26/70 [00:00<00:00, 45.59it/s] 47%|████▋     | 33/70 [00:00<00:00, 50.50it/s] 57%|█████▋    | 40/70 [00:01<00:00, 53.06it/s] 67%|██████▋   | 47/70 [00:01<00:00, 56.80it/s] 81%|████████▏ | 57/70 [00:01<00:00, 67.53it/s] 96%|█████████▌| 67/70 [00:01<00:00, 75.76it/s]100%|██████████| 70/70 [00:01<00:00, 50.69it/s]
8925 images processed, 1.4129881858825684 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:00<00:39,  1.10it/s]  4%|▍         | 2/45 [00:01<00:19,  2.21it/s] 20%|██        | 9/45 [00:01<00:03,  9.46it/s] 24%|██▍       | 11/45 [00:01<00:03,  8.99it/s] 31%|███       | 14/45 [00:01<00:02, 11.76it/s] 38%|███▊      | 17/45 [00:01<00:02, 12.12it/s] 42%|████▏     | 19/45 [00:02<00:02, 11.94it/s] 49%|████▉     | 22/45 [00:02<00:01, 12.98it/s] 56%|█████▌    | 25/45 [00:02<00:01, 14.73it/s] 60%|██████    | 27/45 [00:02<00:01, 14.01it/s] 67%|██████▋   | 30/45 [00:02<00:01, 12.03it/s] 73%|███████▎  | 33/45 [00:03<00:00, 12.69it/s] 80%|████████  | 36/45 [00:03<00:00, 15.29it/s] 87%|████████▋ | 39/45 [00:03<00:00, 17.70it/s] 93%|█████████▎| 42/45 [00:03<00:00, 10.13it/s]100%|██████████| 45/45 [00:04<00:00, 11.20it/s]
5640 images processed, 4.0413055419921875 seconds used

20.452288389205933
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.52  99.36
places365     67.88  81.19
LSUN          17.54  96.08
iSUN          72.34  81.72
dtd           37.89  91.39
AVG           39.63  89.95
Retain-Acc: 0.7406
Forget-as-OOD (retain known vs forget novel):
  FPR: 79.50 AUROC: 86.90 AUIN: 98.36
13.903138637542725
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e10-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid
epochs=10 | cache=6 | flambda=1.0 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e10-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e10-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e10-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21843904
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<02:16,  2.85it/s]  3%|▎         | 11/391 [00:00<00:12, 29.71it/s]  5%|▌         | 21/391 [00:00<00:07, 48.45it/s]  8%|▊         | 31/391 [00:00<00:05, 61.88it/s] 10%|▉         | 39/391 [00:00<00:05, 64.31it/s] 12%|█▏        | 47/391 [00:00<00:05, 64.27it/s] 15%|█▍        | 57/391 [00:01<00:04, 72.50it/s] 17%|█▋        | 67/391 [00:01<00:04, 77.18it/s] 20%|█▉        | 77/391 [00:01<00:03, 81.76it/s] 22%|██▏       | 87/391 [00:01<00:03, 85.35it/s] 25%|██▍       | 97/391 [00:01<00:03, 88.23it/s] 27%|██▋       | 107/391 [00:01<00:03, 90.00it/s] 30%|██▉       | 117/391 [00:01<00:03, 78.83it/s] 32%|███▏      | 126/391 [00:01<00:03, 79.80it/s] 35%|███▍      | 136/391 [00:01<00:03, 82.73it/s] 37%|███▋      | 145/391 [00:02<00:02, 83.28it/s] 40%|███▉      | 155/391 [00:02<00:02, 86.70it/s] 42%|████▏     | 165/391 [00:02<00:02, 88.89it/s] 45%|████▍     | 174/391 [00:02<00:02, 81.20it/s] 47%|████▋     | 183/391 [00:02<00:02, 78.49it/s] 49%|████▉     | 193/391 [00:02<00:02, 82.28it/s] 52%|█████▏    | 202/391 [00:02<00:02, 83.03it/s] 54%|█████▍    | 211/391 [00:02<00:02, 81.17it/s] 56%|█████▋    | 220/391 [00:03<00:02, 73.41it/s] 59%|█████▊    | 229/391 [00:03<00:02, 77.39it/s] 61%|██████    | 238/391 [00:03<00:01, 78.74it/s] 63%|██████▎   | 248/391 [00:03<00:01, 83.48it/s] 66%|██████▌   | 258/391 [00:03<00:01, 86.60it/s] 68%|██████▊   | 267/391 [00:03<00:01, 78.38it/s] 71%|███████   | 276/391 [00:03<00:01, 77.40it/s] 73%|███████▎  | 286/391 [00:03<00:01, 82.19it/s] 76%|███████▌  | 296/391 [00:03<00:01, 85.23it/s] 78%|███████▊  | 306/391 [00:04<00:00, 87.25it/s] 81%|████████  | 316/391 [00:04<00:00, 89.52it/s] 83%|████████▎ | 326/391 [00:04<00:00, 82.57it/s] 86%|████████▌ | 335/391 [00:04<00:00, 77.80it/s] 88%|████████▊ | 344/391 [00:04<00:00, 80.36it/s] 90%|█████████ | 353/391 [00:04<00:00, 81.90it/s] 93%|█████████▎| 363/391 [00:04<00:00, 85.43it/s] 95%|█████████▌| 373/391 [00:04<00:00, 88.30it/s] 98%|█████████▊| 382/391 [00:04<00:00, 77.39it/s]100%|██████████| 391/391 [00:05<00:00, 77.13it/s]100%|██████████| 391/391 [00:05<00:00, 76.93it/s]
50000 images processed, 5.186386346817017 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:31,  2.48it/s] 10%|█         | 8/79 [00:00<00:03, 19.85it/s] 22%|██▏       | 17/79 [00:00<00:01, 37.88it/s] 33%|███▎      | 26/79 [00:00<00:01, 51.95it/s] 46%|████▌     | 36/79 [00:00<00:00, 63.97it/s] 58%|█████▊    | 46/79 [00:00<00:00, 72.67it/s] 70%|██████▉   | 55/79 [00:01<00:00, 71.01it/s] 80%|███████▉  | 63/79 [00:01<00:00, 69.25it/s] 92%|█████████▏| 73/79 [00:01<00:00, 76.62it/s]100%|██████████| 79/79 [00:01<00:00, 57.93it/s]
10000 images processed, 1.3938689231872559 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:08,  2.97it/s]  3%|▎         | 7/204 [00:00<00:09, 19.83it/s]  7%|▋         | 14/204 [00:00<00:05, 34.28it/s] 12%|█▏        | 24/204 [00:00<00:03, 52.83it/s] 16%|█▌        | 33/204 [00:00<00:02, 61.53it/s] 21%|██        | 43/204 [00:00<00:02, 71.05it/s] 25%|██▌       | 51/204 [00:00<00:02, 69.07it/s] 29%|██▉       | 59/204 [00:01<00:02, 67.89it/s] 33%|███▎      | 68/204 [00:01<00:01, 73.72it/s] 38%|███▊      | 77/204 [00:01<00:01, 77.37it/s] 43%|████▎     | 87/204 [00:01<00:01, 81.24it/s] 47%|████▋     | 96/204 [00:01<00:01, 79.39it/s] 51%|█████▏    | 105/204 [00:01<00:01, 73.20it/s] 56%|█████▋    | 115/204 [00:01<00:01, 78.94it/s] 61%|██████    | 124/204 [00:01<00:00, 81.69it/s] 65%|██████▌   | 133/204 [00:02<00:00, 83.39it/s] 70%|███████   | 143/204 [00:02<00:00, 86.70it/s] 75%|███████▍  | 152/204 [00:02<00:00, 80.07it/s] 79%|███████▉  | 161/204 [00:02<00:00, 76.24it/s] 84%|████████▍ | 171/204 [00:02<00:00, 81.02it/s] 88%|████████▊ | 180/204 [00:02<00:00, 82.75it/s] 93%|█████████▎| 190/204 [00:02<00:00, 86.11it/s] 98%|█████████▊| 200/204 [00:02<00:00, 88.84it/s]100%|██████████| 204/204 [00:02<00:00, 71.76it/s]
26032 images processed, 2.89194917678833 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:45,  1.71it/s] 10%|█         | 8/79 [00:00<00:04, 14.70it/s] 18%|█▊        | 14/79 [00:00<00:02, 24.09it/s] 24%|██▍       | 19/79 [00:00<00:02, 26.37it/s] 32%|███▏      | 25/79 [00:01<00:01, 30.64it/s] 39%|███▉      | 31/79 [00:01<00:01, 37.20it/s] 47%|████▋     | 37/79 [00:01<00:00, 42.66it/s] 54%|█████▍    | 43/79 [00:01<00:00, 40.65it/s] 62%|██████▏   | 49/79 [00:01<00:00, 40.79it/s] 72%|███████▏  | 57/79 [00:01<00:00, 41.79it/s] 81%|████████  | 64/79 [00:01<00:00, 46.77it/s] 89%|████████▊ | 70/79 [00:02<00:00, 49.85it/s] 96%|█████████▌| 76/79 [00:02<00:00, 48.41it/s]100%|██████████| 79/79 [00:02<00:00, 36.28it/s]
10000 images processed, 2.2136244773864746 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:27,  2.84it/s] 13%|█▎        | 10/79 [00:00<00:02, 27.43it/s] 24%|██▍       | 19/79 [00:00<00:01, 43.93it/s] 35%|███▌      | 28/79 [00:00<00:00, 55.19it/s] 47%|████▋     | 37/79 [00:00<00:00, 63.00it/s] 58%|█████▊    | 46/79 [00:00<00:00, 68.42it/s] 70%|██████▉   | 55/79 [00:01<00:00, 72.32it/s] 81%|████████  | 64/79 [00:01<00:00, 74.70it/s] 92%|█████████▏| 73/79 [00:01<00:00, 76.98it/s]100%|██████████| 79/79 [00:01<00:00, 60.72it/s]
10000 images processed, 1.3334877490997314 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:30,  2.23it/s] 16%|█▌        | 11/70 [00:00<00:02, 25.31it/s] 30%|███       | 21/70 [00:00<00:01, 43.34it/s] 43%|████▎     | 30/70 [00:00<00:00, 54.85it/s] 57%|█████▋    | 40/70 [00:00<00:00, 65.52it/s] 70%|███████   | 49/70 [00:00<00:00, 70.34it/s] 84%|████████▍ | 59/70 [00:01<00:00, 77.58it/s] 99%|█████████▊| 69/70 [00:01<00:00, 83.20it/s]100%|██████████| 70/70 [00:01<00:00, 57.87it/s]
8925 images processed, 1.2410457134246826 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:00<00:38,  1.13it/s]  9%|▉         | 4/45 [00:00<00:08,  5.09it/s] 20%|██        | 9/45 [00:01<00:04,  8.77it/s] 24%|██▍       | 11/45 [00:01<00:04,  8.38it/s] 36%|███▌      | 16/45 [00:01<00:02, 13.90it/s] 42%|████▏     | 19/45 [00:02<00:02, 10.28it/s] 53%|█████▎    | 24/45 [00:02<00:01, 15.18it/s] 60%|██████    | 27/45 [00:02<00:01, 10.58it/s] 73%|███████▎  | 33/45 [00:03<00:00, 12.33it/s] 78%|███████▊  | 35/45 [00:03<00:01,  9.68it/s] 93%|█████████▎| 42/45 [00:04<00:00,  8.45it/s]100%|██████████| 45/45 [00:04<00:00,  9.71it/s]
5640 images processed, 4.6556501388549805 seconds used

20.626156091690063
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.52  99.36
places365     67.81  81.20
LSUN          17.44  96.10
iSUN          72.20  81.79
dtd           37.82  91.38
AVG           39.56  89.97
Retain-Acc: 0.7403
Forget-as-OOD (retain known vs forget novel):
  FPR: 79.50 AUROC: 86.91 AUIN: 98.36
13.468984603881836
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e20-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid
epochs=20 | cache=6 | flambda=1.0 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e20-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e20-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e20-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21843904
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<02:14,  2.90it/s]  3%|▎         | 10/391 [00:00<00:14, 27.19it/s]  4%|▍         | 17/391 [00:00<00:09, 38.32it/s]  7%|▋         | 26/391 [00:00<00:07, 51.86it/s]  9%|▉         | 35/391 [00:00<00:05, 61.66it/s] 11%|█▏        | 44/391 [00:00<00:05, 69.04it/s] 14%|█▍        | 54/391 [00:00<00:04, 76.83it/s] 16%|█▋        | 64/391 [00:01<00:03, 82.31it/s] 19%|█▉        | 74/391 [00:01<00:03, 85.83it/s] 21%|██▏       | 84/391 [00:01<00:03, 87.54it/s] 24%|██▍       | 93/391 [00:01<00:03, 79.29it/s] 26%|██▌       | 102/391 [00:01<00:03, 77.50it/s] 29%|██▊       | 112/391 [00:01<00:03, 82.43it/s] 31%|███       | 121/391 [00:01<00:03, 82.16it/s] 34%|███▎      | 131/391 [00:01<00:03, 85.75it/s] 36%|███▌      | 141/391 [00:02<00:02, 88.38it/s] 39%|███▊      | 151/391 [00:02<00:02, 90.07it/s] 41%|████      | 161/391 [00:02<00:02, 90.03it/s] 44%|████▎     | 171/391 [00:02<00:02, 82.47it/s] 46%|████▌     | 180/391 [00:02<00:02, 79.17it/s] 49%|████▊     | 190/391 [00:02<00:02, 83.49it/s] 51%|█████     | 199/391 [00:02<00:02, 85.03it/s] 53%|█████▎    | 209/391 [00:02<00:02, 86.92it/s] 56%|█████▌    | 218/391 [00:02<00:02, 83.91it/s] 58%|█████▊    | 227/391 [00:03<00:02, 75.78it/s] 61%|██████    | 237/391 [00:03<00:01, 80.86it/s] 63%|██████▎   | 246/391 [00:03<00:01, 82.04it/s] 65%|██████▌   | 255/391 [00:03<00:01, 83.46it/s] 68%|██████▊   | 265/391 [00:03<00:01, 86.49it/s] 70%|███████   | 275/391 [00:03<00:01, 88.75it/s] 73%|███████▎  | 285/391 [00:03<00:01, 89.96it/s] 75%|███████▌  | 295/391 [00:03<00:01, 88.91it/s] 78%|███████▊  | 304/391 [00:03<00:01, 76.80it/s] 80%|████████  | 314/391 [00:04<00:00, 81.55it/s] 83%|████████▎ | 323/391 [00:04<00:00, 83.75it/s] 85%|████████▍ | 332/391 [00:04<00:00, 83.41it/s] 87%|████████▋ | 342/391 [00:04<00:00, 87.04it/s] 90%|█████████ | 352/391 [00:04<00:00, 89.70it/s] 93%|█████████▎| 362/391 [00:04<00:00, 91.51it/s] 95%|█████████▌| 372/391 [00:04<00:00, 85.44it/s] 97%|█████████▋| 381/391 [00:04<00:00, 78.37it/s]100%|██████████| 391/391 [00:04<00:00, 81.66it/s]100%|██████████| 391/391 [00:04<00:00, 78.38it/s]
50000 images processed, 5.066035985946655 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:21,  3.64it/s] 14%|█▍        | 11/79 [00:00<00:01, 35.91it/s] 25%|██▌       | 20/79 [00:00<00:01, 52.91it/s] 35%|███▌      | 28/79 [00:00<00:00, 55.43it/s] 47%|████▋     | 37/79 [00:00<00:00, 63.70it/s] 59%|█████▉    | 47/79 [00:00<00:00, 72.76it/s] 72%|███████▏  | 57/79 [00:00<00:00, 78.53it/s] 85%|████████▍ | 67/79 [00:01<00:00, 83.48it/s] 97%|█████████▋| 77/79 [00:01<00:00, 86.43it/s]100%|██████████| 79/79 [00:01<00:00, 66.66it/s]
10000 images processed, 1.2081553936004639 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:06,  3.06it/s]  5%|▍         | 10/204 [00:00<00:06, 29.49it/s]  8%|▊         | 17/204 [00:00<00:04, 41.69it/s] 12%|█▏        | 24/204 [00:00<00:03, 47.43it/s] 17%|█▋        | 34/204 [00:00<00:02, 61.65it/s] 21%|██        | 43/204 [00:00<00:02, 69.06it/s] 25%|██▌       | 52/204 [00:00<00:02, 74.72it/s] 30%|██▉       | 61/204 [00:01<00:02, 70.55it/s] 34%|███▍      | 69/204 [00:01<00:01, 72.52it/s] 39%|███▊      | 79/204 [00:01<00:01, 78.39it/s] 44%|████▎     | 89/204 [00:01<00:01, 83.03it/s] 49%|████▊     | 99/204 [00:01<00:01, 85.70it/s] 53%|█████▎    | 108/204 [00:01<00:01, 86.51it/s] 58%|█████▊    | 118/204 [00:01<00:00, 88.60it/s] 63%|██████▎   | 128/204 [00:01<00:00, 90.26it/s] 68%|██████▊   | 138/204 [00:01<00:00, 81.78it/s] 72%|███████▏  | 147/204 [00:02<00:00, 69.19it/s] 76%|███████▋  | 156/204 [00:02<00:00, 72.51it/s] 81%|████████▏ | 166/204 [00:02<00:00, 77.54it/s] 86%|████████▌ | 175/204 [00:02<00:00, 80.17it/s] 91%|█████████ | 185/204 [00:02<00:00, 83.71it/s] 96%|█████████▌| 195/204 [00:02<00:00, 86.77it/s]100%|██████████| 204/204 [00:02<00:00, 72.80it/s]
26032 images processed, 2.842318534851074 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:43,  1.79it/s] 10%|█         | 8/79 [00:00<00:04, 15.57it/s] 16%|█▋        | 13/79 [00:00<00:03, 21.23it/s] 23%|██▎       | 18/79 [00:00<00:02, 27.23it/s] 32%|███▏      | 25/79 [00:01<00:01, 32.91it/s] 42%|████▏     | 33/79 [00:01<00:01, 36.77it/s] 52%|█████▏    | 41/79 [00:01<00:00, 40.17it/s] 61%|██████    | 48/79 [00:01<00:00, 45.53it/s] 68%|██████▊   | 54/79 [00:01<00:00, 45.97it/s] 75%|███████▍  | 59/79 [00:01<00:00, 46.53it/s] 82%|████████▏ | 65/79 [00:01<00:00, 44.77it/s] 92%|█████████▏| 73/79 [00:02<00:00, 47.14it/s]100%|██████████| 79/79 [00:02<00:00, 37.25it/s]
10000 images processed, 2.1638081073760986 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:27,  2.85it/s] 10%|█         | 8/79 [00:00<00:03, 22.03it/s] 18%|█▊        | 14/79 [00:00<00:02, 31.90it/s] 30%|███       | 24/79 [00:00<00:01, 49.96it/s] 42%|████▏     | 33/79 [00:00<00:00, 59.75it/s] 54%|█████▍    | 43/79 [00:00<00:00, 69.27it/s] 67%|██████▋   | 53/79 [00:01<00:00, 76.32it/s] 80%|███████▉  | 63/79 [00:01<00:00, 81.13it/s] 92%|█████████▏| 73/79 [00:01<00:00, 85.05it/s]100%|██████████| 79/79 [00:01<00:00, 60.76it/s]
10000 images processed, 1.320716381072998 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:34,  1.99it/s] 11%|█▏        | 8/70 [00:00<00:03, 16.89it/s] 21%|██▏       | 15/70 [00:00<00:01, 28.60it/s] 36%|███▌      | 25/70 [00:00<00:00, 45.12it/s] 50%|█████     | 35/70 [00:00<00:00, 58.11it/s] 64%|██████▍   | 45/70 [00:01<00:00, 68.31it/s] 79%|███████▊  | 55/70 [00:01<00:00, 75.71it/s] 93%|█████████▎| 65/70 [00:01<00:00, 81.62it/s]100%|██████████| 70/70 [00:01<00:00, 53.51it/s]
8925 images processed, 1.3379299640655518 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:00<00:41,  1.07it/s]  4%|▍         | 2/45 [00:01<00:20,  2.14it/s] 20%|██        | 9/45 [00:01<00:03,  9.50it/s] 24%|██▍       | 11/45 [00:01<00:03,  8.72it/s] 38%|███▊      | 17/45 [00:01<00:02, 12.60it/s] 42%|████▏     | 19/45 [00:02<00:02, 11.48it/s] 53%|█████▎    | 24/45 [00:02<00:01, 16.36it/s] 60%|██████    | 27/45 [00:02<00:01, 11.73it/s] 73%|███████▎  | 33/45 [00:03<00:01, 11.80it/s] 78%|███████▊  | 35/45 [00:03<00:00, 10.65it/s] 91%|█████████ | 41/45 [00:03<00:00, 14.19it/s] 96%|█████████▌| 43/45 [00:04<00:00,  9.62it/s]100%|██████████| 45/45 [00:04<00:00, 10.33it/s]
5640 images processed, 4.3820788860321045 seconds used

20.021161794662476
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.51  99.36
places365     67.79  81.19
LSUN          17.12  96.14
iSUN          71.69  81.88
dtd           37.87  91.35
AVG           39.40  89.98
Retain-Acc: 0.7396
Forget-as-OOD (retain known vs forget novel):
  FPR: 78.90 AUROC: 86.96 AUIN: 98.37
18.563416957855225
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e50-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid
epochs=50 | cache=6 | flambda=1.0 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e50-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e50-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e50-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21843904
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<03:42,  1.75it/s]  3%|▎         | 11/391 [00:00<00:17, 21.21it/s]  5%|▌         | 21/391 [00:00<00:09, 38.11it/s]  8%|▊         | 31/391 [00:00<00:06, 52.26it/s] 10%|█         | 41/391 [00:00<00:05, 63.62it/s] 13%|█▎        | 50/391 [00:01<00:05, 66.71it/s] 15%|█▌        | 59/391 [00:01<00:05, 66.10it/s] 18%|█▊        | 69/391 [00:01<00:04, 73.17it/s] 20%|██        | 79/391 [00:01<00:03, 78.94it/s] 23%|██▎       | 88/391 [00:01<00:04, 74.18it/s] 25%|██▍       | 96/391 [00:01<00:04, 72.08it/s] 27%|██▋       | 106/391 [00:01<00:03, 78.27it/s] 30%|██▉       | 116/391 [00:01<00:03, 82.82it/s] 32%|███▏      | 126/391 [00:02<00:03, 84.61it/s] 35%|███▍      | 135/391 [00:02<00:03, 74.87it/s] 37%|███▋      | 144/391 [00:02<00:03, 78.13it/s] 39%|███▉      | 154/391 [00:02<00:02, 81.74it/s] 42%|████▏     | 164/391 [00:02<00:02, 85.24it/s] 45%|████▍     | 174/391 [00:02<00:02, 88.00it/s] 47%|████▋     | 184/391 [00:02<00:02, 89.78it/s] 50%|████▉     | 194/391 [00:02<00:02, 91.35it/s] 52%|█████▏    | 204/391 [00:02<00:02, 92.22it/s] 55%|█████▍    | 214/391 [00:03<00:02, 82.90it/s] 57%|█████▋    | 223/391 [00:03<00:02, 80.06it/s] 60%|█████▉    | 233/391 [00:03<00:01, 82.95it/s] 62%|██████▏   | 242/391 [00:03<00:01, 82.52it/s] 64%|██████▍   | 251/391 [00:03<00:01, 82.43it/s] 67%|██████▋   | 261/391 [00:03<00:01, 85.48it/s] 69%|██████▉   | 271/391 [00:03<00:01, 88.03it/s] 72%|███████▏  | 281/391 [00:03<00:01, 89.37it/s] 74%|███████▍  | 291/391 [00:03<00:01, 90.29it/s] 77%|███████▋  | 301/391 [00:04<00:01, 84.60it/s] 79%|███████▉  | 310/391 [00:04<00:01, 78.18it/s] 82%|████████▏ | 320/391 [00:04<00:00, 82.10it/s] 84%|████████▍ | 330/391 [00:04<00:00, 84.34it/s] 87%|████████▋ | 340/391 [00:04<00:00, 86.19it/s] 89%|████████▉ | 349/391 [00:04<00:00, 81.00it/s] 92%|█████████▏| 358/391 [00:04<00:00, 75.80it/s] 94%|█████████▍| 368/391 [00:04<00:00, 80.92it/s] 96%|█████████▋| 377/391 [00:05<00:00, 81.44it/s] 99%|█████████▉| 387/391 [00:05<00:00, 85.86it/s]100%|██████████| 391/391 [00:05<00:00, 75.05it/s]
50000 images processed, 5.3003294467926025 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:21,  3.64it/s] 10%|█         | 8/79 [00:00<00:02, 24.93it/s] 19%|█▉        | 15/79 [00:00<00:01, 38.70it/s] 32%|███▏      | 25/79 [00:00<00:00, 55.65it/s] 43%|████▎     | 34/79 [00:00<00:00, 64.62it/s] 56%|█████▌    | 44/79 [00:00<00:00, 73.91it/s] 68%|██████▊   | 54/79 [00:00<00:00, 80.12it/s] 81%|████████  | 64/79 [00:01<00:00, 84.29it/s] 94%|█████████▎| 74/79 [00:01<00:00, 87.78it/s]100%|██████████| 79/79 [00:01<00:00, 66.21it/s]
10000 images processed, 1.2115898132324219 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<00:56,  3.58it/s]  5%|▌         | 11/204 [00:00<00:05, 35.34it/s] 10%|█         | 21/204 [00:00<00:03, 54.79it/s] 14%|█▍        | 29/204 [00:00<00:02, 61.39it/s] 18%|█▊        | 37/204 [00:00<00:02, 61.15it/s] 23%|██▎       | 46/204 [00:00<00:02, 68.77it/s] 27%|██▋       | 56/204 [00:00<00:01, 75.99it/s] 32%|███▏      | 65/204 [00:01<00:01, 78.15it/s] 37%|███▋      | 75/204 [00:01<00:01, 82.63it/s] 42%|████▏     | 85/204 [00:01<00:01, 85.58it/s] 47%|████▋     | 95/204 [00:01<00:01, 86.24it/s] 51%|█████     | 104/204 [00:01<00:01, 79.47it/s] 55%|█████▌    | 113/204 [00:01<00:01, 71.41it/s] 59%|█████▉    | 121/204 [00:01<00:01, 67.86it/s] 64%|██████▍   | 131/204 [00:01<00:00, 74.19it/s] 69%|██████▉   | 141/204 [00:02<00:00, 79.44it/s] 74%|███████▍  | 151/204 [00:02<00:00, 83.37it/s] 79%|███████▉  | 161/204 [00:02<00:00, 85.95it/s] 84%|████████▍ | 171/204 [00:02<00:00, 87.80it/s] 89%|████████▊ | 181/204 [00:02<00:00, 88.74it/s] 93%|█████████▎| 190/204 [00:02<00:00, 85.38it/s] 98%|█████████▊| 199/204 [00:02<00:00, 76.23it/s]100%|██████████| 204/204 [00:02<00:00, 73.35it/s]
26032 images processed, 2.823875665664673 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:46,  1.69it/s] 11%|█▏        | 9/79 [00:00<00:04, 15.37it/s] 19%|█▉        | 15/79 [00:00<00:02, 23.95it/s] 25%|██▌       | 20/79 [00:01<00:02, 25.26it/s] 35%|███▌      | 28/79 [00:01<00:01, 29.67it/s] 46%|████▌     | 36/79 [00:01<00:01, 32.25it/s] 56%|█████▌    | 44/79 [00:01<00:00, 35.68it/s] 66%|██████▌   | 52/79 [00:01<00:00, 41.09it/s] 76%|███████▌  | 60/79 [00:01<00:00, 44.86it/s] 84%|████████▎ | 66/79 [00:02<00:00, 47.18it/s] 91%|█████████ | 72/79 [00:02<00:00, 49.55it/s] 99%|█████████▊| 78/79 [00:02<00:00, 46.43it/s]100%|██████████| 79/79 [00:02<00:00, 34.45it/s]
10000 images processed, 2.3287556171417236 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:35,  2.17it/s] 13%|█▎        | 10/79 [00:00<00:03, 22.69it/s] 25%|██▌       | 20/79 [00:00<00:01, 41.38it/s] 37%|███▋      | 29/79 [00:00<00:00, 53.48it/s] 48%|████▊     | 38/79 [00:00<00:00, 62.18it/s] 61%|██████    | 48/79 [00:00<00:00, 71.32it/s] 73%|███████▎  | 58/79 [00:01<00:00, 77.82it/s] 86%|████████▌ | 68/79 [00:01<00:00, 82.69it/s] 99%|█████████▊| 78/79 [00:01<00:00, 86.31it/s]100%|██████████| 79/79 [00:01<00:00, 60.26it/s]
10000 images processed, 1.3352792263031006 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:28,  2.41it/s] 16%|█▌        | 11/70 [00:00<00:02, 27.06it/s] 30%|███       | 21/70 [00:00<00:01, 45.80it/s] 44%|████▍     | 31/70 [00:00<00:00, 59.15it/s] 59%|█████▊    | 41/70 [00:00<00:00, 69.08it/s] 73%|███████▎  | 51/70 [00:00<00:00, 76.46it/s] 87%|████████▋ | 61/70 [00:01<00:00, 81.87it/s]100%|██████████| 70/70 [00:01<00:00, 60.73it/s]
8925 images processed, 1.1853008270263672 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:00<00:42,  1.03it/s]  4%|▍         | 2/45 [00:01<00:20,  2.07it/s] 20%|██        | 9/45 [00:01<00:03,  9.04it/s] 24%|██▍       | 11/45 [00:01<00:03,  9.19it/s] 31%|███       | 14/45 [00:01<00:02, 11.94it/s] 38%|███▊      | 17/45 [00:02<00:02, 11.59it/s] 49%|████▉     | 22/45 [00:02<00:01, 14.77it/s] 56%|█████▌    | 25/45 [00:02<00:01, 12.66it/s] 67%|██████▋   | 30/45 [00:02<00:00, 16.17it/s] 73%|███████▎  | 33/45 [00:03<00:01, 10.69it/s] 89%|████████▉ | 40/45 [00:03<00:00, 17.43it/s] 98%|█████████▊| 44/45 [00:03<00:00, 12.76it/s]100%|██████████| 45/45 [00:03<00:00, 11.29it/s]
5640 images processed, 4.006032228469849 seconds used

20.08504581451416
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           4.85  98.93
places365     76.92  78.31
LSUN          27.55  94.87
iSUN          77.24  80.34
dtd           45.60  89.56
AVG           46.43  88.40
Retain-Acc: 0.7390
Forget-as-OOD (retain known vs forget novel):
  FPR: 42.20 AUROC: 91.26 AUIN: 98.86
23.775895595550537
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e5-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid
epochs=5 | cache=6 | flambda=1.0 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21843904
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<01:54,  3.41it/s]  3%|▎         | 11/391 [00:00<00:11, 34.49it/s]  5%|▌         | 21/391 [00:00<00:06, 54.39it/s]  7%|▋         | 29/391 [00:00<00:05, 61.32it/s]  9%|▉         | 37/391 [00:00<00:05, 61.85it/s] 12%|█▏        | 45/391 [00:00<00:05, 61.76it/s] 13%|█▎        | 52/391 [00:00<00:05, 62.50it/s] 16%|█▌        | 61/391 [00:01<00:04, 68.57it/s] 18%|█▊        | 71/391 [00:01<00:04, 75.89it/s] 21%|██        | 81/391 [00:01<00:03, 80.86it/s] 23%|██▎       | 91/391 [00:01<00:03, 84.35it/s] 26%|██▌       | 101/391 [00:01<00:03, 87.57it/s] 28%|██▊       | 111/391 [00:01<00:03, 90.11it/s] 31%|███       | 121/391 [00:01<00:03, 83.23it/s] 33%|███▎      | 130/391 [00:01<00:03, 78.44it/s] 36%|███▌      | 140/391 [00:01<00:03, 83.10it/s] 38%|███▊      | 150/391 [00:02<00:02, 86.54it/s] 41%|████      | 160/391 [00:02<00:02, 88.91it/s] 43%|████▎     | 170/391 [00:02<00:02, 88.65it/s] 46%|████▌     | 179/391 [00:02<00:02, 79.02it/s] 48%|████▊     | 188/391 [00:02<00:02, 79.45it/s] 51%|█████     | 198/391 [00:02<00:02, 83.84it/s] 53%|█████▎    | 208/391 [00:02<00:02, 87.01it/s] 56%|█████▌    | 218/391 [00:02<00:01, 88.97it/s] 58%|█████▊    | 228/391 [00:02<00:01, 90.41it/s] 61%|██████    | 238/391 [00:03<00:01, 91.78it/s] 63%|██████▎   | 248/391 [00:03<00:01, 92.89it/s] 66%|██████▌   | 258/391 [00:03<00:01, 93.57it/s] 69%|██████▊   | 268/391 [00:03<00:01, 92.29it/s] 71%|███████   | 278/391 [00:03<00:01, 81.58it/s] 73%|███████▎  | 287/391 [00:03<00:01, 81.80it/s] 76%|███████▌  | 297/391 [00:03<00:01, 85.03it/s] 78%|███████▊  | 306/391 [00:03<00:00, 85.91it/s] 81%|████████  | 316/391 [00:04<00:00, 88.54it/s] 83%|████████▎ | 325/391 [00:04<00:00, 88.88it/s] 86%|████████▌ | 335/391 [00:04<00:00, 90.51it/s] 88%|████████▊ | 345/391 [00:04<00:00, 91.43it/s] 91%|█████████ | 355/391 [00:04<00:00, 87.82it/s] 93%|█████████▎| 364/391 [00:04<00:00, 81.08it/s] 95%|█████████▌| 373/391 [00:04<00:00, 77.54it/s] 98%|█████████▊| 383/391 [00:04<00:00, 82.38it/s]100%|██████████| 391/391 [00:04<00:00, 79.87it/s]
50000 images processed, 4.971000671386719 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:22,  3.54it/s] 14%|█▍        | 11/79 [00:00<00:01, 34.92it/s] 27%|██▋       | 21/79 [00:00<00:01, 54.24it/s] 39%|███▉      | 31/79 [00:00<00:00, 67.13it/s] 51%|█████     | 40/79 [00:00<00:00, 70.51it/s] 61%|██████    | 48/79 [00:00<00:00, 66.24it/s] 73%|███████▎  | 58/79 [00:00<00:00, 74.05it/s] 86%|████████▌ | 68/79 [00:01<00:00, 79.90it/s] 99%|█████████▊| 78/79 [00:01<00:00, 84.62it/s]100%|██████████| 79/79 [00:01<00:00, 66.08it/s]
10000 images processed, 1.2175679206848145 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:03,  3.20it/s]  5%|▌         | 11/204 [00:00<00:05, 32.92it/s] 10%|█         | 21/204 [00:00<00:03, 52.17it/s] 15%|█▌        | 31/204 [00:00<00:02, 65.21it/s] 20%|██        | 41/204 [00:00<00:02, 74.08it/s] 25%|██▌       | 51/204 [00:00<00:01, 80.37it/s] 30%|██▉       | 61/204 [00:00<00:01, 84.83it/s] 35%|███▍      | 71/204 [00:01<00:01, 87.95it/s] 40%|███▉      | 81/204 [00:01<00:01, 90.08it/s] 45%|████▍     | 91/204 [00:01<00:01, 83.12it/s] 49%|████▉     | 100/204 [00:01<00:01, 77.99it/s] 54%|█████▍    | 110/204 [00:01<00:01, 82.12it/s] 58%|█████▊    | 119/204 [00:01<00:01, 82.59it/s] 63%|██████▎   | 129/204 [00:01<00:00, 85.80it/s] 68%|██████▊   | 139/204 [00:01<00:00, 87.66it/s] 73%|███████▎  | 149/204 [00:01<00:00, 89.59it/s] 78%|███████▊  | 159/204 [00:02<00:00, 90.46it/s] 83%|████████▎ | 169/204 [00:02<00:00, 91.65it/s] 88%|████████▊ | 179/204 [00:02<00:00, 86.43it/s] 92%|█████████▏| 188/204 [00:02<00:00, 78.03it/s] 97%|█████████▋| 198/204 [00:02<00:00, 82.86it/s]100%|██████████| 204/204 [00:02<00:00, 77.47it/s]
26032 images processed, 2.680732011795044 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:35,  2.18it/s] 11%|█▏        | 9/79 [00:00<00:03, 18.47it/s] 22%|██▏       | 17/79 [00:00<00:02, 28.52it/s] 32%|███▏      | 25/79 [00:00<00:01, 34.79it/s] 41%|████      | 32/79 [00:01<00:01, 42.21it/s] 48%|████▊     | 38/79 [00:01<00:01, 39.58it/s] 58%|█████▊    | 46/79 [00:01<00:00, 47.76it/s] 66%|██████▌   | 52/79 [00:01<00:00, 47.84it/s] 73%|███████▎  | 58/79 [00:01<00:00, 47.86it/s] 82%|████████▏ | 65/79 [00:01<00:00, 47.85it/s] 92%|█████████▏| 73/79 [00:01<00:00, 48.64it/s]100%|██████████| 79/79 [00:01<00:00, 40.80it/s]
10000 images processed, 1.9706602096557617 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:25,  3.03it/s] 14%|█▍        | 11/79 [00:00<00:02, 31.79it/s] 25%|██▌       | 20/79 [00:00<00:01, 48.72it/s] 35%|███▌      | 28/79 [00:00<00:00, 53.35it/s] 44%|████▍     | 35/79 [00:00<00:00, 57.31it/s] 57%|█████▋    | 45/79 [00:00<00:00, 68.39it/s] 68%|██████▊   | 54/79 [00:00<00:00, 72.95it/s] 81%|████████  | 64/79 [00:01<00:00, 79.51it/s] 94%|█████████▎| 74/79 [00:01<00:00, 84.17it/s]100%|██████████| 79/79 [00:01<00:00, 63.68it/s]
10000 images processed, 1.2607753276824951 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:21,  3.17it/s] 14%|█▍        | 10/70 [00:00<00:02, 28.82it/s] 24%|██▍       | 17/70 [00:00<00:01, 39.58it/s] 37%|███▋      | 26/70 [00:00<00:00, 52.94it/s] 51%|█████▏    | 36/70 [00:00<00:00, 65.42it/s] 66%|██████▌   | 46/70 [00:00<00:00, 73.42it/s] 79%|███████▊  | 55/70 [00:00<00:00, 75.21it/s] 91%|█████████▏| 64/70 [00:01<00:00, 70.00it/s]100%|██████████| 70/70 [00:01<00:00, 58.06it/s]
8925 images processed, 1.2352144718170166 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:00<00:34,  1.26it/s]  4%|▍         | 2/45 [00:01<00:19,  2.21it/s] 20%|██        | 9/45 [00:01<00:03, 10.91it/s] 24%|██▍       | 11/45 [00:01<00:03,  8.64it/s] 36%|███▌      | 16/45 [00:01<00:02, 13.36it/s] 40%|████      | 18/45 [00:02<00:02, 10.38it/s] 53%|█████▎    | 24/45 [00:02<00:01, 12.68it/s] 58%|█████▊    | 26/45 [00:02<00:01, 11.98it/s] 69%|██████▉   | 31/45 [00:02<00:00, 16.96it/s] 76%|███████▌  | 34/45 [00:03<00:01, 10.16it/s] 89%|████████▉ | 40/45 [00:03<00:00, 12.76it/s] 93%|█████████▎| 42/45 [00:04<00:00,  9.36it/s]100%|██████████| 45/45 [00:04<00:00, 10.59it/s]
5640 images processed, 4.271086692810059 seconds used

19.352399826049805
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.52  99.36
places365     67.87  81.18
LSUN          17.60  96.07
iSUN          72.34  81.68
dtd           37.87  91.39
AVG           39.64  89.94
Retain-Acc: 0.7406
Forget-as-OOD (retain known vs forget novel):
  FPR: 79.50 AUROC: 86.90 AUIN: 98.36
13.636625289916992
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e10-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid
epochs=10 | cache=6 | flambda=1.0 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e10-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e10-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e10-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21843904
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<01:51,  3.50it/s]  2%|▏         | 9/391 [00:00<00:13, 28.30it/s]  4%|▍         | 16/391 [00:00<00:09, 39.83it/s]  6%|▋         | 25/391 [00:00<00:06, 54.76it/s]  9%|▉         | 35/391 [00:00<00:05, 67.47it/s] 11%|█▏        | 44/391 [00:00<00:04, 73.32it/s] 14%|█▍        | 54/391 [00:00<00:04, 79.24it/s] 16%|█▋        | 64/391 [00:01<00:03, 83.85it/s] 19%|█▉        | 74/391 [00:01<00:03, 87.44it/s] 21%|██▏       | 84/391 [00:01<00:03, 89.43it/s] 24%|██▍       | 94/391 [00:01<00:03, 91.33it/s] 27%|██▋       | 104/391 [00:01<00:03, 92.62it/s] 29%|██▉       | 114/391 [00:01<00:03, 89.79it/s] 32%|███▏      | 124/391 [00:01<00:03, 78.64it/s] 34%|███▍      | 134/391 [00:01<00:03, 83.26it/s] 37%|███▋      | 144/391 [00:01<00:02, 86.61it/s] 39%|███▉      | 153/391 [00:02<00:02, 86.82it/s] 42%|████▏     | 163/391 [00:02<00:02, 88.77it/s] 44%|████▍     | 173/391 [00:02<00:02, 89.30it/s] 47%|████▋     | 183/391 [00:02<00:02, 90.00it/s] 49%|████▉     | 193/391 [00:02<00:02, 90.88it/s] 52%|█████▏    | 203/391 [00:02<00:02, 91.27it/s] 54%|█████▍    | 213/391 [00:02<00:02, 80.20it/s] 57%|█████▋    | 222/391 [00:02<00:02, 79.14it/s] 59%|█████▉    | 232/391 [00:02<00:01, 82.20it/s] 62%|██████▏   | 242/391 [00:03<00:01, 85.30it/s] 64%|██████▍   | 252/391 [00:03<00:01, 88.12it/s] 67%|██████▋   | 262/391 [00:03<00:01, 90.42it/s] 70%|██████▉   | 272/391 [00:03<00:01, 92.01it/s] 72%|███████▏  | 282/391 [00:03<00:01, 93.18it/s] 75%|███████▍  | 292/391 [00:03<00:01, 93.90it/s] 77%|███████▋  | 302/391 [00:03<00:01, 80.90it/s] 80%|███████▉  | 311/391 [00:03<00:00, 81.21it/s] 82%|████████▏ | 320/391 [00:03<00:00, 83.27it/s] 84%|████████▍ | 329/391 [00:04<00:00, 84.72it/s] 87%|████████▋ | 339/391 [00:04<00:00, 87.46it/s] 89%|████████▉ | 349/391 [00:04<00:00, 89.61it/s] 92%|█████████▏| 359/391 [00:04<00:00, 90.98it/s] 94%|█████████▍| 369/391 [00:04<00:00, 79.53it/s] 97%|█████████▋| 378/391 [00:04<00:00, 79.59it/s] 99%|█████████▉| 388/391 [00:04<00:00, 84.12it/s]100%|██████████| 391/391 [00:04<00:00, 81.03it/s]
50000 images processed, 4.931298017501831 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:29,  2.65it/s] 13%|█▎        | 10/79 [00:00<00:02, 26.55it/s] 20%|██        | 16/79 [00:00<00:01, 35.18it/s] 30%|███       | 24/79 [00:00<00:01, 47.03it/s] 43%|████▎     | 34/79 [00:00<00:00, 61.31it/s] 56%|█████▌    | 44/79 [00:00<00:00, 69.46it/s] 67%|██████▋   | 53/79 [00:01<00:00, 75.15it/s] 80%|███████▉  | 63/79 [00:01<00:00, 81.06it/s] 92%|█████████▏| 73/79 [00:01<00:00, 85.65it/s]100%|██████████| 79/79 [00:01<00:00, 60.67it/s]
10000 images processed, 1.3261663913726807 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<00:58,  3.46it/s]  5%|▌         | 11/204 [00:00<00:05, 34.50it/s] 10%|█         | 21/204 [00:00<00:03, 53.91it/s] 15%|█▌        | 31/204 [00:00<00:02, 65.98it/s] 20%|██        | 41/204 [00:00<00:02, 74.71it/s] 25%|██▌       | 51/204 [00:00<00:01, 80.20it/s] 29%|██▉       | 60/204 [00:00<00:02, 70.63it/s] 34%|███▍      | 69/204 [00:01<00:01, 75.11it/s] 38%|███▊      | 78/204 [00:01<00:01, 77.56it/s] 43%|████▎     | 88/204 [00:01<00:01, 81.72it/s] 48%|████▊     | 98/204 [00:01<00:01, 85.02it/s] 53%|█████▎    | 108/204 [00:01<00:01, 87.06it/s] 58%|█████▊    | 118/204 [00:01<00:00, 88.52it/s] 63%|██████▎   | 128/204 [00:01<00:00, 89.79it/s] 68%|██████▊   | 138/204 [00:01<00:00, 90.78it/s] 73%|███████▎  | 148/204 [00:01<00:00, 84.79it/s] 77%|███████▋  | 157/204 [00:02<00:00, 77.90it/s] 82%|████████▏ | 167/204 [00:02<00:00, 81.70it/s] 86%|████████▋ | 176/204 [00:02<00:00, 81.57it/s] 91%|█████████ | 185/204 [00:02<00:00, 83.08it/s] 95%|█████████▌| 194/204 [00:02<00:00, 83.91it/s]100%|█████████▉| 203/204 [00:02<00:00, 73.47it/s]100%|██████████| 204/204 [00:02<00:00, 74.84it/s]
26032 images processed, 2.7653558254241943 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:45,  1.73it/s] 11%|█▏        | 9/79 [00:00<00:04, 15.38it/s] 19%|█▉        | 15/79 [00:00<00:02, 23.97it/s] 25%|██▌       | 20/79 [00:00<00:02, 28.06it/s] 33%|███▎      | 26/79 [00:01<00:01, 35.09it/s] 42%|████▏     | 33/79 [00:01<00:01, 39.23it/s] 49%|████▉     | 39/79 [00:01<00:00, 43.99it/s] 57%|█████▋    | 45/79 [00:01<00:00, 46.19it/s] 65%|██████▍   | 51/79 [00:01<00:00, 45.27it/s] 72%|███████▏  | 57/79 [00:01<00:00, 48.65it/s] 80%|███████▉  | 63/79 [00:01<00:00, 47.07it/s] 87%|████████▋ | 69/79 [00:01<00:00, 50.05it/s] 95%|█████████▍| 75/79 [00:02<00:00, 48.04it/s]100%|██████████| 79/79 [00:02<00:00, 37.01it/s]
10000 images processed, 2.182047128677368 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:23,  3.35it/s] 14%|█▍        | 11/79 [00:00<00:02, 33.84it/s] 25%|██▌       | 20/79 [00:00<00:01, 50.67it/s] 37%|███▋      | 29/79 [00:00<00:00, 61.85it/s] 49%|████▉     | 39/79 [00:00<00:00, 71.10it/s] 62%|██████▏   | 49/79 [00:00<00:00, 77.68it/s] 75%|███████▍  | 59/79 [00:00<00:00, 82.41it/s] 87%|████████▋ | 69/79 [00:01<00:00, 85.62it/s]100%|██████████| 79/79 [00:01<00:00, 68.86it/s]
10000 images processed, 1.172452449798584 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:29,  2.33it/s] 11%|█▏        | 8/70 [00:00<00:03, 18.68it/s] 24%|██▍       | 17/70 [00:00<00:01, 36.91it/s] 37%|███▋      | 26/70 [00:00<00:00, 50.76it/s] 50%|█████     | 35/70 [00:00<00:00, 60.42it/s] 64%|██████▍   | 45/70 [00:00<00:00, 70.09it/s] 79%|███████▊  | 55/70 [00:01<00:00, 76.86it/s] 93%|█████████▎| 65/70 [00:01<00:00, 82.41it/s]100%|██████████| 70/70 [00:01<00:00, 57.06it/s]
8925 images processed, 1.2550837993621826 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:01<00:44,  1.01s/it] 20%|██        | 9/45 [00:01<00:05,  6.77it/s] 31%|███       | 14/45 [00:01<00:02, 10.53it/s] 38%|███▊      | 17/45 [00:02<00:03,  8.32it/s] 47%|████▋     | 21/45 [00:02<00:02, 11.18it/s] 56%|█████▌    | 25/45 [00:02<00:02,  9.46it/s] 64%|██████▍   | 29/45 [00:03<00:01, 12.10it/s] 73%|███████▎  | 33/45 [00:03<00:01,  9.88it/s] 91%|█████████ | 41/45 [00:04<00:00, 12.80it/s]100%|██████████| 45/45 [00:04<00:00, 10.82it/s]
5640 images processed, 4.191006898880005 seconds used

19.471039056777954
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.52  99.36
places365     67.89  81.18
LSUN          17.54  96.08
iSUN          72.38  81.70
dtd           37.89  91.39
AVG           39.64  89.94
Retain-Acc: 0.7406
Forget-as-OOD (retain known vs forget novel):
  FPR: 79.50 AUROC: 86.90 AUIN: 98.36
24.089102029800415
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e20-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid
epochs=20 | cache=6 | flambda=1.0 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e20-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e20-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e20-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21843904
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<02:18,  2.81it/s]  3%|▎         | 11/391 [00:00<00:12, 30.25it/s]  5%|▌         | 21/391 [00:00<00:07, 49.59it/s]  8%|▊         | 31/391 [00:00<00:05, 63.16it/s] 10%|█         | 41/391 [00:00<00:04, 72.51it/s] 13%|█▎        | 51/391 [00:00<00:04, 79.13it/s] 16%|█▌        | 61/391 [00:00<00:03, 84.01it/s] 18%|█▊        | 71/391 [00:01<00:03, 82.10it/s] 20%|██        | 80/391 [00:01<00:04, 74.79it/s] 23%|██▎       | 90/391 [00:01<00:03, 79.96it/s] 25%|██▌       | 99/391 [00:01<00:03, 82.01it/s] 28%|██▊       | 109/391 [00:01<00:03, 84.79it/s] 30%|███       | 119/391 [00:01<00:03, 87.90it/s] 33%|███▎      | 129/391 [00:01<00:02, 89.73it/s] 36%|███▌      | 139/391 [00:01<00:02, 91.50it/s] 38%|███▊      | 149/391 [00:02<00:02, 82.23it/s] 40%|████      | 158/391 [00:02<00:02, 79.85it/s] 43%|████▎     | 168/391 [00:02<00:02, 83.75it/s] 45%|████▌     | 177/391 [00:02<00:02, 85.19it/s] 48%|████▊     | 186/391 [00:02<00:02, 85.96it/s] 50%|█████     | 196/391 [00:02<00:02, 88.33it/s] 53%|█████▎    | 206/391 [00:02<00:02, 90.31it/s] 55%|█████▌    | 216/391 [00:02<00:01, 91.57it/s] 58%|█████▊    | 226/391 [00:02<00:01, 92.62it/s] 60%|██████    | 236/391 [00:03<00:01, 92.74it/s] 63%|██████▎   | 246/391 [00:03<00:01, 93.22it/s] 65%|██████▌   | 256/391 [00:03<00:01, 87.01it/s] 68%|██████▊   | 265/391 [00:03<00:01, 78.33it/s] 70%|███████   | 275/391 [00:03<00:01, 82.75it/s] 73%|███████▎  | 285/391 [00:03<00:01, 83.32it/s] 75%|███████▌  | 295/391 [00:03<00:01, 85.67it/s] 78%|███████▊  | 305/391 [00:03<00:00, 87.97it/s] 81%|████████  | 315/391 [00:03<00:00, 89.71it/s] 83%|████████▎ | 325/391 [00:04<00:00, 90.90it/s] 86%|████████▌ | 335/391 [00:04<00:00, 91.31it/s] 88%|████████▊ | 345/391 [00:04<00:00, 91.15it/s] 91%|█████████ | 355/391 [00:04<00:00, 75.31it/s] 93%|█████████▎| 364/391 [00:04<00:00, 69.20it/s] 95%|█████████▌| 373/391 [00:04<00:00, 73.78it/s] 98%|█████████▊| 382/391 [00:04<00:00, 77.19it/s]100%|██████████| 391/391 [00:04<00:00, 79.90it/s]100%|██████████| 391/391 [00:04<00:00, 79.60it/s]
50000 images processed, 5.000391244888306 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:23,  3.28it/s] 13%|█▎        | 10/79 [00:00<00:02, 30.67it/s] 25%|██▌       | 20/79 [00:00<00:01, 51.28it/s] 38%|███▊      | 30/79 [00:00<00:00, 64.62it/s] 49%|████▉     | 39/79 [00:00<00:00, 63.57it/s] 59%|█████▉    | 47/79 [00:00<00:00, 66.41it/s] 71%|███████   | 56/79 [00:00<00:00, 71.98it/s] 82%|████████▏ | 65/79 [00:01<00:00, 74.63it/s] 92%|█████████▏| 73/79 [00:01<00:00, 75.94it/s]100%|██████████| 79/79 [00:01<00:00, 62.59it/s]
10000 images processed, 1.2868621349334717 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:09,  2.94it/s]  5%|▌         | 11/204 [00:00<00:06, 30.91it/s] 10%|█         | 21/204 [00:00<00:03, 49.88it/s] 15%|█▌        | 31/204 [00:00<00:02, 62.55it/s] 19%|█▉        | 39/204 [00:00<00:02, 65.80it/s] 23%|██▎       | 47/204 [00:00<00:02, 62.84it/s] 28%|██▊       | 57/204 [00:01<00:02, 70.82it/s] 33%|███▎      | 67/204 [00:01<00:01, 75.16it/s] 37%|███▋      | 76/204 [00:01<00:01, 78.02it/s] 42%|████▏     | 86/204 [00:01<00:01, 81.70it/s] 47%|████▋     | 96/204 [00:01<00:01, 84.32it/s] 52%|█████▏    | 106/204 [00:01<00:01, 86.53it/s] 57%|█████▋    | 116/204 [00:01<00:01, 87.78it/s] 61%|██████▏   | 125/204 [00:01<00:00, 88.36it/s] 66%|██████▌   | 134/204 [00:01<00:00, 85.11it/s] 70%|███████   | 143/204 [00:02<00:00, 74.63it/s] 75%|███████▌  | 153/204 [00:02<00:00, 79.17it/s] 79%|███████▉  | 162/204 [00:02<00:00, 80.98it/s] 84%|████████▍ | 172/204 [00:02<00:00, 84.33it/s] 89%|████████▊ | 181/204 [00:02<00:00, 85.65it/s] 94%|█████████▎| 191/204 [00:02<00:00, 87.39it/s] 99%|█████████▊| 201/204 [00:02<00:00, 89.62it/s]100%|██████████| 204/204 [00:02<00:00, 74.58it/s]
26032 images processed, 2.7790262699127197 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:51,  1.51it/s] 11%|█▏        | 9/79 [00:00<00:05, 13.58it/s] 22%|██▏       | 17/79 [00:01<00:02, 22.00it/s] 32%|███▏      | 25/79 [00:01<00:01, 28.59it/s] 42%|████▏     | 33/79 [00:01<00:01, 34.47it/s] 52%|█████▏    | 41/79 [00:01<00:01, 36.93it/s] 62%|██████▏   | 49/79 [00:01<00:00, 38.89it/s] 72%|███████▏  | 57/79 [00:01<00:00, 41.66it/s] 81%|████████  | 64/79 [00:02<00:00, 45.70it/s] 92%|█████████▏| 73/79 [00:02<00:00, 49.03it/s]100%|██████████| 79/79 [00:02<00:00, 35.32it/s]
10000 images processed, 2.2783257961273193 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:38,  2.03it/s] 14%|█▍        | 11/79 [00:00<00:02, 23.54it/s] 25%|██▌       | 20/79 [00:00<00:01, 38.99it/s] 34%|███▍      | 27/79 [00:00<00:01, 45.39it/s] 43%|████▎     | 34/79 [00:00<00:00, 50.40it/s] 54%|█████▍    | 43/79 [00:01<00:00, 60.19it/s] 66%|██████▌   | 52/79 [00:01<00:00, 67.57it/s] 77%|███████▋  | 61/79 [00:01<00:00, 72.71it/s] 90%|████████▉ | 71/79 [00:01<00:00, 78.73it/s]100%|██████████| 79/79 [00:01<00:00, 55.23it/s]
10000 images processed, 1.4637665748596191 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:35,  1.96it/s] 11%|█▏        | 8/70 [00:00<00:03, 16.51it/s] 26%|██▌       | 18/70 [00:00<00:01, 35.36it/s] 40%|████      | 28/70 [00:00<00:00, 50.14it/s] 53%|█████▎    | 37/70 [00:00<00:00, 58.70it/s] 67%|██████▋   | 47/70 [00:01<00:00, 68.14it/s] 81%|████████▏ | 57/70 [00:01<00:00, 75.23it/s] 96%|█████████▌| 67/70 [00:01<00:00, 80.69it/s]100%|██████████| 70/70 [00:01<00:00, 53.30it/s]
8925 images processed, 1.3539235591888428 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:01<00:46,  1.06s/it]  4%|▍         | 2/45 [00:01<00:21,  1.98it/s] 20%|██        | 9/45 [00:01<00:04,  8.73it/s] 24%|██▍       | 11/45 [00:01<00:03,  8.59it/s] 31%|███       | 14/45 [00:01<00:02, 10.97it/s] 38%|███▊      | 17/45 [00:02<00:02, 11.52it/s] 42%|████▏     | 19/45 [00:02<00:02, 12.05it/s] 49%|████▉     | 22/45 [00:02<00:01, 12.56it/s] 56%|█████▌    | 25/45 [00:02<00:01, 13.78it/s] 60%|██████    | 27/45 [00:02<00:01, 14.77it/s] 67%|██████▋   | 30/45 [00:03<00:01, 11.84it/s] 73%|███████▎  | 33/45 [00:03<00:01, 11.99it/s] 84%|████████▍ | 38/45 [00:03<00:00, 17.62it/s] 91%|█████████ | 41/45 [00:03<00:00, 13.24it/s] 96%|█████████▌| 43/45 [00:04<00:00, 11.80it/s]100%|██████████| 45/45 [00:04<00:00, 10.90it/s]
5640 images processed, 4.1520912647247314 seconds used

19.98258090019226
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.51  99.36
places365     67.91  81.18
LSUN          17.50  96.09
iSUN          72.35  81.72
dtd           37.89  91.39
AVG           39.63  89.95
Retain-Acc: 0.7406
Forget-as-OOD (retain known vs forget novel):
  FPR: 79.50 AUROC: 86.90 AUIN: 98.36
15.199515342712402
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e50-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid
epochs=50 | cache=6 | flambda=1.0 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e50-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e50-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e50-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21843904
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<02:41,  2.42it/s]  3%|▎         | 11/391 [00:00<00:14, 27.11it/s]  5%|▌         | 20/391 [00:00<00:08, 42.61it/s]  8%|▊         | 30/391 [00:00<00:06, 57.49it/s] 10%|█         | 40/391 [00:00<00:05, 68.41it/s] 13%|█▎        | 50/391 [00:00<00:04, 76.24it/s] 15%|█▌        | 60/391 [00:01<00:04, 81.66it/s] 18%|█▊        | 70/391 [00:01<00:03, 85.75it/s] 20%|██        | 80/391 [00:01<00:03, 80.25it/s] 23%|██▎       | 89/391 [00:01<00:03, 77.05it/s] 25%|██▌       | 99/391 [00:01<00:03, 82.17it/s] 28%|██▊       | 109/391 [00:01<00:03, 85.54it/s] 30%|███       | 119/391 [00:01<00:03, 87.19it/s] 33%|███▎      | 129/391 [00:01<00:02, 88.74it/s] 36%|███▌      | 139/391 [00:01<00:02, 88.81it/s] 38%|███▊      | 148/391 [00:02<00:03, 79.64it/s] 40%|████      | 157/391 [00:02<00:02, 80.61it/s] 43%|████▎     | 167/391 [00:02<00:02, 84.94it/s] 45%|████▌     | 176/391 [00:02<00:02, 86.30it/s] 48%|████▊     | 186/391 [00:02<00:02, 89.24it/s] 50%|█████     | 196/391 [00:02<00:02, 90.99it/s] 53%|█████▎    | 206/391 [00:02<00:02, 92.17it/s] 55%|█████▌    | 216/391 [00:02<00:01, 93.12it/s] 58%|█████▊    | 226/391 [00:02<00:01, 93.72it/s] 60%|██████    | 236/391 [00:03<00:01, 94.19it/s] 63%|██████▎   | 246/391 [00:03<00:01, 94.44it/s] 65%|██████▌   | 256/391 [00:03<00:01, 91.84it/s] 68%|██████▊   | 266/391 [00:03<00:01, 80.22it/s] 70%|███████   | 275/391 [00:03<00:01, 80.73it/s] 73%|███████▎  | 285/391 [00:03<00:01, 84.77it/s] 75%|███████▌  | 294/391 [00:03<00:01, 85.77it/s] 77%|███████▋  | 303/391 [00:03<00:01, 85.25it/s] 80%|████████  | 313/391 [00:03<00:00, 87.04it/s] 83%|████████▎ | 323/391 [00:04<00:00, 88.80it/s] 85%|████████▌ | 333/391 [00:04<00:00, 90.67it/s] 88%|████████▊ | 343/391 [00:04<00:00, 91.57it/s] 90%|█████████ | 353/391 [00:04<00:00, 92.35it/s] 93%|█████████▎| 363/391 [00:04<00:00, 92.71it/s] 95%|█████████▌| 373/391 [00:04<00:00, 92.43it/s] 98%|█████████▊| 383/391 [00:04<00:00, 90.97it/s]100%|██████████| 391/391 [00:04<00:00, 80.59it/s]
50000 images processed, 4.95682692527771 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:29,  2.66it/s] 14%|█▍        | 11/79 [00:00<00:02, 29.00it/s] 27%|██▋       | 21/79 [00:00<00:01, 48.05it/s] 39%|███▉      | 31/79 [00:00<00:00, 61.63it/s] 52%|█████▏    | 41/79 [00:00<00:00, 71.35it/s] 65%|██████▍   | 51/79 [00:00<00:00, 78.36it/s] 76%|███████▌  | 60/79 [00:01<00:00, 73.26it/s] 87%|████████▋ | 69/79 [00:01<00:00, 73.73it/s]100%|██████████| 79/79 [00:01<00:00, 77.71it/s]100%|██████████| 79/79 [00:01<00:00, 61.72it/s]
10000 images processed, 1.300583839416504 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:17,  2.62it/s]  4%|▍         | 9/204 [00:00<00:08, 23.30it/s]  9%|▉         | 19/204 [00:00<00:04, 43.59it/s] 13%|█▎        | 27/204 [00:00<00:03, 53.45it/s] 18%|█▊        | 36/204 [00:00<00:02, 63.37it/s] 23%|██▎       | 46/204 [00:00<00:02, 72.21it/s] 27%|██▋       | 55/204 [00:01<00:02, 70.54it/s] 31%|███       | 63/204 [00:01<00:02, 69.24it/s] 36%|███▌      | 73/204 [00:01<00:01, 75.68it/s] 41%|████      | 83/204 [00:01<00:01, 79.99it/s] 45%|████▌     | 92/204 [00:01<00:01, 79.82it/s] 50%|█████     | 102/204 [00:01<00:01, 83.71it/s] 55%|█████▍    | 112/204 [00:01<00:01, 86.68it/s] 60%|█████▉    | 122/204 [00:01<00:00, 88.60it/s] 65%|██████▍   | 132/204 [00:01<00:00, 90.28it/s] 70%|██████▉   | 142/204 [00:02<00:00, 91.46it/s] 75%|███████▍  | 152/204 [00:02<00:00, 92.33it/s] 79%|███████▉  | 162/204 [00:02<00:00, 89.91it/s] 84%|████████▍ | 172/204 [00:02<00:00, 80.75it/s] 89%|████████▊ | 181/204 [00:02<00:00, 81.24it/s] 94%|█████████▎| 191/204 [00:02<00:00, 84.90it/s] 99%|█████████▊| 201/204 [00:02<00:00, 88.09it/s]100%|██████████| 204/204 [00:02<00:00, 73.89it/s]
26032 images processed, 2.8003950119018555 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:36,  2.13it/s] 11%|█▏        | 9/79 [00:00<00:03, 18.83it/s] 22%|██▏       | 17/79 [00:00<00:02, 30.57it/s] 32%|███▏      | 25/79 [00:00<00:01, 39.20it/s] 39%|███▉      | 31/79 [00:00<00:01, 42.57it/s] 48%|████▊     | 38/79 [00:01<00:00, 48.21it/s] 56%|█████▌    | 44/79 [00:01<00:00, 49.91it/s] 63%|██████▎   | 50/79 [00:01<00:00, 46.98it/s] 72%|███████▏  | 57/79 [00:01<00:00, 52.26it/s] 80%|███████▉  | 63/79 [00:01<00:00, 48.76it/s] 87%|████████▋ | 69/79 [00:01<00:00, 46.54it/s] 97%|█████████▋| 77/79 [00:01<00:00, 47.89it/s]100%|██████████| 79/79 [00:01<00:00, 41.16it/s]
10000 images processed, 1.9540884494781494 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:27,  2.81it/s] 11%|█▏        | 9/79 [00:00<00:02, 24.70it/s] 24%|██▍       | 19/79 [00:00<00:01, 45.66it/s] 33%|███▎      | 26/79 [00:00<00:01, 50.07it/s] 42%|████▏     | 33/79 [00:00<00:00, 55.15it/s] 54%|█████▍    | 43/79 [00:00<00:00, 66.79it/s] 66%|██████▌   | 52/79 [00:00<00:00, 72.92it/s] 77%|███████▋  | 61/79 [00:01<00:00, 77.16it/s] 90%|████████▉ | 71/79 [00:01<00:00, 82.94it/s]100%|██████████| 79/79 [00:01<00:00, 61.85it/s]
10000 images processed, 1.2972636222839355 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:21,  3.23it/s] 16%|█▌        | 11/70 [00:00<00:01, 33.23it/s] 30%|███       | 21/70 [00:00<00:00, 52.88it/s] 41%|████▏     | 29/70 [00:00<00:00, 55.95it/s] 51%|█████▏    | 36/70 [00:00<00:00, 59.24it/s] 66%|██████▌   | 46/70 [00:00<00:00, 69.80it/s] 80%|████████  | 56/70 [00:00<00:00, 77.31it/s] 94%|█████████▍| 66/70 [00:01<00:00, 82.18it/s]100%|██████████| 70/70 [00:01<00:00, 62.63it/s]
8925 images processed, 1.1461734771728516 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:01<00:44,  1.01s/it] 20%|██        | 9/45 [00:01<00:04,  8.03it/s] 29%|██▉       | 13/45 [00:01<00:02, 11.62it/s] 36%|███▌      | 16/45 [00:01<00:02, 11.59it/s] 40%|████      | 18/45 [00:01<00:02, 12.21it/s] 44%|████▍     | 20/45 [00:02<00:02, 12.24it/s] 49%|████▉     | 22/45 [00:02<00:02, 10.20it/s] 60%|██████    | 27/45 [00:02<00:01, 13.61it/s] 64%|██████▍   | 29/45 [00:02<00:01, 14.50it/s] 69%|██████▉   | 31/45 [00:02<00:01, 13.43it/s] 76%|███████▌  | 34/45 [00:03<00:00, 14.30it/s] 80%|████████  | 36/45 [00:03<00:00, 13.87it/s] 91%|█████████ | 41/45 [00:03<00:00, 17.98it/s] 96%|█████████▌| 43/45 [00:03<00:00, 10.90it/s]100%|██████████| 45/45 [00:03<00:00, 11.56it/s]
5640 images processed, 3.914501667022705 seconds used

18.95374608039856
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.51  99.36
places365     67.94  81.19
LSUN          17.52  96.09
iSUN          72.32  81.72
dtd           37.89  91.39
AVG           39.64  89.95
Retain-Acc: 0.7406
Forget-as-OOD (retain known vs forget novel):
  FPR: 79.50 AUROC: 86.90 AUIN: 98.36
15.34091591835022
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid
epochs=5 | cache=6 | flambda=0.5 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21843904
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<01:37,  4.00it/s]  3%|▎         | 11/391 [00:00<00:09, 38.32it/s]  5%|▌         | 21/391 [00:00<00:06, 57.98it/s]  8%|▊         | 31/391 [00:00<00:05, 70.31it/s] 10%|█         | 41/391 [00:00<00:04, 78.10it/s] 13%|█▎        | 51/391 [00:00<00:04, 83.54it/s] 16%|█▌        | 61/391 [00:00<00:03, 86.90it/s] 18%|█▊        | 71/391 [00:01<00:04, 79.04it/s] 20%|██        | 80/391 [00:01<00:04, 77.29it/s] 23%|██▎       | 90/391 [00:01<00:03, 82.30it/s] 26%|██▌       | 100/391 [00:01<00:03, 86.00it/s] 28%|██▊       | 110/391 [00:01<00:03, 88.81it/s] 31%|███       | 120/391 [00:01<00:02, 90.60it/s] 33%|███▎      | 130/391 [00:01<00:02, 92.03it/s] 36%|███▌      | 140/391 [00:01<00:02, 92.98it/s] 38%|███▊      | 150/391 [00:01<00:02, 93.53it/s] 41%|████      | 160/391 [00:01<00:02, 93.91it/s] 43%|████▎     | 170/391 [00:02<00:02, 92.61it/s] 46%|████▌     | 180/391 [00:02<00:02, 93.24it/s] 49%|████▊     | 190/391 [00:02<00:02, 93.56it/s] 51%|█████     | 200/391 [00:02<00:02, 94.05it/s] 54%|█████▎    | 210/391 [00:02<00:01, 94.26it/s] 56%|█████▋    | 220/391 [00:02<00:01, 94.48it/s] 59%|█████▉    | 230/391 [00:02<00:01, 94.52it/s] 61%|██████▏   | 240/391 [00:02<00:01, 94.73it/s] 64%|██████▍   | 250/391 [00:02<00:01, 94.69it/s] 66%|██████▋   | 260/391 [00:03<00:01, 94.57it/s] 69%|██████▉   | 270/391 [00:03<00:01, 93.40it/s] 72%|███████▏  | 280/391 [00:03<00:01, 93.80it/s] 74%|███████▍  | 290/391 [00:03<00:01, 94.32it/s] 77%|███████▋  | 300/391 [00:03<00:00, 94.99it/s] 79%|███████▉  | 310/391 [00:03<00:00, 95.35it/s] 82%|████████▏ | 320/391 [00:03<00:00, 95.62it/s] 84%|████████▍ | 330/391 [00:03<00:00, 95.84it/s] 87%|████████▋ | 340/391 [00:03<00:00, 96.11it/s] 90%|████████▉ | 350/391 [00:03<00:00, 96.15it/s] 92%|█████████▏| 360/391 [00:04<00:00, 96.13it/s] 95%|█████████▍| 370/391 [00:04<00:00, 96.24it/s] 97%|█████████▋| 380/391 [00:04<00:00, 95.80it/s]100%|█████████▉| 390/391 [00:04<00:00, 96.54it/s]100%|██████████| 391/391 [00:04<00:00, 88.20it/s]
50000 images processed, 4.5042431354522705 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:17,  4.47it/s] 14%|█▍        | 11/79 [00:00<00:01, 40.33it/s] 27%|██▋       | 21/79 [00:00<00:00, 60.02it/s] 39%|███▉      | 31/79 [00:00<00:00, 71.70it/s] 52%|█████▏    | 41/79 [00:00<00:00, 79.05it/s] 65%|██████▍   | 51/79 [00:00<00:00, 83.86it/s] 77%|███████▋  | 61/79 [00:00<00:00, 87.16it/s] 90%|████████▉ | 71/79 [00:00<00:00, 89.93it/s]100%|██████████| 79/79 [00:01<00:00, 74.63it/s]
10000 images processed, 1.081815481185913 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:07,  3.03it/s]  5%|▌         | 11/204 [00:00<00:06, 31.38it/s] 10%|█         | 21/204 [00:00<00:03, 50.50it/s] 15%|█▌        | 31/204 [00:00<00:02, 63.68it/s] 20%|██        | 41/204 [00:00<00:02, 72.91it/s] 25%|██▌       | 51/204 [00:00<00:01, 79.38it/s] 30%|██▉       | 61/204 [00:00<00:01, 83.83it/s] 35%|███▍      | 71/204 [00:01<00:01, 86.95it/s] 40%|███▉      | 81/204 [00:01<00:01, 89.29it/s] 45%|████▍     | 91/204 [00:01<00:01, 90.50it/s] 50%|████▉     | 101/204 [00:01<00:01, 91.68it/s] 54%|█████▍    | 111/204 [00:01<00:01, 92.67it/s] 59%|█████▉    | 121/204 [00:01<00:00, 93.28it/s] 64%|██████▍   | 131/204 [00:01<00:00, 93.80it/s] 69%|██████▉   | 141/204 [00:01<00:00, 94.19it/s] 74%|███████▍  | 151/204 [00:01<00:00, 94.45it/s] 79%|███████▉  | 161/204 [00:02<00:00, 94.54it/s] 84%|████████▍ | 171/204 [00:02<00:00, 94.73it/s] 89%|████████▊ | 181/204 [00:02<00:00, 94.64it/s] 94%|█████████▎| 191/204 [00:02<00:00, 94.76it/s] 99%|█████████▊| 201/204 [00:02<00:00, 95.18it/s]100%|██████████| 204/204 [00:02<00:00, 82.01it/s]
26032 images processed, 2.5349111557006836 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:45,  1.70it/s] 11%|█▏        | 9/79 [00:00<00:04, 15.26it/s] 22%|██▏       | 17/79 [00:00<00:02, 26.12it/s] 28%|██▊       | 22/79 [00:01<00:01, 29.50it/s] 35%|███▌      | 28/79 [00:01<00:01, 32.07it/s] 46%|████▌     | 36/79 [00:01<00:01, 36.13it/s] 56%|█████▌    | 44/79 [00:01<00:00, 36.78it/s] 66%|██████▌   | 52/79 [00:01<00:00, 37.57it/s] 76%|███████▌  | 60/79 [00:01<00:00, 38.47it/s] 86%|████████▌ | 68/79 [00:02<00:00, 39.88it/s] 96%|█████████▌| 76/79 [00:02<00:00, 40.88it/s]100%|██████████| 79/79 [00:02<00:00, 33.46it/s]
10000 images processed, 2.3964309692382812 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:33,  2.34it/s] 14%|█▍        | 11/79 [00:00<00:02, 26.37it/s] 27%|██▋       | 21/79 [00:00<00:01, 44.81it/s] 39%|███▉      | 31/79 [00:00<00:00, 58.74it/s] 52%|█████▏    | 41/79 [00:00<00:00, 68.92it/s] 65%|██████▍   | 51/79 [00:00<00:00, 76.51it/s] 77%|███████▋  | 61/79 [00:01<00:00, 81.97it/s] 90%|████████▉ | 71/79 [00:01<00:00, 85.97it/s]100%|██████████| 79/79 [00:01<00:00, 63.55it/s]
10000 images processed, 1.264617681503296 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:22,  3.11it/s] 16%|█▌        | 11/70 [00:00<00:01, 32.07it/s] 29%|██▊       | 20/70 [00:00<00:01, 48.86it/s] 43%|████▎     | 30/70 [00:00<00:00, 62.92it/s] 57%|█████▋    | 40/70 [00:00<00:00, 72.46it/s] 71%|███████▏  | 50/70 [00:00<00:00, 79.10it/s] 86%|████████▌ | 60/70 [00:00<00:00, 83.97it/s]100%|██████████| 70/70 [00:01<00:00, 86.04it/s]100%|██████████| 70/70 [00:01<00:00, 65.52it/s]
8925 images processed, 1.0994298458099365 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:00<00:43,  1.00it/s]  4%|▍         | 2/45 [00:01<00:20,  2.11it/s] 20%|██        | 9/45 [00:01<00:04,  8.77it/s] 24%|██▍       | 11/45 [00:01<00:03,  8.91it/s] 31%|███       | 14/45 [00:01<00:02, 11.80it/s] 38%|███▊      | 17/45 [00:02<00:02, 11.11it/s] 42%|████▏     | 19/45 [00:02<00:02, 11.78it/s] 49%|████▉     | 22/45 [00:02<00:01, 13.64it/s] 56%|█████▌    | 25/45 [00:02<00:01, 12.05it/s] 60%|██████    | 27/45 [00:02<00:01, 12.94it/s] 67%|██████▋   | 30/45 [00:03<00:01, 13.51it/s] 73%|███████▎  | 33/45 [00:03<00:01,  9.82it/s] 82%|████████▏ | 37/45 [00:03<00:00, 13.70it/s] 91%|█████████ | 41/45 [00:04<00:00, 11.65it/s] 96%|█████████▌| 43/45 [00:04<00:00,  9.86it/s]100%|██████████| 45/45 [00:04<00:00, 10.25it/s]
5640 images processed, 4.414297103881836 seconds used

19.054136037826538
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.52  99.36
places365     67.89  81.19
LSUN          17.51  96.09
iSUN          72.30  81.72
dtd           37.89  91.39
AVG           39.62  89.95
Retain-Acc: 0.7407
Forget-as-OOD (retain known vs forget novel):
  FPR: 79.50 AUROC: 86.90 AUIN: 98.36
14.352856397628784
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e10-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid
epochs=10 | cache=6 | flambda=0.5 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e10-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e10-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e10-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21843904
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<02:33,  2.55it/s]  3%|▎         | 11/391 [00:00<00:13, 28.12it/s]  5%|▌         | 21/391 [00:00<00:07, 47.12it/s]  8%|▊         | 31/391 [00:00<00:05, 60.96it/s] 10%|█         | 41/391 [00:00<00:04, 70.91it/s] 13%|█▎        | 51/391 [00:00<00:04, 78.09it/s] 16%|█▌        | 61/391 [00:01<00:03, 83.24it/s] 18%|█▊        | 71/391 [00:01<00:03, 86.80it/s] 21%|██        | 81/391 [00:01<00:03, 89.24it/s] 23%|██▎       | 91/391 [00:01<00:03, 91.19it/s] 26%|██▌       | 101/391 [00:01<00:03, 92.61it/s] 28%|██▊       | 111/391 [00:01<00:03, 92.76it/s] 31%|███       | 121/391 [00:01<00:02, 93.04it/s] 34%|███▎      | 131/391 [00:01<00:02, 93.59it/s] 36%|███▌      | 141/391 [00:01<00:02, 93.89it/s] 39%|███▊      | 151/391 [00:01<00:02, 93.87it/s] 41%|████      | 161/391 [00:02<00:02, 93.98it/s] 44%|████▎     | 171/391 [00:02<00:02, 94.35it/s] 46%|████▋     | 181/391 [00:02<00:02, 94.62it/s] 49%|████▉     | 191/391 [00:02<00:02, 94.83it/s] 51%|█████▏    | 201/391 [00:02<00:02, 94.81it/s] 54%|█████▍    | 211/391 [00:02<00:01, 94.96it/s] 57%|█████▋    | 221/391 [00:02<00:01, 94.99it/s] 59%|█████▉    | 231/391 [00:02<00:01, 94.97it/s] 62%|██████▏   | 241/391 [00:02<00:01, 95.01it/s] 64%|██████▍   | 251/391 [00:03<00:01, 95.02it/s] 67%|██████▋   | 261/391 [00:03<00:01, 95.29it/s] 69%|██████▉   | 271/391 [00:03<00:01, 95.31it/s] 72%|███████▏  | 281/391 [00:03<00:01, 95.19it/s] 74%|███████▍  | 291/391 [00:03<00:01, 95.26it/s] 77%|███████▋  | 301/391 [00:03<00:00, 94.83it/s] 80%|███████▉  | 311/391 [00:03<00:00, 94.58it/s] 82%|████████▏ | 321/391 [00:03<00:00, 94.72it/s] 85%|████████▍ | 331/391 [00:03<00:00, 94.58it/s] 87%|████████▋ | 341/391 [00:03<00:00, 94.50it/s] 90%|████████▉ | 351/391 [00:04<00:00, 94.35it/s] 92%|█████████▏| 361/391 [00:04<00:00, 94.46it/s] 95%|█████████▍| 371/391 [00:04<00:00, 94.39it/s] 97%|█████████▋| 381/391 [00:04<00:00, 94.22it/s]100%|██████████| 391/391 [00:04<00:00, 91.73it/s]100%|██████████| 391/391 [00:04<00:00, 86.57it/s]
50000 images processed, 4.599843978881836 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:25,  3.09it/s] 14%|█▍        | 11/79 [00:00<00:02, 32.19it/s] 27%|██▋       | 21/79 [00:00<00:01, 51.51it/s] 39%|███▉      | 31/79 [00:00<00:00, 64.52it/s] 52%|█████▏    | 41/79 [00:00<00:00, 73.09it/s] 65%|██████▍   | 51/79 [00:00<00:00, 79.03it/s] 77%|███████▋  | 61/79 [00:00<00:00, 83.05it/s] 90%|████████▉ | 71/79 [00:01<00:00, 86.82it/s]100%|██████████| 79/79 [00:01<00:00, 67.84it/s]
10000 images processed, 1.1870579719543457 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:12,  2.78it/s]  5%|▌         | 11/204 [00:00<00:06, 29.68it/s] 10%|█         | 21/204 [00:00<00:03, 48.81it/s] 15%|█▌        | 31/204 [00:00<00:02, 62.30it/s] 20%|██        | 41/204 [00:00<00:02, 71.68it/s] 25%|██▌       | 51/204 [00:00<00:01, 78.36it/s] 30%|██▉       | 61/204 [00:01<00:01, 82.75it/s] 35%|███▍      | 71/204 [00:01<00:01, 86.09it/s] 40%|███▉      | 81/204 [00:01<00:01, 87.93it/s] 45%|████▍     | 91/204 [00:01<00:01, 89.60it/s] 50%|████▉     | 101/204 [00:01<00:01, 89.83it/s] 54%|█████▍    | 111/204 [00:01<00:01, 87.09it/s] 59%|█████▉    | 120/204 [00:01<00:00, 87.34it/s] 64%|██████▎   | 130/204 [00:01<00:00, 88.32it/s] 69%|██████▊   | 140/204 [00:01<00:00, 89.81it/s] 74%|███████▎  | 150/204 [00:01<00:00, 90.68it/s] 78%|███████▊  | 160/204 [00:02<00:00, 91.53it/s] 83%|████████▎ | 170/204 [00:02<00:00, 91.93it/s] 88%|████████▊ | 180/204 [00:02<00:00, 91.44it/s] 93%|█████████▎| 190/204 [00:02<00:00, 92.10it/s] 98%|█████████▊| 200/204 [00:02<00:00, 93.14it/s]100%|██████████| 204/204 [00:02<00:00, 79.37it/s]
26032 images processed, 2.6171793937683105 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:42,  1.82it/s] 11%|█▏        | 9/79 [00:00<00:04, 16.05it/s] 22%|██▏       | 17/79 [00:00<00:02, 25.72it/s] 32%|███▏      | 25/79 [00:01<00:01, 32.61it/s] 41%|████      | 32/79 [00:01<00:01, 39.58it/s] 48%|████▊     | 38/79 [00:01<00:01, 38.94it/s] 54%|█████▍    | 43/79 [00:01<00:00, 37.44it/s] 63%|██████▎   | 50/79 [00:01<00:00, 38.25it/s] 73%|███████▎  | 58/79 [00:01<00:00, 40.33it/s] 84%|████████▎ | 66/79 [00:01<00:00, 42.98it/s] 94%|█████████▎| 74/79 [00:02<00:00, 43.15it/s]100%|██████████| 79/79 [00:02<00:00, 35.85it/s]
10000 images processed, 2.237347364425659 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:32,  2.38it/s] 14%|█▍        | 11/79 [00:00<00:02, 26.45it/s] 27%|██▋       | 21/79 [00:00<00:01, 44.59it/s] 39%|███▉      | 31/79 [00:00<00:00, 58.40it/s] 52%|█████▏    | 41/79 [00:00<00:00, 68.63it/s] 65%|██████▍   | 51/79 [00:00<00:00, 75.97it/s] 77%|███████▋  | 61/79 [00:01<00:00, 81.26it/s] 90%|████████▉ | 71/79 [00:01<00:00, 85.37it/s]100%|██████████| 79/79 [00:01<00:00, 63.38it/s]
10000 images processed, 1.2714452743530273 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:29,  2.31it/s] 16%|█▌        | 11/70 [00:00<00:02, 25.96it/s] 30%|███       | 21/70 [00:00<00:01, 44.41it/s] 44%|████▍     | 31/70 [00:00<00:00, 58.35it/s] 59%|█████▊    | 41/70 [00:00<00:00, 68.69it/s] 73%|███████▎  | 51/70 [00:00<00:00, 76.13it/s] 87%|████████▋ | 61/70 [00:01<00:00, 81.70it/s]100%|██████████| 70/70 [00:01<00:00, 59.82it/s]
8925 images processed, 1.2002158164978027 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:00<00:43,  1.02it/s]  4%|▍         | 2/45 [00:01<00:20,  2.09it/s] 20%|██        | 9/45 [00:01<00:04,  8.87it/s] 24%|██▍       | 11/45 [00:01<00:03,  8.74it/s] 33%|███▎      | 15/45 [00:01<00:02, 12.93it/s] 38%|███▊      | 17/45 [00:02<00:02, 11.31it/s] 42%|████▏     | 19/45 [00:02<00:02, 11.61it/s] 49%|████▉     | 22/45 [00:02<00:01, 13.27it/s] 56%|█████▌    | 25/45 [00:02<00:01, 13.69it/s] 60%|██████    | 27/45 [00:02<00:01, 12.85it/s] 67%|██████▋   | 30/45 [00:03<00:01, 12.85it/s] 73%|███████▎  | 33/45 [00:03<00:01, 10.91it/s] 78%|███████▊  | 35/45 [00:03<00:00, 10.95it/s] 91%|█████████ | 41/45 [00:03<00:00, 13.27it/s] 96%|█████████▌| 43/45 [00:04<00:00,  9.98it/s]100%|██████████| 45/45 [00:04<00:00, 10.36it/s]
5640 images processed, 4.3645408153533936 seconds used

19.280519723892212
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.52  99.36
places365     67.91  81.20
LSUN          17.27  96.12
iSUN          72.13  81.76
dtd           37.82  91.37
AVG           39.53  89.96
Retain-Acc: 0.7409
Forget-as-OOD (retain known vs forget novel):
  FPR: 79.30 AUROC: 86.89 AUIN: 98.36
21.124189615249634
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e20-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid
epochs=20 | cache=6 | flambda=0.5 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e20-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e20-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e20-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21843904
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<02:00,  3.23it/s]  3%|▎         | 11/391 [00:00<00:11, 33.26it/s]  5%|▌         | 21/391 [00:00<00:06, 53.13it/s]  8%|▊         | 31/391 [00:00<00:05, 66.24it/s] 10%|█         | 41/391 [00:00<00:04, 74.40it/s] 13%|█▎        | 50/391 [00:00<00:04, 78.36it/s] 15%|█▌        | 60/391 [00:00<00:03, 83.20it/s] 18%|█▊        | 70/391 [00:01<00:03, 86.56it/s] 20%|██        | 80/391 [00:01<00:03, 89.45it/s] 23%|██▎       | 90/391 [00:01<00:03, 91.64it/s] 26%|██▌       | 100/391 [00:01<00:03, 92.86it/s] 28%|██▊       | 110/391 [00:01<00:02, 93.90it/s] 31%|███       | 120/391 [00:01<00:02, 94.17it/s] 33%|███▎      | 130/391 [00:01<00:02, 94.45it/s] 36%|███▌      | 140/391 [00:01<00:02, 94.69it/s] 38%|███▊      | 150/391 [00:01<00:02, 94.98it/s] 41%|████      | 160/391 [00:01<00:02, 95.03it/s] 43%|████▎     | 170/391 [00:02<00:02, 95.13it/s] 46%|████▌     | 180/391 [00:02<00:02, 95.41it/s] 49%|████▊     | 190/391 [00:02<00:02, 95.50it/s] 51%|█████     | 200/391 [00:02<00:01, 95.73it/s] 54%|█████▎    | 210/391 [00:02<00:01, 95.67it/s] 56%|█████▋    | 220/391 [00:02<00:01, 95.58it/s] 59%|█████▉    | 230/391 [00:02<00:01, 95.56it/s] 61%|██████▏   | 240/391 [00:02<00:01, 95.62it/s] 64%|██████▍   | 250/391 [00:02<00:01, 95.18it/s] 66%|██████▋   | 260/391 [00:03<00:01, 95.18it/s] 69%|██████▉   | 270/391 [00:03<00:01, 95.27it/s] 72%|███████▏  | 280/391 [00:03<00:01, 95.44it/s] 74%|███████▍  | 290/391 [00:03<00:01, 95.28it/s] 77%|███████▋  | 300/391 [00:03<00:00, 95.20it/s] 79%|███████▉  | 310/391 [00:03<00:00, 95.27it/s] 82%|████████▏ | 320/391 [00:03<00:00, 95.19it/s] 84%|████████▍ | 330/391 [00:03<00:00, 95.19it/s] 87%|████████▋ | 340/391 [00:03<00:00, 95.06it/s] 90%|████████▉ | 350/391 [00:03<00:00, 95.02it/s] 92%|█████████▏| 360/391 [00:04<00:00, 95.14it/s] 95%|█████████▍| 370/391 [00:04<00:00, 95.38it/s] 97%|█████████▋| 380/391 [00:04<00:00, 95.00it/s]100%|█████████▉| 390/391 [00:04<00:00, 95.82it/s]100%|██████████| 391/391 [00:04<00:00, 88.44it/s]
50000 images processed, 4.505106210708618 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:21,  3.56it/s] 14%|█▍        | 11/79 [00:00<00:01, 34.92it/s] 27%|██▋       | 21/79 [00:00<00:01, 54.69it/s] 39%|███▉      | 31/79 [00:00<00:00, 66.83it/s] 52%|█████▏    | 41/79 [00:00<00:00, 75.14it/s] 65%|██████▍   | 51/79 [00:00<00:00, 80.84it/s] 77%|███████▋  | 61/79 [00:00<00:00, 84.62it/s] 90%|████████▉ | 71/79 [00:01<00:00, 88.11it/s]100%|██████████| 79/79 [00:01<00:00, 70.62it/s]
10000 images processed, 1.1396450996398926 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:04,  3.15it/s]  5%|▌         | 11/204 [00:00<00:05, 32.51it/s] 10%|█         | 21/204 [00:00<00:03, 51.88it/s] 15%|█▌        | 31/204 [00:00<00:02, 64.78it/s] 20%|██        | 41/204 [00:00<00:02, 72.99it/s] 25%|██▌       | 51/204 [00:00<00:01, 79.36it/s] 30%|██▉       | 61/204 [00:00<00:01, 83.70it/s] 35%|███▍      | 71/204 [00:01<00:01, 86.63it/s] 40%|███▉      | 81/204 [00:01<00:01, 88.61it/s] 45%|████▍     | 91/204 [00:01<00:01, 90.12it/s] 50%|████▉     | 101/204 [00:01<00:01, 91.24it/s] 54%|█████▍    | 111/204 [00:01<00:01, 92.00it/s] 59%|█████▉    | 121/204 [00:01<00:00, 92.51it/s] 64%|██████▍   | 131/204 [00:01<00:00, 93.14it/s] 69%|██████▉   | 141/204 [00:01<00:00, 93.22it/s] 74%|███████▍  | 151/204 [00:01<00:00, 93.02it/s] 79%|███████▉  | 161/204 [00:02<00:00, 93.41it/s] 84%|████████▍ | 171/204 [00:02<00:00, 93.70it/s] 89%|████████▊ | 181/204 [00:02<00:00, 94.00it/s] 94%|█████████▎| 191/204 [00:02<00:00, 94.40it/s] 99%|█████████▊| 201/204 [00:02<00:00, 94.88it/s]100%|██████████| 204/204 [00:02<00:00, 82.03it/s]
26032 images processed, 2.5323054790496826 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:40,  1.91it/s] 11%|█▏        | 9/79 [00:00<00:04, 16.21it/s] 22%|██▏       | 17/79 [00:00<00:02, 25.89it/s] 32%|███▏      | 25/79 [00:01<00:01, 32.74it/s] 42%|████▏     | 33/79 [00:01<00:01, 37.21it/s] 52%|█████▏    | 41/79 [00:01<00:00, 39.62it/s] 62%|██████▏   | 49/79 [00:01<00:00, 41.55it/s] 72%|███████▏  | 57/79 [00:01<00:00, 42.63it/s] 82%|████████▏ | 65/79 [00:01<00:00, 44.02it/s] 92%|█████████▏| 73/79 [00:02<00:00, 45.13it/s]100%|██████████| 79/79 [00:02<00:00, 37.22it/s]
10000 images processed, 2.165306806564331 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:35,  2.22it/s]  9%|▉         | 7/79 [00:00<00:04, 15.74it/s] 16%|█▋        | 13/79 [00:00<00:02, 26.79it/s] 29%|██▉       | 23/79 [00:00<00:01, 45.16it/s] 41%|████      | 32/79 [00:00<00:00, 56.69it/s] 53%|█████▎    | 42/79 [00:00<00:00, 66.77it/s] 66%|██████▌   | 52/79 [00:01<00:00, 74.71it/s] 78%|███████▊  | 62/79 [00:01<00:00, 80.44it/s] 91%|█████████ | 72/79 [00:01<00:00, 83.88it/s]100%|██████████| 79/79 [00:01<00:00, 57.61it/s]
10000 images processed, 1.397810697555542 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:31,  2.16it/s] 16%|█▌        | 11/70 [00:00<00:02, 24.90it/s] 30%|███       | 21/70 [00:00<00:01, 43.00it/s] 44%|████▍     | 31/70 [00:00<00:00, 56.79it/s] 59%|█████▊    | 41/70 [00:00<00:00, 66.91it/s] 73%|███████▎  | 51/70 [00:00<00:00, 74.73it/s] 87%|████████▋ | 61/70 [00:01<00:00, 79.80it/s]100%|██████████| 70/70 [00:01<00:00, 82.11it/s]100%|██████████| 70/70 [00:01<00:00, 58.00it/s]
8925 images processed, 1.237356185913086 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:00<00:31,  1.38it/s]  4%|▍         | 2/45 [00:00<00:19,  2.26it/s] 20%|██        | 9/45 [00:01<00:02, 12.59it/s] 27%|██▋       | 12/45 [00:01<00:03,  9.70it/s] 36%|███▌      | 16/45 [00:01<00:02, 13.68it/s] 42%|████▏     | 19/45 [00:02<00:02, 10.99it/s] 49%|████▉     | 22/45 [00:02<00:01, 12.34it/s] 58%|█████▊    | 26/45 [00:02<00:01, 11.51it/s] 67%|██████▋   | 30/45 [00:02<00:01, 12.92it/s] 76%|███████▌  | 34/45 [00:03<00:01, 10.98it/s] 93%|█████████▎| 42/45 [00:03<00:00, 11.76it/s]100%|██████████| 45/45 [00:03<00:00, 11.28it/s]
5640 images processed, 4.010954856872559 seconds used

18.654074668884277
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.80  99.32
places365     68.97  80.75
LSUN          19.16  95.89
iSUN          72.37  81.33
dtd           39.27  90.99
AVG           40.52  89.66
Retain-Acc: 0.7409
Forget-as-OOD (retain known vs forget novel):
  FPR: 75.10 AUROC: 87.26 AUIN: 98.40
19.914077281951904
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e50-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid
epochs=50 | cache=6 | flambda=0.5 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e50-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e50-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e50-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21843904
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<02:13,  2.92it/s]  3%|▎         | 11/391 [00:00<00:12, 31.01it/s]  5%|▌         | 21/391 [00:00<00:07, 50.51it/s]  8%|▊         | 31/391 [00:00<00:05, 63.93it/s] 10%|█         | 41/391 [00:00<00:04, 73.42it/s] 13%|█▎        | 51/391 [00:00<00:04, 78.83it/s] 16%|█▌        | 61/391 [00:00<00:03, 83.73it/s] 18%|█▊        | 71/391 [00:01<00:03, 87.04it/s] 21%|██        | 81/391 [00:01<00:03, 89.50it/s] 23%|██▎       | 91/391 [00:01<00:03, 91.17it/s] 26%|██▌       | 101/391 [00:01<00:03, 92.17it/s] 28%|██▊       | 111/391 [00:01<00:03, 93.09it/s] 31%|███       | 121/391 [00:01<00:02, 93.73it/s] 34%|███▎      | 131/391 [00:01<00:02, 94.04it/s] 36%|███▌      | 141/391 [00:01<00:02, 94.26it/s] 39%|███▊      | 151/391 [00:01<00:02, 94.46it/s] 41%|████      | 161/391 [00:02<00:02, 94.63it/s] 44%|████▎     | 171/391 [00:02<00:02, 94.71it/s] 46%|████▋     | 181/391 [00:02<00:02, 94.82it/s] 49%|████▉     | 191/391 [00:02<00:02, 94.94it/s] 51%|█████▏    | 201/391 [00:02<00:01, 95.02it/s] 54%|█████▍    | 211/391 [00:02<00:01, 95.10it/s] 57%|█████▋    | 221/391 [00:02<00:01, 94.88it/s] 59%|█████▉    | 231/391 [00:02<00:01, 94.91it/s] 62%|██████▏   | 241/391 [00:02<00:01, 94.92it/s] 64%|██████▍   | 251/391 [00:03<00:01, 80.99it/s] 66%|██████▋   | 260/391 [00:03<00:01, 81.33it/s] 69%|██████▉   | 270/391 [00:03<00:01, 84.78it/s] 72%|███████▏  | 280/391 [00:03<00:01, 87.79it/s] 74%|███████▍  | 290/391 [00:03<00:01, 89.90it/s] 77%|███████▋  | 300/391 [00:03<00:00, 91.44it/s] 79%|███████▉  | 310/391 [00:03<00:00, 92.41it/s] 82%|████████▏ | 320/391 [00:03<00:00, 92.84it/s] 84%|████████▍ | 330/391 [00:03<00:00, 92.91it/s] 87%|████████▋ | 340/391 [00:03<00:00, 93.44it/s] 90%|████████▉ | 350/391 [00:04<00:00, 94.00it/s] 92%|█████████▏| 360/391 [00:04<00:00, 94.30it/s] 95%|█████████▍| 370/391 [00:04<00:00, 94.53it/s] 97%|█████████▋| 380/391 [00:04<00:00, 94.02it/s]100%|█████████▉| 390/391 [00:04<00:00, 94.37it/s]100%|██████████| 391/391 [00:04<00:00, 86.03it/s]
50000 images processed, 4.645774602890015 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:23,  3.31it/s] 14%|█▍        | 11/79 [00:00<00:02, 33.82it/s] 27%|██▋       | 21/79 [00:00<00:01, 53.45it/s] 39%|███▉      | 31/79 [00:00<00:00, 66.34it/s] 52%|█████▏    | 41/79 [00:00<00:00, 75.10it/s] 65%|██████▍   | 51/79 [00:00<00:00, 81.18it/s] 77%|███████▋  | 61/79 [00:00<00:00, 85.34it/s] 90%|████████▉ | 71/79 [00:01<00:00, 88.66it/s]100%|██████████| 79/79 [00:01<00:00, 69.15it/s]
10000 images processed, 1.1647863388061523 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:01,  3.32it/s]  5%|▍         | 10/204 [00:00<00:06, 31.00it/s] 10%|▉         | 20/204 [00:00<00:03, 51.54it/s] 15%|█▍        | 30/204 [00:00<00:02, 64.56it/s] 20%|█▉        | 40/204 [00:00<00:02, 73.72it/s] 25%|██▍       | 50/204 [00:00<00:01, 80.00it/s] 29%|██▉       | 60/204 [00:00<00:01, 84.15it/s] 34%|███▍      | 70/204 [00:01<00:01, 87.03it/s] 39%|███▉      | 80/204 [00:01<00:01, 88.12it/s] 44%|████▍     | 90/204 [00:01<00:01, 89.62it/s] 49%|████▉     | 100/204 [00:01<00:01, 90.88it/s] 54%|█████▍    | 110/204 [00:01<00:01, 91.70it/s] 59%|█████▉    | 120/204 [00:01<00:00, 91.94it/s] 64%|██████▎   | 130/204 [00:01<00:00, 92.39it/s] 69%|██████▊   | 140/204 [00:01<00:00, 92.73it/s] 74%|███████▎  | 150/204 [00:01<00:00, 93.19it/s] 78%|███████▊  | 160/204 [00:02<00:00, 93.47it/s] 83%|████████▎ | 170/204 [00:02<00:00, 93.74it/s] 88%|████████▊ | 180/204 [00:02<00:00, 93.16it/s] 93%|█████████▎| 190/204 [00:02<00:00, 93.11it/s] 98%|█████████▊| 200/204 [00:02<00:00, 94.07it/s]100%|██████████| 204/204 [00:02<00:00, 82.12it/s]
26032 images processed, 2.5319018363952637 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:39,  1.99it/s] 11%|█▏        | 9/79 [00:00<00:04, 16.76it/s] 22%|██▏       | 17/79 [00:00<00:02, 26.97it/s] 32%|███▏      | 25/79 [00:00<00:01, 33.88it/s] 42%|████▏     | 33/79 [00:01<00:01, 38.45it/s] 52%|█████▏    | 41/79 [00:01<00:00, 41.51it/s] 62%|██████▏   | 49/79 [00:01<00:00, 43.23it/s] 72%|███████▏  | 57/79 [00:01<00:00, 44.28it/s] 82%|████████▏ | 65/79 [00:01<00:00, 45.64it/s] 92%|█████████▏| 73/79 [00:01<00:00, 46.51it/s]100%|██████████| 79/79 [00:02<00:00, 38.56it/s]
10000 images processed, 2.0859036445617676 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:32,  2.38it/s] 14%|█▍        | 11/79 [00:00<00:02, 26.44it/s] 27%|██▋       | 21/79 [00:00<00:01, 44.89it/s] 39%|███▉      | 31/79 [00:00<00:00, 58.48it/s] 52%|█████▏    | 41/79 [00:00<00:00, 68.43it/s] 65%|██████▍   | 51/79 [00:00<00:00, 75.90it/s] 77%|███████▋  | 61/79 [00:01<00:00, 81.11it/s] 90%|████████▉ | 71/79 [00:01<00:00, 84.90it/s]100%|██████████| 79/79 [00:01<00:00, 63.11it/s]
10000 images processed, 1.2746517658233643 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:22,  3.07it/s] 16%|█▌        | 11/70 [00:00<00:01, 31.77it/s] 30%|███       | 21/70 [00:00<00:00, 51.25it/s] 44%|████▍     | 31/70 [00:00<00:00, 64.68it/s] 59%|█████▊    | 41/70 [00:00<00:00, 73.87it/s] 73%|███████▎  | 51/70 [00:00<00:00, 80.25it/s] 87%|████████▋ | 61/70 [00:00<00:00, 84.79it/s]100%|██████████| 70/70 [00:01<00:00, 65.97it/s]
8925 images processed, 1.0973336696624756 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:00<00:40,  1.08it/s]  4%|▍         | 2/45 [00:01<00:20,  2.15it/s] 20%|██        | 9/45 [00:01<00:03,  9.89it/s] 24%|██▍       | 11/45 [00:01<00:03,  8.52it/s] 36%|███▌      | 16/45 [00:01<00:02, 14.06it/s] 42%|████▏     | 19/45 [00:02<00:02, 10.75it/s] 51%|█████     | 23/45 [00:02<00:01, 13.83it/s] 58%|█████▊    | 26/45 [00:02<00:01,  9.94it/s] 69%|██████▉   | 31/45 [00:03<00:01, 13.57it/s] 76%|███████▌  | 34/45 [00:03<00:01,  8.86it/s] 93%|█████████▎| 42/45 [00:04<00:00, 10.20it/s]100%|██████████| 45/45 [00:04<00:00, 10.16it/s]
5640 images processed, 4.44855809211731 seconds used

18.9606876373291
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           5.64  98.76
places365     79.29  77.71
LSUN          33.14  93.90
iSUN          80.12  79.09
dtd           46.93  89.32
AVG           49.03  87.76
Retain-Acc: 0.7381
Forget-as-OOD (retain known vs forget novel):
  FPR: 46.50 AUROC: 90.93 AUIN: 98.83
15.306429386138916
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e5-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid
epochs=5 | cache=6 | flambda=0.5 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21843904
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<02:00,  3.24it/s]  3%|▎         | 11/391 [00:00<00:11, 33.32it/s]  5%|▌         | 21/391 [00:00<00:06, 53.06it/s]  8%|▊         | 31/391 [00:00<00:05, 65.74it/s] 10%|█         | 41/391 [00:00<00:04, 74.35it/s] 13%|█▎        | 51/391 [00:00<00:04, 80.46it/s] 16%|█▌        | 61/391 [00:00<00:03, 84.78it/s] 18%|█▊        | 71/391 [00:01<00:03, 87.72it/s] 21%|██        | 81/391 [00:01<00:03, 89.69it/s] 23%|██▎       | 91/391 [00:01<00:03, 91.27it/s] 26%|██▌       | 101/391 [00:01<00:03, 92.57it/s] 28%|██▊       | 111/391 [00:01<00:02, 93.39it/s] 31%|███       | 121/391 [00:01<00:02, 93.73it/s] 34%|███▎      | 131/391 [00:01<00:02, 94.13it/s] 36%|███▌      | 141/391 [00:01<00:02, 94.36it/s] 39%|███▊      | 151/391 [00:01<00:02, 94.35it/s] 41%|████      | 161/391 [00:01<00:02, 94.35it/s] 44%|████▎     | 171/391 [00:02<00:02, 94.44it/s] 46%|████▋     | 181/391 [00:02<00:02, 94.17it/s] 49%|████▉     | 191/391 [00:02<00:02, 94.29it/s] 51%|█████▏    | 201/391 [00:02<00:02, 94.41it/s] 54%|█████▍    | 211/391 [00:02<00:01, 93.55it/s] 57%|█████▋    | 221/391 [00:02<00:01, 93.70it/s] 59%|█████▉    | 231/391 [00:02<00:01, 92.97it/s] 62%|██████▏   | 241/391 [00:02<00:01, 93.59it/s] 64%|██████▍   | 251/391 [00:02<00:01, 94.03it/s] 67%|██████▋   | 261/391 [00:03<00:01, 94.27it/s] 69%|██████▉   | 271/391 [00:03<00:01, 93.22it/s] 72%|███████▏  | 281/391 [00:03<00:01, 93.45it/s] 74%|███████▍  | 291/391 [00:03<00:01, 93.57it/s] 77%|███████▋  | 301/391 [00:03<00:00, 93.65it/s] 80%|███████▉  | 311/391 [00:03<00:00, 93.74it/s] 82%|████████▏ | 321/391 [00:03<00:00, 93.75it/s] 85%|████████▍ | 331/391 [00:03<00:00, 93.32it/s] 87%|████████▋ | 341/391 [00:03<00:00, 91.72it/s] 90%|████████▉ | 351/391 [00:04<00:00, 79.97it/s] 92%|█████████▏| 360/391 [00:04<00:00, 81.76it/s] 95%|█████████▍| 370/391 [00:04<00:00, 84.61it/s] 97%|█████████▋| 380/391 [00:04<00:00, 87.12it/s]100%|█████████▉| 390/391 [00:04<00:00, 89.98it/s]100%|██████████| 391/391 [00:04<00:00, 86.19it/s]
50000 images processed, 4.627930164337158 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:22,  3.43it/s] 14%|█▍        | 11/79 [00:00<00:01, 34.44it/s] 27%|██▋       | 21/79 [00:00<00:01, 53.80it/s] 39%|███▉      | 31/79 [00:00<00:00, 66.63it/s] 52%|█████▏    | 41/79 [00:00<00:00, 74.61it/s] 65%|██████▍   | 51/79 [00:00<00:00, 80.74it/s] 77%|███████▋  | 61/79 [00:00<00:00, 81.93it/s] 90%|████████▉ | 71/79 [00:01<00:00, 84.66it/s]100%|██████████| 79/79 [00:01<00:00, 68.85it/s]
10000 images processed, 1.176469087600708 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<00:54,  3.73it/s]  5%|▌         | 11/204 [00:00<00:05, 36.63it/s] 10%|█         | 21/204 [00:00<00:03, 56.39it/s] 15%|█▌        | 31/204 [00:00<00:02, 68.60it/s] 20%|██        | 41/204 [00:00<00:02, 76.68it/s] 25%|██▌       | 51/204 [00:00<00:01, 82.04it/s] 30%|██▉       | 61/204 [00:00<00:01, 85.79it/s] 35%|███▍      | 71/204 [00:01<00:01, 88.12it/s] 40%|███▉      | 81/204 [00:01<00:01, 89.46it/s] 45%|████▍     | 91/204 [00:01<00:01, 90.96it/s] 50%|████▉     | 101/204 [00:01<00:01, 92.13it/s] 54%|█████▍    | 111/204 [00:01<00:01, 92.58it/s] 59%|█████▉    | 121/204 [00:01<00:00, 92.69it/s] 64%|██████▍   | 131/204 [00:01<00:00, 93.16it/s] 69%|██████▉   | 141/204 [00:01<00:00, 93.11it/s] 74%|███████▍  | 151/204 [00:01<00:00, 93.31it/s] 79%|███████▉  | 161/204 [00:01<00:00, 93.57it/s] 84%|████████▍ | 171/204 [00:02<00:00, 93.69it/s] 89%|████████▊ | 181/204 [00:02<00:00, 93.61it/s] 94%|█████████▎| 191/204 [00:02<00:00, 93.98it/s] 99%|█████████▊| 201/204 [00:02<00:00, 94.69it/s]100%|██████████| 204/204 [00:02<00:00, 83.88it/s]
26032 images processed, 2.476963520050049 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:33,  2.33it/s] 11%|█▏        | 9/79 [00:00<00:03, 18.70it/s] 22%|██▏       | 17/79 [00:00<00:02, 28.15it/s] 32%|███▏      | 25/79 [00:00<00:01, 34.17it/s] 42%|████▏     | 33/79 [00:01<00:01, 38.38it/s] 52%|█████▏    | 41/79 [00:01<00:00, 42.39it/s] 62%|██████▏   | 49/79 [00:01<00:00, 45.59it/s] 72%|███████▏  | 57/79 [00:01<00:00, 46.28it/s] 82%|████████▏ | 65/79 [00:01<00:00, 47.17it/s] 92%|█████████▏| 73/79 [00:01<00:00, 47.75it/s]100%|██████████| 79/79 [00:01<00:00, 39.90it/s]
10000 images processed, 2.013481616973877 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:26,  2.98it/s] 14%|█▍        | 11/79 [00:00<00:02, 31.51it/s] 27%|██▋       | 21/79 [00:00<00:01, 50.40it/s] 39%|███▉      | 31/79 [00:00<00:00, 63.67it/s] 52%|█████▏    | 41/79 [00:00<00:00, 73.18it/s] 65%|██████▍   | 51/79 [00:00<00:00, 79.82it/s] 77%|███████▋  | 61/79 [00:00<00:00, 84.44it/s] 90%|████████▉ | 71/79 [00:01<00:00, 87.90it/s]100%|██████████| 79/79 [00:01<00:00, 68.61it/s]
10000 images processed, 1.1734321117401123 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:21,  3.23it/s] 16%|█▌        | 11/70 [00:00<00:01, 33.31it/s] 30%|███       | 21/70 [00:00<00:00, 53.03it/s] 44%|████▍     | 31/70 [00:00<00:00, 66.27it/s] 59%|█████▊    | 41/70 [00:00<00:00, 75.25it/s] 73%|███████▎  | 51/70 [00:00<00:00, 81.43it/s] 87%|████████▋ | 61/70 [00:00<00:00, 85.87it/s]100%|██████████| 70/70 [00:01<00:00, 67.48it/s]
8925 images processed, 1.06807279586792 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:00<00:40,  1.10it/s]  4%|▍         | 2/45 [00:01<00:19,  2.24it/s] 20%|██        | 9/45 [00:01<00:03,  9.42it/s] 24%|██▍       | 11/45 [00:01<00:03,  9.17it/s] 31%|███       | 14/45 [00:01<00:02, 11.26it/s] 38%|███▊      | 17/45 [00:01<00:02, 12.25it/s] 42%|████▏     | 19/45 [00:02<00:02, 12.04it/s] 49%|████▉     | 22/45 [00:02<00:01, 12.08it/s] 56%|█████▌    | 25/45 [00:02<00:01, 14.47it/s] 60%|██████    | 27/45 [00:02<00:01, 13.13it/s] 67%|██████▋   | 30/45 [00:03<00:01, 11.19it/s] 73%|███████▎  | 33/45 [00:03<00:00, 12.25it/s] 78%|███████▊  | 35/45 [00:03<00:00, 11.98it/s] 89%|████████▉ | 40/45 [00:03<00:00, 16.73it/s] 93%|█████████▎| 42/45 [00:04<00:00,  9.06it/s]100%|██████████| 45/45 [00:04<00:00, 10.63it/s]
5640 images processed, 4.2533276081085205 seconds used

18.2601637840271
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.52  99.36
places365     67.91  81.18
LSUN          17.58  96.08
iSUN          72.37  81.70
dtd           37.91  91.39
AVG           39.66  89.94
Retain-Acc: 0.7406
Forget-as-OOD (retain known vs forget novel):
  FPR: 79.50 AUROC: 86.90 AUIN: 98.36
19.44101572036743
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e10-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid
epochs=10 | cache=6 | flambda=0.5 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e10-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e10-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e10-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21843904
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<02:35,  2.50it/s]  3%|▎         | 11/391 [00:00<00:13, 27.50it/s]  5%|▌         | 21/391 [00:00<00:08, 45.61it/s]  8%|▊         | 31/391 [00:00<00:06, 59.24it/s] 10%|█         | 41/391 [00:00<00:05, 69.08it/s] 13%|█▎        | 51/391 [00:00<00:04, 76.28it/s] 16%|█▌        | 61/391 [00:01<00:04, 80.79it/s] 18%|█▊        | 71/391 [00:01<00:03, 84.36it/s] 21%|██        | 81/391 [00:01<00:03, 86.92it/s] 23%|██▎       | 91/391 [00:01<00:03, 87.89it/s] 26%|██▌       | 101/391 [00:01<00:03, 88.67it/s] 28%|██▊       | 111/391 [00:01<00:03, 88.27it/s] 31%|███       | 121/391 [00:01<00:03, 89.67it/s] 34%|███▎      | 131/391 [00:01<00:02, 91.37it/s] 36%|███▌      | 141/391 [00:01<00:02, 92.68it/s] 39%|███▊      | 151/391 [00:02<00:02, 93.48it/s] 41%|████      | 161/391 [00:02<00:02, 93.72it/s] 44%|████▎     | 171/391 [00:02<00:02, 94.02it/s] 46%|████▋     | 181/391 [00:02<00:02, 94.22it/s] 49%|████▉     | 191/391 [00:02<00:02, 94.33it/s] 51%|█████▏    | 201/391 [00:02<00:02, 94.03it/s] 54%|█████▍    | 211/391 [00:02<00:01, 94.28it/s] 57%|█████▋    | 221/391 [00:02<00:01, 93.65it/s] 59%|█████▉    | 231/391 [00:02<00:01, 93.57it/s] 62%|██████▏   | 241/391 [00:02<00:01, 93.56it/s] 64%|██████▍   | 251/391 [00:03<00:01, 93.50it/s] 67%|██████▋   | 261/391 [00:03<00:01, 93.64it/s] 69%|██████▉   | 271/391 [00:03<00:01, 93.88it/s] 72%|███████▏  | 281/391 [00:03<00:01, 93.86it/s] 74%|███████▍  | 291/391 [00:03<00:01, 93.94it/s] 77%|███████▋  | 301/391 [00:03<00:00, 93.57it/s] 80%|███████▉  | 311/391 [00:03<00:00, 92.86it/s] 82%|████████▏ | 321/391 [00:03<00:00, 93.34it/s] 85%|████████▍ | 331/391 [00:03<00:00, 93.33it/s] 87%|████████▋ | 341/391 [00:04<00:00, 93.81it/s] 90%|████████▉ | 351/391 [00:04<00:00, 94.19it/s] 92%|█████████▏| 361/391 [00:04<00:00, 94.13it/s] 95%|█████████▍| 371/391 [00:04<00:00, 93.97it/s] 97%|█████████▋| 381/391 [00:04<00:00, 93.95it/s]100%|██████████| 391/391 [00:04<00:00, 92.08it/s]100%|██████████| 391/391 [00:04<00:00, 85.22it/s]
50000 images processed, 4.673475980758667 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:25,  3.11it/s] 14%|█▍        | 11/79 [00:00<00:02, 32.37it/s] 27%|██▋       | 21/79 [00:00<00:01, 51.87it/s] 39%|███▉      | 31/79 [00:00<00:00, 65.12it/s] 52%|█████▏    | 41/79 [00:00<00:00, 74.29it/s] 65%|██████▍   | 51/79 [00:00<00:00, 80.25it/s] 77%|███████▋  | 61/79 [00:00<00:00, 83.86it/s] 90%|████████▉ | 71/79 [00:01<00:00, 86.88it/s]100%|██████████| 79/79 [00:01<00:00, 67.04it/s]
10000 images processed, 1.2080342769622803 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:28,  2.30it/s]  5%|▌         | 11/204 [00:00<00:07, 25.91it/s] 10%|█         | 21/204 [00:00<00:04, 43.92it/s] 15%|█▌        | 31/204 [00:00<00:03, 57.12it/s] 20%|██        | 41/204 [00:00<00:02, 66.82it/s] 25%|██▌       | 51/204 [00:00<00:02, 73.86it/s] 30%|██▉       | 61/204 [00:01<00:01, 78.84it/s] 34%|███▍      | 70/204 [00:01<00:01, 81.91it/s] 39%|███▉      | 80/204 [00:01<00:01, 84.67it/s] 44%|████▎     | 89/204 [00:01<00:01, 85.47it/s] 49%|████▊     | 99/204 [00:01<00:01, 86.88it/s] 53%|█████▎    | 109/204 [00:01<00:01, 88.04it/s] 58%|█████▊    | 119/204 [00:01<00:00, 88.73it/s] 63%|██████▎   | 129/204 [00:01<00:00, 89.49it/s] 68%|██████▊   | 139/204 [00:01<00:00, 89.42it/s] 73%|███████▎  | 149/204 [00:02<00:00, 89.92it/s] 78%|███████▊  | 159/204 [00:02<00:00, 90.26it/s] 83%|████████▎ | 169/204 [00:02<00:00, 90.21it/s] 88%|████████▊ | 179/204 [00:02<00:00, 89.96it/s] 93%|█████████▎| 189/204 [00:02<00:00, 90.61it/s] 98%|█████████▊| 199/204 [00:02<00:00, 91.62it/s]100%|██████████| 204/204 [00:02<00:00, 76.13it/s]
26032 images processed, 2.729308605194092 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:42,  1.82it/s] 11%|█▏        | 9/79 [00:00<00:04, 14.68it/s] 22%|██▏       | 17/79 [00:00<00:02, 22.40it/s] 32%|███▏      | 25/79 [00:01<00:01, 27.49it/s] 42%|████▏     | 33/79 [00:01<00:01, 30.76it/s] 52%|█████▏    | 41/79 [00:01<00:01, 32.93it/s] 62%|██████▏   | 49/79 [00:01<00:00, 34.20it/s] 72%|███████▏  | 57/79 [00:02<00:00, 35.15it/s] 82%|████████▏ | 65/79 [00:02<00:00, 36.07it/s] 92%|█████████▏| 73/79 [00:02<00:00, 36.79it/s]100%|██████████| 79/79 [00:02<00:00, 31.46it/s]
10000 images processed, 2.5486836433410645 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:27,  2.87it/s] 13%|█▎        | 10/79 [00:00<00:02, 27.50it/s] 25%|██▌       | 20/79 [00:00<00:01, 47.64it/s] 38%|███▊      | 30/79 [00:00<00:00, 61.72it/s] 49%|████▉     | 39/79 [00:00<00:00, 69.31it/s] 62%|██████▏   | 49/79 [00:00<00:00, 76.92it/s] 75%|███████▍  | 59/79 [00:00<00:00, 82.07it/s] 87%|████████▋ | 69/79 [00:01<00:00, 86.12it/s]100%|██████████| 79/79 [00:01<00:00, 66.64it/s]
10000 images processed, 1.2055199146270752 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:26,  2.60it/s] 16%|█▌        | 11/70 [00:00<00:02, 28.36it/s] 30%|███       | 21/70 [00:00<00:01, 46.95it/s] 44%|████▍     | 31/70 [00:00<00:00, 60.26it/s] 57%|█████▋    | 40/70 [00:00<00:00, 68.48it/s] 71%|███████▏  | 50/70 [00:00<00:00, 75.55it/s] 86%|████████▌ | 60/70 [00:01<00:00, 80.93it/s]100%|██████████| 70/70 [00:01<00:00, 83.59it/s]100%|██████████| 70/70 [00:01<00:00, 61.52it/s]
8925 images processed, 1.1741697788238525 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:01<00:44,  1.00s/it]  4%|▍         | 2/45 [00:01<00:20,  2.06it/s] 20%|██        | 9/45 [00:01<00:04,  8.75it/s] 24%|██▍       | 11/45 [00:01<00:03,  8.95it/s] 31%|███       | 14/45 [00:01<00:02, 11.82it/s] 38%|███▊      | 17/45 [00:02<00:02, 11.22it/s] 42%|████▏     | 19/45 [00:02<00:02, 12.06it/s] 49%|████▉     | 22/45 [00:02<00:01, 13.51it/s] 56%|█████▌    | 25/45 [00:02<00:01, 13.34it/s] 60%|██████    | 27/45 [00:02<00:01, 13.18it/s] 67%|██████▋   | 30/45 [00:03<00:01, 12.94it/s] 73%|███████▎  | 33/45 [00:03<00:01, 10.67it/s] 78%|███████▊  | 35/45 [00:03<00:00, 11.66it/s] 91%|█████████ | 41/45 [00:03<00:00, 12.83it/s] 96%|█████████▌| 43/45 [00:04<00:00, 10.38it/s]100%|██████████| 45/45 [00:04<00:00, 10.42it/s]
5640 images processed, 4.3445093631744385 seconds used

19.763463497161865
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.51  99.36
places365     67.82  81.19
LSUN          17.42  96.11
iSUN          72.29  81.73
dtd           37.87  91.38
AVG           39.58  89.95
Retain-Acc: 0.7407
Forget-as-OOD (retain known vs forget novel):
  FPR: 79.50 AUROC: 86.89 AUIN: 98.36
20.14655566215515
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e20-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid
epochs=20 | cache=6 | flambda=0.5 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e20-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e20-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e20-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21843904
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<02:43,  2.38it/s]  3%|▎         | 11/391 [00:00<00:14, 26.78it/s]  5%|▌         | 21/391 [00:00<00:08, 45.44it/s]  8%|▊         | 31/391 [00:00<00:06, 59.56it/s] 10%|█         | 41/391 [00:00<00:05, 69.94it/s] 13%|█▎        | 51/391 [00:00<00:04, 77.40it/s] 16%|█▌        | 61/391 [00:01<00:03, 82.83it/s] 18%|█▊        | 71/391 [00:01<00:03, 86.69it/s] 21%|██        | 81/391 [00:01<00:03, 89.36it/s] 23%|██▎       | 91/391 [00:01<00:03, 91.27it/s] 26%|██▌       | 101/391 [00:01<00:03, 92.56it/s] 28%|██▊       | 111/391 [00:01<00:02, 93.50it/s] 31%|███       | 121/391 [00:01<00:02, 94.11it/s] 34%|███▎      | 131/391 [00:01<00:02, 94.63it/s] 36%|███▌      | 141/391 [00:01<00:02, 94.78it/s] 39%|███▊      | 151/391 [00:01<00:02, 94.86it/s] 41%|████      | 161/391 [00:02<00:02, 94.58it/s] 44%|████▎     | 171/391 [00:02<00:02, 94.62it/s] 46%|████▋     | 181/391 [00:02<00:02, 94.91it/s] 49%|████▉     | 191/391 [00:02<00:02, 94.81it/s] 51%|█████▏    | 201/391 [00:02<00:01, 95.00it/s] 54%|█████▍    | 211/391 [00:02<00:01, 95.10it/s] 57%|█████▋    | 221/391 [00:02<00:01, 94.99it/s] 59%|█████▉    | 231/391 [00:02<00:01, 95.12it/s] 62%|██████▏   | 241/391 [00:02<00:01, 95.27it/s] 64%|██████▍   | 251/391 [00:03<00:01, 95.04it/s] 67%|██████▋   | 261/391 [00:03<00:01, 95.29it/s] 69%|██████▉   | 271/391 [00:03<00:01, 95.33it/s] 72%|███████▏  | 281/391 [00:03<00:01, 95.27it/s] 74%|███████▍  | 291/391 [00:03<00:01, 95.34it/s] 77%|███████▋  | 301/391 [00:03<00:00, 95.33it/s] 80%|███████▉  | 311/391 [00:03<00:00, 95.12it/s] 82%|████████▏ | 321/391 [00:03<00:00, 95.15it/s] 85%|████████▍ | 331/391 [00:03<00:00, 95.06it/s] 87%|████████▋ | 341/391 [00:03<00:00, 94.97it/s] 90%|████████▉ | 351/391 [00:04<00:00, 94.96it/s] 92%|█████████▏| 361/391 [00:04<00:00, 94.72it/s] 95%|█████████▍| 371/391 [00:04<00:00, 94.60it/s] 97%|█████████▋| 381/391 [00:04<00:00, 94.58it/s]100%|██████████| 391/391 [00:04<00:00, 91.82it/s]100%|██████████| 391/391 [00:04<00:00, 86.35it/s]
50000 images processed, 4.615692853927612 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:27,  2.86it/s] 14%|█▍        | 11/79 [00:00<00:02, 30.31it/s] 27%|██▋       | 21/79 [00:00<00:01, 49.05it/s] 39%|███▉      | 31/79 [00:00<00:00, 62.04it/s] 52%|█████▏    | 41/79 [00:00<00:00, 71.18it/s] 65%|██████▍   | 51/79 [00:00<00:00, 77.55it/s] 77%|███████▋  | 61/79 [00:01<00:00, 81.95it/s] 90%|████████▉ | 71/79 [00:01<00:00, 85.53it/s]100%|██████████| 79/79 [00:01<00:00, 65.52it/s]
10000 images processed, 1.23085618019104 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:29,  2.26it/s]  5%|▌         | 11/204 [00:00<00:07, 25.74it/s] 10%|█         | 21/204 [00:00<00:04, 44.11it/s] 15%|█▌        | 31/204 [00:00<00:02, 57.78it/s] 20%|██        | 41/204 [00:00<00:02, 67.96it/s] 25%|██▌       | 51/204 [00:00<00:02, 75.69it/s] 30%|██▉       | 61/204 [00:01<00:01, 81.12it/s] 35%|███▍      | 71/204 [00:01<00:01, 85.03it/s] 40%|███▉      | 81/204 [00:01<00:01, 87.77it/s] 45%|████▍     | 91/204 [00:01<00:01, 89.75it/s] 50%|████▉     | 101/204 [00:01<00:01, 90.66it/s] 54%|█████▍    | 111/204 [00:01<00:01, 91.66it/s] 59%|█████▉    | 121/204 [00:01<00:00, 92.54it/s] 64%|██████▍   | 131/204 [00:01<00:00, 92.78it/s] 69%|██████▉   | 141/204 [00:01<00:00, 93.50it/s] 74%|███████▍  | 151/204 [00:02<00:00, 93.88it/s] 79%|███████▉  | 161/204 [00:02<00:00, 94.03it/s] 84%|████████▍ | 171/204 [00:02<00:00, 93.88it/s] 89%|████████▊ | 181/204 [00:02<00:00, 92.29it/s] 94%|█████████▎| 191/204 [00:02<00:00, 92.27it/s] 99%|█████████▊| 201/204 [00:02<00:00, 92.97it/s]100%|██████████| 204/204 [00:02<00:00, 78.03it/s]
26032 images processed, 2.666685104370117 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:40,  1.91it/s] 11%|█▏        | 9/79 [00:00<00:04, 16.23it/s] 22%|██▏       | 17/79 [00:00<00:02, 26.34it/s] 29%|██▉       | 23/79 [00:00<00:01, 33.37it/s] 37%|███▋      | 29/79 [00:01<00:01, 34.33it/s] 47%|████▋     | 37/79 [00:01<00:01, 37.22it/s] 57%|█████▋    | 45/79 [00:01<00:00, 38.91it/s] 67%|██████▋   | 53/79 [00:01<00:00, 40.33it/s] 77%|███████▋  | 61/79 [00:01<00:00, 40.89it/s] 87%|████████▋ | 69/79 [00:02<00:00, 42.17it/s] 97%|█████████▋| 77/79 [00:02<00:00, 43.90it/s]100%|██████████| 79/79 [00:02<00:00, 35.45it/s]
10000 images processed, 2.2708442211151123 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:26,  2.96it/s] 14%|█▍        | 11/79 [00:00<00:02, 31.33it/s] 27%|██▋       | 21/79 [00:00<00:01, 50.86it/s] 39%|███▉      | 31/79 [00:00<00:00, 63.72it/s] 52%|█████▏    | 41/79 [00:00<00:00, 72.93it/s] 65%|██████▍   | 51/79 [00:00<00:00, 79.53it/s] 77%|███████▋  | 61/79 [00:00<00:00, 84.26it/s] 90%|████████▉ | 71/79 [00:01<00:00, 87.75it/s]100%|██████████| 79/79 [00:01<00:00, 68.50it/s]
10000 images processed, 1.175328016281128 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:25,  2.65it/s] 16%|█▌        | 11/70 [00:00<00:02, 28.95it/s] 30%|███       | 21/70 [00:00<00:01, 47.97it/s] 44%|████▍     | 31/70 [00:00<00:00, 61.77it/s] 59%|█████▊    | 41/70 [00:00<00:00, 71.65it/s] 73%|███████▎  | 51/70 [00:00<00:00, 78.61it/s] 87%|████████▋ | 61/70 [00:01<00:00, 83.79it/s]100%|██████████| 70/70 [00:01<00:00, 63.19it/s]
8925 images processed, 1.1404492855072021 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:00<00:40,  1.10it/s]  4%|▍         | 2/45 [00:01<00:19,  2.22it/s] 20%|██        | 9/45 [00:01<00:03,  9.38it/s] 24%|██▍       | 11/45 [00:01<00:03, 10.29it/s] 31%|███       | 14/45 [00:01<00:02, 12.99it/s] 38%|███▊      | 17/45 [00:01<00:02, 12.25it/s] 44%|████▍     | 20/45 [00:02<00:01, 13.56it/s] 49%|████▉     | 22/45 [00:02<00:01, 14.47it/s] 53%|█████▎    | 24/45 [00:02<00:01, 15.01it/s] 62%|██████▏   | 28/45 [00:02<00:01, 14.54it/s] 67%|██████▋   | 30/45 [00:02<00:01, 13.28it/s] 73%|███████▎  | 33/45 [00:02<00:00, 13.91it/s] 80%|████████  | 36/45 [00:03<00:00, 13.54it/s] 87%|████████▋ | 39/45 [00:03<00:00, 14.62it/s] 91%|█████████ | 41/45 [00:03<00:00, 15.04it/s] 96%|█████████▌| 43/45 [00:03<00:00, 14.63it/s]100%|██████████| 45/45 [00:03<00:00, 11.04it/s]100%|██████████| 45/45 [00:03<00:00, 11.35it/s]
5640 images processed, 3.9863321781158447 seconds used

18.932713747024536
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.51  99.36
places365     67.74  81.19
LSUN          17.31  96.12
iSUN          72.21  81.74
dtd           37.84  91.38
AVG           39.52  89.96
Retain-Acc: 0.7407
Forget-as-OOD (retain known vs forget novel):
  FPR: 79.50 AUROC: 86.89 AUIN: 98.36
12.544043064117432
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e50-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid
epochs=50 | cache=6 | flambda=0.5 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e50-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e50-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e50-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21843904
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<01:50,  3.52it/s]  3%|▎         | 10/391 [00:00<00:11, 31.98it/s]  5%|▍         | 19/391 [00:00<00:07, 49.05it/s]  7%|▋         | 28/391 [00:00<00:06, 59.94it/s]  9%|▉         | 37/391 [00:00<00:05, 67.14it/s] 12%|█▏        | 46/391 [00:00<00:04, 71.91it/s] 14%|█▍        | 55/391 [00:00<00:04, 75.19it/s] 16%|█▋        | 64/391 [00:01<00:04, 77.41it/s] 19%|█▊        | 73/391 [00:01<00:04, 78.85it/s] 21%|██        | 82/391 [00:01<00:03, 79.93it/s] 23%|██▎       | 91/391 [00:01<00:03, 80.71it/s] 26%|██▌       | 100/391 [00:01<00:03, 81.80it/s] 28%|██▊       | 110/391 [00:01<00:03, 85.49it/s] 31%|███       | 120/391 [00:01<00:03, 88.26it/s] 33%|███▎      | 129/391 [00:01<00:02, 88.48it/s] 35%|███▌      | 138/391 [00:01<00:02, 88.80it/s] 38%|███▊      | 147/391 [00:02<00:03, 81.30it/s] 40%|███▉      | 156/391 [00:02<00:03, 77.32it/s] 42%|████▏     | 164/391 [00:02<00:03, 75.35it/s] 44%|████▍     | 172/391 [00:02<00:03, 69.71it/s] 46%|████▋     | 181/391 [00:02<00:02, 73.65it/s] 48%|████▊     | 189/391 [00:02<00:02, 72.86it/s] 50%|█████     | 197/391 [00:02<00:02, 70.21it/s] 53%|█████▎    | 206/391 [00:02<00:02, 73.76it/s] 55%|█████▍    | 214/391 [00:02<00:02, 69.87it/s] 57%|█████▋    | 222/391 [00:03<00:02, 70.02it/s] 59%|█████▉    | 231/391 [00:03<00:02, 74.41it/s] 61%|██████    | 239/391 [00:03<00:02, 71.96it/s] 63%|██████▎   | 247/391 [00:03<00:02, 71.00it/s] 65%|██████▌   | 255/391 [00:03<00:01, 72.67it/s] 67%|██████▋   | 263/391 [00:03<00:01, 71.25it/s] 69%|██████▉   | 271/391 [00:03<00:01, 68.64it/s] 72%|███████▏  | 281/391 [00:03<00:01, 75.23it/s] 74%|███████▍  | 289/391 [00:04<00:01, 74.18it/s] 76%|███████▌  | 297/391 [00:04<00:01, 71.04it/s] 78%|███████▊  | 305/391 [00:04<00:01, 72.88it/s] 80%|████████  | 313/391 [00:04<00:01, 71.86it/s] 82%|████████▏ | 321/391 [00:04<00:01, 67.69it/s] 84%|████████▍ | 330/391 [00:04<00:00, 72.06it/s] 86%|████████▋ | 338/391 [00:04<00:00, 70.48it/s] 88%|████████▊ | 346/391 [00:04<00:00, 67.75it/s] 91%|█████████ | 354/391 [00:04<00:00, 69.78it/s] 93%|█████████▎| 362/391 [00:05<00:00, 66.30it/s] 95%|█████████▍| 371/391 [00:05<00:00, 70.88it/s] 97%|█████████▋| 379/391 [00:05<00:00, 70.28it/s] 99%|█████████▉| 387/391 [00:05<00:00, 68.09it/s]100%|██████████| 391/391 [00:05<00:00, 71.23it/s]
50000 images processed, 5.567925214767456 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:26,  2.99it/s] 10%|█         | 8/79 [00:00<00:03, 22.33it/s] 22%|██▏       | 17/79 [00:00<00:01, 41.27it/s] 32%|███▏      | 25/79 [00:00<00:01, 51.04it/s] 41%|████      | 32/79 [00:00<00:00, 53.85it/s] 51%|█████     | 40/79 [00:00<00:00, 59.64it/s] 59%|█████▉    | 47/79 [00:00<00:00, 61.00it/s] 68%|██████▊   | 54/79 [00:01<00:00, 59.18it/s] 78%|███████▊  | 62/79 [00:01<00:00, 64.64it/s] 87%|████████▋ | 69/79 [00:01<00:00, 63.40it/s] 96%|█████████▌| 76/79 [00:01<00:00, 62.31it/s]100%|██████████| 79/79 [00:01<00:00, 52.74it/s]
10000 images processed, 1.520888328552246 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:11,  2.83it/s]  4%|▍         | 8/204 [00:00<00:08, 21.95it/s]  8%|▊         | 16/204 [00:00<00:05, 37.48it/s] 11%|█         | 22/204 [00:00<00:04, 43.36it/s] 15%|█▍        | 30/204 [00:00<00:03, 52.27it/s] 18%|█▊        | 37/204 [00:00<00:02, 56.86it/s] 22%|██▏       | 44/204 [00:01<00:02, 58.01it/s] 25%|██▌       | 52/204 [00:01<00:02, 63.67it/s] 29%|██▉       | 59/204 [00:01<00:02, 63.98it/s] 32%|███▏      | 66/204 [00:01<00:02, 61.86it/s] 36%|███▋      | 74/204 [00:01<00:01, 65.64it/s] 40%|███▉      | 81/204 [00:01<00:01, 64.65it/s] 43%|████▎     | 88/204 [00:01<00:01, 65.40it/s] 48%|████▊     | 97/204 [00:01<00:01, 70.36it/s] 51%|█████▏    | 105/204 [00:01<00:01, 65.75it/s] 56%|█████▌    | 114/204 [00:02<00:01, 71.60it/s] 60%|█████▉    | 122/204 [00:02<00:01, 69.01it/s] 64%|██████▎   | 130/204 [00:02<00:01, 68.16it/s] 68%|██████▊   | 139/204 [00:02<00:00, 71.56it/s] 72%|███████▏  | 147/204 [00:02<00:00, 68.98it/s] 75%|███████▌  | 154/204 [00:02<00:00, 68.42it/s] 79%|███████▉  | 161/204 [00:02<00:00, 67.82it/s] 82%|████████▏ | 168/204 [00:02<00:00, 65.09it/s] 86%|████████▋ | 176/204 [00:02<00:00, 67.41it/s] 90%|████████▉ | 183/204 [00:03<00:00, 64.68it/s] 93%|█████████▎| 190/204 [00:03<00:00, 64.24it/s] 98%|█████████▊| 199/204 [00:03<00:00, 70.88it/s]100%|██████████| 204/204 [00:03<00:00, 60.99it/s]
26032 images processed, 3.396486759185791 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:47,  1.65it/s]  9%|▉         | 7/79 [00:00<00:05, 12.41it/s] 15%|█▌        | 12/79 [00:00<00:03, 19.88it/s] 23%|██▎       | 18/79 [00:00<00:02, 28.68it/s] 29%|██▉       | 23/79 [00:01<00:01, 32.87it/s] 35%|███▌      | 28/79 [00:01<00:01, 33.44it/s] 43%|████▎     | 34/79 [00:01<00:01, 39.10it/s] 49%|████▉     | 39/79 [00:01<00:00, 41.41it/s] 56%|█████▌    | 44/79 [00:01<00:00, 38.08it/s] 65%|██████▍   | 51/79 [00:01<00:00, 39.14it/s] 75%|███████▍  | 59/79 [00:01<00:00, 41.21it/s] 84%|████████▎ | 66/79 [00:02<00:00, 47.29it/s] 91%|█████████ | 72/79 [00:02<00:00, 47.07it/s] 97%|█████████▋| 77/79 [00:02<00:00, 41.91it/s]100%|██████████| 79/79 [00:02<00:00, 34.14it/s]
10000 images processed, 2.3526651859283447 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:35,  2.20it/s]  9%|▉         | 7/79 [00:00<00:04, 15.81it/s] 20%|██        | 16/79 [00:00<00:01, 33.66it/s] 29%|██▉       | 23/79 [00:00<00:01, 41.32it/s] 38%|███▊      | 30/79 [00:00<00:01, 48.01it/s] 48%|████▊     | 38/79 [00:00<00:00, 56.48it/s] 57%|█████▋    | 45/79 [00:01<00:00, 58.38it/s] 66%|██████▌   | 52/79 [00:01<00:00, 59.67it/s] 77%|███████▋  | 61/79 [00:01<00:00, 67.88it/s] 87%|████████▋ | 69/79 [00:01<00:00, 65.20it/s] 96%|█████████▌| 76/79 [00:01<00:00, 65.97it/s]100%|██████████| 79/79 [00:01<00:00, 50.02it/s]
10000 images processed, 1.6071140766143799 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:29,  2.32it/s] 14%|█▍        | 10/70 [00:00<00:02, 23.58it/s] 23%|██▎       | 16/70 [00:00<00:01, 32.31it/s] 34%|███▍      | 24/70 [00:00<00:01, 43.96it/s] 47%|████▋     | 33/70 [00:00<00:00, 53.99it/s] 57%|█████▋    | 40/70 [00:01<00:00, 54.27it/s] 70%|███████   | 49/70 [00:01<00:00, 63.17it/s] 81%|████████▏ | 57/70 [00:01<00:00, 63.54it/s] 91%|█████████▏| 64/70 [00:01<00:00, 63.62it/s]100%|██████████| 70/70 [00:01<00:00, 49.69it/s]
8925 images processed, 1.445488691329956 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:01<00:44,  1.02s/it]  4%|▍         | 2/45 [00:01<00:21,  2.00it/s] 20%|██        | 9/45 [00:01<00:04,  8.13it/s] 24%|██▍       | 11/45 [00:01<00:04,  7.85it/s] 38%|███▊      | 17/45 [00:02<00:02, 10.27it/s] 42%|████▏     | 19/45 [00:02<00:02, 10.07it/s] 56%|█████▌    | 25/45 [00:02<00:01, 11.47it/s] 60%|██████    | 27/45 [00:03<00:01, 10.98it/s] 73%|███████▎  | 33/45 [00:03<00:01, 11.09it/s] 78%|███████▊  | 35/45 [00:03<00:00, 11.13it/s] 91%|█████████ | 41/45 [00:04<00:00, 13.71it/s] 96%|█████████▌| 43/45 [00:04<00:00, 10.16it/s]100%|██████████| 45/45 [00:04<00:00,  9.72it/s]
5640 images processed, 4.655501127243042 seconds used

22.371028661727905
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           4.64  98.99
places365     77.26  78.42
LSUN          30.02  94.45
iSUN          78.88  79.42
dtd           45.66  89.68
AVG           47.29  88.19
Retain-Acc: 0.7398
Forget-as-OOD (retain known vs forget novel):
  FPR: 51.10 AUROC: 89.83 AUIN: 98.70
41.759671688079834
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e5-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid
epochs=5 | cache=6 | flambda=0.5 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21843904
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<02:32,  2.56it/s]  2%|▏         | 8/391 [00:00<00:18, 20.55it/s]  4%|▎         | 14/391 [00:00<00:12, 30.95it/s]  5%|▌         | 21/391 [00:00<00:08, 41.52it/s]  8%|▊         | 30/391 [00:00<00:06, 54.50it/s] 10%|▉         | 38/391 [00:00<00:05, 60.38it/s] 12%|█▏        | 45/391 [00:01<00:05, 61.19it/s] 13%|█▎        | 52/391 [00:01<00:05, 63.59it/s] 15%|█▌        | 60/391 [00:01<00:04, 67.75it/s] 18%|█▊        | 69/391 [00:01<00:04, 72.97it/s] 20%|█▉        | 78/391 [00:01<00:04, 76.60it/s] 22%|██▏       | 86/391 [00:01<00:04, 75.01it/s] 24%|██▍       | 94/391 [00:01<00:04, 69.98it/s] 26%|██▌       | 102/391 [00:01<00:04, 69.96it/s] 28%|██▊       | 110/391 [00:01<00:03, 72.38it/s] 31%|███       | 120/391 [00:02<00:03, 78.21it/s] 33%|███▎      | 129/391 [00:02<00:03, 78.47it/s] 35%|███▌      | 137/391 [00:02<00:03, 75.02it/s] 37%|███▋      | 145/391 [00:02<00:03, 71.00it/s] 39%|███▉      | 153/391 [00:02<00:03, 71.84it/s] 41%|████▏     | 162/391 [00:02<00:03, 75.51it/s] 43%|████▎     | 170/391 [00:02<00:03, 73.13it/s] 46%|████▌     | 178/391 [00:02<00:02, 71.47it/s] 48%|████▊     | 186/391 [00:02<00:02, 71.37it/s] 50%|████▉     | 195/391 [00:03<00:02, 75.51it/s] 52%|█████▏    | 204/391 [00:03<00:02, 77.93it/s] 54%|█████▍    | 212/391 [00:03<00:02, 77.60it/s] 56%|█████▋    | 220/391 [00:03<00:02, 70.48it/s] 58%|█████▊    | 228/391 [00:03<00:02, 70.21it/s] 61%|██████    | 237/391 [00:03<00:02, 74.48it/s] 63%|██████▎   | 245/391 [00:03<00:01, 74.08it/s] 65%|██████▍   | 253/391 [00:03<00:01, 69.44it/s] 67%|██████▋   | 262/391 [00:03<00:01, 73.22it/s] 69%|██████▉   | 271/391 [00:04<00:01, 76.24it/s] 72%|███████▏  | 280/391 [00:04<00:01, 78.59it/s] 74%|███████▎  | 288/391 [00:04<00:01, 76.97it/s] 76%|███████▌  | 296/391 [00:04<00:01, 74.17it/s] 78%|███████▊  | 304/391 [00:04<00:01, 73.22it/s] 80%|███████▉  | 312/391 [00:04<00:01, 73.28it/s] 82%|████████▏ | 321/391 [00:04<00:00, 75.93it/s] 84%|████████▍ | 329/391 [00:04<00:00, 70.20it/s] 86%|████████▌ | 337/391 [00:04<00:00, 70.91it/s] 88%|████████▊ | 345/391 [00:05<00:00, 72.50it/s] 90%|█████████ | 353/391 [00:05<00:00, 72.51it/s] 92%|█████████▏| 361/391 [00:05<00:00, 72.51it/s] 94%|█████████▍| 369/391 [00:05<00:00, 69.86it/s] 96%|█████████▋| 377/391 [00:05<00:00, 70.54it/s] 99%|█████████▉| 387/391 [00:05<00:00, 77.97it/s]100%|██████████| 391/391 [00:05<00:00, 68.70it/s]
50000 images processed, 5.807565927505493 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:33,  2.30it/s] 10%|█         | 8/79 [00:00<00:03, 18.80it/s] 20%|██        | 16/79 [00:00<00:01, 33.37it/s] 29%|██▉       | 23/79 [00:00<00:01, 42.10it/s] 42%|████▏     | 33/79 [00:00<00:00, 56.19it/s] 53%|█████▎    | 42/79 [00:00<00:00, 63.76it/s] 66%|██████▌   | 52/79 [00:01<00:00, 72.06it/s] 77%|███████▋  | 61/79 [00:01<00:00, 70.69it/s] 87%|████████▋ | 69/79 [00:01<00:00, 69.39it/s] 99%|█████████▊| 78/79 [00:01<00:00, 73.07it/s]100%|██████████| 79/79 [00:01<00:00, 52.35it/s]
10000 images processed, 1.533827781677246 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:27,  2.31it/s]  4%|▍         | 9/204 [00:00<00:09, 21.41it/s]  8%|▊         | 17/204 [00:00<00:05, 36.39it/s] 12%|█▏        | 24/204 [00:00<00:04, 44.94it/s] 15%|█▌        | 31/204 [00:00<00:03, 48.83it/s] 20%|█▉        | 40/204 [00:00<00:02, 58.67it/s] 24%|██▎       | 48/204 [00:01<00:02, 63.99it/s] 27%|██▋       | 56/204 [00:01<00:02, 66.75it/s] 31%|███▏      | 64/204 [00:01<00:02, 63.50it/s] 35%|███▌      | 72/204 [00:01<00:02, 65.61it/s] 40%|███▉      | 81/204 [00:01<00:01, 70.05it/s] 44%|████▎     | 89/204 [00:01<00:01, 67.87it/s] 47%|████▋     | 96/204 [00:01<00:01, 64.45it/s] 51%|█████     | 104/204 [00:01<00:01, 67.48it/s] 55%|█████▌    | 113/204 [00:02<00:01, 72.79it/s] 60%|█████▉    | 122/204 [00:02<00:01, 74.84it/s] 64%|██████▎   | 130/204 [00:02<00:01, 68.67it/s] 68%|██████▊   | 138/204 [00:02<00:00, 68.94it/s] 72%|███████▏  | 146/204 [00:02<00:00, 71.26it/s] 76%|███████▌  | 155/204 [00:02<00:00, 74.07it/s] 80%|███████▉  | 163/204 [00:02<00:00, 70.12it/s] 84%|████████▍ | 171/204 [00:02<00:00, 69.19it/s] 88%|████████▊ | 179/204 [00:02<00:00, 70.27it/s] 92%|█████████▏| 188/204 [00:03<00:00, 74.77it/s] 97%|█████████▋| 198/204 [00:03<00:00, 79.57it/s]100%|██████████| 204/204 [00:03<00:00, 62.85it/s]
26032 images processed, 3.2992067337036133 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:49,  1.57it/s] 10%|█         | 8/79 [00:00<00:05, 13.79it/s] 15%|█▌        | 12/79 [00:00<00:03, 18.24it/s] 23%|██▎       | 18/79 [00:00<00:02, 26.74it/s] 32%|███▏      | 25/79 [00:01<00:01, 32.47it/s] 42%|████▏     | 33/79 [00:01<00:01, 36.23it/s] 51%|█████     | 40/79 [00:01<00:00, 41.06it/s] 59%|█████▉    | 47/79 [00:01<00:00, 46.16it/s] 67%|██████▋   | 53/79 [00:01<00:00, 42.98it/s] 73%|███████▎  | 58/79 [00:01<00:00, 43.86it/s] 82%|████████▏ | 65/79 [00:01<00:00, 48.67it/s] 90%|████████▉ | 71/79 [00:02<00:00, 51.32it/s] 97%|█████████▋| 77/79 [00:02<00:00, 46.04it/s]100%|██████████| 79/79 [00:02<00:00, 35.33it/s]
10000 images processed, 2.2745304107666016 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:35,  2.19it/s] 11%|█▏        | 9/79 [00:00<00:03, 20.55it/s] 22%|██▏       | 17/79 [00:00<00:01, 35.32it/s] 32%|███▏      | 25/79 [00:00<00:01, 46.75it/s] 41%|████      | 32/79 [00:00<00:00, 51.24it/s] 49%|████▉     | 39/79 [00:00<00:00, 53.50it/s] 59%|█████▉    | 47/79 [00:01<00:00, 60.00it/s] 70%|██████▉   | 55/79 [00:01<00:00, 65.15it/s] 81%|████████  | 64/79 [00:01<00:00, 69.39it/s] 91%|█████████ | 72/79 [00:01<00:00, 69.09it/s]100%|██████████| 79/79 [00:01<00:00, 52.28it/s]
10000 images processed, 1.535123586654663 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:31,  2.18it/s] 14%|█▍        | 10/70 [00:00<00:02, 22.13it/s] 24%|██▍       | 17/70 [00:00<00:01, 33.86it/s] 33%|███▎      | 23/70 [00:00<00:01, 39.81it/s] 44%|████▍     | 31/70 [00:00<00:00, 49.64it/s] 56%|█████▌    | 39/70 [00:00<00:00, 57.15it/s] 67%|██████▋   | 47/70 [00:01<00:00, 62.76it/s] 79%|███████▊  | 55/70 [00:01<00:00, 61.40it/s] 91%|█████████▏| 64/70 [00:01<00:00, 66.77it/s]100%|██████████| 70/70 [00:01<00:00, 49.37it/s]
8925 images processed, 1.4602985382080078 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:01<00:46,  1.05s/it]  4%|▍         | 2/45 [00:01<00:21,  1.99it/s] 20%|██        | 9/45 [00:01<00:04,  7.81it/s] 22%|██▏       | 10/45 [00:01<00:04,  7.38it/s] 31%|███       | 14/45 [00:01<00:02, 10.89it/s] 38%|███▊      | 17/45 [00:02<00:02, 10.79it/s] 42%|████▏     | 19/45 [00:02<00:02, 11.57it/s] 49%|████▉     | 22/45 [00:02<00:01, 13.95it/s] 56%|█████▌    | 25/45 [00:02<00:01, 13.24it/s] 60%|██████    | 27/45 [00:03<00:01, 11.34it/s] 71%|███████   | 32/45 [00:03<00:00, 17.51it/s] 78%|███████▊  | 35/45 [00:03<00:01,  9.05it/s] 91%|█████████ | 41/45 [00:04<00:00, 11.62it/s] 96%|█████████▌| 43/45 [00:04<00:00,  8.51it/s]100%|██████████| 45/45 [00:04<00:00,  9.48it/s]
5640 images processed, 4.782391309738159 seconds used

22.65193486213684
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.53  99.36
places365     67.87  81.18
LSUN          17.61  96.07
iSUN          72.34  81.68
dtd           37.87  91.39
AVG           39.64  89.94
Retain-Acc: 0.7406
Forget-as-OOD (retain known vs forget novel):
  FPR: 79.50 AUROC: 86.90 AUIN: 98.36
38.520524740219116
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e10-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid
epochs=10 | cache=6 | flambda=0.5 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e10-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e10-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e10-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21843904
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<02:30,  2.60it/s]  2%|▏         | 8/391 [00:00<00:19, 20.01it/s]  4%|▎         | 14/391 [00:00<00:12, 30.00it/s]  6%|▌         | 22/391 [00:00<00:08, 42.70it/s]  8%|▊         | 31/391 [00:00<00:06, 55.01it/s] 10%|█         | 40/391 [00:00<00:05, 61.90it/s] 12%|█▏        | 48/391 [00:01<00:05, 63.45it/s] 14%|█▍        | 55/391 [00:01<00:05, 63.06it/s] 16%|█▌        | 63/391 [00:01<00:04, 67.30it/s] 18%|█▊        | 72/391 [00:01<00:04, 72.79it/s] 20%|██        | 80/391 [00:01<00:04, 73.01it/s] 23%|██▎       | 88/391 [00:01<00:04, 73.40it/s] 25%|██▍       | 96/391 [00:01<00:04, 69.48it/s] 27%|██▋       | 104/391 [00:01<00:04, 69.85it/s] 29%|██▉       | 113/391 [00:01<00:03, 73.66it/s] 31%|███       | 122/391 [00:02<00:03, 75.81it/s] 33%|███▎      | 130/391 [00:02<00:03, 73.91it/s] 35%|███▌      | 138/391 [00:02<00:03, 69.24it/s] 37%|███▋      | 146/391 [00:02<00:03, 71.70it/s] 40%|███▉      | 155/391 [00:02<00:03, 76.19it/s] 42%|████▏     | 164/391 [00:02<00:02, 78.98it/s] 44%|████▍     | 172/391 [00:02<00:03, 67.55it/s] 46%|████▌     | 180/391 [00:02<00:03, 68.74it/s] 48%|████▊     | 189/391 [00:02<00:02, 73.74it/s] 50%|█████     | 197/391 [00:03<00:02, 71.69it/s] 52%|█████▏    | 205/391 [00:03<00:02, 65.42it/s] 55%|█████▍    | 214/391 [00:03<00:02, 70.32it/s] 57%|█████▋    | 224/391 [00:03<00:02, 76.27it/s] 60%|█████▉    | 233/391 [00:03<00:02, 78.94it/s] 62%|██████▏   | 242/391 [00:03<00:01, 75.77it/s] 64%|██████▍   | 250/391 [00:03<00:01, 70.58it/s] 66%|██████▌   | 258/391 [00:03<00:01, 71.39it/s] 68%|██████▊   | 266/391 [00:04<00:01, 72.85it/s] 70%|███████   | 275/391 [00:04<00:01, 75.09it/s] 72%|███████▏  | 283/391 [00:04<00:01, 72.94it/s] 74%|███████▍  | 291/391 [00:04<00:01, 68.81it/s] 77%|███████▋  | 300/391 [00:04<00:01, 72.78it/s] 79%|███████▉  | 308/391 [00:04<00:01, 73.67it/s] 81%|████████  | 316/391 [00:04<00:01, 71.56it/s] 83%|████████▎ | 324/391 [00:04<00:00, 67.57it/s] 85%|████████▌ | 334/391 [00:04<00:00, 73.48it/s] 88%|████████▊ | 343/391 [00:05<00:00, 76.59it/s] 90%|████████▉ | 351/391 [00:05<00:00, 77.18it/s] 92%|█████████▏| 359/391 [00:05<00:00, 75.80it/s] 94%|█████████▍| 367/391 [00:05<00:00, 70.86it/s] 96%|█████████▌| 375/391 [00:05<00:00, 71.56it/s] 98%|█████████▊| 385/391 [00:05<00:00, 78.61it/s]100%|██████████| 391/391 [00:05<00:00, 68.16it/s]
50000 images processed, 5.846358060836792 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:24,  3.23it/s] 11%|█▏        | 9/79 [00:00<00:02, 26.54it/s] 19%|█▉        | 15/79 [00:00<00:01, 35.85it/s] 28%|██▊       | 22/79 [00:00<00:01, 44.55it/s] 38%|███▊      | 30/79 [00:00<00:00, 53.34it/s] 49%|████▉     | 39/79 [00:00<00:00, 63.36it/s] 61%|██████    | 48/79 [00:00<00:00, 70.28it/s] 71%|███████   | 56/79 [00:01<00:00, 66.65it/s] 81%|████████  | 64/79 [00:01<00:00, 66.75it/s] 94%|█████████▎| 74/79 [00:01<00:00, 74.30it/s]100%|██████████| 79/79 [00:01<00:00, 57.11it/s]
10000 images processed, 1.4102075099945068 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:26,  2.34it/s]  4%|▍         | 9/204 [00:00<00:09, 21.31it/s]  8%|▊         | 17/204 [00:00<00:05, 36.42it/s] 12%|█▏        | 25/204 [00:00<00:03, 46.59it/s] 16%|█▌        | 32/204 [00:00<00:03, 52.67it/s] 19%|█▉        | 39/204 [00:00<00:02, 56.50it/s] 23%|██▎       | 47/204 [00:01<00:02, 62.71it/s] 27%|██▋       | 56/204 [00:01<00:02, 68.24it/s] 31%|███▏      | 64/204 [00:01<00:02, 65.97it/s] 35%|███▍      | 71/204 [00:01<00:02, 61.56it/s] 39%|███▊      | 79/204 [00:01<00:01, 65.76it/s] 43%|████▎     | 88/204 [00:01<00:01, 71.87it/s] 48%|████▊     | 98/204 [00:01<00:01, 77.78it/s] 52%|█████▏    | 106/204 [00:01<00:01, 72.73it/s] 56%|█████▌    | 114/204 [00:02<00:01, 69.89it/s] 60%|██████    | 123/204 [00:02<00:01, 74.36it/s] 65%|██████▍   | 132/204 [00:02<00:00, 76.84it/s] 69%|██████▊   | 140/204 [00:02<00:00, 75.44it/s] 73%|███████▎  | 148/204 [00:02<00:00, 70.27it/s] 76%|███████▋  | 156/204 [00:02<00:00, 71.40it/s] 81%|████████  | 165/204 [00:02<00:00, 75.66it/s] 85%|████████▍ | 173/204 [00:02<00:00, 73.16it/s] 89%|████████▊ | 181/204 [00:02<00:00, 68.25it/s] 93%|█████████▎| 189/204 [00:03<00:00, 71.25it/s] 98%|█████████▊| 199/204 [00:03<00:00, 77.93it/s]100%|██████████| 204/204 [00:03<00:00, 63.80it/s]
26032 images processed, 3.2593188285827637 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:45,  1.70it/s]  8%|▊         | 6/79 [00:00<00:06, 11.10it/s] 13%|█▎        | 10/79 [00:00<00:04, 16.54it/s] 22%|██▏       | 17/79 [00:00<00:02, 26.08it/s] 27%|██▋       | 21/79 [00:01<00:02, 27.83it/s] 34%|███▍      | 27/79 [00:01<00:01, 34.22it/s] 41%|████      | 32/79 [00:01<00:01, 36.37it/s] 47%|████▋     | 37/79 [00:01<00:01, 34.56it/s] 57%|█████▋    | 45/79 [00:01<00:00, 37.38it/s] 66%|██████▌   | 52/79 [00:01<00:00, 44.01it/s] 72%|███████▏  | 57/79 [00:01<00:00, 42.99it/s] 78%|███████▊  | 62/79 [00:02<00:00, 40.94it/s] 87%|████████▋ | 69/79 [00:02<00:00, 42.53it/s] 97%|█████████▋| 77/79 [00:02<00:00, 42.64it/s]100%|██████████| 79/79 [00:02<00:00, 33.09it/s]
10000 images processed, 2.4294984340667725 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:37,  2.10it/s] 13%|█▎        | 10/79 [00:00<00:03, 22.18it/s] 24%|██▍       | 19/79 [00:00<00:01, 37.94it/s] 34%|███▍      | 27/79 [00:00<00:01, 48.32it/s] 44%|████▍     | 35/79 [00:00<00:00, 50.39it/s] 54%|█████▍    | 43/79 [00:01<00:00, 57.17it/s] 66%|██████▌   | 52/79 [00:01<00:00, 64.22it/s] 76%|███████▌  | 60/79 [00:01<00:00, 65.30it/s] 86%|████████▌ | 68/79 [00:01<00:00, 63.39it/s] 99%|█████████▊| 78/79 [00:01<00:00, 72.12it/s]100%|██████████| 79/79 [00:01<00:00, 52.11it/s]
10000 images processed, 1.5384182929992676 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:26,  2.65it/s] 11%|█▏        | 8/70 [00:00<00:02, 20.71it/s] 20%|██        | 14/70 [00:00<00:01, 29.99it/s] 31%|███▏      | 22/70 [00:00<00:01, 42.97it/s] 44%|████▍     | 31/70 [00:00<00:00, 55.37it/s] 57%|█████▋    | 40/70 [00:00<00:00, 63.95it/s] 69%|██████▊   | 48/70 [00:01<00:00, 63.55it/s] 79%|███████▊  | 55/70 [00:01<00:00, 62.88it/s] 93%|█████████▎| 65/70 [00:01<00:00, 71.79it/s]100%|██████████| 70/70 [00:01<00:00, 52.55it/s]
8925 images processed, 1.3717155456542969 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:01<00:46,  1.06s/it] 11%|█         | 5/45 [00:01<00:07,  5.55it/s] 20%|██        | 9/45 [00:01<00:04,  7.73it/s] 24%|██▍       | 11/45 [00:01<00:04,  8.25it/s] 31%|███       | 14/45 [00:01<00:03,  9.25it/s] 40%|████      | 18/45 [00:02<00:02, 11.05it/s] 44%|████▍     | 20/45 [00:02<00:02, 12.12it/s] 49%|████▉     | 22/45 [00:02<00:01, 11.62it/s] 58%|█████▊    | 26/45 [00:02<00:01, 12.16it/s] 64%|██████▍   | 29/45 [00:02<00:01, 14.14it/s] 69%|██████▉   | 31/45 [00:03<00:01, 11.23it/s] 73%|███████▎  | 33/45 [00:03<00:00, 12.10it/s] 78%|███████▊  | 35/45 [00:03<00:01,  9.60it/s] 91%|█████████ | 41/45 [00:03<00:00, 16.03it/s] 98%|█████████▊| 44/45 [00:04<00:00,  8.85it/s]100%|██████████| 45/45 [00:04<00:00,  9.66it/s]
5640 images processed, 4.687204599380493 seconds used

22.615814208984375
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.52  99.36
places365     67.90  81.18
LSUN          17.59  96.07
iSUN          72.38  81.69
dtd           37.93  91.39
AVG           39.66  89.94
Retain-Acc: 0.7406
Forget-as-OOD (retain known vs forget novel):
  FPR: 79.50 AUROC: 86.90 AUIN: 98.36
33.852861166000366
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e20-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid
epochs=20 | cache=6 | flambda=0.5 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e20-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e20-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e20-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21843904
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<03:17,  1.97it/s]  2%|▏         | 7/391 [00:00<00:26, 14.54it/s]  3%|▎         | 13/391 [00:00<00:15, 24.90it/s]  5%|▌         | 20/391 [00:00<00:10, 34.95it/s]  7%|▋         | 26/391 [00:00<00:08, 40.92it/s]  8%|▊         | 32/391 [00:01<00:07, 45.30it/s] 10%|▉         | 39/391 [00:01<00:07, 49.44it/s] 12%|█▏        | 45/391 [00:01<00:07, 46.53it/s] 13%|█▎        | 51/391 [00:01<00:06, 49.68it/s] 15%|█▍        | 58/391 [00:01<00:06, 55.04it/s] 17%|█▋        | 65/391 [00:01<00:05, 58.57it/s] 18%|█▊        | 72/391 [00:01<00:05, 53.80it/s] 20%|██        | 79/391 [00:01<00:05, 56.91it/s] 22%|██▏       | 86/391 [00:01<00:05, 60.01it/s] 24%|██▍       | 95/391 [00:02<00:04, 67.12it/s] 26%|██▋       | 103/391 [00:02<00:04, 69.16it/s] 28%|██▊       | 111/391 [00:02<00:04, 63.28it/s] 30%|███       | 118/391 [00:02<00:04, 57.75it/s] 32%|███▏      | 126/391 [00:02<00:04, 62.03it/s] 34%|███▍      | 134/391 [00:02<00:03, 65.37it/s] 36%|███▌      | 141/391 [00:02<00:04, 57.11it/s] 38%|███▊      | 147/391 [00:02<00:04, 55.11it/s] 40%|███▉      | 156/391 [00:03<00:03, 63.81it/s] 42%|████▏     | 165/391 [00:03<00:03, 70.39it/s] 44%|████▍     | 173/391 [00:03<00:03, 71.73it/s] 46%|████▋     | 181/391 [00:03<00:03, 69.68it/s] 48%|████▊     | 189/391 [00:03<00:03, 63.40it/s] 50%|█████     | 197/391 [00:03<00:02, 65.44it/s] 52%|█████▏    | 205/391 [00:03<00:02, 68.48it/s] 54%|█████▍    | 213/391 [00:03<00:02, 68.10it/s] 57%|█████▋    | 221/391 [00:04<00:02, 68.90it/s] 58%|█████▊    | 228/391 [00:04<00:02, 64.47it/s] 60%|██████    | 236/391 [00:04<00:02, 65.21it/s] 62%|██████▏   | 243/391 [00:04<00:02, 65.16it/s] 64%|██████▍   | 250/391 [00:04<00:02, 66.08it/s] 66%|██████▌   | 258/391 [00:04<00:01, 67.20it/s] 68%|██████▊   | 265/391 [00:04<00:01, 67.77it/s] 70%|██████▉   | 272/391 [00:04<00:01, 65.76it/s] 71%|███████▏  | 279/391 [00:04<00:01, 60.87it/s] 73%|███████▎  | 286/391 [00:05<00:01, 61.64it/s] 75%|███████▌  | 294/391 [00:05<00:01, 65.51it/s] 77%|███████▋  | 302/391 [00:05<00:01, 69.37it/s] 79%|███████▉  | 310/391 [00:05<00:01, 62.13it/s] 81%|████████  | 317/391 [00:05<00:01, 62.45it/s] 83%|████████▎ | 324/391 [00:05<00:01, 63.27it/s] 85%|████████▍ | 332/391 [00:05<00:00, 67.59it/s] 87%|████████▋ | 341/391 [00:05<00:00, 73.70it/s] 89%|████████▉ | 349/391 [00:05<00:00, 64.62it/s] 91%|█████████ | 356/391 [00:06<00:00, 60.48it/s] 93%|█████████▎| 365/391 [00:06<00:00, 65.87it/s] 96%|█████████▌| 374/391 [00:06<00:00, 70.44it/s] 98%|█████████▊| 382/391 [00:06<00:00, 70.83it/s]100%|█████████▉| 390/391 [00:06<00:00, 62.22it/s]100%|██████████| 391/391 [00:06<00:00, 58.72it/s]
50000 images processed, 6.781876802444458 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:33,  2.34it/s]  9%|▉         | 7/79 [00:00<00:04, 16.44it/s] 16%|█▋        | 13/79 [00:00<00:02, 27.48it/s] 25%|██▌       | 20/79 [00:00<00:01, 37.76it/s] 34%|███▍      | 27/79 [00:00<00:01, 45.31it/s] 43%|████▎     | 34/79 [00:00<00:00, 52.07it/s] 53%|█████▎    | 42/79 [00:01<00:00, 57.55it/s] 62%|██████▏   | 49/79 [00:01<00:00, 55.52it/s] 70%|██████▉   | 55/79 [00:01<00:00, 54.46it/s] 78%|███████▊  | 62/79 [00:01<00:00, 57.91it/s] 91%|█████████ | 72/79 [00:01<00:00, 68.44it/s]100%|██████████| 79/79 [00:01<00:00, 48.73it/s]
10000 images processed, 1.6457529067993164 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:41,  2.00it/s]  4%|▍         | 8/204 [00:00<00:11, 16.98it/s]  7%|▋         | 15/204 [00:00<00:06, 29.62it/s] 11%|█▏        | 23/204 [00:00<00:04, 41.17it/s] 15%|█▍        | 30/204 [00:00<00:03, 43.89it/s] 18%|█▊        | 37/204 [00:01<00:03, 49.02it/s] 22%|██▏       | 44/204 [00:01<00:03, 52.32it/s] 25%|██▌       | 51/204 [00:01<00:02, 54.95it/s] 28%|██▊       | 57/204 [00:01<00:02, 51.93it/s] 31%|███       | 63/204 [00:01<00:02, 53.93it/s] 35%|███▍      | 71/204 [00:01<00:02, 59.25it/s] 38%|███▊      | 78/204 [00:01<00:02, 60.63it/s] 42%|████▏     | 85/204 [00:01<00:01, 61.11it/s] 45%|████▌     | 92/204 [00:01<00:01, 60.58it/s] 49%|████▊     | 99/204 [00:02<00:01, 55.56it/s] 52%|█████▏    | 107/204 [00:02<00:01, 60.13it/s] 56%|█████▋    | 115/204 [00:02<00:01, 62.62it/s] 60%|█████▉    | 122/204 [00:02<00:01, 63.50it/s] 63%|██████▎   | 129/204 [00:02<00:01, 61.90it/s] 67%|██████▋   | 136/204 [00:02<00:01, 61.32it/s] 71%|███████   | 145/204 [00:02<00:00, 67.00it/s] 75%|███████▍  | 152/204 [00:02<00:00, 66.02it/s] 78%|███████▊  | 159/204 [00:03<00:00, 67.10it/s] 81%|████████▏ | 166/204 [00:03<00:00, 64.40it/s] 85%|████████▍ | 173/204 [00:03<00:00, 62.61it/s] 88%|████████▊ | 180/204 [00:03<00:00, 61.75it/s] 92%|█████████▏| 187/204 [00:03<00:00, 57.59it/s] 95%|█████████▍| 193/204 [00:03<00:00, 52.79it/s] 98%|█████████▊| 199/204 [00:03<00:00, 53.73it/s]100%|██████████| 204/204 [00:03<00:00, 53.20it/s]
26032 images processed, 3.8847312927246094 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:54,  1.43it/s] 10%|█         | 8/79 [00:00<00:05, 13.04it/s] 16%|█▋        | 13/79 [00:00<00:03, 18.70it/s] 23%|██▎       | 18/79 [00:01<00:02, 23.94it/s] 33%|███▎      | 26/79 [00:01<00:01, 32.41it/s] 41%|████      | 32/79 [00:01<00:01, 37.85it/s] 47%|████▋     | 37/79 [00:01<00:01, 38.43it/s] 54%|█████▍    | 43/79 [00:01<00:00, 41.79it/s] 62%|██████▏   | 49/79 [00:01<00:00, 45.53it/s] 68%|██████▊   | 54/79 [00:01<00:00, 41.80it/s] 76%|███████▌  | 60/79 [00:01<00:00, 43.75it/s] 85%|████████▍ | 67/79 [00:02<00:00, 49.81it/s] 92%|█████████▏| 73/79 [00:02<00:00, 44.81it/s] 99%|█████████▊| 78/79 [00:02<00:00, 40.94it/s]100%|██████████| 79/79 [00:02<00:00, 33.31it/s]
10000 images processed, 2.4113550186157227 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:41,  1.86it/s]  9%|▉         | 7/79 [00:00<00:05, 13.92it/s] 18%|█▊        | 14/79 [00:00<00:02, 25.81it/s] 27%|██▋       | 21/79 [00:00<00:01, 35.67it/s] 35%|███▌      | 28/79 [00:00<00:01, 43.56it/s] 43%|████▎     | 34/79 [00:01<00:00, 45.26it/s] 52%|█████▏    | 41/79 [00:01<00:00, 51.10it/s] 62%|██████▏   | 49/79 [00:01<00:00, 58.30it/s] 71%|███████   | 56/79 [00:01<00:00, 60.70it/s] 80%|███████▉  | 63/79 [00:01<00:00, 55.87it/s] 89%|████████▊ | 70/79 [00:01<00:00, 58.96it/s]100%|██████████| 79/79 [00:01<00:00, 44.88it/s]
10000 images processed, 1.7929394245147705 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:30,  2.26it/s] 10%|█         | 7/70 [00:00<00:03, 16.32it/s] 19%|█▊        | 13/70 [00:00<00:02, 26.51it/s] 27%|██▋       | 19/70 [00:00<00:01, 34.32it/s] 40%|████      | 28/70 [00:00<00:00, 47.41it/s] 53%|█████▎    | 37/70 [00:00<00:00, 56.57it/s] 63%|██████▎   | 44/70 [00:01<00:00, 50.92it/s] 71%|███████▏  | 50/70 [00:01<00:00, 51.30it/s] 84%|████████▍ | 59/70 [00:01<00:00, 60.48it/s] 97%|█████████▋| 68/70 [00:01<00:00, 66.47it/s]100%|██████████| 70/70 [00:01<00:00, 45.74it/s]
8925 images processed, 1.5685720443725586 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:00<00:43,  1.01it/s]  4%|▍         | 2/45 [00:01<00:20,  2.07it/s] 16%|█▌        | 7/45 [00:01<00:04,  8.57it/s] 20%|██        | 9/45 [00:01<00:03,  9.02it/s] 24%|██▍       | 11/45 [00:01<00:03,  9.72it/s] 31%|███       | 14/45 [00:01<00:03,  9.89it/s] 38%|███▊      | 17/45 [00:02<00:02, 11.86it/s] 42%|████▏     | 19/45 [00:02<00:02, 12.86it/s] 47%|████▋     | 21/45 [00:02<00:01, 13.11it/s] 51%|█████     | 23/45 [00:02<00:01, 12.74it/s] 56%|█████▌    | 25/45 [00:02<00:01, 14.15it/s] 60%|██████    | 27/45 [00:02<00:01, 11.41it/s] 67%|██████▋   | 30/45 [00:03<00:01, 11.22it/s] 73%|███████▎  | 33/45 [00:03<00:00, 12.99it/s] 78%|███████▊  | 35/45 [00:03<00:00, 11.86it/s] 87%|████████▋ | 39/45 [00:03<00:00, 15.57it/s] 91%|█████████ | 41/45 [00:03<00:00, 13.83it/s] 96%|█████████▌| 43/45 [00:04<00:00, 10.37it/s]100%|██████████| 45/45 [00:04<00:00, 10.60it/s]
5640 images processed, 4.267791271209717 seconds used

24.325905799865723
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.52  99.36
places365     67.91  81.18
LSUN          17.54  96.08
iSUN          72.38  81.69
dtd           37.91  91.39
AVG           39.65  89.94
Retain-Acc: 0.7406
Forget-as-OOD (retain known vs forget novel):
  FPR: 79.50 AUROC: 86.90 AUIN: 98.36
23.9071261882782
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e50-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid
epochs=50 | cache=6 | flambda=0.5 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e50-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e50-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e50-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21843904
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<02:47,  2.33it/s]  2%|▏         | 9/391 [00:00<00:17, 21.64it/s]  5%|▍         | 18/391 [00:00<00:09, 37.76it/s]  6%|▋         | 25/391 [00:00<00:09, 38.06it/s]  8%|▊         | 31/391 [00:00<00:09, 39.30it/s] 10%|▉         | 39/391 [00:01<00:07, 47.81it/s] 12%|█▏        | 45/391 [00:01<00:06, 50.76it/s] 13%|█▎        | 51/391 [00:01<00:07, 47.69it/s] 15%|█▍        | 57/391 [00:01<00:07, 47.36it/s] 16%|█▌        | 63/391 [00:01<00:06, 46.92it/s] 18%|█▊        | 70/391 [00:01<00:06, 51.31it/s] 19%|█▉        | 76/391 [00:01<00:06, 50.01it/s] 21%|██        | 82/391 [00:01<00:06, 44.60it/s] 23%|██▎       | 88/391 [00:02<00:06, 47.46it/s] 25%|██▍       | 97/391 [00:02<00:05, 57.22it/s] 27%|██▋       | 104/391 [00:02<00:05, 49.88it/s] 28%|██▊       | 110/391 [00:02<00:06, 44.34it/s] 31%|███       | 120/391 [00:02<00:04, 55.52it/s] 32%|███▏      | 127/391 [00:02<00:04, 57.39it/s] 34%|███▍      | 134/391 [00:02<00:04, 52.34it/s] 36%|███▌      | 140/391 [00:03<00:04, 50.59it/s] 38%|███▊      | 147/391 [00:03<00:04, 53.11it/s] 39%|███▉      | 153/391 [00:03<00:04, 53.85it/s] 41%|████      | 159/391 [00:03<00:04, 50.15it/s] 42%|████▏     | 165/391 [00:03<00:04, 49.65it/s] 44%|████▎     | 171/391 [00:03<00:04, 50.45it/s] 45%|████▌     | 177/391 [00:03<00:04, 50.36it/s] 47%|████▋     | 183/391 [00:03<00:04, 50.72it/s] 49%|████▊     | 190/391 [00:04<00:03, 55.12it/s] 50%|█████     | 196/391 [00:04<00:03, 52.98it/s] 52%|█████▏    | 202/391 [00:04<00:03, 47.30it/s] 53%|█████▎    | 207/391 [00:04<00:03, 47.69it/s] 55%|█████▍    | 215/391 [00:04<00:03, 55.10it/s] 57%|█████▋    | 221/391 [00:04<00:03, 54.45it/s] 58%|█████▊    | 227/391 [00:04<00:03, 48.28it/s] 60%|█████▉    | 233/391 [00:04<00:03, 48.01it/s] 62%|██████▏   | 241/391 [00:05<00:02, 55.48it/s] 63%|██████▎   | 247/391 [00:05<00:02, 52.68it/s] 65%|██████▍   | 253/391 [00:05<00:02, 48.90it/s] 66%|██████▋   | 260/391 [00:05<00:02, 53.06it/s] 68%|██████▊   | 266/391 [00:05<00:02, 54.77it/s] 70%|██████▉   | 272/391 [00:05<00:02, 52.69it/s] 71%|███████   | 278/391 [00:05<00:02, 46.54it/s] 73%|███████▎  | 285/391 [00:05<00:02, 50.64it/s] 75%|███████▌  | 294/391 [00:06<00:01, 58.96it/s] 77%|███████▋  | 301/391 [00:06<00:01, 55.09it/s] 79%|███████▊  | 307/391 [00:06<00:01, 50.76it/s] 80%|████████  | 313/391 [00:06<00:01, 52.35it/s] 82%|████████▏ | 320/391 [00:06<00:01, 56.67it/s] 83%|████████▎ | 326/391 [00:06<00:01, 56.48it/s] 85%|████████▍ | 332/391 [00:06<00:01, 53.22it/s] 87%|████████▋ | 339/391 [00:06<00:00, 55.55it/s] 88%|████████▊ | 346/391 [00:06<00:00, 58.48it/s] 90%|█████████ | 352/391 [00:07<00:00, 58.15it/s] 92%|█████████▏| 358/391 [00:07<00:00, 55.00it/s] 93%|█████████▎| 364/391 [00:07<00:00, 56.27it/s] 95%|█████████▍| 370/391 [00:07<00:00, 55.78it/s] 96%|█████████▌| 376/391 [00:07<00:00, 55.07it/s] 98%|█████████▊| 383/391 [00:07<00:00, 57.45it/s]100%|█████████▉| 390/391 [00:07<00:00, 58.96it/s]100%|██████████| 391/391 [00:07<00:00, 50.32it/s]
50000 images processed, 7.855459928512573 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:28,  2.70it/s]  9%|▉         | 7/79 [00:00<00:03, 18.12it/s] 15%|█▌        | 12/79 [00:00<00:02, 26.79it/s] 25%|██▌       | 20/79 [00:00<00:01, 40.28it/s] 33%|███▎      | 26/79 [00:00<00:01, 44.95it/s] 42%|████▏     | 33/79 [00:00<00:00, 49.82it/s] 49%|████▉     | 39/79 [00:01<00:00, 45.78it/s] 57%|█████▋    | 45/79 [00:01<00:00, 46.40it/s] 65%|██████▍   | 51/79 [00:01<00:00, 49.29it/s] 73%|███████▎  | 58/79 [00:01<00:00, 52.95it/s] 81%|████████  | 64/79 [00:01<00:00, 51.59it/s] 89%|████████▊ | 70/79 [00:01<00:00, 49.26it/s] 96%|█████████▌| 76/79 [00:01<00:00, 50.53it/s]100%|██████████| 79/79 [00:01<00:00, 43.05it/s]
10000 images processed, 1.8586103916168213 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:28,  2.28it/s]  4%|▍         | 8/204 [00:00<00:10, 18.05it/s]  6%|▋         | 13/204 [00:00<00:07, 24.46it/s]  9%|▉         | 18/204 [00:00<00:06, 29.72it/s] 12%|█▏        | 25/204 [00:00<00:04, 39.64it/s] 15%|█▍        | 30/204 [00:01<00:04, 42.19it/s] 17%|█▋        | 35/204 [00:01<00:03, 42.61it/s] 20%|█▉        | 40/204 [00:01<00:03, 41.20it/s] 22%|██▏       | 45/204 [00:01<00:03, 42.17it/s] 25%|██▌       | 52/204 [00:01<00:03, 49.40it/s] 28%|██▊       | 58/204 [00:01<00:02, 51.37it/s] 31%|███▏      | 64/204 [00:01<00:03, 46.24it/s] 34%|███▍      | 69/204 [00:01<00:02, 46.94it/s] 38%|███▊      | 77/204 [00:01<00:02, 53.96it/s] 41%|████      | 83/204 [00:02<00:02, 52.94it/s] 44%|████▎     | 89/204 [00:02<00:02, 51.64it/s] 47%|████▋     | 95/204 [00:02<00:02, 49.15it/s] 50%|████▉     | 101/204 [00:02<00:02, 50.11it/s] 53%|█████▎    | 108/204 [00:02<00:01, 53.71it/s] 56%|█████▋    | 115/204 [00:02<00:01, 56.01it/s] 59%|█████▉    | 121/204 [00:02<00:01, 54.22it/s] 62%|██████▏   | 127/204 [00:02<00:01, 48.46it/s] 65%|██████▍   | 132/204 [00:03<00:01, 46.79it/s] 68%|██████▊   | 138/204 [00:03<00:01, 49.59it/s] 71%|███████   | 144/204 [00:03<00:01, 52.28it/s] 74%|███████▎  | 150/204 [00:03<00:01, 48.81it/s] 76%|███████▌  | 155/204 [00:03<00:01, 47.07it/s] 79%|███████▉  | 162/204 [00:03<00:00, 52.64it/s] 82%|████████▏ | 168/204 [00:03<00:00, 53.73it/s] 85%|████████▌ | 174/204 [00:03<00:00, 53.45it/s] 88%|████████▊ | 180/204 [00:03<00:00, 50.63it/s] 91%|█████████ | 186/204 [00:04<00:00, 50.15it/s] 95%|█████████▍| 193/204 [00:04<00:00, 53.94it/s] 98%|█████████▊| 199/204 [00:04<00:00, 49.68it/s]100%|██████████| 204/204 [00:04<00:00, 45.77it/s]
26032 images processed, 4.500446557998657 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:40,  1.93it/s]  6%|▋         | 5/79 [00:00<00:07,  9.97it/s] 14%|█▍        | 11/79 [00:00<00:03, 21.04it/s] 22%|██▏       | 17/79 [00:00<00:02, 25.81it/s] 27%|██▋       | 21/79 [00:01<00:02, 27.70it/s] 34%|███▍      | 27/79 [00:01<00:01, 34.15it/s] 44%|████▍     | 35/79 [00:01<00:00, 44.98it/s] 52%|█████▏    | 41/79 [00:01<00:00, 42.25it/s] 58%|█████▊    | 46/79 [00:01<00:00, 39.47it/s] 66%|██████▌   | 52/79 [00:01<00:00, 43.98it/s] 77%|███████▋  | 61/79 [00:01<00:00, 54.70it/s] 85%|████████▍ | 67/79 [00:01<00:00, 54.18it/s] 92%|█████████▏| 73/79 [00:02<00:00, 52.60it/s]100%|██████████| 79/79 [00:02<00:00, 37.63it/s]
10000 images processed, 2.1402294635772705 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:31,  2.48it/s] 13%|█▎        | 10/79 [00:00<00:02, 24.75it/s] 23%|██▎       | 18/79 [00:00<00:01, 37.34it/s] 30%|███       | 24/79 [00:00<00:01, 37.47it/s] 38%|███▊      | 30/79 [00:00<00:01, 42.52it/s] 48%|████▊     | 38/79 [00:01<00:00, 51.45it/s] 58%|█████▊    | 46/79 [00:01<00:00, 58.32it/s] 67%|██████▋   | 53/79 [00:01<00:00, 58.21it/s] 76%|███████▌  | 60/79 [00:01<00:00, 52.51it/s] 87%|████████▋ | 69/79 [00:01<00:00, 60.67it/s] 96%|█████████▌| 76/79 [00:01<00:00, 60.43it/s]100%|██████████| 79/79 [00:01<00:00, 47.36it/s]
10000 images processed, 1.6871850490570068 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:28,  2.40it/s]  9%|▊         | 6/70 [00:00<00:04, 13.87it/s] 14%|█▍        | 10/70 [00:00<00:02, 20.50it/s] 21%|██▏       | 15/70 [00:00<00:01, 27.71it/s] 33%|███▎      | 23/70 [00:00<00:01, 40.89it/s] 41%|████▏     | 29/70 [00:00<00:00, 42.51it/s] 49%|████▊     | 34/70 [00:01<00:00, 41.28it/s] 57%|█████▋    | 40/70 [00:01<00:00, 46.13it/s] 69%|██████▊   | 48/70 [00:01<00:00, 54.26it/s] 77%|███████▋  | 54/70 [00:01<00:00, 53.43it/s] 86%|████████▌ | 60/70 [00:01<00:00, 49.17it/s] 94%|█████████▍| 66/70 [00:01<00:00, 50.12it/s]100%|██████████| 70/70 [00:01<00:00, 39.50it/s]
8925 images processed, 1.804459810256958 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:00<00:43,  1.02it/s]  4%|▍         | 2/45 [00:01<00:21,  2.00it/s] 18%|█▊        | 8/45 [00:01<00:03, 10.20it/s] 24%|██▍       | 11/45 [00:01<00:04,  8.34it/s] 36%|███▌      | 16/45 [00:01<00:02, 13.52it/s] 42%|████▏     | 19/45 [00:02<00:02, 11.03it/s] 49%|████▉     | 22/45 [00:02<00:01, 13.16it/s] 56%|█████▌    | 25/45 [00:02<00:01, 13.07it/s] 60%|██████    | 27/45 [00:02<00:01, 11.72it/s] 67%|██████▋   | 30/45 [00:02<00:01, 13.95it/s] 73%|███████▎  | 33/45 [00:03<00:01, 11.41it/s] 78%|███████▊  | 35/45 [00:03<00:00, 10.40it/s] 91%|█████████ | 41/45 [00:03<00:00, 14.17it/s] 96%|█████████▌| 43/45 [00:04<00:00,  9.60it/s]100%|██████████| 45/45 [00:04<00:00, 10.31it/s]
5640 images processed, 4.388432025909424 seconds used

26.010977745056152
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.51  99.36
places365     67.89  81.18
LSUN          17.48  96.10
iSUN          72.35  81.70
dtd           37.89  91.38
AVG           39.62  89.94
Retain-Acc: 0.7408
Forget-as-OOD (retain known vs forget novel):
  FPR: 79.50 AUROC: 86.89 AUIN: 98.36
18.19571876525879
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid
epochs=5 | cache=6 | flambda=0.2 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21843904
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<02:17,  2.83it/s]  2%|▏         | 6/391 [00:00<00:23, 16.08it/s]  3%|▎         | 11/391 [00:00<00:16, 23.69it/s]  4%|▍         | 15/391 [00:00<00:13, 28.01it/s]  5%|▌         | 20/391 [00:00<00:11, 33.13it/s]  7%|▋         | 27/391 [00:00<00:08, 43.21it/s]  8%|▊         | 33/391 [00:01<00:07, 47.70it/s] 10%|█         | 40/391 [00:01<00:06, 52.68it/s] 12%|█▏        | 46/391 [00:01<00:06, 53.26it/s] 13%|█▎        | 52/391 [00:01<00:06, 51.36it/s] 15%|█▍        | 58/391 [00:01<00:06, 48.36it/s] 17%|█▋        | 65/391 [00:01<00:06, 52.30it/s] 19%|█▊        | 73/391 [00:01<00:05, 58.56it/s] 21%|██        | 81/391 [00:01<00:05, 61.76it/s] 23%|██▎       | 88/391 [00:02<00:05, 50.85it/s] 24%|██▍       | 94/391 [00:02<00:05, 49.57it/s] 27%|██▋       | 104/391 [00:02<00:04, 60.69it/s] 28%|██▊       | 111/391 [00:02<00:04, 62.22it/s] 30%|███       | 118/391 [00:02<00:04, 59.60it/s] 32%|███▏      | 125/391 [00:02<00:04, 54.10it/s] 34%|███▎      | 131/391 [00:02<00:04, 54.25it/s] 35%|███▌      | 138/391 [00:02<00:04, 56.51it/s] 37%|███▋      | 144/391 [00:02<00:04, 55.16it/s] 38%|███▊      | 150/391 [00:03<00:04, 53.21it/s] 40%|███▉      | 156/391 [00:03<00:04, 53.26it/s] 41%|████▏     | 162/391 [00:03<00:04, 50.78it/s] 43%|████▎     | 169/391 [00:03<00:04, 54.26it/s] 45%|████▌     | 176/391 [00:03<00:03, 55.30it/s] 47%|████▋     | 182/391 [00:03<00:04, 49.57it/s] 48%|████▊     | 188/391 [00:03<00:04, 47.90it/s] 50%|████▉     | 195/391 [00:03<00:03, 51.62it/s] 52%|█████▏    | 202/391 [00:04<00:03, 54.12it/s] 53%|█████▎    | 208/391 [00:04<00:03, 53.42it/s] 55%|█████▍    | 214/391 [00:04<00:03, 53.14it/s] 56%|█████▋    | 220/391 [00:04<00:03, 54.06it/s] 58%|█████▊    | 226/391 [00:04<00:03, 49.66it/s] 59%|█████▉    | 232/391 [00:04<00:03, 50.80it/s] 61%|██████    | 238/391 [00:04<00:02, 51.42it/s] 63%|██████▎   | 245/391 [00:04<00:02, 53.70it/s] 64%|██████▍   | 252/391 [00:05<00:02, 56.10it/s] 66%|██████▌   | 258/391 [00:05<00:02, 56.92it/s] 68%|██████▊   | 266/391 [00:05<00:02, 61.44it/s] 70%|██████▉   | 273/391 [00:05<00:01, 59.77it/s] 72%|███████▏  | 280/391 [00:05<00:02, 55.23it/s] 73%|███████▎  | 286/391 [00:05<00:01, 56.24it/s] 75%|███████▌  | 294/391 [00:05<00:01, 61.89it/s] 77%|███████▋  | 302/391 [00:05<00:01, 65.98it/s] 79%|███████▉  | 309/391 [00:05<00:01, 60.82it/s] 81%|████████  | 316/391 [00:06<00:01, 52.66it/s] 83%|████████▎ | 324/391 [00:06<00:01, 58.41it/s] 85%|████████▍ | 331/391 [00:06<00:01, 59.49it/s] 86%|████████▋ | 338/391 [00:06<00:00, 54.52it/s] 88%|████████▊ | 344/391 [00:06<00:00, 53.23it/s] 90%|█████████ | 353/391 [00:06<00:00, 61.62it/s] 93%|█████████▎| 362/391 [00:06<00:00, 67.59it/s] 94%|█████████▍| 369/391 [00:06<00:00, 67.07it/s] 96%|█████████▌| 376/391 [00:07<00:00, 62.58it/s] 98%|█████████▊| 383/391 [00:07<00:00, 60.92it/s]100%|█████████▉| 390/391 [00:07<00:00, 58.34it/s]100%|██████████| 391/391 [00:07<00:00, 53.00it/s]
50000 images processed, 7.4710798263549805 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:23,  3.36it/s]  6%|▋         | 5/79 [00:00<00:05, 14.61it/s] 13%|█▎        | 10/79 [00:00<00:02, 24.92it/s] 19%|█▉        | 15/79 [00:00<00:01, 32.05it/s] 28%|██▊       | 22/79 [00:00<00:01, 41.86it/s] 35%|███▌      | 28/79 [00:00<00:01, 45.29it/s] 42%|████▏     | 33/79 [00:00<00:01, 45.31it/s] 48%|████▊     | 38/79 [00:01<00:00, 43.21it/s] 56%|█████▌    | 44/79 [00:01<00:00, 47.41it/s] 65%|██████▍   | 51/79 [00:01<00:00, 52.34it/s] 73%|███████▎  | 58/79 [00:01<00:00, 53.72it/s] 81%|████████  | 64/79 [00:01<00:00, 52.35it/s] 89%|████████▊ | 70/79 [00:01<00:00, 52.84it/s] 96%|█████████▌| 76/79 [00:01<00:00, 52.56it/s]100%|██████████| 79/79 [00:01<00:00, 42.54it/s]
10000 images processed, 1.8783161640167236 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:27,  2.31it/s]  3%|▎         | 7/204 [00:00<00:12, 16.03it/s]  5%|▌         | 11/204 [00:00<00:08, 21.84it/s]  7%|▋         | 15/204 [00:00<00:07, 25.85it/s] 10%|█         | 21/204 [00:00<00:05, 34.82it/s] 14%|█▍        | 29/204 [00:00<00:03, 45.48it/s] 17%|█▋        | 35/204 [00:01<00:03, 45.48it/s] 20%|██        | 41/204 [00:01<00:03, 46.68it/s] 23%|██▎       | 46/204 [00:01<00:03, 45.45it/s] 25%|██▌       | 51/204 [00:01<00:03, 44.62it/s] 27%|██▋       | 56/204 [00:01<00:03, 44.47it/s] 31%|███       | 63/204 [00:01<00:02, 49.63it/s] 34%|███▍      | 69/204 [00:01<00:02, 49.39it/s] 37%|███▋      | 75/204 [00:01<00:02, 48.82it/s] 40%|███▉      | 81/204 [00:02<00:02, 50.97it/s] 43%|████▎     | 88/204 [00:02<00:02, 53.22it/s] 46%|████▌     | 94/204 [00:02<00:02, 51.68it/s] 50%|████▉     | 101/204 [00:02<00:01, 54.22it/s] 53%|█████▎    | 108/204 [00:02<00:01, 55.94it/s] 56%|█████▌    | 114/204 [00:02<00:01, 50.48it/s] 59%|█████▉    | 120/204 [00:02<00:01, 48.80it/s] 63%|██████▎   | 128/204 [00:02<00:01, 55.49it/s] 67%|██████▋   | 137/204 [00:03<00:01, 63.67it/s] 71%|███████   | 144/204 [00:03<00:01, 57.61it/s] 74%|███████▎  | 150/204 [00:03<00:01, 50.33it/s] 76%|███████▋  | 156/204 [00:03<00:00, 51.91it/s] 80%|████████  | 164/204 [00:03<00:00, 56.78it/s] 83%|████████▎ | 170/204 [00:03<00:00, 55.89it/s] 86%|████████▋ | 176/204 [00:03<00:00, 52.65it/s] 89%|████████▉ | 182/204 [00:03<00:00, 51.07it/s] 92%|█████████▏| 188/204 [00:04<00:00, 53.05it/s] 96%|█████████▌| 195/204 [00:04<00:00, 56.00it/s] 99%|█████████▊| 201/204 [00:04<00:00, 53.10it/s]100%|██████████| 204/204 [00:04<00:00, 47.19it/s]
26032 images processed, 4.382861614227295 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:40,  1.95it/s] 11%|█▏        | 9/79 [00:00<00:04, 16.68it/s] 18%|█▊        | 14/79 [00:00<00:02, 22.98it/s] 23%|██▎       | 18/79 [00:00<00:02, 26.45it/s] 29%|██▉       | 23/79 [00:01<00:01, 31.60it/s] 39%|███▉      | 31/79 [00:01<00:01, 42.39it/s] 47%|████▋     | 37/79 [00:01<00:00, 43.49it/s] 53%|█████▎    | 42/79 [00:01<00:00, 38.23it/s] 62%|██████▏   | 49/79 [00:01<00:00, 40.14it/s] 68%|██████▊   | 54/79 [00:01<00:00, 41.90it/s] 75%|███████▍  | 59/79 [00:01<00:00, 40.90it/s] 82%|████████▏ | 65/79 [00:01<00:00, 44.63it/s] 92%|█████████▏| 73/79 [00:02<00:00, 49.16it/s]100%|██████████| 79/79 [00:02<00:00, 37.03it/s]
10000 images processed, 2.170231342315674 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:29,  2.69it/s]  8%|▊         | 6/79 [00:00<00:04, 15.02it/s] 16%|█▋        | 13/79 [00:00<00:02, 28.92it/s] 28%|██▊       | 22/79 [00:00<00:01, 44.98it/s] 37%|███▋      | 29/79 [00:00<00:00, 51.22it/s] 46%|████▌     | 36/79 [00:00<00:00, 55.68it/s] 54%|█████▍    | 43/79 [00:01<00:00, 53.86it/s] 63%|██████▎   | 50/79 [00:01<00:00, 57.24it/s] 72%|███████▏  | 57/79 [00:01<00:00, 56.31it/s] 80%|███████▉  | 63/79 [00:01<00:00, 55.88it/s] 87%|████████▋ | 69/79 [00:01<00:00, 56.79it/s] 95%|█████████▍| 75/79 [00:01<00:00, 56.01it/s]100%|██████████| 79/79 [00:01<00:00, 46.98it/s]
10000 images processed, 1.7031080722808838 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:25,  2.72it/s]  9%|▊         | 6/70 [00:00<00:04, 15.09it/s] 16%|█▌        | 11/70 [00:00<00:02, 24.07it/s] 26%|██▌       | 18/70 [00:00<00:01, 36.06it/s] 34%|███▍      | 24/70 [00:00<00:01, 41.67it/s] 41%|████▏     | 29/70 [00:00<00:00, 42.47it/s] 50%|█████     | 35/70 [00:01<00:00, 46.84it/s] 60%|██████    | 42/70 [00:01<00:00, 52.55it/s] 69%|██████▊   | 48/70 [00:01<00:00, 49.65it/s] 77%|███████▋  | 54/70 [00:01<00:00, 44.08it/s] 87%|████████▋ | 61/70 [00:01<00:00, 49.58it/s]100%|██████████| 70/70 [00:01<00:00, 42.46it/s]
8925 images processed, 1.6832916736602783 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:00<00:41,  1.07it/s]  4%|▍         | 2/45 [00:01<00:23,  1.79it/s] 20%|██        | 9/45 [00:01<00:03, 10.00it/s] 27%|██▋       | 12/45 [00:01<00:03,  8.54it/s] 38%|███▊      | 17/45 [00:01<00:02, 13.51it/s] 44%|████▍     | 20/45 [00:02<00:02, 10.47it/s] 56%|█████▌    | 25/45 [00:02<00:01, 15.15it/s] 62%|██████▏   | 28/45 [00:02<00:01, 11.19it/s] 73%|███████▎  | 33/45 [00:03<00:00, 13.75it/s] 80%|████████  | 36/45 [00:03<00:00, 11.02it/s] 91%|█████████ | 41/45 [00:03<00:00, 15.41it/s] 98%|█████████▊| 44/45 [00:04<00:00,  9.34it/s]100%|██████████| 45/45 [00:04<00:00, 10.04it/s]
5640 images processed, 4.503950834274292 seconds used

25.70221495628357
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.52  99.36
places365     67.90  81.18
LSUN          17.55  96.08
iSUN          72.31  81.69
dtd           37.89  91.39
AVG           39.63  89.94
Retain-Acc: 0.7407
Forget-as-OOD (retain known vs forget novel):
  FPR: 79.50 AUROC: 86.89 AUIN: 98.36
12.000439167022705
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e10-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid
epochs=10 | cache=6 | flambda=0.2 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e10-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e10-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e10-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21843904
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<02:19,  2.80it/s]  3%|▎         | 10/391 [00:00<00:13, 27.40it/s]  4%|▍         | 16/391 [00:00<00:10, 35.56it/s]  6%|▌         | 22/391 [00:00<00:09, 39.12it/s]  7%|▋         | 29/391 [00:00<00:07, 46.92it/s] 10%|▉         | 38/391 [00:00<00:06, 57.50it/s] 12%|█▏        | 47/391 [00:01<00:05, 64.18it/s] 14%|█▍        | 54/391 [00:01<00:05, 56.75it/s] 16%|█▌        | 61/391 [00:01<00:05, 56.68it/s] 18%|█▊        | 70/391 [00:01<00:05, 64.08it/s] 20%|██        | 80/391 [00:01<00:04, 72.45it/s] 23%|██▎       | 88/391 [00:01<00:04, 65.73it/s] 24%|██▍       | 95/391 [00:01<00:05, 58.75it/s] 27%|██▋       | 104/391 [00:01<00:04, 65.82it/s] 29%|██▊       | 112/391 [00:02<00:04, 67.94it/s] 31%|███       | 120/391 [00:02<00:04, 59.86it/s] 32%|███▏      | 127/391 [00:02<00:04, 60.75it/s] 35%|███▍      | 136/391 [00:02<00:03, 66.63it/s] 37%|███▋      | 144/391 [00:02<00:03, 67.44it/s] 39%|███▊      | 151/391 [00:02<00:03, 61.01it/s] 40%|████      | 158/391 [00:02<00:03, 61.17it/s] 43%|████▎     | 167/391 [00:02<00:03, 66.24it/s] 45%|████▍     | 175/391 [00:03<00:03, 68.84it/s] 47%|████▋     | 183/391 [00:03<00:03, 61.65it/s] 49%|████▊     | 190/391 [00:03<00:03, 60.09it/s] 51%|█████     | 199/391 [00:03<00:02, 67.54it/s] 53%|█████▎    | 209/391 [00:03<00:02, 74.42it/s] 55%|█████▌    | 217/391 [00:03<00:02, 69.26it/s] 58%|█████▊    | 225/391 [00:03<00:02, 62.00it/s] 60%|█████▉    | 233/391 [00:03<00:02, 66.23it/s] 61%|██████▏   | 240/391 [00:04<00:02, 64.21it/s] 63%|██████▎   | 247/391 [00:04<00:02, 64.33it/s] 65%|██████▍   | 254/391 [00:04<00:02, 59.65it/s] 67%|██████▋   | 261/391 [00:04<00:02, 60.67it/s] 69%|██████▉   | 269/391 [00:04<00:01, 64.56it/s] 71%|███████   | 276/391 [00:04<00:01, 61.03it/s] 72%|███████▏  | 283/391 [00:04<00:01, 58.95it/s] 74%|███████▍  | 291/391 [00:04<00:01, 64.06it/s] 76%|███████▋  | 299/391 [00:04<00:01, 65.79it/s] 78%|███████▊  | 306/391 [00:05<00:01, 63.42it/s] 80%|████████  | 313/391 [00:05<00:01, 59.55it/s] 82%|████████▏ | 320/391 [00:05<00:01, 57.16it/s] 83%|████████▎ | 326/391 [00:05<00:01, 53.31it/s] 85%|████████▍ | 332/391 [00:05<00:01, 52.30it/s] 87%|████████▋ | 339/391 [00:05<00:00, 55.08it/s] 89%|████████▉ | 348/391 [00:05<00:00, 61.99it/s] 91%|█████████ | 355/391 [00:05<00:00, 62.29it/s] 93%|█████████▎| 362/391 [00:06<00:00, 57.15it/s] 94%|█████████▍| 368/391 [00:06<00:00, 56.83it/s] 96%|█████████▋| 377/391 [00:06<00:00, 63.57it/s] 98%|█████████▊| 385/391 [00:06<00:00, 64.54it/s]100%|██████████| 391/391 [00:06<00:00, 59.33it/s]
50000 images processed, 6.723034381866455 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:36,  2.16it/s] 10%|█         | 8/79 [00:00<00:03, 18.11it/s] 16%|█▋        | 13/79 [00:00<00:02, 25.29it/s] 24%|██▍       | 19/79 [00:00<00:01, 33.21it/s] 35%|███▌      | 28/79 [00:00<00:01, 46.73it/s] 47%|████▋     | 37/79 [00:01<00:00, 57.15it/s] 56%|█████▌    | 44/79 [00:01<00:00, 57.03it/s] 65%|██████▍   | 51/79 [00:01<00:00, 54.79it/s] 73%|███████▎  | 58/79 [00:01<00:00, 58.12it/s] 82%|████████▏ | 65/79 [00:01<00:00, 60.72it/s] 91%|█████████ | 72/79 [00:01<00:00, 56.22it/s] 99%|█████████▊| 78/79 [00:01<00:00, 56.51it/s]100%|██████████| 79/79 [00:01<00:00, 45.21it/s]
10000 images processed, 1.7704532146453857 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:23,  2.44it/s]  3%|▎         | 6/204 [00:00<00:13, 14.17it/s]  6%|▌         | 12/204 [00:00<00:07, 25.53it/s]  9%|▉         | 19/204 [00:00<00:05, 36.25it/s] 13%|█▎        | 26/204 [00:00<00:04, 43.60it/s] 17%|█▋        | 34/204 [00:00<00:03, 51.21it/s] 20%|█▉        | 40/204 [00:01<00:03, 53.48it/s] 23%|██▎       | 47/204 [00:01<00:02, 57.43it/s] 26%|██▋       | 54/204 [00:01<00:02, 58.38it/s] 30%|██▉       | 61/204 [00:01<00:02, 60.06it/s] 33%|███▎      | 68/204 [00:01<00:02, 56.75it/s] 36%|███▋      | 74/204 [00:01<00:02, 56.60it/s] 40%|████      | 82/204 [00:01<00:01, 61.55it/s] 44%|████▍     | 90/204 [00:01<00:01, 65.52it/s] 48%|████▊     | 97/204 [00:01<00:01, 63.06it/s] 51%|█████     | 104/204 [00:02<00:01, 60.46it/s] 54%|█████▍    | 111/204 [00:02<00:01, 60.57it/s] 58%|█████▊    | 118/204 [00:02<00:01, 60.46it/s] 61%|██████▏   | 125/204 [00:02<00:01, 59.55it/s] 65%|██████▍   | 132/204 [00:02<00:01, 59.41it/s] 68%|██████▊   | 139/204 [00:02<00:01, 60.07it/s] 72%|███████▏  | 146/204 [00:02<00:00, 62.74it/s] 75%|███████▌  | 153/204 [00:02<00:00, 58.66it/s] 78%|███████▊  | 159/204 [00:03<00:00, 57.75it/s] 82%|████████▏ | 167/204 [00:03<00:00, 62.18it/s] 85%|████████▌ | 174/204 [00:03<00:00, 61.89it/s] 89%|████████▊ | 181/204 [00:03<00:00, 62.48it/s] 93%|█████████▎| 189/204 [00:03<00:00, 66.59it/s] 96%|█████████▌| 196/204 [00:03<00:00, 62.00it/s]100%|█████████▉| 203/204 [00:03<00:00, 59.31it/s]100%|██████████| 204/204 [00:03<00:00, 54.18it/s]
26032 images processed, 3.809534788131714 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:38,  2.04it/s]  9%|▉         | 7/79 [00:00<00:04, 15.11it/s] 14%|█▍        | 11/79 [00:00<00:03, 21.13it/s] 22%|██▏       | 17/79 [00:00<00:02, 29.35it/s] 32%|███▏      | 25/79 [00:00<00:01, 36.81it/s] 38%|███▊      | 30/79 [00:01<00:01, 38.54it/s] 44%|████▍     | 35/79 [00:01<00:01, 40.94it/s] 54%|█████▍    | 43/79 [00:01<00:00, 50.67it/s] 62%|██████▏   | 49/79 [00:01<00:00, 47.11it/s] 70%|██████▉   | 55/79 [00:01<00:00, 46.48it/s] 78%|███████▊  | 62/79 [00:01<00:00, 51.28it/s] 86%|████████▌ | 68/79 [00:01<00:00, 52.24it/s] 94%|█████████▎| 74/79 [00:01<00:00, 48.74it/s]100%|██████████| 79/79 [00:02<00:00, 38.91it/s]
10000 images processed, 2.0747087001800537 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:31,  2.46it/s] 10%|█         | 8/79 [00:00<00:03, 19.39it/s] 16%|█▋        | 13/79 [00:00<00:02, 26.87it/s] 25%|██▌       | 20/79 [00:00<00:01, 37.57it/s] 35%|███▌      | 28/79 [00:00<00:01, 49.16it/s] 44%|████▍     | 35/79 [00:00<00:00, 51.17it/s] 52%|█████▏    | 41/79 [00:01<00:00, 50.43it/s] 59%|█████▉    | 47/79 [00:01<00:00, 52.88it/s] 70%|██████▉   | 55/79 [00:01<00:00, 57.25it/s] 78%|███████▊  | 62/79 [00:01<00:00, 57.94it/s] 87%|████████▋ | 69/79 [00:01<00:00, 59.73it/s] 96%|█████████▌| 76/79 [00:01<00:00, 61.30it/s]100%|██████████| 79/79 [00:01<00:00, 47.08it/s]
10000 images processed, 1.7032208442687988 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:35,  1.95it/s] 14%|█▍        | 10/70 [00:00<00:02, 20.59it/s] 24%|██▍       | 17/70 [00:00<00:01, 31.31it/s] 33%|███▎      | 23/70 [00:00<00:01, 35.52it/s] 41%|████▏     | 29/70 [00:00<00:00, 41.32it/s] 56%|█████▌    | 39/70 [00:01<00:00, 55.28it/s] 70%|███████   | 49/70 [00:01<00:00, 65.49it/s] 81%|████████▏ | 57/70 [00:01<00:00, 62.22it/s] 91%|█████████▏| 64/70 [00:01<00:00, 55.59it/s]100%|██████████| 70/70 [00:01<00:00, 44.89it/s]
8925 images processed, 1.5948843955993652 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:00<00:41,  1.06it/s]  4%|▍         | 2/45 [00:01<00:21,  1.97it/s] 20%|██        | 9/45 [00:01<00:03,  9.06it/s] 24%|██▍       | 11/45 [00:01<00:04,  8.40it/s] 38%|███▊      | 17/45 [00:01<00:02, 13.15it/s] 42%|████▏     | 19/45 [00:02<00:02, 11.20it/s] 49%|████▉     | 22/45 [00:02<00:01, 13.31it/s] 56%|█████▌    | 25/45 [00:02<00:01, 14.80it/s] 60%|██████    | 27/45 [00:02<00:01, 12.32it/s] 67%|██████▋   | 30/45 [00:02<00:01, 13.07it/s] 73%|███████▎  | 33/45 [00:03<00:00, 12.19it/s] 78%|███████▊  | 35/45 [00:03<00:00, 11.65it/s] 91%|█████████ | 41/45 [00:03<00:00, 13.88it/s] 96%|█████████▌| 43/45 [00:04<00:00,  9.93it/s]100%|██████████| 45/45 [00:04<00:00, 10.51it/s]
5640 images processed, 4.3044774532318115 seconds used

23.7656569480896
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.52  99.36
places365     68.02  81.18
LSUN          17.30  96.13
iSUN          72.29  81.68
dtd           37.94  91.36
AVG           39.62  89.94
Retain-Acc: 0.7411
Forget-as-OOD (retain known vs forget novel):
  FPR: 79.40 AUROC: 86.87 AUIN: 98.36
18.024662017822266
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e20-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid
epochs=20 | cache=6 | flambda=0.2 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e20-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e20-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e20-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21843904
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<01:57,  3.32it/s]  2%|▏         | 9/391 [00:00<00:14, 26.99it/s]  4%|▍         | 15/391 [00:00<00:10, 35.08it/s]  6%|▌         | 22/391 [00:00<00:08, 45.28it/s]  8%|▊         | 30/391 [00:00<00:06, 55.37it/s] 10%|▉         | 39/391 [00:00<00:05, 62.91it/s] 12%|█▏        | 46/391 [00:00<00:05, 59.04it/s] 14%|█▍        | 54/391 [00:01<00:05, 63.55it/s] 16%|█▋        | 64/391 [00:01<00:04, 72.37it/s] 19%|█▊        | 73/391 [00:01<00:04, 75.61it/s] 21%|██        | 81/391 [00:01<00:04, 66.24it/s] 23%|██▎       | 88/391 [00:01<00:05, 60.14it/s] 25%|██▌       | 98/391 [00:01<00:04, 68.79it/s] 27%|██▋       | 107/391 [00:01<00:03, 72.53it/s] 29%|██▉       | 115/391 [00:02<00:04, 61.03it/s] 31%|███       | 122/391 [00:02<00:04, 61.79it/s] 34%|███▎      | 131/391 [00:02<00:03, 67.25it/s] 36%|███▌      | 139/391 [00:02<00:03, 63.10it/s] 37%|███▋      | 146/391 [00:02<00:04, 60.40it/s] 39%|███▉      | 154/391 [00:02<00:03, 64.24it/s] 42%|████▏     | 163/391 [00:02<00:03, 69.89it/s] 44%|████▎     | 171/391 [00:02<00:03, 68.24it/s] 46%|████▌     | 178/391 [00:02<00:03, 66.90it/s] 47%|████▋     | 185/391 [00:03<00:03, 66.80it/s] 49%|████▉     | 192/391 [00:03<00:03, 62.88it/s] 51%|█████     | 199/391 [00:03<00:03, 62.67it/s] 53%|█████▎    | 207/391 [00:03<00:02, 65.67it/s] 55%|█████▌    | 217/391 [00:03<00:02, 74.09it/s] 58%|█████▊    | 226/391 [00:03<00:02, 75.90it/s] 60%|█████▉    | 234/391 [00:03<00:02, 66.66it/s] 62%|██████▏   | 241/391 [00:03<00:02, 63.54it/s] 64%|██████▍   | 250/391 [00:04<00:02, 69.39it/s] 66%|██████▌   | 259/391 [00:04<00:01, 73.34it/s] 68%|██████▊   | 267/391 [00:04<00:01, 74.13it/s] 70%|███████   | 275/391 [00:04<00:01, 64.95it/s] 72%|███████▏  | 282/391 [00:04<00:01, 63.74it/s] 74%|███████▍  | 291/391 [00:04<00:01, 69.43it/s] 76%|███████▋  | 299/391 [00:04<00:01, 62.06it/s] 78%|███████▊  | 306/391 [00:04<00:01, 60.83it/s] 81%|████████  | 315/391 [00:04<00:01, 66.43it/s] 83%|████████▎ | 325/391 [00:05<00:00, 73.92it/s] 85%|████████▌ | 333/391 [00:05<00:00, 73.04it/s] 87%|████████▋ | 341/391 [00:05<00:00, 66.37it/s] 89%|████████▉ | 348/391 [00:05<00:00, 66.96it/s] 91%|█████████ | 355/391 [00:05<00:00, 65.09it/s] 93%|█████████▎| 362/391 [00:05<00:00, 65.58it/s] 95%|█████████▍| 370/391 [00:05<00:00, 68.92it/s] 97%|█████████▋| 378/391 [00:05<00:00, 71.38it/s] 99%|█████████▊| 386/391 [00:06<00:00, 66.32it/s]100%|██████████| 391/391 [00:06<00:00, 63.73it/s]
50000 images processed, 6.224162817001343 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:22,  3.51it/s]  9%|▉         | 7/79 [00:00<00:03, 21.88it/s] 20%|██        | 16/79 [00:00<00:01, 42.35it/s] 32%|███▏      | 25/79 [00:00<00:00, 56.26it/s] 41%|████      | 32/79 [00:00<00:00, 57.86it/s] 49%|████▉     | 39/79 [00:00<00:00, 53.45it/s] 59%|█████▉    | 47/79 [00:00<00:00, 59.15it/s] 72%|███████▏  | 57/79 [00:01<00:00, 68.22it/s] 82%|████████▏ | 65/79 [00:01<00:00, 67.29it/s] 92%|█████████▏| 73/79 [00:01<00:00, 65.01it/s]100%|██████████| 79/79 [00:01<00:00, 54.98it/s]
10000 images processed, 1.460087537765503 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:04,  3.16it/s]  3%|▎         | 7/204 [00:00<00:09, 20.05it/s]  7%|▋         | 14/204 [00:00<00:05, 33.53it/s] 10%|█         | 21/204 [00:00<00:04, 43.12it/s] 14%|█▎        | 28/204 [00:00<00:03, 49.11it/s] 17%|█▋        | 34/204 [00:00<00:03, 50.00it/s] 20%|██        | 41/204 [00:00<00:03, 54.03it/s] 24%|██▍       | 49/204 [00:01<00:02, 60.41it/s] 28%|██▊       | 58/204 [00:01<00:02, 68.43it/s] 32%|███▏      | 66/204 [00:01<00:02, 65.76it/s] 36%|███▌      | 73/204 [00:01<00:02, 58.12it/s] 40%|███▉      | 81/204 [00:01<00:01, 63.20it/s] 45%|████▍     | 91/204 [00:01<00:01, 71.65it/s] 49%|████▊     | 99/204 [00:01<00:01, 68.16it/s] 52%|█████▏    | 107/204 [00:01<00:01, 61.85it/s] 56%|█████▌    | 114/204 [00:02<00:01, 63.79it/s] 61%|██████    | 124/204 [00:02<00:01, 71.83it/s] 65%|██████▍   | 132/204 [00:02<00:01, 71.12it/s] 69%|██████▊   | 140/204 [00:02<00:01, 62.43it/s] 72%|███████▏  | 147/204 [00:02<00:00, 62.46it/s] 76%|███████▋  | 156/204 [00:02<00:00, 68.49it/s] 81%|████████  | 165/204 [00:02<00:00, 71.41it/s] 85%|████████▍ | 173/204 [00:03<00:00, 58.37it/s] 89%|████████▊ | 181/204 [00:03<00:00, 61.84it/s] 93%|█████████▎| 190/204 [00:03<00:00, 66.99it/s] 98%|█████████▊| 199/204 [00:03<00:00, 70.26it/s]100%|██████████| 204/204 [00:03<00:00, 59.05it/s]
26032 images processed, 3.500515937805176 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:39,  1.98it/s]  8%|▊         | 6/79 [00:00<00:05, 12.29it/s] 14%|█▍        | 11/79 [00:00<00:03, 20.79it/s] 22%|██▏       | 17/79 [00:00<00:02, 25.29it/s] 30%|███       | 24/79 [00:01<00:01, 34.56it/s] 37%|███▋      | 29/79 [00:01<00:01, 32.26it/s] 42%|████▏     | 33/79 [00:01<00:01, 32.22it/s] 52%|█████▏    | 41/79 [00:01<00:01, 37.75it/s] 58%|█████▊    | 46/79 [00:01<00:00, 39.47it/s] 67%|██████▋   | 53/79 [00:01<00:00, 46.13it/s] 73%|███████▎  | 58/79 [00:01<00:00, 44.78it/s] 82%|████████▏ | 65/79 [00:01<00:00, 45.62it/s] 90%|████████▉ | 71/79 [00:02<00:00, 48.27it/s] 99%|█████████▊| 78/79 [00:02<00:00, 53.15it/s]100%|██████████| 79/79 [00:02<00:00, 36.14it/s]
10000 images processed, 2.219766139984131 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:26,  2.95it/s] 10%|█         | 8/79 [00:00<00:03, 21.95it/s] 19%|█▉        | 15/79 [00:00<00:01, 35.15it/s] 28%|██▊       | 22/79 [00:00<00:01, 44.54it/s] 37%|███▋      | 29/79 [00:00<00:00, 50.42it/s] 46%|████▌     | 36/79 [00:00<00:00, 54.19it/s] 54%|█████▍    | 43/79 [00:01<00:00, 56.51it/s] 65%|██████▍   | 51/79 [00:01<00:00, 61.09it/s] 73%|███████▎  | 58/79 [00:01<00:00, 54.37it/s] 81%|████████  | 64/79 [00:01<00:00, 54.79it/s] 90%|████████▉ | 71/79 [00:01<00:00, 57.19it/s] 99%|█████████▊| 78/79 [00:01<00:00, 60.09it/s]100%|██████████| 79/79 [00:01<00:00, 49.39it/s]
10000 images processed, 1.6183929443359375 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:20,  3.34it/s] 13%|█▎        | 9/70 [00:00<00:02, 27.48it/s] 20%|██        | 14/70 [00:00<00:01, 33.71it/s] 27%|██▋       | 19/70 [00:00<00:01, 36.49it/s] 39%|███▊      | 27/70 [00:00<00:00, 49.00it/s] 50%|█████     | 35/70 [00:00<00:00, 57.91it/s] 64%|██████▍   | 45/70 [00:00<00:00, 67.30it/s] 76%|███████▌  | 53/70 [00:01<00:00, 56.06it/s] 87%|████████▋ | 61/70 [00:01<00:00, 61.67it/s]100%|██████████| 70/70 [00:01<00:00, 67.74it/s]100%|██████████| 70/70 [00:01<00:00, 51.79it/s]
8925 images processed, 1.3836896419525146 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:00<00:41,  1.05it/s]  4%|▍         | 2/45 [00:01<00:21,  1.97it/s] 20%|██        | 9/45 [00:01<00:03,  9.36it/s] 24%|██▍       | 11/45 [00:01<00:04,  7.53it/s] 38%|███▊      | 17/45 [00:01<00:02, 13.42it/s] 44%|████▍     | 20/45 [00:02<00:02,  9.99it/s] 53%|█████▎    | 24/45 [00:02<00:01, 12.52it/s] 58%|█████▊    | 26/45 [00:03<00:01,  9.51it/s] 71%|███████   | 32/45 [00:03<00:00, 14.97it/s] 78%|███████▊  | 35/45 [00:03<00:00, 10.28it/s] 91%|█████████ | 41/45 [00:03<00:00, 15.62it/s]100%|██████████| 45/45 [00:04<00:00, 11.06it/s]100%|██████████| 45/45 [00:04<00:00, 10.04it/s]
5640 images processed, 4.504709959030151 seconds used

22.626801013946533
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           3.16  99.28
places365     70.23  80.52
LSUN          21.09  95.66
iSUN          74.49  80.71
dtd           41.05  90.71
AVG           42.00  89.38
Retain-Acc: 0.7401
Forget-as-OOD (retain known vs forget novel):
  FPR: 75.00 AUROC: 87.32 AUIN: 98.40
29.50474524497986
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e50-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid
epochs=50 | cache=6 | flambda=0.2 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e50-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e50-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e50-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21843904
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<02:25,  2.68it/s]  2%|▏         | 9/391 [00:00<00:16, 23.38it/s]  4%|▍         | 16/391 [00:00<00:10, 35.41it/s]  6%|▋         | 25/391 [00:00<00:07, 49.43it/s]  9%|▊         | 34/391 [00:00<00:05, 59.82it/s] 11%|█         | 42/391 [00:00<00:05, 60.52it/s] 13%|█▎        | 49/391 [00:01<00:05, 61.94it/s] 15%|█▍        | 58/391 [00:01<00:04, 68.17it/s] 17%|█▋        | 67/391 [00:01<00:04, 72.74it/s] 19%|█▉        | 75/391 [00:01<00:04, 72.47it/s] 21%|██        | 83/391 [00:01<00:04, 67.17it/s] 23%|██▎       | 91/391 [00:01<00:04, 68.97it/s] 26%|██▌       | 100/391 [00:01<00:03, 73.69it/s] 28%|██▊       | 109/391 [00:01<00:03, 75.68it/s] 30%|██▉       | 117/391 [00:01<00:04, 67.74it/s] 32%|███▏      | 125/391 [00:02<00:03, 68.25it/s] 34%|███▍      | 134/391 [00:02<00:03, 72.88it/s] 37%|███▋      | 143/391 [00:02<00:03, 75.49it/s] 39%|███▊      | 151/391 [00:02<00:03, 71.79it/s] 41%|████      | 159/391 [00:02<00:03, 70.17it/s] 43%|████▎     | 169/391 [00:02<00:02, 76.47it/s] 46%|████▌     | 178/391 [00:02<00:02, 79.46it/s] 48%|████▊     | 188/391 [00:02<00:02, 83.63it/s] 50%|█████     | 197/391 [00:03<00:02, 70.66it/s] 52%|█████▏    | 205/391 [00:03<00:02, 65.30it/s] 55%|█████▍    | 215/391 [00:03<00:02, 72.12it/s] 58%|█████▊    | 225/391 [00:03<00:02, 76.40it/s] 60%|█████▉    | 233/391 [00:03<00:02, 68.56it/s] 62%|██████▏   | 241/391 [00:03<00:02, 64.42it/s] 63%|██████▎   | 248/391 [00:03<00:02, 65.33it/s] 65%|██████▌   | 255/391 [00:03<00:02, 63.59it/s] 67%|██████▋   | 262/391 [00:04<00:02, 62.04it/s] 69%|██████▉   | 269/391 [00:04<00:02, 60.79it/s] 71%|███████   | 276/391 [00:04<00:01, 60.77it/s] 72%|███████▏  | 283/391 [00:04<00:01, 60.67it/s] 74%|███████▍  | 290/391 [00:04<00:01, 56.86it/s] 76%|███████▌  | 296/391 [00:04<00:01, 50.53it/s] 77%|███████▋  | 302/391 [00:04<00:01, 50.46it/s] 80%|███████▉  | 311/391 [00:04<00:01, 58.94it/s] 82%|████████▏ | 320/391 [00:05<00:01, 64.26it/s] 84%|████████▎ | 327/391 [00:05<00:01, 56.26it/s] 85%|████████▌ | 334/391 [00:05<00:01, 56.90it/s] 88%|████████▊ | 343/391 [00:05<00:00, 62.98it/s] 90%|████████▉ | 351/391 [00:05<00:00, 64.93it/s] 92%|█████████▏| 358/391 [00:05<00:00, 64.38it/s] 93%|█████████▎| 365/391 [00:05<00:00, 63.21it/s] 95%|█████████▌| 372/391 [00:05<00:00, 63.18it/s] 97%|█████████▋| 379/391 [00:06<00:00, 62.79it/s] 99%|█████████▊| 386/391 [00:06<00:00, 63.79it/s]100%|██████████| 391/391 [00:06<00:00, 63.15it/s]
50000 images processed, 6.297671556472778 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:32,  2.42it/s] 10%|█         | 8/79 [00:00<00:03, 19.48it/s] 19%|█▉        | 15/79 [00:00<00:02, 31.89it/s] 28%|██▊       | 22/79 [00:00<00:01, 40.31it/s] 35%|███▌      | 28/79 [00:00<00:01, 45.41it/s] 47%|████▋     | 37/79 [00:00<00:00, 56.14it/s] 57%|█████▋    | 45/79 [00:01<00:00, 62.71it/s] 66%|██████▌   | 52/79 [00:01<00:00, 58.44it/s] 75%|███████▍  | 59/79 [00:01<00:00, 56.77it/s] 86%|████████▌ | 68/79 [00:01<00:00, 64.92it/s] 96%|█████████▌| 76/79 [00:01<00:00, 67.87it/s]100%|██████████| 79/79 [00:01<00:00, 49.41it/s]
10000 images processed, 1.6213388442993164 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:13,  2.78it/s]  3%|▎         | 7/204 [00:00<00:10, 18.56it/s]  7%|▋         | 14/204 [00:00<00:05, 31.95it/s] 11%|█▏        | 23/204 [00:00<00:03, 47.79it/s] 15%|█▍        | 30/204 [00:00<00:03, 51.81it/s] 18%|█▊        | 37/204 [00:00<00:03, 50.15it/s] 22%|██▏       | 45/204 [00:01<00:02, 56.64it/s] 26%|██▋       | 54/204 [00:01<00:02, 63.81it/s] 30%|██▉       | 61/204 [00:01<00:02, 56.90it/s] 33%|███▎      | 68/204 [00:01<00:02, 55.77it/s] 38%|███▊      | 78/204 [00:01<00:01, 65.43it/s] 42%|████▏     | 86/204 [00:01<00:01, 69.14it/s] 46%|████▌     | 94/204 [00:01<00:01, 57.25it/s] 50%|█████     | 102/204 [00:01<00:01, 62.47it/s] 53%|█████▎    | 109/204 [00:02<00:01, 62.44it/s] 57%|█████▋    | 116/204 [00:02<00:01, 57.69it/s] 60%|██████    | 123/204 [00:02<00:01, 58.79it/s] 64%|██████▍   | 131/204 [00:02<00:01, 62.62it/s] 68%|██████▊   | 138/204 [00:02<00:01, 61.69it/s] 71%|███████   | 145/204 [00:02<00:00, 61.76it/s] 75%|███████▍  | 152/204 [00:02<00:00, 55.27it/s] 78%|███████▊  | 159/204 [00:02<00:00, 57.18it/s] 82%|████████▏ | 168/204 [00:03<00:00, 64.36it/s] 86%|████████▌ | 175/204 [00:03<00:00, 58.15it/s] 89%|████████▉ | 182/204 [00:03<00:00, 54.48it/s] 94%|█████████▎| 191/204 [00:03<00:00, 61.70it/s] 97%|█████████▋| 198/204 [00:03<00:00, 63.41it/s]100%|██████████| 204/204 [00:03<00:00, 55.24it/s]
26032 images processed, 3.729724645614624 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:42,  1.86it/s] 10%|█         | 8/79 [00:00<00:04, 15.74it/s] 15%|█▌        | 12/79 [00:00<00:03, 19.12it/s] 22%|██▏       | 17/79 [00:00<00:02, 23.36it/s] 29%|██▉       | 23/79 [00:01<00:01, 31.39it/s] 35%|███▌      | 28/79 [00:01<00:01, 34.98it/s] 42%|████▏     | 33/79 [00:01<00:01, 34.78it/s] 49%|████▉     | 39/79 [00:01<00:01, 39.63it/s] 56%|█████▌    | 44/79 [00:01<00:00, 41.64it/s] 62%|██████▏   | 49/79 [00:01<00:00, 39.25it/s] 71%|███████   | 56/79 [00:01<00:00, 45.84it/s] 77%|███████▋  | 61/79 [00:01<00:00, 41.44it/s] 84%|████████▎ | 66/79 [00:02<00:00, 37.54it/s] 91%|█████████ | 72/79 [00:02<00:00, 42.18it/s] 99%|█████████▊| 78/79 [00:02<00:00, 45.92it/s]100%|██████████| 79/79 [00:02<00:00, 34.12it/s]
10000 images processed, 2.3501954078674316 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:29,  2.65it/s]  8%|▊         | 6/79 [00:00<00:04, 15.55it/s] 18%|█▊        | 14/79 [00:00<00:01, 32.70it/s] 27%|██▋       | 21/79 [00:00<00:01, 41.93it/s] 34%|███▍      | 27/79 [00:00<00:01, 43.36it/s] 42%|████▏     | 33/79 [00:00<00:00, 46.53it/s] 49%|████▉     | 39/79 [00:01<00:00, 49.94it/s] 57%|█████▋    | 45/79 [00:01<00:00, 47.02it/s] 65%|██████▍   | 51/79 [00:01<00:00, 46.00it/s] 73%|███████▎  | 58/79 [00:01<00:00, 51.90it/s] 82%|████████▏ | 65/79 [00:01<00:00, 53.96it/s] 90%|████████▉ | 71/79 [00:01<00:00, 50.41it/s]100%|██████████| 79/79 [00:01<00:00, 44.38it/s]
10000 images processed, 1.8061931133270264 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:21,  3.16it/s]  9%|▊         | 6/70 [00:00<00:03, 17.07it/s] 16%|█▌        | 11/70 [00:00<00:02, 25.79it/s] 26%|██▌       | 18/70 [00:00<00:01, 38.38it/s] 39%|███▊      | 27/70 [00:00<00:00, 52.35it/s] 49%|████▊     | 34/70 [00:00<00:00, 54.51it/s] 59%|█████▊    | 41/70 [00:01<00:00, 53.12it/s] 69%|██████▊   | 48/70 [00:01<00:00, 56.23it/s] 79%|███████▊  | 55/70 [00:01<00:00, 58.52it/s] 89%|████████▊ | 62/70 [00:01<00:00, 59.35it/s] 99%|█████████▊| 69/70 [00:01<00:00, 60.45it/s]100%|██████████| 70/70 [00:01<00:00, 47.55it/s]
8925 images processed, 1.5015978813171387 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:00<00:42,  1.03it/s]  9%|▉         | 4/45 [00:01<00:08,  4.72it/s] 20%|██        | 9/45 [00:01<00:04,  8.86it/s] 24%|██▍       | 11/45 [00:01<00:04,  8.42it/s] 38%|███▊      | 17/45 [00:01<00:02, 12.40it/s] 42%|████▏     | 19/45 [00:02<00:02, 11.93it/s] 49%|████▉     | 22/45 [00:02<00:01, 13.88it/s] 56%|█████▌    | 25/45 [00:02<00:01, 15.54it/s] 60%|██████    | 27/45 [00:02<00:01, 11.68it/s] 67%|██████▋   | 30/45 [00:02<00:01, 13.69it/s] 73%|███████▎  | 33/45 [00:03<00:00, 13.58it/s] 78%|███████▊  | 35/45 [00:03<00:00, 11.18it/s] 91%|█████████ | 41/45 [00:03<00:00, 15.82it/s] 96%|█████████▌| 43/45 [00:04<00:00, 10.22it/s]100%|██████████| 45/45 [00:04<00:00, 10.89it/s]
5640 images processed, 4.151232719421387 seconds used

23.20218563079834
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           5.17  98.81
places365     73.57  79.67
LSUN          23.36  95.44
iSUN          75.35  79.92
dtd           42.66  90.16
AVG           44.02  88.80
Retain-Acc: 0.7330
Forget-as-OOD (retain known vs forget novel):
  FPR: 39.50 AUROC: 91.83 AUIN: 98.92
23.2205171585083
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e5-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid
epochs=5 | cache=6 | flambda=0.2 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21843904
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<02:10,  2.98it/s]  3%|▎         | 10/391 [00:00<00:13, 28.04it/s]  5%|▍         | 19/391 [00:00<00:08, 44.98it/s]  7%|▋         | 29/391 [00:00<00:06, 59.36it/s] 10%|▉         | 39/391 [00:00<00:05, 69.99it/s] 13%|█▎        | 49/391 [00:00<00:04, 76.70it/s] 15%|█▍        | 58/391 [00:00<00:04, 79.82it/s] 17%|█▋        | 68/391 [00:01<00:03, 83.54it/s] 20%|█▉        | 77/391 [00:01<00:04, 77.66it/s] 22%|██▏       | 86/391 [00:01<00:04, 74.59it/s] 25%|██▍       | 96/391 [00:01<00:03, 79.12it/s] 27%|██▋       | 106/391 [00:01<00:03, 83.45it/s] 29%|██▉       | 115/391 [00:01<00:03, 80.52it/s] 32%|███▏      | 124/391 [00:01<00:03, 73.39it/s] 34%|███▍      | 134/391 [00:01<00:03, 78.63it/s] 37%|███▋      | 144/391 [00:02<00:02, 83.10it/s] 39%|███▉      | 153/391 [00:02<00:03, 74.25it/s] 41%|████▏     | 162/391 [00:02<00:02, 76.57it/s] 44%|████▎     | 171/391 [00:02<00:02, 79.90it/s] 46%|████▌     | 180/391 [00:02<00:02, 76.08it/s] 48%|████▊     | 188/391 [00:02<00:02, 73.04it/s] 50%|█████     | 197/391 [00:02<00:02, 76.63it/s] 53%|█████▎    | 207/391 [00:02<00:02, 80.03it/s] 55%|█████▌    | 216/391 [00:03<00:02, 73.86it/s] 58%|█████▊    | 225/391 [00:03<00:02, 75.76it/s] 60%|█████▉    | 234/391 [00:03<00:01, 79.00it/s] 62%|██████▏   | 243/391 [00:03<00:01, 75.03it/s] 64%|██████▍   | 251/391 [00:03<00:01, 72.45it/s] 67%|██████▋   | 261/391 [00:03<00:01, 78.73it/s] 69%|██████▉   | 270/391 [00:03<00:01, 79.54it/s] 71%|███████▏  | 279/391 [00:03<00:01, 71.77it/s] 74%|███████▎  | 288/391 [00:03<00:01, 76.24it/s] 76%|███████▌  | 296/391 [00:04<00:01, 71.84it/s] 78%|███████▊  | 304/391 [00:04<00:01, 71.57it/s] 80%|███████▉  | 312/391 [00:04<00:01, 72.63it/s] 82%|████████▏ | 320/391 [00:04<00:01, 65.91it/s] 84%|████████▎ | 327/391 [00:04<00:01, 62.34it/s] 86%|████████▌ | 336/391 [00:04<00:00, 67.19it/s] 88%|████████▊ | 345/391 [00:04<00:00, 72.03it/s] 90%|█████████ | 353/391 [00:04<00:00, 70.41it/s] 92%|█████████▏| 361/391 [00:05<00:00, 69.10it/s] 94%|█████████▍| 369/391 [00:05<00:00, 70.24it/s] 97%|█████████▋| 378/391 [00:05<00:00, 72.58it/s] 99%|█████████▊| 386/391 [00:05<00:00, 68.26it/s]100%|██████████| 391/391 [00:05<00:00, 71.25it/s]
50000 images processed, 5.5651750564575195 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:23,  3.27it/s]  9%|▉         | 7/79 [00:00<00:03, 21.29it/s] 19%|█▉        | 15/79 [00:00<00:01, 38.04it/s] 27%|██▋       | 21/79 [00:00<00:01, 43.97it/s] 38%|███▊      | 30/79 [00:00<00:00, 57.19it/s] 49%|████▉     | 39/79 [00:00<00:00, 64.28it/s] 59%|█████▉    | 47/79 [00:00<00:00, 63.94it/s] 70%|██████▉   | 55/79 [00:01<00:00, 67.15it/s] 81%|████████  | 64/79 [00:01<00:00, 70.18it/s] 91%|█████████ | 72/79 [00:01<00:00, 67.82it/s]100%|██████████| 79/79 [00:01<00:00, 67.96it/s]100%|██████████| 79/79 [00:01<00:00, 55.58it/s]
10000 images processed, 1.4452791213989258 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:15,  2.70it/s]  3%|▎         | 7/204 [00:00<00:10, 18.63it/s]  7%|▋         | 14/204 [00:00<00:05, 32.87it/s] 12%|█▏        | 24/204 [00:00<00:03, 50.65it/s] 15%|█▌        | 31/204 [00:00<00:03, 52.18it/s] 19%|█▉        | 39/204 [00:00<00:02, 58.53it/s] 24%|██▎       | 48/204 [00:01<00:02, 65.13it/s] 27%|██▋       | 56/204 [00:01<00:02, 62.89it/s] 32%|███▏      | 65/204 [00:01<00:02, 68.44it/s] 36%|███▌      | 73/204 [00:01<00:01, 69.91it/s] 40%|███▉      | 81/204 [00:01<00:01, 66.54it/s] 44%|████▍     | 90/204 [00:01<00:01, 71.63it/s] 49%|████▉     | 100/204 [00:01<00:01, 77.95it/s] 53%|█████▎    | 108/204 [00:01<00:01, 74.18it/s] 57%|█████▋    | 116/204 [00:01<00:01, 71.84it/s] 61%|██████▏   | 125/204 [00:02<00:01, 75.83it/s] 65%|██████▌   | 133/204 [00:02<00:00, 74.81it/s] 69%|██████▉   | 141/204 [00:02<00:00, 70.90it/s] 74%|███████▎  | 150/204 [00:02<00:00, 74.32it/s] 77%|███████▋  | 158/204 [00:02<00:00, 75.41it/s] 81%|████████▏ | 166/204 [00:02<00:00, 70.48it/s] 85%|████████▌ | 174/204 [00:02<00:00, 71.26it/s] 89%|████████▉ | 182/204 [00:02<00:00, 72.64it/s] 94%|█████████▎| 191/204 [00:02<00:00, 75.77it/s] 98%|█████████▊| 199/204 [00:03<00:00, 68.89it/s]100%|██████████| 204/204 [00:03<00:00, 63.94it/s]
26032 images processed, 3.235462188720703 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:44,  1.76it/s] 11%|█▏        | 9/79 [00:00<00:04, 15.51it/s] 20%|██        | 16/79 [00:00<00:02, 26.42it/s] 29%|██▉       | 23/79 [00:00<00:01, 35.38it/s] 37%|███▋      | 29/79 [00:01<00:01, 35.40it/s] 43%|████▎     | 34/79 [00:01<00:01, 37.75it/s] 52%|█████▏    | 41/79 [00:01<00:00, 39.71it/s] 61%|██████    | 48/79 [00:01<00:00, 45.04it/s] 71%|███████   | 56/79 [00:01<00:00, 53.12it/s] 78%|███████▊  | 62/79 [00:01<00:00, 51.88it/s] 86%|████████▌ | 68/79 [00:01<00:00, 47.98it/s] 94%|█████████▎| 74/79 [00:02<00:00, 45.70it/s]100%|██████████| 79/79 [00:02<00:00, 38.07it/s]
10000 images processed, 2.1175572872161865 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:30,  2.57it/s] 10%|█         | 8/79 [00:00<00:03, 19.88it/s] 19%|█▉        | 15/79 [00:00<00:01, 33.08it/s] 30%|███       | 24/79 [00:00<00:01, 47.90it/s] 39%|███▉      | 31/79 [00:00<00:00, 52.99it/s] 48%|████▊     | 38/79 [00:00<00:00, 55.40it/s] 59%|█████▉    | 47/79 [00:01<00:00, 63.43it/s] 68%|██████▊   | 54/79 [00:01<00:00, 64.23it/s] 77%|███████▋  | 61/79 [00:01<00:00, 62.99it/s] 90%|████████▉ | 71/79 [00:01<00:00, 71.83it/s]100%|██████████| 79/79 [00:01<00:00, 53.86it/s]
10000 images processed, 1.490002155303955 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:28,  2.46it/s] 14%|█▍        | 10/70 [00:00<00:02, 24.48it/s] 23%|██▎       | 16/70 [00:00<00:01, 33.71it/s] 33%|███▎      | 23/70 [00:00<00:01, 43.19it/s] 47%|████▋     | 33/70 [00:00<00:00, 58.12it/s] 61%|██████▏   | 43/70 [00:00<00:00, 66.78it/s] 73%|███████▎  | 51/70 [00:01<00:00, 62.42it/s] 86%|████████▌ | 60/70 [00:01<00:00, 69.37it/s] 99%|█████████▊| 69/70 [00:01<00:00, 72.23it/s]100%|██████████| 70/70 [00:01<00:00, 52.79it/s]
8925 images processed, 1.353893518447876 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:00<00:40,  1.08it/s]  4%|▍         | 2/45 [00:01<00:19,  2.19it/s] 18%|█▊        | 8/45 [00:01<00:03, 11.12it/s] 24%|██▍       | 11/45 [00:01<00:03,  8.96it/s] 38%|███▊      | 17/45 [00:01<00:02, 11.55it/s] 42%|████▏     | 19/45 [00:02<00:02, 11.89it/s] 53%|█████▎    | 24/45 [00:02<00:01, 16.30it/s] 60%|██████    | 27/45 [00:02<00:01, 12.65it/s] 67%|██████▋   | 30/45 [00:02<00:00, 15.01it/s] 73%|███████▎  | 33/45 [00:03<00:01, 11.06it/s] 78%|███████▊  | 35/45 [00:03<00:00, 11.29it/s] 91%|█████████ | 41/45 [00:03<00:00, 13.02it/s] 96%|█████████▌| 43/45 [00:04<00:00, 10.52it/s]100%|██████████| 45/45 [00:04<00:00, 10.86it/s]
5640 images processed, 4.166030645370483 seconds used

21.207841873168945
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.52  99.36
places365     67.87  81.18
LSUN          17.57  96.07
iSUN          72.35  81.68
dtd           37.85  91.39
AVG           39.63  89.94
Retain-Acc: 0.7407
Forget-as-OOD (retain known vs forget novel):
  FPR: 79.50 AUROC: 86.90 AUIN: 98.36
23.558825731277466
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e10-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid
epochs=10 | cache=6 | flambda=0.2 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e10-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e10-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e10-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21843904
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<01:57,  3.33it/s]  2%|▏         | 8/391 [00:00<00:15, 24.01it/s]  5%|▍         | 18/391 [00:00<00:08, 46.17it/s]  7%|▋         | 28/391 [00:00<00:05, 60.74it/s]  9%|▉         | 36/391 [00:00<00:05, 61.24it/s] 11%|█▏        | 44/391 [00:00<00:05, 63.71it/s] 14%|█▍        | 54/391 [00:00<00:04, 72.89it/s] 16%|█▌        | 63/391 [00:01<00:04, 75.39it/s] 18%|█▊        | 71/391 [00:01<00:04, 71.49it/s] 20%|██        | 80/391 [00:01<00:04, 73.96it/s] 23%|██▎       | 89/391 [00:01<00:03, 76.74it/s] 25%|██▌       | 98/391 [00:01<00:03, 76.83it/s] 27%|██▋       | 106/391 [00:01<00:04, 70.62it/s] 30%|██▉       | 116/391 [00:01<00:03, 77.32it/s] 32%|███▏      | 124/391 [00:01<00:03, 75.06it/s] 34%|███▍      | 132/391 [00:02<00:03, 71.02it/s] 36%|███▋      | 142/391 [00:02<00:03, 76.77it/s] 38%|███▊      | 150/391 [00:02<00:03, 71.63it/s] 40%|████      | 158/391 [00:02<00:03, 71.45it/s] 43%|████▎     | 168/391 [00:02<00:02, 77.20it/s] 45%|████▌     | 177/391 [00:02<00:02, 78.19it/s] 47%|████▋     | 185/391 [00:02<00:02, 73.50it/s] 50%|████▉     | 194/391 [00:02<00:02, 76.07it/s] 52%|█████▏    | 203/391 [00:02<00:02, 78.98it/s] 54%|█████▍    | 211/391 [00:03<00:02, 77.71it/s] 56%|█████▌    | 219/391 [00:03<00:02, 73.88it/s] 58%|█████▊    | 228/391 [00:03<00:02, 76.82it/s] 61%|██████    | 237/391 [00:03<00:01, 78.79it/s] 63%|██████▎   | 245/391 [00:03<00:01, 76.19it/s] 65%|██████▍   | 253/391 [00:03<00:01, 71.99it/s] 67%|██████▋   | 262/391 [00:03<00:01, 76.24it/s] 69%|██████▉   | 271/391 [00:03<00:01, 78.09it/s] 71%|███████▏  | 279/391 [00:03<00:01, 73.29it/s] 74%|███████▎  | 288/391 [00:04<00:01, 75.80it/s] 76%|███████▌  | 297/391 [00:04<00:01, 78.69it/s] 78%|███████▊  | 305/391 [00:04<00:01, 77.16it/s] 80%|████████  | 313/391 [00:04<00:01, 72.19it/s] 82%|████████▏ | 322/391 [00:04<00:00, 75.18it/s] 84%|████████▍ | 330/391 [00:04<00:00, 73.57it/s] 86%|████████▋ | 338/391 [00:04<00:00, 70.02it/s] 89%|████████▊ | 347/391 [00:04<00:00, 73.90it/s] 91%|█████████▏| 357/391 [00:04<00:00, 79.10it/s] 93%|█████████▎| 365/391 [00:05<00:00, 77.30it/s] 95%|█████████▌| 373/391 [00:05<00:00, 71.74it/s] 98%|█████████▊| 383/391 [00:05<00:00, 78.00it/s]100%|██████████| 391/391 [00:05<00:00, 71.98it/s]
50000 images processed, 5.513982057571411 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:25,  3.01it/s]  9%|▉         | 7/79 [00:00<00:03, 19.71it/s] 18%|█▊        | 14/79 [00:00<00:01, 33.98it/s] 29%|██▉       | 23/79 [00:00<00:01, 49.17it/s] 38%|███▊      | 30/79 [00:00<00:00, 53.28it/s] 47%|████▋     | 37/79 [00:00<00:00, 56.18it/s] 59%|█████▉    | 47/79 [00:00<00:00, 67.57it/s] 72%|███████▏  | 57/79 [00:01<00:00, 75.04it/s] 82%|████████▏ | 65/79 [00:01<00:00, 72.21it/s] 92%|█████████▏| 73/79 [00:01<00:00, 70.46it/s]100%|██████████| 79/79 [00:01<00:00, 55.69it/s]
10000 images processed, 1.451817274093628 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:07,  3.01it/s]  4%|▍         | 9/204 [00:00<00:07, 26.11it/s]  7%|▋         | 15/204 [00:00<00:05, 35.52it/s] 11%|█         | 22/204 [00:00<00:04, 45.16it/s] 15%|█▍        | 30/204 [00:00<00:03, 54.78it/s] 19%|█▊        | 38/204 [00:00<00:02, 59.94it/s] 22%|██▏       | 45/204 [00:00<00:02, 59.21it/s] 27%|██▋       | 55/204 [00:01<00:02, 67.95it/s] 31%|███       | 63/204 [00:01<00:02, 66.24it/s] 34%|███▍      | 70/204 [00:01<00:02, 65.26it/s] 39%|███▉      | 80/204 [00:01<00:01, 72.26it/s] 43%|████▎     | 88/204 [00:01<00:01, 67.35it/s] 47%|████▋     | 96/204 [00:01<00:01, 69.33it/s] 51%|█████▏    | 105/204 [00:01<00:01, 72.92it/s] 55%|█████▌    | 113/204 [00:01<00:01, 67.48it/s] 59%|█████▉    | 121/204 [00:02<00:01, 70.63it/s] 64%|██████▎   | 130/204 [00:02<00:01, 72.98it/s] 68%|██████▊   | 138/204 [00:02<00:01, 63.89it/s] 71%|███████   | 145/204 [00:02<00:00, 62.63it/s] 75%|███████▍  | 152/204 [00:02<00:00, 62.01it/s] 78%|███████▊  | 159/204 [00:02<00:00, 59.78it/s] 82%|████████▏ | 168/204 [00:02<00:00, 66.42it/s] 86%|████████▋ | 176/204 [00:02<00:00, 69.59it/s] 90%|█████████ | 184/204 [00:03<00:00, 66.45it/s] 95%|█████████▍| 193/204 [00:03<00:00, 71.78it/s] 99%|█████████▊| 201/204 [00:03<00:00, 71.34it/s]100%|██████████| 204/204 [00:03<00:00, 61.87it/s]
26032 images processed, 3.3464088439941406 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:42,  1.84it/s] 11%|█▏        | 9/79 [00:00<00:04, 16.10it/s] 19%|█▉        | 15/79 [00:00<00:02, 25.26it/s] 28%|██▊       | 22/79 [00:00<00:01, 34.77it/s] 35%|███▌      | 28/79 [00:01<00:01, 36.12it/s] 42%|████▏     | 33/79 [00:01<00:01, 38.88it/s] 52%|█████▏    | 41/79 [00:01<00:00, 42.89it/s] 61%|██████    | 48/79 [00:01<00:00, 49.25it/s] 68%|██████▊   | 54/79 [00:01<00:00, 47.91it/s] 76%|███████▌  | 60/79 [00:01<00:00, 49.01it/s] 84%|████████▎ | 66/79 [00:01<00:00, 47.99it/s] 94%|█████████▎| 74/79 [00:01<00:00, 49.66it/s]100%|██████████| 79/79 [00:02<00:00, 38.99it/s]
10000 images processed, 2.064620018005371 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:28,  2.76it/s] 13%|█▎        | 10/79 [00:00<00:02, 26.67it/s] 25%|██▌       | 20/79 [00:00<00:01, 46.39it/s] 37%|███▋      | 29/79 [00:00<00:00, 57.82it/s] 48%|████▊     | 38/79 [00:00<00:00, 64.82it/s] 61%|██████    | 48/79 [00:00<00:00, 73.57it/s] 73%|███████▎  | 58/79 [00:01<00:00, 78.73it/s] 85%|████████▍ | 67/79 [00:01<00:00, 72.46it/s] 96%|█████████▌| 76/79 [00:01<00:00, 75.61it/s]100%|██████████| 79/79 [00:01<00:00, 61.17it/s]
10000 images processed, 1.311793327331543 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:21,  3.20it/s] 14%|█▍        | 10/70 [00:00<00:01, 30.15it/s] 23%|██▎       | 16/70 [00:00<00:01, 39.17it/s] 31%|███▏      | 22/70 [00:00<00:01, 45.10it/s] 46%|████▌     | 32/70 [00:00<00:00, 60.31it/s] 60%|██████    | 42/70 [00:00<00:00, 70.07it/s] 73%|███████▎  | 51/70 [00:00<00:00, 73.55it/s] 84%|████████▍ | 59/70 [00:01<00:00, 67.82it/s] 97%|█████████▋| 68/70 [00:01<00:00, 73.70it/s]100%|██████████| 70/70 [00:01<00:00, 57.60it/s]
8925 images processed, 1.2482397556304932 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:01<00:46,  1.05s/it] 13%|█▎        | 6/45 [00:01<00:05,  6.74it/s] 20%|██        | 9/45 [00:01<00:04,  7.77it/s] 24%|██▍       | 11/45 [00:01<00:04,  7.72it/s] 33%|███▎      | 15/45 [00:01<00:02, 12.05it/s] 40%|████      | 18/45 [00:02<00:02, 10.39it/s] 49%|████▉     | 22/45 [00:02<00:02, 11.21it/s] 58%|█████▊    | 26/45 [00:02<00:01, 11.57it/s] 67%|██████▋   | 30/45 [00:03<00:01, 12.12it/s] 76%|███████▌  | 34/45 [00:03<00:00, 11.35it/s] 89%|████████▉ | 40/45 [00:03<00:00, 17.00it/s] 96%|█████████▌| 43/45 [00:04<00:00, 11.02it/s]100%|██████████| 45/45 [00:04<00:00, 10.53it/s]
5640 images processed, 4.3007142543792725 seconds used

21.05279517173767
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.52  99.36
places365     67.91  81.18
LSUN          17.49  96.10
iSUN          72.35  81.68
dtd           37.87  91.38
AVG           39.63  89.94
Retain-Acc: 0.7408
Forget-as-OOD (retain known vs forget novel):
  FPR: 79.50 AUROC: 86.88 AUIN: 98.36
24.775020122528076
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e20-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid
epochs=20 | cache=6 | flambda=0.2 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e20-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e20-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e20-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21843904
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<03:09,  2.05it/s]  3%|▎         | 10/391 [00:00<00:17, 21.99it/s]  4%|▍         | 17/391 [00:00<00:11, 33.58it/s]  6%|▋         | 25/391 [00:00<00:08, 45.40it/s]  8%|▊         | 32/391 [00:00<00:07, 50.55it/s] 10%|█         | 40/391 [00:01<00:06, 57.39it/s] 13%|█▎        | 49/391 [00:01<00:05, 65.24it/s] 15%|█▍        | 58/391 [00:01<00:04, 71.97it/s] 17%|█▋        | 67/391 [00:01<00:04, 74.77it/s] 19%|█▉        | 75/391 [00:01<00:04, 70.70it/s] 21%|██▏       | 84/391 [00:01<00:04, 74.36it/s] 24%|██▍       | 93/391 [00:01<00:03, 76.69it/s] 26%|██▋       | 103/391 [00:01<00:03, 81.89it/s] 29%|██▊       | 112/391 [00:01<00:03, 78.92it/s] 31%|███       | 121/391 [00:02<00:03, 74.13it/s] 33%|███▎      | 130/391 [00:02<00:03, 78.20it/s] 35%|███▌      | 138/391 [00:02<00:03, 77.20it/s] 37%|███▋      | 146/391 [00:02<00:03, 71.56it/s] 40%|███▉      | 155/391 [00:02<00:03, 73.73it/s] 42%|████▏     | 164/391 [00:02<00:02, 77.84it/s] 44%|████▍     | 173/391 [00:02<00:02, 80.66it/s] 47%|████▋     | 182/391 [00:02<00:02, 73.35it/s] 49%|████▉     | 191/391 [00:02<00:02, 75.82it/s] 51%|█████     | 200/391 [00:03<00:02, 77.05it/s] 53%|█████▎    | 208/391 [00:03<00:02, 72.38it/s] 55%|█████▌    | 216/391 [00:03<00:02, 74.33it/s] 57%|█████▋    | 224/391 [00:03<00:02, 74.11it/s] 60%|█████▉    | 233/391 [00:03<00:02, 76.47it/s] 62%|██████▏   | 241/391 [00:03<00:02, 72.08it/s] 64%|██████▎   | 249/391 [00:03<00:01, 73.03it/s] 66%|██████▌   | 258/391 [00:03<00:01, 76.97it/s] 68%|██████▊   | 267/391 [00:03<00:01, 79.48it/s] 71%|███████   | 276/391 [00:04<00:01, 77.10it/s] 73%|███████▎  | 284/391 [00:04<00:01, 73.08it/s] 75%|███████▌  | 294/391 [00:04<00:01, 78.00it/s] 77%|███████▋  | 303/391 [00:04<00:01, 80.71it/s] 80%|███████▉  | 312/391 [00:04<00:00, 82.77it/s] 82%|████████▏ | 321/391 [00:04<00:00, 76.43it/s] 84%|████████▍ | 329/391 [00:04<00:00, 76.41it/s] 87%|████████▋ | 339/391 [00:04<00:00, 80.93it/s] 89%|████████▉ | 348/391 [00:04<00:00, 81.14it/s] 91%|█████████▏| 357/391 [00:05<00:00, 74.83it/s] 93%|█████████▎| 365/391 [00:05<00:00, 74.60it/s] 95%|█████████▌| 373/391 [00:05<00:00, 74.85it/s] 98%|█████████▊| 382/391 [00:05<00:00, 78.04it/s]100%|█████████▉| 390/391 [00:05<00:00, 74.27it/s]100%|██████████| 391/391 [00:05<00:00, 69.93it/s]
50000 images processed, 5.714977741241455 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:24,  3.13it/s] 11%|█▏        | 9/79 [00:00<00:02, 26.60it/s] 23%|██▎       | 18/79 [00:00<00:01, 44.42it/s] 33%|███▎      | 26/79 [00:00<00:01, 52.68it/s] 42%|████▏     | 33/79 [00:00<00:00, 57.65it/s] 52%|█████▏    | 41/79 [00:00<00:00, 63.52it/s] 62%|██████▏   | 49/79 [00:00<00:00, 67.29it/s] 72%|███████▏  | 57/79 [00:01<00:00, 67.85it/s] 82%|████████▏ | 65/79 [00:01<00:00, 64.89it/s] 91%|█████████ | 72/79 [00:01<00:00, 64.62it/s]100%|██████████| 79/79 [00:01<00:00, 65.09it/s]100%|██████████| 79/79 [00:01<00:00, 55.50it/s]
10000 images processed, 1.4483058452606201 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:35,  2.13it/s]  4%|▍         | 9/204 [00:00<00:09, 20.18it/s]  8%|▊         | 16/204 [00:00<00:05, 31.75it/s] 11%|█         | 22/204 [00:00<00:04, 38.95it/s] 15%|█▌        | 31/204 [00:00<00:03, 52.44it/s] 20%|█▉        | 40/204 [00:00<00:02, 62.78it/s] 24%|██▎       | 48/204 [00:01<00:02, 67.63it/s] 27%|██▋       | 56/204 [00:01<00:02, 64.57it/s] 32%|███▏      | 65/204 [00:01<00:01, 70.41it/s] 36%|███▋      | 74/204 [00:01<00:01, 75.27it/s] 41%|████      | 84/204 [00:01<00:01, 80.40it/s] 46%|████▌     | 93/204 [00:01<00:01, 79.74it/s] 50%|█████     | 102/204 [00:01<00:01, 73.22it/s] 54%|█████▍    | 111/204 [00:01<00:01, 75.82it/s] 58%|█████▊    | 119/204 [00:02<00:01, 76.06it/s] 62%|██████▏   | 127/204 [00:02<00:01, 71.43it/s] 66%|██████▌   | 135/204 [00:02<00:00, 72.91it/s] 70%|███████   | 143/204 [00:02<00:00, 74.83it/s] 74%|███████▍  | 151/204 [00:02<00:00, 72.44it/s] 78%|███████▊  | 159/204 [00:02<00:00, 71.52it/s] 82%|████████▏ | 168/204 [00:02<00:00, 74.53it/s] 87%|████████▋ | 177/204 [00:02<00:00, 77.14it/s] 92%|█████████▏| 187/204 [00:02<00:00, 81.80it/s] 96%|█████████▌| 196/204 [00:03<00:00, 77.17it/s]100%|██████████| 204/204 [00:03<00:00, 72.75it/s]100%|██████████| 204/204 [00:03<00:00, 64.49it/s]
26032 images processed, 3.2095940113067627 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:41,  1.87it/s] 11%|█▏        | 9/79 [00:00<00:04, 15.99it/s] 19%|█▉        | 15/79 [00:00<00:02, 25.13it/s] 25%|██▌       | 20/79 [00:00<00:01, 30.21it/s] 33%|███▎      | 26/79 [00:01<00:01, 31.83it/s] 43%|████▎     | 34/79 [00:01<00:01, 36.29it/s] 53%|█████▎    | 42/79 [00:01<00:00, 40.92it/s] 62%|██████▏   | 49/79 [00:01<00:00, 47.02it/s] 70%|██████▉   | 55/79 [00:01<00:00, 48.08it/s] 77%|███████▋  | 61/79 [00:01<00:00, 45.79it/s] 84%|████████▎ | 66/79 [00:01<00:00, 45.24it/s] 94%|█████████▎| 74/79 [00:02<00:00, 46.36it/s]100%|██████████| 79/79 [00:02<00:00, 36.99it/s]
10000 images processed, 2.1694726943969727 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:30,  2.59it/s] 14%|█▍        | 11/79 [00:00<00:02, 28.29it/s] 23%|██▎       | 18/79 [00:00<00:01, 39.43it/s] 32%|███▏      | 25/79 [00:00<00:01, 46.57it/s] 43%|████▎     | 34/79 [00:00<00:00, 58.53it/s] 54%|█████▍    | 43/79 [00:00<00:00, 65.78it/s] 67%|██████▋   | 53/79 [00:01<00:00, 74.11it/s] 78%|███████▊  | 62/79 [00:01<00:00, 70.12it/s] 89%|████████▊ | 70/79 [00:01<00:00, 70.30it/s]100%|██████████| 79/79 [00:01<00:00, 57.74it/s]
10000 images processed, 1.3966472148895264 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:36,  1.91it/s]  9%|▊         | 6/70 [00:00<00:05, 12.11it/s] 17%|█▋        | 12/70 [00:00<00:02, 22.88it/s] 30%|███       | 21/70 [00:00<00:01, 38.44it/s] 43%|████▎     | 30/70 [00:00<00:00, 51.33it/s] 53%|█████▎    | 37/70 [00:01<00:00, 55.53it/s] 63%|██████▎   | 44/70 [00:01<00:00, 57.02it/s] 77%|███████▋  | 54/70 [00:01<00:00, 67.01it/s] 90%|█████████ | 63/70 [00:01<00:00, 71.15it/s]100%|██████████| 70/70 [00:01<00:00, 46.41it/s]
8925 images processed, 1.5443167686462402 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:00<00:39,  1.10it/s]  7%|▋         | 3/45 [00:01<00:11,  3.64it/s] 20%|██        | 9/45 [00:01<00:04,  8.85it/s] 24%|██▍       | 11/45 [00:01<00:03,  9.76it/s] 31%|███       | 14/45 [00:01<00:02, 11.92it/s] 38%|███▊      | 17/45 [00:01<00:02, 11.56it/s] 49%|████▉     | 22/45 [00:02<00:01, 13.97it/s] 56%|█████▌    | 25/45 [00:02<00:01, 12.98it/s] 67%|██████▋   | 30/45 [00:02<00:01, 13.33it/s] 73%|███████▎  | 33/45 [00:03<00:01, 10.96it/s] 91%|█████████ | 41/45 [00:03<00:00, 12.98it/s] 96%|█████████▌| 43/45 [00:03<00:00, 13.10it/s]100%|██████████| 45/45 [00:03<00:00, 11.34it/s]
5640 images processed, 3.9932472705841064 seconds used

21.187248468399048
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.51  99.36
places365     67.95  81.18
LSUN          17.32  96.12
iSUN          72.34  81.66
dtd           37.87  91.36
AVG           39.60  89.94
Retain-Acc: 0.7409
Forget-as-OOD (retain known vs forget novel):
  FPR: 79.50 AUROC: 86.86 AUIN: 98.36
21.124342441558838
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e50-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid
epochs=50 | cache=6 | flambda=0.2 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e50-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e50-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e50-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21843904
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<02:05,  3.11it/s]  3%|▎         | 11/391 [00:00<00:11, 32.25it/s]  5%|▌         | 21/391 [00:00<00:07, 51.62it/s]  8%|▊         | 31/391 [00:00<00:05, 64.76it/s] 10%|█         | 41/391 [00:00<00:04, 73.19it/s] 13%|█▎        | 51/391 [00:00<00:04, 78.73it/s] 16%|█▌        | 61/391 [00:00<00:03, 83.11it/s] 18%|█▊        | 70/391 [00:01<00:03, 84.46it/s] 20%|██        | 80/391 [00:01<00:03, 86.59it/s] 23%|██▎       | 90/391 [00:01<00:03, 89.27it/s] 26%|██▌       | 100/391 [00:01<00:03, 90.80it/s] 28%|██▊       | 110/391 [00:01<00:03, 92.13it/s] 31%|███       | 120/391 [00:01<00:02, 92.49it/s] 33%|███▎      | 130/391 [00:01<00:02, 92.89it/s] 36%|███▌      | 140/391 [00:01<00:02, 92.17it/s] 38%|███▊      | 150/391 [00:01<00:02, 91.26it/s] 41%|████      | 160/391 [00:02<00:02, 87.35it/s] 43%|████▎     | 169/391 [00:02<00:02, 78.05it/s] 46%|████▌     | 178/391 [00:02<00:02, 80.10it/s] 48%|████▊     | 187/391 [00:02<00:02, 82.59it/s] 50%|█████     | 196/391 [00:02<00:02, 84.18it/s] 53%|█████▎    | 206/391 [00:02<00:02, 87.12it/s] 55%|█████▌    | 216/391 [00:02<00:01, 89.40it/s] 58%|█████▊    | 226/391 [00:02<00:01, 89.88it/s] 60%|██████    | 236/391 [00:02<00:01, 91.31it/s] 63%|██████▎   | 246/391 [00:03<00:01, 91.50it/s] 65%|██████▌   | 256/391 [00:03<00:01, 90.47it/s] 68%|██████▊   | 266/391 [00:03<00:01, 89.85it/s] 71%|███████   | 276/391 [00:03<00:01, 90.84it/s] 73%|███████▎  | 286/391 [00:03<00:01, 91.71it/s] 76%|███████▌  | 296/391 [00:03<00:01, 91.31it/s] 78%|███████▊  | 306/391 [00:03<00:00, 91.86it/s] 81%|████████  | 316/391 [00:03<00:00, 92.27it/s] 83%|████████▎ | 326/391 [00:03<00:00, 91.23it/s] 86%|████████▌ | 336/391 [00:04<00:00, 91.20it/s] 88%|████████▊ | 346/391 [00:04<00:00, 90.94it/s] 91%|█████████ | 356/391 [00:04<00:00, 90.93it/s] 94%|█████████▎| 366/391 [00:04<00:00, 89.10it/s] 96%|█████████▌| 375/391 [00:04<00:00, 89.05it/s] 98%|█████████▊| 385/391 [00:04<00:00, 91.36it/s]100%|██████████| 391/391 [00:04<00:00, 84.03it/s]
50000 images processed, 4.767143964767456 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:28,  2.70it/s] 14%|█▍        | 11/79 [00:00<00:02, 29.25it/s] 27%|██▋       | 21/79 [00:00<00:01, 48.23it/s] 39%|███▉      | 31/79 [00:00<00:00, 61.76it/s] 52%|█████▏    | 41/79 [00:00<00:00, 71.26it/s] 65%|██████▍   | 51/79 [00:00<00:00, 78.01it/s] 77%|███████▋  | 61/79 [00:01<00:00, 82.72it/s] 90%|████████▉ | 71/79 [00:01<00:00, 86.71it/s]100%|██████████| 79/79 [00:01<00:00, 65.49it/s]
10000 images processed, 1.2303733825683594 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:24,  2.40it/s]  5%|▌         | 11/204 [00:00<00:07, 26.92it/s] 10%|█         | 21/204 [00:00<00:04, 45.49it/s] 15%|█▌        | 31/204 [00:00<00:02, 59.16it/s] 20%|██        | 41/204 [00:00<00:02, 68.71it/s] 25%|██▍       | 50/204 [00:00<00:02, 74.58it/s] 29%|██▉       | 60/204 [00:01<00:01, 79.48it/s] 34%|███▍      | 69/204 [00:01<00:01, 82.43it/s] 39%|███▊      | 79/204 [00:01<00:01, 84.80it/s] 43%|████▎     | 88/204 [00:01<00:01, 85.44it/s] 48%|████▊     | 97/204 [00:01<00:01, 86.46it/s] 52%|█████▏    | 106/204 [00:01<00:01, 87.35it/s] 57%|█████▋    | 116/204 [00:01<00:01, 87.72it/s] 61%|██████▏   | 125/204 [00:01<00:00, 87.37it/s] 66%|██████▌   | 134/204 [00:01<00:00, 88.10it/s] 70%|███████   | 143/204 [00:01<00:00, 88.15it/s] 75%|███████▍  | 152/204 [00:02<00:00, 88.19it/s] 79%|███████▉  | 162/204 [00:02<00:00, 89.01it/s] 84%|████████▍ | 171/204 [00:02<00:00, 89.23it/s] 89%|████████▊ | 181/204 [00:02<00:00, 89.66it/s] 93%|█████████▎| 190/204 [00:02<00:00, 89.75it/s] 98%|█████████▊| 200/204 [00:02<00:00, 91.04it/s]100%|██████████| 204/204 [00:02<00:00, 76.35it/s]
26032 images processed, 2.7231547832489014 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:45,  1.71it/s] 11%|█▏        | 9/79 [00:00<00:04, 15.18it/s] 22%|██▏       | 17/79 [00:00<00:02, 25.05it/s] 32%|███▏      | 25/79 [00:01<00:01, 32.55it/s] 42%|████▏     | 33/79 [00:01<00:01, 38.32it/s] 49%|████▉     | 39/79 [00:01<00:00, 42.86it/s] 57%|█████▋    | 45/79 [00:01<00:00, 41.35it/s] 66%|██████▌   | 52/79 [00:01<00:00, 41.24it/s] 72%|███████▏  | 57/79 [00:01<00:00, 42.05it/s] 81%|████████  | 64/79 [00:01<00:00, 48.08it/s] 89%|████████▊ | 70/79 [00:02<00:00, 44.94it/s] 95%|█████████▍| 75/79 [00:02<00:00, 44.51it/s]100%|██████████| 79/79 [00:02<00:00, 35.93it/s]
10000 images processed, 2.2403011322021484 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:27,  2.85it/s] 14%|█▍        | 11/79 [00:00<00:02, 30.43it/s] 27%|██▋       | 21/79 [00:00<00:01, 49.31it/s] 39%|███▉      | 31/79 [00:00<00:00, 62.77it/s] 52%|█████▏    | 41/79 [00:00<00:00, 72.33it/s] 65%|██████▍   | 51/79 [00:00<00:00, 79.00it/s] 77%|███████▋  | 61/79 [00:00<00:00, 83.75it/s] 90%|████████▉ | 71/79 [00:01<00:00, 87.36it/s]100%|██████████| 79/79 [00:01<00:00, 67.57it/s]
10000 images processed, 1.1929433345794678 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:29,  2.31it/s] 16%|█▌        | 11/70 [00:00<00:02, 26.10it/s] 30%|███       | 21/70 [00:00<00:01, 44.53it/s] 44%|████▍     | 31/70 [00:00<00:00, 58.46it/s] 59%|█████▊    | 41/70 [00:00<00:00, 68.75it/s] 73%|███████▎  | 51/70 [00:00<00:00, 76.24it/s] 87%|████████▋ | 61/70 [00:01<00:00, 81.83it/s]100%|██████████| 70/70 [00:01<00:00, 59.95it/s]
8925 images processed, 1.2015094757080078 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:01<00:44,  1.02s/it]  4%|▍         | 2/45 [00:01<00:20,  2.06it/s] 20%|██        | 9/45 [00:01<00:04,  8.80it/s] 24%|██▍       | 11/45 [00:01<00:03,  8.84it/s] 31%|███       | 14/45 [00:01<00:02, 11.45it/s] 38%|███▊      | 17/45 [00:02<00:02, 11.78it/s] 42%|████▏     | 19/45 [00:02<00:02, 11.79it/s] 49%|████▉     | 22/45 [00:02<00:01, 12.62it/s] 56%|█████▌    | 25/45 [00:02<00:01, 13.80it/s] 60%|██████    | 27/45 [00:02<00:01, 13.05it/s] 67%|██████▋   | 30/45 [00:03<00:01, 12.44it/s] 73%|███████▎  | 33/45 [00:03<00:01, 11.29it/s] 78%|███████▊  | 35/45 [00:03<00:00, 11.44it/s] 87%|████████▋ | 39/45 [00:03<00:00, 16.01it/s] 93%|█████████▎| 42/45 [00:04<00:00,  9.04it/s]100%|██████████| 45/45 [00:04<00:00, 10.34it/s]
5640 images processed, 4.377716779708862 seconds used

19.59361171722412
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           4.74  98.97
places365     77.69  78.33
LSUN          30.41  94.35
iSUN          80.65  78.59
dtd           46.83  89.54
AVG           48.06  87.96
Retain-Acc: 0.7397
Forget-as-OOD (retain known vs forget novel):
  FPR: 54.10 AUROC: 89.18 AUIN: 98.62
26.474879264831543
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e5-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid
epochs=5 | cache=6 | flambda=0.2 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21843904
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<02:33,  2.55it/s]  2%|▏         | 6/391 [00:00<00:25, 15.08it/s]  3%|▎         | 12/391 [00:00<00:14, 26.39it/s]  5%|▍         | 19/391 [00:00<00:09, 37.42it/s]  7%|▋         | 28/391 [00:00<00:07, 51.63it/s]  9%|▉         | 37/391 [00:00<00:05, 60.96it/s] 12%|█▏        | 45/391 [00:01<00:06, 50.63it/s] 13%|█▎        | 51/391 [00:01<00:07, 46.45it/s] 15%|█▍        | 58/391 [00:01<00:06, 51.80it/s] 17%|█▋        | 67/391 [00:01<00:05, 59.80it/s] 19%|█▉        | 74/391 [00:01<00:05, 60.33it/s] 21%|██        | 81/391 [00:01<00:05, 60.24it/s] 23%|██▎       | 88/391 [00:01<00:05, 56.47it/s] 24%|██▍       | 94/391 [00:01<00:05, 55.99it/s] 26%|██▌       | 100/391 [00:02<00:05, 51.14it/s] 27%|██▋       | 106/391 [00:02<00:05, 51.30it/s] 29%|██▉       | 115/391 [00:02<00:04, 60.29it/s] 31%|███▏      | 123/391 [00:02<00:04, 65.50it/s] 33%|███▎      | 130/391 [00:02<00:04, 52.89it/s] 35%|███▍      | 136/391 [00:02<00:05, 49.02it/s] 37%|███▋      | 143/391 [00:02<00:04, 52.66it/s] 38%|███▊      | 150/391 [00:03<00:04, 56.23it/s] 40%|████      | 157/391 [00:03<00:04, 58.08it/s] 42%|████▏     | 165/391 [00:03<00:03, 62.78it/s] 44%|████▍     | 173/391 [00:03<00:03, 63.98it/s] 46%|████▌     | 180/391 [00:03<00:03, 55.91it/s] 48%|████▊     | 186/391 [00:03<00:04, 50.25it/s] 49%|████▉     | 193/391 [00:03<00:03, 54.07it/s] 51%|█████▏    | 201/391 [00:03<00:03, 59.85it/s] 53%|█████▎    | 208/391 [00:03<00:03, 60.22it/s] 55%|█████▍    | 215/391 [00:04<00:03, 52.00it/s] 57%|█████▋    | 221/391 [00:04<00:03, 51.79it/s] 58%|█████▊    | 227/391 [00:04<00:03, 51.54it/s] 60%|█████▉    | 234/391 [00:04<00:02, 54.76it/s] 61%|██████▏   | 240/391 [00:04<00:02, 54.98it/s] 64%|██████▎   | 249/391 [00:04<00:02, 63.76it/s] 65%|██████▌   | 256/391 [00:04<00:02, 64.82it/s] 67%|██████▋   | 263/391 [00:05<00:02, 52.90it/s] 69%|██████▉   | 269/391 [00:05<00:02, 48.51it/s] 71%|███████   | 276/391 [00:05<00:02, 53.29it/s] 73%|███████▎  | 284/391 [00:05<00:01, 58.92it/s] 74%|███████▍  | 291/391 [00:05<00:01, 59.81it/s] 76%|███████▌  | 298/391 [00:05<00:01, 57.90it/s] 78%|███████▊  | 304/391 [00:05<00:01, 53.67it/s] 79%|███████▉  | 310/391 [00:05<00:01, 48.68it/s] 81%|████████  | 316/391 [00:06<00:01, 49.39it/s] 83%|████████▎ | 325/391 [00:06<00:01, 58.33it/s] 85%|████████▌ | 334/391 [00:06<00:00, 65.28it/s] 87%|████████▋ | 342/391 [00:06<00:00, 68.32it/s] 90%|████████▉ | 350/391 [00:06<00:00, 59.45it/s] 91%|█████████▏| 357/391 [00:06<00:00, 53.84it/s] 93%|█████████▎| 363/391 [00:06<00:00, 52.60it/s] 95%|█████████▍| 371/391 [00:06<00:00, 58.31it/s] 97%|█████████▋| 378/391 [00:07<00:00, 59.12it/s] 99%|█████████▊| 386/391 [00:07<00:00, 63.32it/s]100%|██████████| 391/391 [00:07<00:00, 54.24it/s]
50000 images processed, 7.2942283153533936 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:23,  3.34it/s]  8%|▊         | 6/79 [00:00<00:04, 18.16it/s] 14%|█▍        | 11/79 [00:00<00:02, 28.12it/s] 22%|██▏       | 17/79 [00:00<00:01, 36.80it/s] 30%|███       | 24/79 [00:00<00:01, 45.46it/s] 42%|████▏     | 33/79 [00:00<00:00, 57.34it/s] 52%|█████▏    | 41/79 [00:00<00:00, 63.73it/s] 61%|██████    | 48/79 [00:01<00:00, 56.05it/s] 70%|██████▉   | 55/79 [00:01<00:00, 50.31it/s] 77%|███████▋  | 61/79 [00:01<00:00, 50.48it/s] 89%|████████▊ | 70/79 [00:01<00:00, 59.90it/s]100%|██████████| 79/79 [00:01<00:00, 64.77it/s]100%|██████████| 79/79 [00:01<00:00, 49.41it/s]
10000 images processed, 1.623887300491333 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:06,  3.04it/s]  3%|▎         | 7/204 [00:00<00:10, 19.19it/s]  6%|▌         | 12/204 [00:00<00:07, 26.11it/s]  8%|▊         | 17/204 [00:00<00:06, 30.09it/s] 11%|█         | 22/204 [00:00<00:05, 34.34it/s] 15%|█▌        | 31/204 [00:00<00:03, 47.49it/s] 19%|█▉        | 39/204 [00:01<00:03, 54.57it/s] 22%|██▏       | 45/204 [00:01<00:02, 54.45it/s] 25%|██▌       | 51/204 [00:01<00:03, 47.79it/s] 28%|██▊       | 57/204 [00:01<00:02, 49.57it/s] 31%|███       | 63/204 [00:01<00:02, 48.54it/s] 34%|███▍      | 69/204 [00:01<00:02, 50.38it/s] 38%|███▊      | 78/204 [00:01<00:02, 58.63it/s] 42%|████▏     | 86/204 [00:01<00:01, 64.22it/s] 46%|████▌     | 93/204 [00:02<00:02, 51.92it/s] 49%|████▊     | 99/204 [00:02<00:02, 46.85it/s] 52%|█████▏    | 107/204 [00:02<00:01, 52.92it/s] 57%|█████▋    | 116/204 [00:02<00:01, 60.58it/s] 60%|██████    | 123/204 [00:02<00:01, 52.44it/s] 63%|██████▎   | 129/204 [00:02<00:01, 47.61it/s] 66%|██████▌   | 135/204 [00:02<00:01, 49.97it/s] 70%|███████   | 143/204 [00:03<00:01, 56.73it/s] 74%|███████▍  | 151/204 [00:03<00:00, 62.07it/s] 77%|███████▋  | 158/204 [00:03<00:00, 55.00it/s] 80%|████████  | 164/204 [00:03<00:00, 49.58it/s] 83%|████████▎ | 170/204 [00:03<00:00, 51.81it/s] 87%|████████▋ | 177/204 [00:03<00:00, 53.39it/s] 90%|████████▉ | 183/204 [00:03<00:00, 49.29it/s] 93%|█████████▎| 189/204 [00:03<00:00, 50.69it/s] 97%|█████████▋| 198/204 [00:04<00:00, 60.51it/s]100%|██████████| 204/204 [00:04<00:00, 49.94it/s]
26032 images processed, 4.134718179702759 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:38,  2.03it/s] 11%|█▏        | 9/79 [00:00<00:03, 18.28it/s] 18%|█▊        | 14/79 [00:00<00:02, 24.86it/s] 24%|██▍       | 19/79 [00:00<00:02, 27.90it/s] 32%|███▏      | 25/79 [00:01<00:01, 33.55it/s] 39%|███▉      | 31/79 [00:01<00:01, 39.19it/s] 46%|████▌     | 36/79 [00:01<00:01, 38.74it/s] 54%|█████▍    | 43/79 [00:01<00:00, 42.23it/s] 61%|██████    | 48/79 [00:01<00:00, 41.49it/s] 67%|██████▋   | 53/79 [00:01<00:00, 40.50it/s] 75%|███████▍  | 59/79 [00:01<00:00, 43.77it/s] 86%|████████▌ | 68/79 [00:01<00:00, 54.75it/s] 95%|█████████▍| 75/79 [00:02<00:00, 53.68it/s]100%|██████████| 79/79 [00:02<00:00, 37.54it/s]
10000 images processed, 2.1381101608276367 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:35,  2.21it/s]  8%|▊         | 6/79 [00:00<00:05, 13.36it/s] 16%|█▋        | 13/79 [00:00<00:02, 26.84it/s] 24%|██▍       | 19/79 [00:00<00:01, 34.29it/s] 35%|███▌      | 28/79 [00:00<00:01, 47.83it/s] 44%|████▍     | 35/79 [00:00<00:00, 53.31it/s] 53%|█████▎    | 42/79 [00:01<00:00, 50.83it/s] 61%|██████    | 48/79 [00:01<00:00, 47.18it/s] 70%|██████▉   | 55/79 [00:01<00:00, 50.89it/s] 77%|███████▋  | 61/79 [00:01<00:00, 51.25it/s] 86%|████████▌ | 68/79 [00:01<00:00, 54.57it/s] 97%|█████████▋| 77/79 [00:01<00:00, 63.83it/s]100%|██████████| 79/79 [00:01<00:00, 45.01it/s]
10000 images processed, 1.7759215831756592 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:25,  2.74it/s]  7%|▋         | 5/70 [00:00<00:05, 12.88it/s] 17%|█▋        | 12/70 [00:00<00:02, 27.85it/s] 29%|██▊       | 20/70 [00:00<00:01, 41.94it/s] 40%|████      | 28/70 [00:00<00:00, 52.43it/s] 50%|█████     | 35/70 [00:00<00:00, 51.86it/s] 59%|█████▊    | 41/70 [00:01<00:00, 45.54it/s] 67%|██████▋   | 47/70 [00:01<00:00, 45.05it/s] 80%|████████  | 56/70 [00:01<00:00, 55.03it/s] 93%|█████████▎| 65/70 [00:01<00:00, 63.62it/s]100%|██████████| 70/70 [00:01<00:00, 46.35it/s]
8925 images processed, 1.5422775745391846 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:00<00:40,  1.09it/s]  4%|▍         | 2/45 [00:01<00:19,  2.18it/s] 16%|█▌        | 7/45 [00:01<00:04,  9.32it/s] 22%|██▏       | 10/45 [00:01<00:04,  7.85it/s] 31%|███       | 14/45 [00:01<00:02, 11.78it/s] 38%|███▊      | 17/45 [00:01<00:02, 13.64it/s] 44%|████▍     | 20/45 [00:02<00:01, 12.89it/s] 49%|████▉     | 22/45 [00:02<00:01, 12.53it/s] 53%|█████▎    | 24/45 [00:02<00:01, 12.80it/s] 58%|█████▊    | 26/45 [00:02<00:01, 11.98it/s] 64%|██████▍   | 29/45 [00:02<00:01, 13.64it/s] 71%|███████   | 32/45 [00:02<00:00, 15.57it/s] 76%|███████▌  | 34/45 [00:03<00:01, 10.17it/s] 84%|████████▍ | 38/45 [00:03<00:00, 14.64it/s] 91%|█████████ | 41/45 [00:03<00:00, 15.40it/s] 98%|█████████▊| 44/45 [00:04<00:00, 10.82it/s]100%|██████████| 45/45 [00:04<00:00, 10.83it/s]
5640 images processed, 4.1789305210113525 seconds used

24.431737661361694
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.53  99.36
places365     67.87  81.18
LSUN          17.60  96.07
iSUN          72.34  81.68
dtd           37.85  91.39
AVG           39.64  89.93
Retain-Acc: 0.7407
Forget-as-OOD (retain known vs forget novel):
  FPR: 79.50 AUROC: 86.90 AUIN: 98.36
21.89956045150757
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e10-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid
epochs=10 | cache=6 | flambda=0.2 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e10-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e10-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e10-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21843904
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<02:42,  2.40it/s]  2%|▏         | 8/391 [00:00<00:19, 19.28it/s]  4%|▎         | 14/391 [00:00<00:12, 29.34it/s]  6%|▌         | 23/391 [00:00<00:08, 43.66it/s]  8%|▊         | 30/391 [00:00<00:07, 49.12it/s] 10%|▉         | 38/391 [00:00<00:06, 55.93it/s] 12%|█▏        | 47/391 [00:01<00:05, 64.76it/s] 14%|█▍        | 55/391 [00:01<00:05, 61.85it/s] 16%|█▌        | 62/391 [00:01<00:05, 57.23it/s] 18%|█▊        | 69/391 [00:01<00:06, 53.05it/s] 19%|█▉        | 75/391 [00:01<00:05, 53.64it/s] 21%|██▏       | 84/391 [00:01<00:04, 61.59it/s] 24%|██▎       | 92/391 [00:01<00:04, 66.31it/s] 25%|██▌       | 99/391 [00:01<00:04, 65.92it/s] 27%|██▋       | 106/391 [00:02<00:05, 55.98it/s] 29%|██▊       | 112/391 [00:02<00:05, 49.96it/s] 31%|███       | 120/391 [00:02<00:04, 56.29it/s] 33%|███▎      | 129/391 [00:02<00:04, 63.25it/s] 35%|███▌      | 138/391 [00:02<00:03, 67.28it/s] 37%|███▋      | 145/391 [00:02<00:03, 65.69it/s] 39%|███▉      | 153/391 [00:02<00:03, 66.46it/s] 41%|████      | 160/391 [00:02<00:03, 58.53it/s] 43%|████▎     | 167/391 [00:03<00:03, 56.82it/s] 45%|████▍     | 175/391 [00:03<00:03, 61.01it/s] 47%|████▋     | 182/391 [00:03<00:03, 60.79it/s] 48%|████▊     | 189/391 [00:03<00:03, 62.99it/s] 51%|█████     | 198/391 [00:03<00:02, 70.00it/s] 53%|█████▎    | 207/391 [00:03<00:02, 74.78it/s] 55%|█████▍    | 215/391 [00:03<00:02, 72.68it/s] 57%|█████▋    | 223/391 [00:03<00:02, 56.41it/s] 59%|█████▉    | 230/391 [00:04<00:03, 47.58it/s] 61%|██████    | 239/391 [00:04<00:02, 55.52it/s] 63%|██████▎   | 246/391 [00:04<00:02, 58.61it/s] 65%|██████▌   | 255/391 [00:04<00:02, 63.22it/s] 67%|██████▋   | 262/391 [00:04<00:02, 55.88it/s] 69%|██████▉   | 269/391 [00:04<00:02, 51.04it/s] 71%|███████   | 276/391 [00:04<00:02, 54.33it/s] 73%|███████▎  | 285/391 [00:05<00:01, 62.40it/s] 75%|███████▌  | 294/391 [00:05<00:01, 68.11it/s] 77%|███████▋  | 303/391 [00:05<00:01, 71.08it/s] 80%|███████▉  | 311/391 [00:05<00:01, 57.42it/s] 81%|████████▏ | 318/391 [00:05<00:01, 51.63it/s] 84%|████████▎ | 327/391 [00:05<00:01, 58.69it/s] 86%|████████▌ | 335/391 [00:05<00:00, 63.14it/s] 87%|████████▋ | 342/391 [00:05<00:00, 63.94it/s] 89%|████████▉ | 349/391 [00:06<00:00, 57.93it/s] 91%|█████████ | 356/391 [00:06<00:00, 54.13it/s] 93%|█████████▎| 362/391 [00:06<00:00, 54.20it/s] 94%|█████████▍| 368/391 [00:06<00:00, 54.00it/s] 96%|█████████▌| 374/391 [00:06<00:00, 55.04it/s] 98%|█████████▊| 383/391 [00:06<00:00, 64.03it/s]100%|██████████| 391/391 [00:06<00:00, 57.33it/s]
50000 images processed, 6.894423007965088 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:24,  3.13it/s]  6%|▋         | 5/79 [00:00<00:05, 14.43it/s] 15%|█▌        | 12/79 [00:00<00:02, 30.66it/s] 27%|██▋       | 21/79 [00:00<00:01, 47.97it/s] 38%|███▊      | 30/79 [00:00<00:00, 60.22it/s] 49%|████▉     | 39/79 [00:00<00:00, 68.84it/s] 59%|█████▉    | 47/79 [00:00<00:00, 71.01it/s] 70%|██████▉   | 55/79 [00:01<00:00, 55.38it/s] 78%|███████▊  | 62/79 [00:01<00:00, 53.10it/s] 89%|████████▊ | 70/79 [00:01<00:00, 58.29it/s]100%|██████████| 79/79 [00:01<00:00, 64.76it/s]100%|██████████| 79/79 [00:01<00:00, 52.15it/s]
10000 images processed, 1.5354583263397217 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:05,  3.11it/s]  3%|▎         | 6/204 [00:00<00:11, 17.07it/s]  5%|▌         | 11/204 [00:00<00:07, 26.02it/s]  8%|▊         | 17/204 [00:00<00:05, 33.96it/s] 12%|█▏        | 24/204 [00:00<00:04, 43.47it/s] 15%|█▌        | 31/204 [00:00<00:03, 48.95it/s] 20%|█▉        | 40/204 [00:00<00:02, 58.90it/s] 23%|██▎       | 47/204 [00:01<00:02, 60.15it/s] 26%|██▋       | 54/204 [00:01<00:02, 52.95it/s] 29%|██▉       | 60/204 [00:01<00:03, 47.79it/s] 32%|███▏      | 66/204 [00:01<00:02, 50.23it/s] 37%|███▋      | 75/204 [00:01<00:02, 59.03it/s] 41%|████      | 83/204 [00:01<00:01, 64.48it/s] 44%|████▍     | 90/204 [00:01<00:02, 55.27it/s] 47%|████▋     | 96/204 [00:02<00:02, 49.05it/s] 50%|█████     | 102/204 [00:02<00:02, 50.41it/s] 54%|█████▍    | 110/204 [00:02<00:01, 57.21it/s] 58%|█████▊    | 118/204 [00:02<00:01, 61.28it/s] 61%|██████▏   | 125/204 [00:02<00:01, 61.26it/s] 65%|██████▍   | 132/204 [00:02<00:01, 61.17it/s] 68%|██████▊   | 139/204 [00:02<00:01, 54.43it/s] 71%|███████   | 145/204 [00:02<00:01, 53.45it/s] 75%|███████▍  | 152/204 [00:03<00:00, 55.78it/s] 77%|███████▋  | 158/204 [00:03<00:00, 56.75it/s] 82%|████████▏ | 167/204 [00:03<00:00, 65.15it/s] 86%|████████▌ | 175/204 [00:03<00:00, 66.37it/s] 89%|████████▉ | 182/204 [00:03<00:00, 56.95it/s] 92%|█████████▏| 188/204 [00:03<00:00, 50.34it/s] 95%|█████████▌| 194/204 [00:03<00:00, 52.20it/s]100%|█████████▉| 203/204 [00:03<00:00, 61.00it/s]100%|██████████| 204/204 [00:03<00:00, 52.43it/s]
26032 images processed, 3.9325106143951416 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:44,  1.74it/s]  8%|▊         | 6/79 [00:00<00:06, 11.31it/s] 16%|█▋        | 13/79 [00:00<00:02, 23.51it/s] 23%|██▎       | 18/79 [00:00<00:02, 27.15it/s] 29%|██▉       | 23/79 [00:01<00:01, 30.38it/s] 37%|███▋      | 29/79 [00:01<00:01, 36.54it/s] 43%|████▎     | 34/79 [00:01<00:01, 37.33it/s] 52%|█████▏    | 41/79 [00:01<00:00, 43.97it/s] 59%|█████▉    | 47/79 [00:01<00:00, 46.78it/s] 67%|██████▋   | 53/79 [00:01<00:00, 41.48it/s] 73%|███████▎  | 58/79 [00:01<00:00, 42.73it/s] 82%|████████▏ | 65/79 [00:01<00:00, 49.12it/s] 90%|████████▉ | 71/79 [00:02<00:00, 48.00it/s] 97%|█████████▋| 77/79 [00:02<00:00, 48.54it/s]100%|██████████| 79/79 [00:02<00:00, 35.91it/s]
10000 images processed, 2.246067762374878 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:28,  2.74it/s]  9%|▉         | 7/79 [00:00<00:04, 17.62it/s] 18%|█▊        | 14/79 [00:00<00:02, 31.40it/s] 28%|██▊       | 22/79 [00:00<00:01, 44.72it/s] 35%|███▌      | 28/79 [00:00<00:01, 48.18it/s] 44%|████▍     | 35/79 [00:00<00:00, 54.37it/s] 56%|█████▌    | 44/79 [00:01<00:00, 63.13it/s] 65%|██████▍   | 51/79 [00:01<00:00, 53.45it/s] 72%|███████▏  | 57/79 [00:01<00:00, 47.53it/s] 81%|████████  | 64/79 [00:01<00:00, 51.60it/s] 92%|█████████▏| 73/79 [00:01<00:00, 60.92it/s]100%|██████████| 79/79 [00:01<00:00, 48.68it/s]
10000 images processed, 1.6471202373504639 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:27,  2.47it/s] 14%|█▍        | 10/70 [00:00<00:02, 24.52it/s] 23%|██▎       | 16/70 [00:00<00:01, 33.50it/s] 31%|███▏      | 22/70 [00:00<00:01, 40.45it/s] 41%|████▏     | 29/70 [00:00<00:00, 48.01it/s] 50%|█████     | 35/70 [00:00<00:00, 45.36it/s] 59%|█████▊    | 41/70 [00:01<00:00, 46.49it/s] 67%|██████▋   | 47/70 [00:01<00:00, 48.88it/s] 77%|███████▋  | 54/70 [00:01<00:00, 53.67it/s] 90%|█████████ | 63/70 [00:01<00:00, 63.22it/s]100%|██████████| 70/70 [00:01<00:00, 46.73it/s]
8925 images processed, 1.5298631191253662 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:00<00:40,  1.08it/s]  4%|▍         | 2/45 [00:01<00:20,  2.13it/s] 18%|█▊        | 8/45 [00:01<00:03, 10.64it/s] 24%|██▍       | 11/45 [00:01<00:03,  8.68it/s] 31%|███       | 14/45 [00:01<00:02, 11.43it/s] 38%|███▊      | 17/45 [00:01<00:02, 12.30it/s] 42%|████▏     | 19/45 [00:02<00:02, 12.17it/s] 49%|████▉     | 22/45 [00:02<00:01, 12.93it/s] 56%|█████▌    | 25/45 [00:02<00:01, 14.43it/s] 60%|██████    | 27/45 [00:02<00:01, 12.14it/s] 67%|██████▋   | 30/45 [00:02<00:01, 14.83it/s] 71%|███████   | 32/45 [00:03<00:01, 12.84it/s] 76%|███████▌  | 34/45 [00:03<00:01,  9.23it/s] 87%|████████▋ | 39/45 [00:03<00:00, 14.04it/s] 91%|█████████ | 41/45 [00:03<00:00, 13.98it/s] 96%|█████████▌| 43/45 [00:04<00:00,  9.22it/s]100%|██████████| 45/45 [00:04<00:00, 10.54it/s]
5640 images processed, 4.297572374343872 seconds used

23.769015073776245
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.52  99.36
places365     67.86  81.18
LSUN          17.59  96.07
iSUN          72.34  81.68
dtd           37.85  91.39
AVG           39.63  89.94
Retain-Acc: 0.7407
Forget-as-OOD (retain known vs forget novel):
  FPR: 79.50 AUROC: 86.90 AUIN: 98.36
28.233821392059326
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e20-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid
epochs=20 | cache=6 | flambda=0.2 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e20-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e20-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e20-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21843904
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<03:13,  2.02it/s]  2%|▏         | 6/391 [00:00<00:30, 12.49it/s]  3%|▎         | 11/391 [00:00<00:18, 20.52it/s]  4%|▍         | 17/391 [00:00<00:12, 29.71it/s]  6%|▋         | 25/391 [00:00<00:08, 42.23it/s]  9%|▊         | 34/391 [00:01<00:06, 53.84it/s] 10%|█         | 41/391 [00:01<00:06, 55.30it/s] 12%|█▏        | 48/391 [00:01<00:06, 50.87it/s] 14%|█▍        | 54/391 [00:01<00:07, 48.05it/s] 16%|█▌        | 61/391 [00:01<00:06, 52.16it/s] 18%|█▊        | 69/391 [00:01<00:05, 58.67it/s] 20%|█▉        | 78/391 [00:01<00:04, 65.22it/s] 22%|██▏       | 85/391 [00:01<00:05, 61.10it/s] 24%|██▎       | 92/391 [00:02<00:05, 51.40it/s] 25%|██▌       | 98/391 [00:02<00:05, 49.36it/s] 27%|██▋       | 106/391 [00:02<00:05, 55.45it/s] 29%|██▉       | 115/391 [00:02<00:04, 62.70it/s] 31%|███       | 122/391 [00:02<00:04, 60.31it/s] 33%|███▎      | 129/391 [00:02<00:05, 52.28it/s] 35%|███▍      | 135/391 [00:02<00:05, 48.43it/s] 37%|███▋      | 144/391 [00:03<00:04, 57.41it/s] 39%|███▉      | 153/391 [00:03<00:03, 63.85it/s] 41%|████▏     | 162/391 [00:03<00:03, 70.08it/s] 43%|████▎     | 170/391 [00:03<00:03, 67.50it/s] 46%|████▌     | 178/391 [00:03<00:03, 59.33it/s] 47%|████▋     | 185/391 [00:03<00:03, 53.49it/s] 49%|████▉     | 193/391 [00:03<00:03, 59.00it/s] 52%|█████▏    | 202/391 [00:03<00:02, 65.82it/s] 54%|█████▍    | 211/391 [00:04<00:02, 68.64it/s] 56%|█████▌    | 219/391 [00:04<00:02, 63.60it/s] 58%|█████▊    | 226/391 [00:04<00:02, 55.86it/s] 59%|█████▉    | 232/391 [00:04<00:03, 52.24it/s] 61%|██████▏   | 240/391 [00:04<00:02, 58.60it/s] 64%|██████▎   | 249/391 [00:04<00:02, 64.49it/s] 66%|██████▌   | 258/391 [00:04<00:01, 69.10it/s] 68%|██████▊   | 266/391 [00:04<00:01, 64.54it/s] 70%|██████▉   | 273/391 [00:05<00:01, 61.07it/s] 72%|███████▏  | 280/391 [00:05<00:02, 54.64it/s] 73%|███████▎  | 287/391 [00:05<00:01, 56.79it/s] 76%|███████▌  | 296/391 [00:05<00:01, 64.18it/s] 77%|███████▋  | 303/391 [00:05<00:01, 64.91it/s] 79%|███████▉  | 310/391 [00:05<00:01, 57.90it/s] 81%|████████  | 317/391 [00:05<00:01, 56.59it/s] 83%|████████▎ | 323/391 [00:05<00:01, 54.18it/s] 84%|████████▍ | 330/391 [00:06<00:01, 56.28it/s] 86%|████████▋ | 338/391 [00:06<00:00, 61.95it/s] 88%|████████▊ | 346/391 [00:06<00:00, 66.26it/s] 90%|█████████ | 353/391 [00:06<00:00, 60.27it/s] 92%|█████████▏| 360/391 [00:06<00:00, 56.64it/s] 94%|█████████▎| 366/391 [00:06<00:00, 56.71it/s] 95%|█████████▌| 372/391 [00:06<00:00, 57.51it/s] 97%|█████████▋| 379/391 [00:06<00:00, 59.94it/s] 99%|█████████▉| 388/391 [00:06<00:00, 67.96it/s]100%|██████████| 391/391 [00:07<00:00, 55.49it/s]
50000 images processed, 7.170455455780029 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:37,  2.05it/s] 10%|█         | 8/79 [00:00<00:04, 17.31it/s] 18%|█▊        | 14/79 [00:00<00:02, 27.37it/s] 29%|██▉       | 23/79 [00:00<00:01, 42.50it/s] 39%|███▉      | 31/79 [00:00<00:00, 51.51it/s] 48%|████▊     | 38/79 [00:01<00:00, 53.97it/s] 57%|█████▋    | 45/79 [00:01<00:00, 52.68it/s] 65%|██████▍   | 51/79 [00:01<00:00, 50.36it/s] 75%|███████▍  | 59/79 [00:01<00:00, 54.39it/s] 82%|████████▏ | 65/79 [00:01<00:00, 52.91it/s] 91%|█████████ | 72/79 [00:01<00:00, 56.47it/s]100%|██████████| 79/79 [00:01<00:00, 45.52it/s]
10000 images processed, 1.7599456310272217 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:09,  2.91it/s]  3%|▎         | 6/204 [00:00<00:12, 16.14it/s]  6%|▋         | 13/204 [00:00<00:06, 30.59it/s] 10%|▉         | 20/204 [00:00<00:04, 40.14it/s] 14%|█▍        | 29/204 [00:00<00:03, 52.66it/s] 18%|█▊        | 36/204 [00:00<00:02, 57.29it/s] 21%|██        | 43/204 [00:01<00:03, 51.17it/s] 24%|██▍       | 49/204 [00:01<00:03, 48.04it/s] 27%|██▋       | 56/204 [00:01<00:02, 52.05it/s] 31%|███       | 63/204 [00:01<00:02, 56.31it/s] 35%|███▌      | 72/204 [00:01<00:02, 64.61it/s] 39%|███▉      | 80/204 [00:01<00:01, 68.65it/s] 43%|████▎     | 88/204 [00:01<00:02, 56.85it/s] 47%|████▋     | 95/204 [00:02<00:02, 49.26it/s] 50%|█████     | 103/204 [00:02<00:01, 55.84it/s] 55%|█████▍    | 112/204 [00:02<00:01, 63.48it/s] 59%|█████▉    | 121/204 [00:02<00:01, 69.03it/s] 64%|██████▎   | 130/204 [00:02<00:01, 71.35it/s] 68%|██████▊   | 138/204 [00:02<00:01, 55.72it/s] 71%|███████   | 145/204 [00:02<00:01, 51.68it/s] 75%|███████▌  | 154/204 [00:02<00:00, 59.09it/s] 80%|███████▉  | 163/204 [00:03<00:00, 65.51it/s] 84%|████████▍ | 172/204 [00:03<00:00, 69.09it/s] 88%|████████▊ | 180/204 [00:03<00:00, 53.18it/s] 92%|█████████▏| 187/204 [00:03<00:00, 51.12it/s] 96%|█████████▌| 196/204 [00:03<00:00, 59.12it/s]100%|██████████| 204/204 [00:03<00:00, 54.62it/s]
26032 images processed, 3.7993826866149902 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:46,  1.66it/s]  6%|▋         | 5/79 [00:00<00:08,  8.66it/s] 13%|█▎        | 10/79 [00:00<00:04, 16.72it/s] 19%|█▉        | 15/79 [00:00<00:02, 23.83it/s] 30%|███       | 24/79 [00:01<00:01, 39.11it/s] 38%|███▊      | 30/79 [00:01<00:01, 36.02it/s] 44%|████▍     | 35/79 [00:01<00:01, 37.12it/s] 51%|█████     | 40/79 [00:01<00:01, 37.67it/s] 62%|██████▏   | 49/79 [00:01<00:00, 43.46it/s] 68%|██████▊   | 54/79 [00:01<00:00, 42.86it/s] 75%|███████▍  | 59/79 [00:01<00:00, 43.54it/s] 81%|████████  | 64/79 [00:02<00:00, 43.52it/s] 90%|████████▉ | 71/79 [00:02<00:00, 48.28it/s] 97%|█████████▋| 77/79 [00:02<00:00, 51.08it/s]100%|██████████| 79/79 [00:02<00:00, 35.27it/s]
10000 images processed, 2.2770190238952637 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:28,  2.71it/s]  8%|▊         | 6/79 [00:00<00:04, 15.09it/s] 15%|█▌        | 12/79 [00:00<00:02, 26.65it/s] 22%|██▏       | 17/79 [00:00<00:01, 32.84it/s] 28%|██▊       | 22/79 [00:00<00:01, 37.54it/s] 35%|███▌      | 28/79 [00:00<00:01, 43.21it/s] 47%|████▋     | 37/79 [00:01<00:00, 55.72it/s] 57%|█████▋    | 45/79 [00:01<00:00, 62.15it/s] 66%|██████▌   | 52/79 [00:01<00:00, 58.35it/s] 75%|███████▍  | 59/79 [00:01<00:00, 55.97it/s] 82%|████████▏ | 65/79 [00:01<00:00, 50.47it/s] 91%|█████████ | 72/79 [00:01<00:00, 54.73it/s]100%|██████████| 79/79 [00:01<00:00, 46.05it/s]
10000 images processed, 1.7378883361816406 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:27,  2.53it/s]  6%|▌         | 4/70 [00:00<00:06,  9.52it/s] 13%|█▎        | 9/70 [00:00<00:03, 20.20it/s] 20%|██        | 14/70 [00:00<00:01, 28.27it/s] 33%|███▎      | 23/70 [00:00<00:01, 43.80it/s] 41%|████▏     | 29/70 [00:00<00:00, 47.62it/s] 51%|█████▏    | 36/70 [00:01<00:00, 52.98it/s] 64%|██████▍   | 45/70 [00:01<00:00, 60.24it/s] 74%|███████▍  | 52/70 [00:01<00:00, 52.37it/s] 83%|████████▎ | 58/70 [00:01<00:00, 51.31it/s] 94%|█████████▍| 66/70 [00:01<00:00, 57.16it/s]100%|██████████| 70/70 [00:01<00:00, 42.91it/s]
8925 images processed, 1.6688308715820312 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:00<00:40,  1.09it/s]  4%|▍         | 2/45 [00:01<00:18,  2.28it/s] 20%|██        | 9/45 [00:01<00:03,  9.41it/s] 24%|██▍       | 11/45 [00:01<00:03,  9.80it/s] 31%|███       | 14/45 [00:01<00:02, 12.38it/s] 38%|███▊      | 17/45 [00:01<00:02, 12.04it/s] 42%|████▏     | 19/45 [00:02<00:02, 11.66it/s] 51%|█████     | 23/45 [00:02<00:01, 15.89it/s] 56%|█████▌    | 25/45 [00:02<00:01, 12.90it/s] 60%|██████    | 27/45 [00:02<00:01, 12.40it/s] 67%|██████▋   | 30/45 [00:02<00:00, 15.10it/s] 73%|███████▎  | 33/45 [00:03<00:01,  9.81it/s] 80%|████████  | 36/45 [00:03<00:00, 12.44it/s] 91%|█████████ | 41/45 [00:03<00:00, 12.59it/s] 96%|█████████▌| 43/45 [00:04<00:00,  9.86it/s]100%|██████████| 45/45 [00:04<00:00, 10.61it/s]
5640 images processed, 4.261764049530029 seconds used

24.397233963012695
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.52  99.36
places365     67.91  81.18
LSUN          17.57  96.08
iSUN          72.38  81.67
dtd           37.91  91.39
AVG           39.66  89.94
Retain-Acc: 0.7407
Forget-as-OOD (retain known vs forget novel):
  FPR: 79.50 AUROC: 86.89 AUIN: 98.36
27.971660137176514
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e50-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid
epochs=50 | cache=6 | flambda=0.2 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e50-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e50-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e50-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21843904
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<02:19,  2.79it/s]  2%|▏         | 8/391 [00:00<00:17, 21.53it/s]  3%|▎         | 13/391 [00:00<00:13, 28.83it/s]  5%|▍         | 19/391 [00:00<00:10, 35.02it/s]  6%|▌         | 24/391 [00:00<00:09, 38.40it/s]  8%|▊         | 31/391 [00:00<00:07, 46.10it/s] 10%|█         | 40/391 [00:01<00:06, 58.19it/s] 13%|█▎        | 49/391 [00:01<00:05, 65.58it/s] 15%|█▍        | 58/391 [00:01<00:04, 70.87it/s] 17%|█▋        | 66/391 [00:01<00:05, 64.52it/s] 19%|█▊        | 73/391 [00:01<00:05, 59.85it/s] 20%|██        | 80/391 [00:01<00:05, 56.58it/s] 22%|██▏       | 86/391 [00:01<00:05, 57.42it/s] 24%|██▍       | 94/391 [00:01<00:04, 63.19it/s] 26%|██▋       | 103/391 [00:01<00:04, 67.98it/s] 28%|██▊       | 110/391 [00:02<00:04, 65.53it/s] 30%|██▉       | 117/391 [00:02<00:05, 53.86it/s] 31%|███▏      | 123/391 [00:02<00:05, 51.77it/s] 33%|███▎      | 130/391 [00:02<00:04, 56.03it/s] 36%|███▌      | 139/391 [00:02<00:04, 62.76it/s] 38%|███▊      | 148/391 [00:02<00:03, 69.07it/s] 40%|████      | 157/391 [00:02<00:03, 74.26it/s] 42%|████▏     | 165/391 [00:03<00:03, 60.99it/s] 44%|████▍     | 172/391 [00:03<00:04, 53.95it/s] 46%|████▌     | 179/391 [00:03<00:03, 56.41it/s] 48%|████▊     | 188/391 [00:03<00:03, 64.18it/s] 50%|█████     | 196/391 [00:03<00:02, 67.70it/s] 52%|█████▏    | 205/391 [00:03<00:02, 73.21it/s] 54%|█████▍    | 213/391 [00:03<00:02, 64.59it/s] 56%|█████▋    | 220/391 [00:03<00:03, 53.27it/s] 58%|█████▊    | 226/391 [00:04<00:03, 48.48it/s] 60%|█████▉    | 234/391 [00:04<00:02, 54.21it/s] 62%|██████▏   | 243/391 [00:04<00:02, 62.42it/s] 64%|██████▍   | 252/391 [00:04<00:02, 67.53it/s] 67%|██████▋   | 261/391 [00:04<00:01, 72.85it/s] 69%|██████▉   | 269/391 [00:04<00:01, 66.02it/s] 71%|███████   | 276/391 [00:04<00:01, 62.33it/s] 72%|███████▏  | 283/391 [00:04<00:01, 58.39it/s] 74%|███████▍  | 290/391 [00:05<00:01, 59.66it/s] 76%|███████▌  | 298/391 [00:05<00:01, 63.14it/s] 79%|███████▊  | 307/391 [00:05<00:01, 67.61it/s] 81%|████████  | 316/391 [00:05<00:01, 72.52it/s] 83%|████████▎ | 324/391 [00:05<00:01, 62.78it/s] 85%|████████▍ | 331/391 [00:05<00:01, 59.79it/s] 86%|████████▋ | 338/391 [00:05<00:00, 62.07it/s] 88%|████████▊ | 345/391 [00:05<00:00, 62.69it/s] 90%|█████████ | 352/391 [00:06<00:00, 63.56it/s] 92%|█████████▏| 360/391 [00:06<00:00, 66.67it/s] 94%|█████████▍| 369/391 [00:06<00:00, 72.48it/s] 96%|█████████▋| 377/391 [00:06<00:00, 63.13it/s] 98%|█████████▊| 384/391 [00:06<00:00, 54.97it/s]100%|█████████▉| 390/391 [00:06<00:00, 53.08it/s]100%|██████████| 391/391 [00:06<00:00, 58.21it/s]
50000 images processed, 6.805405855178833 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:24,  3.19it/s]  9%|▉         | 7/79 [00:00<00:03, 20.32it/s] 20%|██        | 16/79 [00:00<00:01, 40.48it/s] 29%|██▉       | 23/79 [00:00<00:01, 48.60it/s] 38%|███▊      | 30/79 [00:00<00:00, 53.36it/s] 48%|████▊     | 38/79 [00:00<00:00, 61.10it/s] 59%|█████▉    | 47/79 [00:00<00:00, 69.12it/s] 70%|██████▉   | 55/79 [00:01<00:00, 63.80it/s] 78%|███████▊  | 62/79 [00:01<00:00, 60.21it/s] 87%|████████▋ | 69/79 [00:01<00:00, 58.35it/s] 99%|█████████▊| 78/79 [00:01<00:00, 63.90it/s]100%|██████████| 79/79 [00:01<00:00, 52.73it/s]
10000 images processed, 1.5272061824798584 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:12,  2.81it/s]  3%|▎         | 6/204 [00:00<00:12, 15.93it/s]  6%|▋         | 13/204 [00:00<00:06, 29.96it/s] 10%|█         | 21/204 [00:00<00:04, 43.41it/s] 15%|█▍        | 30/204 [00:00<00:03, 55.25it/s] 19%|█▉        | 39/204 [00:00<00:02, 64.26it/s] 23%|██▎       | 47/204 [00:01<00:02, 64.25it/s] 26%|██▋       | 54/204 [00:01<00:02, 62.54it/s] 30%|██▉       | 61/204 [00:01<00:02, 54.17it/s] 33%|███▎      | 68/204 [00:01<00:02, 55.25it/s] 36%|███▋      | 74/204 [00:01<00:02, 53.59it/s] 40%|███▉      | 81/204 [00:01<00:02, 55.63it/s] 44%|████▍     | 90/204 [00:01<00:01, 62.80it/s] 49%|████▊     | 99/204 [00:01<00:01, 69.10it/s] 53%|█████▎    | 108/204 [00:01<00:01, 74.19it/s] 57%|█████▋    | 116/204 [00:02<00:01, 69.07it/s] 61%|██████    | 124/204 [00:02<00:01, 62.55it/s] 64%|██████▍   | 131/204 [00:02<00:01, 56.06it/s] 68%|██████▊   | 138/204 [00:02<00:01, 57.69it/s] 72%|███████▏  | 147/204 [00:02<00:00, 64.93it/s] 76%|███████▋  | 156/204 [00:02<00:00, 70.91it/s] 81%|████████  | 165/204 [00:02<00:00, 74.97it/s] 85%|████████▌ | 174/204 [00:02<00:00, 76.91it/s] 89%|████████▉ | 182/204 [00:03<00:00, 62.44it/s] 93%|█████████▎| 189/204 [00:03<00:00, 57.22it/s] 96%|█████████▌| 196/204 [00:03<00:00, 58.30it/s]100%|██████████| 204/204 [00:03<00:00, 62.86it/s]100%|██████████| 204/204 [00:03<00:00, 57.72it/s]
26032 images processed, 3.577877998352051 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:36,  2.15it/s] 10%|█         | 8/79 [00:00<00:04, 17.53it/s] 15%|█▌        | 12/79 [00:00<00:03, 21.12it/s] 22%|██▏       | 17/79 [00:00<00:02, 27.32it/s] 28%|██▊       | 22/79 [00:00<00:01, 32.17it/s] 34%|███▍      | 27/79 [00:01<00:01, 35.75it/s] 41%|████      | 32/79 [00:01<00:01, 38.14it/s] 47%|████▋     | 37/79 [00:01<00:01, 39.61it/s] 53%|█████▎    | 42/79 [00:01<00:00, 40.37it/s] 61%|██████    | 48/79 [00:01<00:00, 44.69it/s] 67%|██████▋   | 53/79 [00:01<00:00, 45.64it/s] 75%|███████▍  | 59/79 [00:01<00:00, 41.06it/s] 82%|████████▏ | 65/79 [00:01<00:00, 45.36it/s] 91%|█████████ | 72/79 [00:01<00:00, 51.30it/s] 99%|█████████▊| 78/79 [00:02<00:00, 50.44it/s]100%|██████████| 79/79 [00:02<00:00, 37.22it/s]
10000 images processed, 2.157606601715088 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:28,  2.71it/s]  8%|▊         | 6/79 [00:00<00:04, 14.80it/s] 15%|█▌        | 12/79 [00:00<00:02, 26.20it/s] 24%|██▍       | 19/79 [00:00<00:01, 37.11it/s] 35%|███▌      | 28/79 [00:00<00:00, 51.28it/s] 44%|████▍     | 35/79 [00:00<00:00, 54.41it/s] 53%|█████▎    | 42/79 [00:01<00:00, 56.18it/s] 65%|██████▍   | 51/79 [00:01<00:00, 64.92it/s] 73%|███████▎  | 58/79 [00:01<00:00, 65.82it/s] 82%|████████▏ | 65/79 [00:01<00:00, 56.44it/s] 91%|█████████ | 72/79 [00:01<00:00, 55.93it/s]100%|██████████| 79/79 [00:01<00:00, 58.93it/s]100%|██████████| 79/79 [00:01<00:00, 47.75it/s]
10000 images processed, 1.6767845153808594 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:27,  2.47it/s] 13%|█▎        | 9/70 [00:00<00:02, 22.20it/s] 26%|██▌       | 18/70 [00:00<00:01, 38.64it/s] 36%|███▌      | 25/70 [00:00<00:00, 45.28it/s] 47%|████▋     | 33/70 [00:00<00:00, 53.07it/s] 60%|██████    | 42/70 [00:00<00:00, 62.65it/s] 71%|███████▏  | 50/70 [00:01<00:00, 58.58it/s] 81%|████████▏ | 57/70 [00:01<00:00, 55.04it/s] 91%|█████████▏| 64/70 [00:01<00:00, 57.35it/s]100%|██████████| 70/70 [00:01<00:00, 48.54it/s]
8925 images processed, 1.4697082042694092 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:00<00:37,  1.18it/s]  4%|▍         | 2/45 [00:00<00:18,  2.30it/s] 13%|█▎        | 6/45 [00:01<00:05,  7.49it/s] 20%|██        | 9/45 [00:01<00:03, 11.11it/s] 24%|██▍       | 11/45 [00:01<00:03,  9.66it/s] 31%|███       | 14/45 [00:02<00:04,  7.05it/s] 47%|████▋     | 21/45 [00:02<00:01, 14.35it/s] 56%|█████▌    | 25/45 [00:02<00:01, 10.24it/s] 67%|██████▋   | 30/45 [00:03<00:01,  8.63it/s] 80%|████████  | 36/45 [00:03<00:00, 12.65it/s] 87%|████████▋ | 39/45 [00:04<00:00, 11.39it/s]100%|██████████| 45/45 [00:04<00:00, 10.75it/s]
5640 images processed, 4.206644058227539 seconds used

23.162901163101196
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.52  99.36
places365     67.88  81.18
LSUN          17.48  96.10
iSUN          72.38  81.67
dtd           37.89  91.38
AVG           39.63  89.94
Retain-Acc: 0.7407
Forget-as-OOD (retain known vs forget novel):
  FPR: 79.50 AUROC: 86.88 AUIN: 98.36
28.60373568534851
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.1-lora_r8a32d0.05-temp0.08-fullgrid
epochs=5 | cache=6 | flambda=0.1 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.1-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.1-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.1-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21843904
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<02:34,  2.53it/s]  2%|▏         | 6/391 [00:00<00:26, 14.49it/s]  3%|▎         | 11/391 [00:00<00:17, 22.28it/s]  4%|▍         | 15/391 [00:00<00:14, 26.56it/s]  6%|▌         | 23/391 [00:00<00:09, 40.56it/s]  8%|▊         | 32/391 [00:00<00:06, 53.56it/s] 10%|█         | 40/391 [00:01<00:05, 60.50it/s] 12%|█▏        | 48/391 [00:01<00:05, 64.38it/s] 14%|█▍        | 55/391 [00:01<00:05, 57.64it/s] 16%|█▌        | 62/391 [00:01<00:05, 57.29it/s] 18%|█▊        | 69/391 [00:01<00:05, 60.58it/s] 20%|█▉        | 78/391 [00:01<00:04, 68.31it/s] 22%|██▏       | 86/391 [00:01<00:04, 70.07it/s] 24%|██▍       | 94/391 [00:01<00:04, 69.02it/s] 26%|██▌       | 102/391 [00:01<00:04, 70.05it/s] 28%|██▊       | 110/391 [00:02<00:04, 69.38it/s] 30%|███       | 118/391 [00:02<00:04, 61.15it/s] 32%|███▏      | 125/391 [00:02<00:04, 58.92it/s] 34%|███▍      | 134/391 [00:02<00:03, 66.08it/s] 37%|███▋      | 143/391 [00:02<00:03, 72.01it/s] 39%|███▉      | 152/391 [00:02<00:03, 76.70it/s] 41%|████      | 160/391 [00:02<00:03, 68.52it/s] 43%|████▎     | 168/391 [00:03<00:03, 60.41it/s] 45%|████▍     | 175/391 [00:03<00:03, 58.86it/s] 47%|████▋     | 182/391 [00:03<00:03, 56.82it/s] 48%|████▊     | 188/391 [00:03<00:03, 55.21it/s] 50%|█████     | 197/391 [00:03<00:03, 63.57it/s] 53%|█████▎    | 206/391 [00:03<00:02, 70.17it/s] 55%|█████▍    | 215/391 [00:03<00:02, 74.98it/s] 57%|█████▋    | 224/391 [00:03<00:02, 78.80it/s] 60%|█████▉    | 233/391 [00:03<00:02, 72.89it/s] 62%|██████▏   | 241/391 [00:04<00:02, 60.76it/s] 63%|██████▎   | 248/391 [00:04<00:02, 60.73it/s] 65%|██████▌   | 255/391 [00:04<00:02, 59.22it/s] 67%|██████▋   | 263/391 [00:04<00:02, 63.69it/s] 69%|██████▉   | 270/391 [00:04<00:01, 63.34it/s] 71%|███████   | 278/391 [00:04<00:01, 66.03it/s] 73%|███████▎  | 287/391 [00:04<00:01, 71.81it/s] 75%|███████▌  | 295/391 [00:04<00:01, 72.39it/s] 77%|███████▋  | 303/391 [00:05<00:01, 61.91it/s] 79%|███████▉  | 310/391 [00:05<00:01, 53.80it/s] 81%|████████  | 316/391 [00:05<00:01, 54.87it/s] 83%|████████▎ | 325/391 [00:05<00:01, 63.00it/s] 85%|████████▌ | 334/391 [00:05<00:00, 69.47it/s] 87%|████████▋ | 342/391 [00:05<00:00, 69.62it/s] 90%|████████▉ | 350/391 [00:05<00:00, 60.60it/s] 91%|█████████▏| 357/391 [00:05<00:00, 58.62it/s] 93%|█████████▎| 365/391 [00:06<00:00, 62.71it/s] 96%|█████████▌| 374/391 [00:06<00:00, 69.42it/s] 98%|█████████▊| 382/391 [00:06<00:00, 71.27it/s]100%|█████████▉| 390/391 [00:06<00:00, 68.46it/s]100%|██████████| 391/391 [00:06<00:00, 60.53it/s]
50000 images processed, 6.578536033630371 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:27,  2.86it/s] 13%|█▎        | 10/79 [00:00<00:02, 27.57it/s] 24%|██▍       | 19/79 [00:00<00:01, 42.95it/s] 33%|███▎      | 26/79 [00:00<00:01, 43.91it/s] 41%|████      | 32/79 [00:00<00:01, 43.05it/s] 48%|████▊     | 38/79 [00:00<00:00, 45.90it/s] 59%|█████▉    | 47/79 [00:01<00:00, 55.76it/s] 70%|██████▉   | 55/79 [00:01<00:00, 62.12it/s] 80%|███████▉  | 63/79 [00:01<00:00, 65.60it/s] 89%|████████▊ | 70/79 [00:01<00:00, 58.61it/s] 97%|█████████▋| 77/79 [00:01<00:00, 56.93it/s]100%|██████████| 79/79 [00:01<00:00, 48.35it/s]
10000 images processed, 1.6567823886871338 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:03,  3.18it/s]  3%|▎         | 6/204 [00:00<00:11, 16.95it/s]  6%|▌         | 12/204 [00:00<00:06, 28.22it/s] 10%|▉         | 20/204 [00:00<00:04, 42.62it/s] 13%|█▎        | 27/204 [00:00<00:03, 48.41it/s] 17%|█▋        | 34/204 [00:00<00:03, 54.49it/s] 21%|██        | 43/204 [00:00<00:02, 63.73it/s] 25%|██▍       | 50/204 [00:01<00:02, 63.05it/s] 28%|██▊       | 57/204 [00:01<00:02, 55.71it/s] 31%|███       | 63/204 [00:01<00:02, 53.75it/s] 35%|███▌      | 72/204 [00:01<00:02, 62.02it/s] 40%|███▉      | 81/204 [00:01<00:01, 68.27it/s] 44%|████▎     | 89/204 [00:01<00:01, 69.02it/s] 48%|████▊     | 97/204 [00:01<00:01, 58.24it/s] 51%|█████     | 104/204 [00:02<00:01, 54.50it/s] 54%|█████▍    | 110/204 [00:02<00:01, 55.07it/s] 58%|█████▊    | 119/204 [00:02<00:01, 62.54it/s] 62%|██████▏   | 126/204 [00:02<00:01, 62.89it/s] 65%|██████▌   | 133/204 [00:02<00:01, 61.98it/s] 69%|██████▉   | 141/204 [00:02<00:00, 66.10it/s] 73%|███████▎  | 148/204 [00:02<00:00, 58.55it/s] 76%|███████▌  | 155/204 [00:02<00:00, 56.17it/s] 79%|███████▉  | 162/204 [00:02<00:00, 58.95it/s] 84%|████████▍ | 171/204 [00:03<00:00, 65.75it/s] 88%|████████▊ | 180/204 [00:03<00:00, 70.97it/s] 92%|█████████▏| 188/204 [00:03<00:00, 72.36it/s] 96%|█████████▌| 196/204 [00:03<00:00, 58.12it/s]100%|█████████▉| 203/204 [00:03<00:00, 52.19it/s]100%|██████████| 204/204 [00:03<00:00, 55.45it/s]
26032 images processed, 3.7412822246551514 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:39,  1.97it/s]  8%|▊         | 6/79 [00:00<00:06, 11.94it/s] 15%|█▌        | 12/79 [00:00<00:02, 22.53it/s] 24%|██▍       | 19/79 [00:00<00:01, 33.38it/s] 32%|███▏      | 25/79 [00:00<00:01, 37.70it/s] 38%|███▊      | 30/79 [00:01<00:01, 36.79it/s] 44%|████▍     | 35/79 [00:01<00:01, 37.80it/s] 51%|█████     | 40/79 [00:01<00:00, 39.65it/s] 62%|██████▏   | 49/79 [00:01<00:00, 52.10it/s] 70%|██████▉   | 55/79 [00:01<00:00, 45.75it/s] 77%|███████▋  | 61/79 [00:01<00:00, 46.09it/s] 85%|████████▍ | 67/79 [00:01<00:00, 49.09it/s] 94%|█████████▎| 74/79 [00:01<00:00, 51.36it/s]100%|██████████| 79/79 [00:02<00:00, 37.54it/s]
10000 images processed, 2.141624689102173 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:31,  2.45it/s]  8%|▊         | 6/79 [00:00<00:04, 14.75it/s] 14%|█▍        | 11/79 [00:00<00:02, 23.70it/s] 25%|██▌       | 20/79 [00:00<00:01, 40.74it/s] 35%|███▌      | 28/79 [00:00<00:01, 49.19it/s] 43%|████▎     | 34/79 [00:00<00:00, 51.04it/s] 54%|█████▍    | 43/79 [00:01<00:00, 59.96it/s] 65%|██████▍   | 51/79 [00:01<00:00, 61.34it/s] 73%|███████▎  | 58/79 [00:01<00:00, 55.96it/s] 81%|████████  | 64/79 [00:01<00:00, 54.50it/s] 92%|█████████▏| 73/79 [00:01<00:00, 63.45it/s]100%|██████████| 79/79 [00:01<00:00, 48.80it/s]
10000 images processed, 1.6389951705932617 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:21,  3.17it/s]  9%|▊         | 6/70 [00:00<00:03, 17.33it/s] 16%|█▌        | 11/70 [00:00<00:02, 26.56it/s] 27%|██▋       | 19/70 [00:00<00:01, 41.62it/s] 40%|████      | 28/70 [00:00<00:00, 54.08it/s] 50%|█████     | 35/70 [00:00<00:00, 55.61it/s] 60%|██████    | 42/70 [00:01<00:00, 46.48it/s] 69%|██████▊   | 48/70 [00:01<00:00, 46.92it/s] 81%|████████▏ | 57/70 [00:01<00:00, 56.04it/s] 94%|█████████▍| 66/70 [00:01<00:00, 64.00it/s]100%|██████████| 70/70 [00:01<00:00, 47.86it/s]
8925 images processed, 1.4980957508087158 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:00<00:42,  1.04it/s]  4%|▍         | 2/45 [00:01<00:20,  2.13it/s] 16%|█▌        | 7/45 [00:01<00:04,  9.24it/s] 22%|██▏       | 10/45 [00:01<00:04,  8.06it/s] 31%|███       | 14/45 [00:01<00:02, 11.51it/s] 40%|████      | 18/45 [00:02<00:02, 11.31it/s] 49%|████▉     | 22/45 [00:02<00:01, 12.46it/s] 58%|█████▊    | 26/45 [00:02<00:01, 12.60it/s] 67%|██████▋   | 30/45 [00:03<00:01, 13.03it/s] 76%|███████▌  | 34/45 [00:03<00:00, 11.60it/s] 89%|████████▉ | 40/45 [00:03<00:00, 16.80it/s] 96%|█████████▌| 43/45 [00:04<00:00, 10.57it/s]100%|██████████| 45/45 [00:04<00:00, 10.62it/s]
5640 images processed, 4.261411428451538 seconds used

23.192240476608276
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.51  99.36
places365     67.87  81.18
LSUN          17.54  96.08
iSUN          72.31  81.68
dtd           37.85  91.39
AVG           39.62  89.94
Retain-Acc: 0.7407
Forget-as-OOD (retain known vs forget novel):
  FPR: 79.50 AUROC: 86.89 AUIN: 98.36
27.688159942626953
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e10-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.1-lora_r8a32d0.05-temp0.08-fullgrid
epochs=10 | cache=6 | flambda=0.1 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e10-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.1-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e10-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.1-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e10-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.1-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21843904
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<02:56,  2.21it/s]  2%|▏         | 7/391 [00:00<00:24, 15.91it/s]  4%|▎         | 14/391 [00:00<00:12, 29.53it/s]  6%|▌         | 23/391 [00:00<00:08, 44.98it/s]  8%|▊         | 31/391 [00:00<00:06, 51.87it/s] 10%|▉         | 38/391 [00:01<00:07, 49.43it/s] 11%|█▏        | 44/391 [00:01<00:06, 49.76it/s] 13%|█▎        | 52/391 [00:01<00:06, 55.94it/s] 16%|█▌        | 61/391 [00:01<00:05, 64.52it/s] 18%|█▊        | 70/391 [00:01<00:04, 70.71it/s] 20%|█▉        | 78/391 [00:01<00:04, 68.75it/s] 22%|██▏       | 86/391 [00:01<00:04, 67.24it/s] 24%|██▍       | 93/391 [00:01<00:04, 59.84it/s] 26%|██▌       | 100/391 [00:01<00:04, 59.12it/s] 27%|██▋       | 107/391 [00:02<00:04, 58.92it/s] 30%|██▉       | 116/391 [00:02<00:04, 66.17it/s] 32%|███▏      | 125/391 [00:02<00:03, 71.33it/s] 34%|███▍      | 133/391 [00:02<00:03, 72.57it/s] 36%|███▌      | 141/391 [00:02<00:03, 64.25it/s] 38%|███▊      | 148/391 [00:02<00:04, 57.21it/s] 40%|███▉      | 155/391 [00:02<00:04, 56.53it/s] 41%|████▏     | 162/391 [00:02<00:03, 59.77it/s] 44%|████▎     | 171/391 [00:03<00:03, 67.30it/s] 46%|████▌     | 179/391 [00:03<00:03, 69.77it/s] 48%|████▊     | 187/391 [00:03<00:03, 66.81it/s] 50%|████▉     | 194/391 [00:03<00:03, 65.28it/s] 51%|█████▏    | 201/391 [00:03<00:02, 63.96it/s] 53%|█████▎    | 208/391 [00:03<00:03, 56.31it/s] 55%|█████▍    | 214/391 [00:03<00:03, 55.96it/s] 56%|█████▋    | 220/391 [00:03<00:03, 54.45it/s] 59%|█████▊    | 229/391 [00:04<00:02, 62.07it/s] 61%|██████    | 238/391 [00:04<00:02, 68.69it/s] 63%|██████▎   | 246/391 [00:04<00:02, 66.14it/s] 65%|██████▍   | 253/391 [00:04<00:02, 65.67it/s] 66%|██████▋   | 260/391 [00:04<00:02, 60.13it/s] 68%|██████▊   | 267/391 [00:04<00:02, 55.31it/s] 70%|███████   | 274/391 [00:04<00:02, 58.40it/s] 72%|███████▏  | 283/391 [00:04<00:01, 66.10it/s] 74%|███████▍  | 291/391 [00:04<00:01, 68.96it/s] 77%|███████▋  | 300/391 [00:05<00:01, 74.46it/s] 79%|███████▉  | 309/391 [00:05<00:01, 74.60it/s] 81%|████████  | 317/391 [00:05<00:01, 57.44it/s] 83%|████████▎ | 324/391 [00:05<00:01, 53.27it/s] 85%|████████▌ | 333/391 [00:05<00:00, 60.08it/s] 87%|████████▋ | 341/391 [00:05<00:00, 64.01it/s] 89%|████████▉ | 349/391 [00:05<00:00, 67.31it/s] 91%|█████████▏| 357/391 [00:06<00:00, 65.47it/s] 93%|█████████▎| 364/391 [00:06<00:00, 60.36it/s] 95%|█████████▍| 371/391 [00:06<00:00, 57.44it/s] 96%|█████████▋| 377/391 [00:06<00:00, 55.82it/s] 99%|█████████▉| 387/391 [00:06<00:00, 65.22it/s]100%|██████████| 391/391 [00:06<00:00, 59.27it/s]
50000 images processed, 6.690586090087891 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:31,  2.47it/s] 10%|█         | 8/79 [00:00<00:03, 20.04it/s] 22%|██▏       | 17/79 [00:00<00:01, 38.10it/s] 33%|███▎      | 26/79 [00:00<00:01, 51.35it/s] 44%|████▍     | 35/79 [00:00<00:00, 60.30it/s] 54%|█████▍    | 43/79 [00:01<00:00, 53.45it/s] 63%|██████▎   | 50/79 [00:01<00:00, 53.66it/s] 75%|███████▍  | 59/79 [00:01<00:00, 61.77it/s] 86%|████████▌ | 68/79 [00:01<00:00, 68.51it/s] 99%|█████████▊| 78/79 [00:01<00:00, 74.73it/s]100%|██████████| 79/79 [00:01<00:00, 53.36it/s]
10000 images processed, 1.507863998413086 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:28,  2.29it/s]  5%|▍         | 10/204 [00:00<00:08, 23.32it/s]  9%|▉         | 18/204 [00:00<00:05, 36.91it/s] 12%|█▏        | 25/204 [00:00<00:04, 42.89it/s] 16%|█▌        | 33/204 [00:00<00:03, 52.48it/s] 20%|█▉        | 40/204 [00:01<00:03, 50.45it/s] 23%|██▎       | 46/204 [00:01<00:03, 50.61it/s] 25%|██▌       | 52/204 [00:01<00:02, 52.51it/s] 30%|██▉       | 61/204 [00:01<00:02, 61.80it/s] 34%|███▍      | 70/204 [00:01<00:01, 68.51it/s] 38%|███▊      | 78/204 [00:01<00:01, 69.12it/s] 42%|████▏     | 86/204 [00:01<00:01, 64.77it/s] 46%|████▌     | 93/204 [00:01<00:01, 56.25it/s] 49%|████▊     | 99/204 [00:01<00:01, 55.25it/s] 52%|█████▏    | 106/204 [00:02<00:01, 58.51it/s] 56%|█████▌    | 114/204 [00:02<00:01, 63.87it/s] 60%|██████    | 123/204 [00:02<00:01, 69.96it/s] 64%|██████▍   | 131/204 [00:02<00:01, 67.01it/s] 68%|██████▊   | 138/204 [00:02<00:01, 53.67it/s] 71%|███████   | 144/204 [00:02<00:01, 50.23it/s] 75%|███████▌  | 153/204 [00:02<00:00, 58.68it/s] 79%|███████▉  | 162/204 [00:02<00:00, 65.19it/s] 84%|████████▍ | 171/204 [00:03<00:00, 70.46it/s] 88%|████████▊ | 179/204 [00:03<00:00, 64.25it/s] 91%|█████████ | 186/204 [00:03<00:00, 57.48it/s] 95%|█████████▍| 193/204 [00:03<00:00, 59.74it/s] 99%|█████████▊| 201/204 [00:03<00:00, 64.45it/s]100%|██████████| 204/204 [00:03<00:00, 55.62it/s]
26032 images processed, 3.72918701171875 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:40,  1.91it/s] 11%|█▏        | 9/79 [00:00<00:04, 17.02it/s] 18%|█▊        | 14/79 [00:00<00:02, 23.15it/s] 24%|██▍       | 19/79 [00:00<00:02, 28.33it/s] 32%|███▏      | 25/79 [00:01<00:01, 34.84it/s] 39%|███▉      | 31/79 [00:01<00:01, 41.08it/s] 47%|████▋     | 37/79 [00:01<00:00, 45.56it/s] 54%|█████▍    | 43/79 [00:01<00:00, 42.95it/s] 62%|██████▏   | 49/79 [00:01<00:00, 44.54it/s] 72%|███████▏  | 57/79 [00:01<00:00, 52.51it/s] 80%|███████▉  | 63/79 [00:01<00:00, 51.89it/s] 87%|████████▋ | 69/79 [00:01<00:00, 46.84it/s] 95%|█████████▍| 75/79 [00:02<00:00, 46.84it/s]100%|██████████| 79/79 [00:02<00:00, 37.72it/s]
10000 images processed, 2.1401517391204834 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:32,  2.36it/s]  9%|▉         | 7/79 [00:00<00:04, 15.97it/s] 15%|█▌        | 12/79 [00:00<00:02, 23.96it/s] 23%|██▎       | 18/79 [00:00<00:01, 32.23it/s] 30%|███       | 24/79 [00:00<00:01, 39.47it/s] 39%|███▉      | 31/79 [00:00<00:01, 45.98it/s] 51%|█████     | 40/79 [00:01<00:00, 56.47it/s] 62%|██████▏   | 49/79 [00:01<00:00, 65.07it/s] 73%|███████▎  | 58/79 [00:01<00:00, 70.63it/s] 84%|████████▎ | 66/79 [00:01<00:00, 66.04it/s] 92%|█████████▏| 73/79 [00:01<00:00, 53.22it/s]100%|██████████| 79/79 [00:01<00:00, 52.48it/s]100%|██████████| 79/79 [00:01<00:00, 44.80it/s]
10000 images processed, 1.78804612159729 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:29,  2.33it/s] 11%|█▏        | 8/70 [00:00<00:03, 19.08it/s] 24%|██▍       | 17/70 [00:00<00:01, 36.66it/s] 37%|███▋      | 26/70 [00:00<00:00, 49.79it/s] 49%|████▊     | 34/70 [00:00<00:00, 56.12it/s] 59%|█████▊    | 41/70 [00:01<00:00, 50.80it/s] 69%|██████▊   | 48/70 [00:01<00:00, 46.88it/s] 77%|███████▋  | 54/70 [00:01<00:00, 49.89it/s] 90%|█████████ | 63/70 [00:01<00:00, 59.26it/s]100%|██████████| 70/70 [00:01<00:00, 46.89it/s]
8925 images processed, 1.5455496311187744 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:00<00:42,  1.03it/s]  4%|▍         | 2/45 [00:01<00:19,  2.17it/s] 16%|█▌        | 7/45 [00:01<00:04,  9.09it/s] 22%|██▏       | 10/45 [00:01<00:04,  8.26it/s] 31%|███       | 14/45 [00:01<00:02, 10.66it/s] 38%|███▊      | 17/45 [00:01<00:02, 13.27it/s] 42%|████▏     | 19/45 [00:02<00:02, 11.44it/s] 49%|████▉     | 22/45 [00:02<00:01, 12.91it/s] 58%|█████▊    | 26/45 [00:02<00:01, 11.96it/s] 67%|██████▋   | 30/45 [00:03<00:01, 12.71it/s] 73%|███████▎  | 33/45 [00:03<00:00, 13.13it/s] 78%|███████▊  | 35/45 [00:03<00:00, 10.44it/s] 91%|█████████ | 41/45 [00:03<00:00, 15.33it/s] 96%|█████████▌| 43/45 [00:04<00:00,  9.61it/s]100%|██████████| 45/45 [00:04<00:00, 10.32it/s]
5640 images processed, 4.385601997375488 seconds used

23.479048490524292
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.52  99.36
places365     67.95  81.18
LSUN          17.28  96.12
iSUN          72.25  81.65
dtd           37.82  91.36
AVG           39.56  89.93
Retain-Acc: 0.7412
Forget-as-OOD (retain known vs forget novel):
  FPR: 79.40 AUROC: 86.86 AUIN: 98.36
38.271615505218506
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e20-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.1-lora_r8a32d0.05-temp0.08-fullgrid
epochs=20 | cache=6 | flambda=0.1 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e20-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.1-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e20-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.1-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e20-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.1-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21843904
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<02:54,  2.24it/s]  2%|▏         | 6/391 [00:00<00:28, 13.61it/s]  4%|▍         | 15/391 [00:00<00:11, 32.97it/s]  6%|▌         | 24/391 [00:00<00:07, 47.82it/s]  8%|▊         | 32/391 [00:00<00:06, 55.14it/s] 10%|█         | 40/391 [00:00<00:06, 57.95it/s] 12%|█▏        | 48/391 [00:01<00:05, 63.34it/s] 14%|█▍        | 56/391 [00:01<00:05, 56.76it/s] 16%|█▌        | 63/391 [00:01<00:06, 52.18it/s] 18%|█▊        | 72/391 [00:01<00:05, 60.95it/s] 21%|██        | 81/391 [00:01<00:04, 68.09it/s] 23%|██▎       | 90/391 [00:01<00:04, 72.80it/s] 25%|██▌       | 99/391 [00:01<00:03, 77.11it/s] 28%|██▊       | 108/391 [00:01<00:03, 79.60it/s] 30%|██▉       | 117/391 [00:02<00:04, 60.77it/s] 32%|███▏      | 124/391 [00:02<00:04, 53.70it/s] 34%|███▍      | 132/391 [00:02<00:04, 59.02it/s] 36%|███▌      | 141/391 [00:02<00:03, 66.20it/s] 38%|███▊      | 150/391 [00:02<00:03, 72.05it/s] 41%|████      | 159/391 [00:02<00:03, 76.61it/s] 43%|████▎     | 168/391 [00:02<00:02, 78.56it/s] 45%|████▌     | 177/391 [00:03<00:03, 64.89it/s] 47%|████▋     | 185/391 [00:03<00:03, 58.32it/s] 49%|████▉     | 192/391 [00:03<00:03, 59.37it/s] 51%|█████▏    | 201/391 [00:03<00:02, 65.38it/s] 54%|█████▎    | 210/391 [00:03<00:02, 71.07it/s] 56%|█████▌    | 219/391 [00:03<00:02, 73.58it/s] 58%|█████▊    | 227/391 [00:03<00:02, 64.08it/s] 60%|█████▉    | 234/391 [00:03<00:02, 60.75it/s] 62%|██████▏   | 243/391 [00:04<00:02, 66.61it/s] 64%|██████▍   | 252/391 [00:04<00:01, 70.89it/s] 67%|██████▋   | 261/391 [00:04<00:01, 75.00it/s] 69%|██████▉   | 269/391 [00:04<00:01, 72.57it/s] 71%|███████   | 277/391 [00:04<00:01, 63.51it/s] 73%|███████▎  | 284/391 [00:04<00:01, 63.45it/s] 75%|███████▍  | 293/391 [00:04<00:01, 69.82it/s] 77%|███████▋  | 302/391 [00:04<00:01, 73.71it/s] 80%|███████▉  | 311/391 [00:04<00:01, 76.12it/s] 82%|████████▏ | 319/391 [00:05<00:00, 72.51it/s] 84%|████████▎ | 327/391 [00:05<00:00, 73.42it/s] 86%|████████▌ | 336/391 [00:05<00:00, 77.73it/s] 88%|████████▊ | 345/391 [00:05<00:00, 79.35it/s] 91%|█████████ | 354/391 [00:05<00:00, 79.86it/s] 93%|█████████▎| 364/391 [00:05<00:00, 84.38it/s] 96%|█████████▌| 374/391 [00:05<00:00, 87.58it/s] 98%|█████████▊| 384/391 [00:05<00:00, 89.79it/s]100%|██████████| 391/391 [00:05<00:00, 65.84it/s]
50000 images processed, 6.042970418930054 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:22,  3.45it/s]  9%|▉         | 7/79 [00:00<00:03, 20.91it/s] 20%|██        | 16/79 [00:00<00:01, 41.69it/s] 32%|███▏      | 25/79 [00:00<00:00, 55.19it/s] 43%|████▎     | 34/79 [00:00<00:00, 63.69it/s] 54%|█████▍    | 43/79 [00:00<00:00, 69.73it/s] 66%|██████▌   | 52/79 [00:00<00:00, 74.50it/s] 76%|███████▌  | 60/79 [00:01<00:00, 60.12it/s] 85%|████████▍ | 67/79 [00:01<00:00, 53.30it/s] 94%|█████████▎| 74/79 [00:01<00:00, 55.78it/s]100%|██████████| 79/79 [00:01<00:00, 53.24it/s]
10000 images processed, 1.5056030750274658 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:01,  3.29it/s]  4%|▍         | 9/204 [00:00<00:07, 26.74it/s]  8%|▊         | 17/204 [00:00<00:04, 42.71it/s] 13%|█▎        | 26/204 [00:00<00:03, 55.91it/s] 17%|█▋        | 34/204 [00:00<00:02, 62.36it/s] 21%|██        | 42/204 [00:00<00:03, 53.81it/s] 24%|██▍       | 49/204 [00:01<00:02, 54.04it/s] 28%|██▊       | 58/204 [00:01<00:02, 62.45it/s] 32%|███▏      | 66/204 [00:01<00:02, 64.49it/s] 36%|███▌      | 73/204 [00:01<00:02, 62.12it/s] 40%|████      | 82/204 [00:01<00:01, 68.65it/s] 45%|████▍     | 91/204 [00:01<00:01, 69.70it/s] 49%|████▊     | 99/204 [00:01<00:01, 60.20it/s] 52%|█████▏    | 106/204 [00:01<00:01, 57.89it/s] 56%|█████▋    | 115/204 [00:02<00:01, 65.15it/s] 61%|██████    | 124/204 [00:02<00:01, 70.86it/s] 65%|██████▌   | 133/204 [00:02<00:00, 75.12it/s] 70%|██████▉   | 142/204 [00:02<00:00, 75.99it/s] 74%|███████▎  | 150/204 [00:02<00:00, 63.02it/s] 77%|███████▋  | 157/204 [00:02<00:00, 51.34it/s] 80%|███████▉  | 163/204 [00:02<00:00, 49.49it/s] 84%|████████▍ | 172/204 [00:02<00:00, 57.86it/s] 89%|████████▊ | 181/204 [00:03<00:00, 64.32it/s] 93%|█████████▎| 190/204 [00:03<00:00, 70.11it/s] 98%|█████████▊| 199/204 [00:03<00:00, 75.21it/s]100%|██████████| 204/204 [00:03<00:00, 60.83it/s]
26032 images processed, 3.4054067134857178 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:48,  1.60it/s] 11%|█▏        | 9/79 [00:00<00:04, 14.11it/s] 18%|█▊        | 14/79 [00:00<00:03, 20.14it/s] 23%|██▎       | 18/79 [00:01<00:02, 23.66it/s] 32%|███▏      | 25/79 [00:01<00:01, 32.50it/s] 42%|████▏     | 33/79 [00:01<00:01, 37.52it/s] 48%|████▊     | 38/79 [00:01<00:01, 38.50it/s] 54%|█████▍    | 43/79 [00:01<00:00, 37.83it/s] 63%|██████▎   | 50/79 [00:01<00:00, 45.11it/s] 73%|███████▎  | 58/79 [00:01<00:00, 53.42it/s] 81%|████████  | 64/79 [00:01<00:00, 53.28it/s] 89%|████████▊ | 70/79 [00:02<00:00, 45.66it/s] 97%|█████████▋| 77/79 [00:02<00:00, 50.97it/s]100%|██████████| 79/79 [00:02<00:00, 35.91it/s]
10000 images processed, 2.2345311641693115 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:33,  2.30it/s] 13%|█▎        | 10/79 [00:00<00:02, 23.20it/s] 19%|█▉        | 15/79 [00:00<00:02, 26.36it/s] 25%|██▌       | 20/79 [00:00<00:01, 30.31it/s] 32%|███▏      | 25/79 [00:00<00:01, 34.92it/s] 42%|████▏     | 33/79 [00:01<00:00, 46.38it/s] 53%|█████▎    | 42/79 [00:01<00:00, 57.25it/s] 65%|██████▍   | 51/79 [00:01<00:00, 65.74it/s] 76%|███████▌  | 60/79 [00:01<00:00, 71.70it/s] 86%|████████▌ | 68/79 [00:01<00:00, 59.65it/s] 95%|█████████▍| 75/79 [00:01<00:00, 57.23it/s]100%|██████████| 79/79 [00:01<00:00, 46.30it/s]
10000 images processed, 1.726994514465332 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:32,  2.11it/s] 14%|█▍        | 10/70 [00:00<00:02, 22.30it/s] 27%|██▋       | 19/70 [00:00<00:01, 38.65it/s] 37%|███▋      | 26/70 [00:00<00:00, 46.77it/s] 47%|████▋     | 33/70 [00:00<00:00, 42.62it/s] 56%|█████▌    | 39/70 [00:01<00:00, 44.37it/s] 64%|██████▍   | 45/70 [00:01<00:00, 47.82it/s] 77%|███████▋  | 54/70 [00:01<00:00, 57.67it/s] 90%|█████████ | 63/70 [00:01<00:00, 65.94it/s]100%|██████████| 70/70 [00:01<00:00, 46.95it/s]
8925 images processed, 1.5213453769683838 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:01<00:46,  1.06s/it]  7%|▋         | 3/45 [00:01<00:13,  3.14it/s] 16%|█▌        | 7/45 [00:01<00:04,  8.18it/s] 22%|██▏       | 10/45 [00:01<00:04,  7.68it/s] 33%|███▎      | 15/45 [00:01<00:02, 12.99it/s] 40%|████      | 18/45 [00:02<00:02, 10.24it/s] 44%|████▍     | 20/45 [00:02<00:02, 10.16it/s] 56%|█████▌    | 25/45 [00:02<00:01, 12.56it/s] 62%|██████▏   | 28/45 [00:03<00:01, 11.40it/s] 73%|███████▎  | 33/45 [00:03<00:01, 11.78it/s] 80%|████████  | 36/45 [00:03<00:00, 12.58it/s] 91%|█████████ | 41/45 [00:04<00:00, 12.98it/s] 96%|█████████▌| 43/45 [00:04<00:00, 11.83it/s]100%|██████████| 45/45 [00:04<00:00, 10.31it/s]
5640 images processed, 4.385470628738403 seconds used

22.423771142959595
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           3.11  99.28
places365     70.00  80.56
LSUN          20.99  95.67
iSUN          74.48  80.57
dtd           40.90  90.71
AVG           41.90  89.36
Retain-Acc: 0.7409
Forget-as-OOD (retain known vs forget novel):
  FPR: 75.30 AUROC: 87.19 AUIN: 98.39
22.645787000656128
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e50-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.1-lora_r8a32d0.05-temp0.08-fullgrid
epochs=50 | cache=6 | flambda=0.1 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e50-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.1-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e50-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.1-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e50-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.1-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21843904
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<02:25,  2.68it/s]  3%|▎         | 11/391 [00:00<00:13, 29.16it/s]  5%|▌         | 20/391 [00:00<00:08, 45.69it/s]  7%|▋         | 28/391 [00:00<00:07, 50.96it/s]  9%|▉         | 35/391 [00:00<00:06, 55.32it/s] 12%|█▏        | 45/391 [00:00<00:05, 66.04it/s] 14%|█▍        | 54/391 [00:01<00:04, 71.13it/s] 16%|█▌        | 62/391 [00:01<00:04, 72.00it/s] 18%|█▊        | 70/391 [00:01<00:04, 66.08it/s] 20%|██        | 80/391 [00:01<00:04, 73.26it/s] 23%|██▎       | 90/391 [00:01<00:03, 78.59it/s] 25%|██▌       | 99/391 [00:01<00:03, 78.22it/s] 28%|██▊       | 109/391 [00:01<00:03, 82.95it/s] 30%|███       | 118/391 [00:01<00:03, 74.89it/s] 32%|███▏      | 127/391 [00:01<00:03, 77.72it/s] 35%|███▍      | 136/391 [00:02<00:03, 80.79it/s] 37%|███▋      | 145/391 [00:02<00:03, 81.73it/s] 39%|███▉      | 154/391 [00:02<00:02, 81.29it/s] 42%|████▏     | 163/391 [00:02<00:03, 73.41it/s] 44%|████▎     | 171/391 [00:02<00:03, 67.06it/s] 46%|████▌     | 178/391 [00:02<00:03, 62.20it/s] 47%|████▋     | 185/391 [00:02<00:03, 59.58it/s] 50%|████▉     | 194/391 [00:02<00:02, 66.28it/s] 52%|█████▏    | 203/391 [00:03<00:02, 70.76it/s] 54%|█████▍    | 212/391 [00:03<00:02, 75.58it/s] 57%|█████▋    | 221/391 [00:03<00:02, 79.10it/s] 59%|█████▉    | 230/391 [00:03<00:01, 80.95it/s] 61%|██████    | 239/391 [00:03<00:02, 71.26it/s] 63%|██████▎   | 247/391 [00:03<00:02, 57.60it/s] 65%|██████▍   | 254/391 [00:03<00:02, 56.88it/s] 67%|██████▋   | 263/391 [00:03<00:01, 64.14it/s] 70%|██████▉   | 272/391 [00:04<00:01, 69.79it/s] 72%|███████▏  | 281/391 [00:04<00:01, 73.17it/s] 74%|███████▍  | 290/391 [00:04<00:01, 77.07it/s] 76%|███████▌  | 298/391 [00:04<00:01, 72.15it/s] 78%|███████▊  | 306/391 [00:04<00:01, 64.82it/s] 80%|████████  | 313/391 [00:04<00:01, 61.66it/s] 82%|████████▏ | 322/391 [00:04<00:01, 68.10it/s] 84%|████████▍ | 330/391 [00:04<00:00, 66.19it/s] 86%|████████▌ | 337/391 [00:05<00:00, 66.19it/s] 88%|████████▊ | 346/391 [00:05<00:00, 72.34it/s] 91%|█████████ | 355/391 [00:05<00:00, 76.57it/s] 93%|█████████▎| 363/391 [00:05<00:00, 67.14it/s] 95%|█████████▍| 371/391 [00:05<00:00, 60.79it/s] 97%|█████████▋| 378/391 [00:05<00:00, 61.59it/s] 99%|█████████▉| 387/391 [00:05<00:00, 68.55it/s]100%|██████████| 391/391 [00:05<00:00, 66.86it/s]
50000 images processed, 5.966829538345337 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:32,  2.38it/s] 11%|█▏        | 9/79 [00:00<00:03, 21.89it/s] 23%|██▎       | 18/79 [00:00<00:01, 39.51it/s] 34%|███▍      | 27/79 [00:00<00:01, 51.94it/s] 44%|████▍     | 35/79 [00:00<00:00, 52.61it/s] 53%|█████▎    | 42/79 [00:01<00:00, 53.02it/s] 62%|██████▏   | 49/79 [00:01<00:00, 54.07it/s] 73%|███████▎  | 58/79 [00:01<00:00, 61.47it/s] 85%|████████▍ | 67/79 [00:01<00:00, 68.01it/s] 95%|█████████▍| 75/79 [00:01<00:00, 69.28it/s]100%|██████████| 79/79 [00:01<00:00, 51.51it/s]
10000 images processed, 1.5581142902374268 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:13,  2.74it/s]  4%|▍         | 8/204 [00:00<00:09, 21.33it/s]  7%|▋         | 15/204 [00:00<00:05, 33.76it/s] 10%|█         | 21/204 [00:00<00:04, 40.95it/s] 14%|█▍        | 29/204 [00:00<00:03, 51.79it/s] 18%|█▊        | 36/204 [00:00<00:03, 54.69it/s] 21%|██        | 43/204 [00:01<00:03, 48.61it/s] 24%|██▍       | 49/204 [00:01<00:03, 49.10it/s] 27%|██▋       | 55/204 [00:01<00:02, 51.33it/s] 30%|██▉       | 61/204 [00:01<00:02, 53.45it/s] 33%|███▎      | 67/204 [00:01<00:02, 54.89it/s] 37%|███▋      | 76/204 [00:01<00:01, 64.03it/s] 42%|████▏     | 85/204 [00:01<00:01, 70.87it/s] 46%|████▌     | 94/204 [00:01<00:01, 75.71it/s] 50%|█████     | 102/204 [00:01<00:01, 64.82it/s] 53%|█████▎    | 109/204 [00:02<00:01, 59.66it/s] 57%|█████▋    | 116/204 [00:02<00:01, 61.61it/s] 61%|██████▏   | 125/204 [00:02<00:01, 68.03it/s] 66%|██████▌   | 134/204 [00:02<00:00, 72.42it/s] 70%|███████   | 143/204 [00:02<00:00, 75.53it/s] 74%|███████▍  | 151/204 [00:02<00:00, 65.53it/s] 77%|███████▋  | 158/204 [00:02<00:00, 55.56it/s] 80%|████████  | 164/204 [00:03<00:00, 54.35it/s] 84%|████████▍ | 172/204 [00:03<00:00, 59.85it/s] 89%|████████▊ | 181/204 [00:03<00:00, 66.19it/s] 93%|█████████▎| 190/204 [00:03<00:00, 70.95it/s] 97%|█████████▋| 198/204 [00:03<00:00, 66.78it/s]100%|██████████| 204/204 [00:03<00:00, 56.72it/s]
26032 images processed, 3.6449291706085205 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:46,  1.66it/s]  6%|▋         | 5/79 [00:00<00:08,  8.84it/s] 14%|█▍        | 11/79 [00:00<00:03, 19.58it/s] 23%|██▎       | 18/79 [00:00<00:02, 30.44it/s] 32%|███▏      | 25/79 [00:01<00:01, 38.44it/s] 39%|███▉      | 31/79 [00:01<00:01, 37.41it/s] 46%|████▌     | 36/79 [00:01<00:01, 40.22it/s] 53%|█████▎    | 42/79 [00:01<00:00, 38.24it/s] 59%|█████▉    | 47/79 [00:01<00:00, 39.27it/s] 66%|██████▌   | 52/79 [00:01<00:00, 41.23it/s] 76%|███████▌  | 60/79 [00:01<00:00, 50.44it/s] 84%|████████▎ | 66/79 [00:01<00:00, 45.76it/s] 90%|████████▉ | 71/79 [00:02<00:00, 41.28it/s] 97%|█████████▋| 77/79 [00:02<00:00, 44.61it/s]100%|██████████| 79/79 [00:02<00:00, 34.79it/s]
10000 images processed, 2.3087098598480225 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:34,  2.28it/s]  9%|▉         | 7/79 [00:00<00:04, 15.74it/s] 18%|█▊        | 14/79 [00:00<00:02, 29.23it/s] 27%|██▋       | 21/79 [00:00<00:01, 39.72it/s] 34%|███▍      | 27/79 [00:00<00:01, 44.12it/s] 44%|████▍     | 35/79 [00:00<00:00, 52.31it/s] 53%|█████▎    | 42/79 [00:01<00:00, 54.41it/s] 62%|██████▏   | 49/79 [00:01<00:00, 51.26it/s] 70%|██████▉   | 55/79 [00:01<00:00, 51.29it/s] 81%|████████  | 64/79 [00:01<00:00, 60.61it/s] 90%|████████▉ | 71/79 [00:01<00:00, 59.14it/s] 99%|█████████▊| 78/79 [00:01<00:00, 61.99it/s]100%|██████████| 79/79 [00:01<00:00, 46.36it/s]
10000 images processed, 1.730011224746704 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:32,  2.10it/s] 10%|█         | 7/70 [00:00<00:04, 15.05it/s] 23%|██▎       | 16/70 [00:00<00:01, 32.58it/s] 36%|███▌      | 25/70 [00:00<00:00, 46.45it/s] 49%|████▊     | 34/70 [00:00<00:00, 57.29it/s] 60%|██████    | 42/70 [00:01<00:00, 54.21it/s] 70%|███████   | 49/70 [00:01<00:00, 49.34it/s] 79%|███████▊  | 55/70 [00:01<00:00, 48.01it/s] 91%|█████████▏| 64/70 [00:01<00:00, 57.61it/s]100%|██████████| 70/70 [00:01<00:00, 45.11it/s]
8925 images processed, 1.594240427017212 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:01<00:45,  1.03s/it]  4%|▍         | 2/45 [00:01<00:21,  2.01it/s] 16%|█▌        | 7/45 [00:01<00:04,  8.70it/s] 22%|██▏       | 10/45 [00:01<00:04,  7.11it/s] 33%|███▎      | 15/45 [00:01<00:02, 11.90it/s] 40%|████      | 18/45 [00:02<00:02,  9.63it/s] 51%|█████     | 23/45 [00:02<00:01, 14.12it/s] 58%|█████▊    | 26/45 [00:02<00:01, 11.82it/s] 67%|██████▋   | 30/45 [00:03<00:01, 13.28it/s] 73%|███████▎  | 33/45 [00:03<00:00, 13.53it/s] 78%|███████▊  | 35/45 [00:03<00:00, 11.23it/s] 91%|█████████ | 41/45 [00:03<00:00, 16.08it/s] 96%|█████████▌| 43/45 [00:04<00:00,  9.32it/s]100%|██████████| 45/45 [00:04<00:00, 10.06it/s]
5640 images processed, 4.499089956283569 seconds used

23.190707683563232
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           5.02  98.83
places365     74.80  79.17
LSUN          24.80  95.14
iSUN          77.76  78.87
dtd           42.98  90.03
AVG           45.07  88.41
Retain-Acc: 0.7337
Forget-as-OOD (retain known vs forget novel):
  FPR: 40.40 AUROC: 91.39 AUIN: 98.86
26.7851459980011
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e5-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.1-lora_r8a32d0.05-temp0.08-fullgrid
epochs=5 | cache=6 | flambda=0.1 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.1-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.1-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.1-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21843904
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<01:46,  3.68it/s]  3%|▎         | 10/391 [00:00<00:11, 32.75it/s]  4%|▍         | 16/391 [00:00<00:09, 38.20it/s]  5%|▌         | 21/391 [00:00<00:09, 37.70it/s]  7%|▋         | 27/391 [00:00<00:08, 41.59it/s]  9%|▊         | 34/391 [00:00<00:07, 48.11it/s] 11%|█         | 43/391 [00:00<00:06, 57.91it/s] 13%|█▎        | 52/391 [00:01<00:05, 66.75it/s] 16%|█▌        | 61/391 [00:01<00:04, 73.23it/s] 18%|█▊        | 70/391 [00:01<00:04, 78.02it/s] 20%|██        | 79/391 [00:01<00:04, 75.79it/s] 22%|██▏       | 87/391 [00:01<00:04, 64.57it/s] 24%|██▍       | 94/391 [00:01<00:05, 57.05it/s] 26%|██▌       | 101/391 [00:01<00:04, 58.06it/s] 28%|██▊       | 110/391 [00:01<00:04, 65.19it/s] 30%|███       | 119/391 [00:02<00:03, 69.84it/s] 33%|███▎      | 128/391 [00:02<00:03, 74.79it/s] 35%|███▍      | 136/391 [00:02<00:03, 73.83it/s] 37%|███▋      | 144/391 [00:02<00:04, 57.31it/s] 39%|███▊      | 151/391 [00:02<00:04, 53.80it/s] 41%|████      | 160/391 [00:02<00:03, 61.50it/s] 43%|████▎     | 169/391 [00:02<00:03, 67.17it/s] 46%|████▌     | 178/391 [00:02<00:02, 72.84it/s] 48%|████▊     | 187/391 [00:03<00:02, 74.54it/s] 50%|████▉     | 195/391 [00:03<00:02, 70.44it/s] 52%|█████▏    | 203/391 [00:03<00:03, 61.53it/s] 54%|█████▎    | 210/391 [00:03<00:03, 56.83it/s] 55%|█████▌    | 216/391 [00:03<00:03, 57.46it/s] 58%|█████▊    | 225/391 [00:03<00:02, 65.42it/s] 60%|█████▉    | 233/391 [00:03<00:02, 68.63it/s] 62%|██████▏   | 241/391 [00:03<00:02, 65.43it/s] 64%|██████▍   | 250/391 [00:04<00:02, 70.34it/s] 66%|██████▌   | 259/391 [00:04<00:01, 75.55it/s] 68%|██████▊   | 267/391 [00:04<00:01, 65.74it/s] 70%|███████   | 274/391 [00:04<00:01, 62.15it/s] 72%|███████▏  | 281/391 [00:04<00:01, 62.66it/s] 74%|███████▍  | 290/391 [00:04<00:01, 69.72it/s] 76%|███████▋  | 299/391 [00:04<00:01, 75.03it/s] 79%|███████▉  | 308/391 [00:04<00:01, 79.15it/s] 81%|████████  | 317/391 [00:04<00:00, 81.92it/s] 83%|████████▎ | 326/391 [00:05<00:00, 74.06it/s] 85%|████████▌ | 334/391 [00:05<00:00, 58.33it/s] 87%|████████▋ | 341/391 [00:05<00:00, 56.31it/s] 89%|████████▉ | 349/391 [00:05<00:00, 61.73it/s] 92%|█████████▏| 358/391 [00:05<00:00, 68.15it/s] 94%|█████████▍| 368/391 [00:05<00:00, 74.27it/s] 96%|█████████▋| 377/391 [00:05<00:00, 75.71it/s] 98%|█████████▊| 385/391 [00:06<00:00, 64.38it/s]100%|██████████| 391/391 [00:06<00:00, 63.26it/s]
50000 images processed, 6.280272483825684 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:21,  3.71it/s] 13%|█▎        | 10/79 [00:00<00:02, 33.26it/s] 20%|██        | 16/79 [00:00<00:01, 41.30it/s] 28%|██▊       | 22/79 [00:00<00:01, 41.47it/s] 34%|███▍      | 27/79 [00:00<00:01, 41.01it/s] 42%|████▏     | 33/79 [00:00<00:01, 45.17it/s] 53%|█████▎    | 42/79 [00:00<00:00, 57.34it/s] 65%|██████▍   | 51/79 [00:01<00:00, 65.53it/s] 76%|███████▌  | 60/79 [00:01<00:00, 70.84it/s] 86%|████████▌ | 68/79 [00:01<00:00, 71.98it/s] 96%|█████████▌| 76/79 [00:01<00:00, 61.60it/s]100%|██████████| 79/79 [00:01<00:00, 52.77it/s]
10000 images processed, 1.5160844326019287 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:02,  3.24it/s]  5%|▍         | 10/204 [00:00<00:06, 30.48it/s]  9%|▉         | 19/204 [00:00<00:03, 48.48it/s] 14%|█▎        | 28/204 [00:00<00:02, 60.72it/s] 18%|█▊        | 37/204 [00:00<00:02, 69.12it/s] 23%|██▎       | 46/204 [00:00<00:02, 68.28it/s] 26%|██▋       | 54/204 [00:01<00:02, 54.85it/s] 30%|██▉       | 61/204 [00:01<00:02, 51.62it/s] 34%|███▍      | 70/204 [00:01<00:02, 59.78it/s] 38%|███▊      | 78/204 [00:01<00:01, 63.91it/s] 42%|████▏     | 85/204 [00:01<00:01, 63.07it/s] 45%|████▌     | 92/204 [00:01<00:01, 57.10it/s] 49%|████▊     | 99/204 [00:01<00:01, 56.21it/s] 53%|█████▎    | 108/204 [00:01<00:01, 64.12it/s] 57%|█████▋    | 117/204 [00:02<00:01, 69.23it/s] 61%|██████▏   | 125/204 [00:02<00:01, 66.24it/s] 65%|██████▍   | 132/204 [00:02<00:01, 66.71it/s] 68%|██████▊   | 139/204 [00:02<00:01, 63.54it/s] 72%|███████▏  | 146/204 [00:02<00:00, 59.12it/s] 75%|███████▌  | 153/204 [00:02<00:00, 57.61it/s] 79%|███████▉  | 162/204 [00:02<00:00, 64.88it/s] 84%|████████▍ | 171/204 [00:02<00:00, 71.18it/s] 88%|████████▊ | 180/204 [00:02<00:00, 75.63it/s] 93%|█████████▎| 189/204 [00:03<00:00, 77.98it/s] 97%|█████████▋| 197/204 [00:03<00:00, 61.63it/s]100%|██████████| 204/204 [00:03<00:00, 57.70it/s]100%|██████████| 204/204 [00:03<00:00, 59.59it/s]
26032 images processed, 3.4662864208221436 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:41,  1.90it/s] 10%|█         | 8/79 [00:00<00:04, 16.23it/s] 15%|█▌        | 12/79 [00:00<00:03, 18.92it/s] 23%|██▎       | 18/79 [00:00<00:02, 27.16it/s] 29%|██▉       | 23/79 [00:01<00:01, 30.12it/s] 38%|███▊      | 30/79 [00:01<00:01, 38.82it/s] 47%|████▋     | 37/79 [00:01<00:00, 46.45it/s] 54%|█████▍    | 43/79 [00:01<00:00, 43.45it/s] 62%|██████▏   | 49/79 [00:01<00:00, 45.93it/s] 70%|██████▉   | 55/79 [00:01<00:00, 47.18it/s] 77%|███████▋  | 61/79 [00:01<00:00, 50.27it/s] 86%|████████▌ | 68/79 [00:01<00:00, 55.45it/s] 94%|█████████▎| 74/79 [00:01<00:00, 52.23it/s]100%|██████████| 79/79 [00:02<00:00, 37.90it/s]
10000 images processed, 2.1214332580566406 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:32,  2.42it/s] 11%|█▏        | 9/79 [00:00<00:03, 21.64it/s] 19%|█▉        | 15/79 [00:00<00:02, 31.27it/s] 25%|██▌       | 20/79 [00:00<00:01, 36.12it/s] 32%|███▏      | 25/79 [00:00<00:01, 37.76it/s] 39%|███▉      | 31/79 [00:00<00:01, 42.80it/s] 48%|████▊     | 38/79 [00:01<00:00, 49.76it/s] 59%|█████▉    | 47/79 [00:01<00:00, 59.20it/s] 71%|███████   | 56/79 [00:01<00:00, 67.19it/s] 82%|████████▏ | 65/79 [00:01<00:00, 73.14it/s] 92%|█████████▏| 73/79 [00:01<00:00, 61.81it/s]100%|██████████| 79/79 [00:01<00:00, 47.11it/s]
10000 images processed, 1.6997950077056885 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:26,  2.58it/s] 10%|█         | 7/70 [00:00<00:03, 17.92it/s] 20%|██        | 14/70 [00:00<00:01, 31.59it/s] 33%|███▎      | 23/70 [00:00<00:00, 47.36it/s] 46%|████▌     | 32/70 [00:00<00:00, 58.86it/s] 59%|█████▊    | 41/70 [00:00<00:00, 66.96it/s] 70%|███████   | 49/70 [00:01<00:00, 57.71it/s] 80%|████████  | 56/70 [00:01<00:00, 48.85it/s] 91%|█████████▏| 64/70 [00:01<00:00, 54.67it/s]100%|██████████| 70/70 [00:01<00:00, 47.79it/s]
8925 images processed, 1.4974706172943115 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:00<00:43,  1.01it/s]  7%|▋         | 3/45 [00:01<00:12,  3.35it/s] 18%|█▊        | 8/45 [00:01<00:03, 10.23it/s] 24%|██▍       | 11/45 [00:01<00:03,  9.50it/s] 31%|███       | 14/45 [00:01<00:02, 11.48it/s] 38%|███▊      | 17/45 [00:02<00:02,  9.49it/s] 53%|█████▎    | 24/45 [00:02<00:01, 16.63it/s] 60%|██████    | 27/45 [00:02<00:01, 12.44it/s] 73%|███████▎  | 33/45 [00:03<00:01, 11.12it/s] 87%|████████▋ | 39/45 [00:03<00:00, 15.66it/s] 93%|█████████▎| 42/45 [00:03<00:00, 12.31it/s]100%|██████████| 45/45 [00:03<00:00, 11.34it/s]
5640 images processed, 3.9872255325317383 seconds used

22.146708726882935
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.52  99.36
places365     67.86  81.18
LSUN          17.56  96.07
iSUN          72.34  81.68
dtd           37.87  91.39
AVG           39.63  89.94
Retain-Acc: 0.7407
Forget-as-OOD (retain known vs forget novel):
  FPR: 79.50 AUROC: 86.90 AUIN: 98.36
24.790958642959595
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e10-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.1-lora_r8a32d0.05-temp0.08-fullgrid
epochs=10 | cache=6 | flambda=0.1 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e10-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.1-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e10-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.1-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e10-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.1-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21843904
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<01:59,  3.27it/s]  2%|▏         | 7/391 [00:00<00:18, 20.61it/s]  4%|▍         | 15/391 [00:00<00:09, 38.60it/s]  6%|▌         | 24/391 [00:00<00:06, 53.91it/s]  8%|▊         | 33/391 [00:00<00:05, 64.37it/s] 11%|█         | 42/391 [00:00<00:04, 71.69it/s] 13%|█▎        | 50/391 [00:00<00:04, 72.46it/s] 15%|█▍        | 58/391 [00:01<00:05, 61.29it/s] 17%|█▋        | 65/391 [00:01<00:05, 59.71it/s] 19%|█▉        | 74/391 [00:01<00:04, 66.74it/s] 21%|██        | 83/391 [00:01<00:04, 72.77it/s] 24%|██▎       | 92/391 [00:01<00:03, 77.40it/s] 26%|██▌       | 101/391 [00:01<00:03, 80.76it/s] 28%|██▊       | 110/391 [00:01<00:03, 82.35it/s] 30%|███       | 119/391 [00:01<00:04, 67.07it/s] 32%|███▏      | 127/391 [00:02<00:04, 61.86it/s] 35%|███▍      | 136/391 [00:02<00:03, 68.33it/s] 37%|███▋      | 145/391 [00:02<00:03, 73.70it/s] 39%|███▉      | 154/391 [00:02<00:03, 77.86it/s] 42%|████▏     | 163/391 [00:02<00:02, 81.12it/s] 44%|████▍     | 172/391 [00:02<00:02, 83.38it/s] 46%|████▋     | 181/391 [00:02<00:02, 70.48it/s] 48%|████▊     | 189/391 [00:02<00:03, 65.17it/s] 50%|█████     | 196/391 [00:03<00:02, 65.48it/s] 52%|█████▏    | 205/391 [00:03<00:02, 71.44it/s] 55%|█████▍    | 214/391 [00:03<00:02, 75.75it/s] 57%|█████▋    | 223/391 [00:03<00:02, 79.23it/s] 59%|█████▉    | 232/391 [00:03<00:02, 77.75it/s] 61%|██████▏   | 240/391 [00:03<00:02, 65.37it/s] 63%|██████▎   | 247/391 [00:03<00:02, 61.65it/s] 65%|██████▌   | 256/391 [00:03<00:01, 68.47it/s] 68%|██████▊   | 265/391 [00:03<00:01, 74.04it/s] 70%|███████   | 274/391 [00:04<00:01, 78.21it/s] 72%|███████▏  | 283/391 [00:04<00:01, 78.54it/s] 75%|███████▍  | 292/391 [00:04<00:01, 64.74it/s] 77%|███████▋  | 300/391 [00:04<00:01, 61.26it/s] 79%|███████▉  | 309/391 [00:04<00:01, 67.83it/s] 81%|████████▏ | 318/391 [00:04<00:01, 72.45it/s] 84%|████████▎ | 327/391 [00:04<00:00, 76.18it/s] 86%|████████▌ | 336/391 [00:04<00:00, 78.95it/s] 88%|████████▊ | 345/391 [00:05<00:00, 74.01it/s] 90%|█████████ | 353/391 [00:05<00:00, 64.82it/s] 92%|█████████▏| 360/391 [00:05<00:00, 62.26it/s] 94%|█████████▍| 369/391 [00:05<00:00, 68.78it/s] 97%|█████████▋| 378/391 [00:05<00:00, 73.82it/s] 99%|█████████▉| 388/391 [00:05<00:00, 78.63it/s]100%|██████████| 391/391 [00:05<00:00, 68.50it/s]
50000 images processed, 5.800917625427246 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:27,  2.79it/s] 10%|█         | 8/79 [00:00<00:03, 21.45it/s] 22%|██▏       | 17/79 [00:00<00:01, 40.73it/s] 33%|███▎      | 26/79 [00:00<00:00, 54.27it/s] 44%|████▍     | 35/79 [00:00<00:00, 63.09it/s] 54%|█████▍    | 43/79 [00:00<00:00, 57.65it/s] 63%|██████▎   | 50/79 [00:01<00:00, 56.19it/s] 72%|███████▏  | 57/79 [00:01<00:00, 58.69it/s] 84%|████████▎ | 66/79 [00:01<00:00, 66.56it/s] 95%|█████████▍| 75/79 [00:01<00:00, 72.90it/s]100%|██████████| 79/79 [00:01<00:00, 54.98it/s]
10000 images processed, 1.4588947296142578 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:02,  3.25it/s]  4%|▍         | 8/204 [00:00<00:08, 23.86it/s]  8%|▊         | 17/204 [00:00<00:04, 43.58it/s] 13%|█▎        | 26/204 [00:00<00:03, 56.97it/s] 17%|█▋        | 35/204 [00:00<00:02, 66.18it/s] 21%|██        | 43/204 [00:00<00:02, 58.57it/s] 25%|██▍       | 50/204 [00:01<00:02, 55.03it/s] 28%|██▊       | 58/204 [00:01<00:02, 59.69it/s] 33%|███▎      | 67/204 [00:01<00:02, 67.26it/s] 37%|███▋      | 76/204 [00:01<00:01, 72.73it/s] 42%|████▏     | 85/204 [00:01<00:01, 76.83it/s] 46%|████▌     | 94/204 [00:01<00:01, 79.93it/s] 50%|█████     | 103/204 [00:01<00:01, 72.36it/s] 54%|█████▍    | 111/204 [00:01<00:01, 61.60it/s] 58%|█████▊    | 118/204 [00:01<00:01, 62.83it/s] 62%|██████▏   | 127/204 [00:02<00:01, 69.21it/s] 67%|██████▋   | 136/204 [00:02<00:00, 73.51it/s] 71%|███████   | 145/204 [00:02<00:00, 77.38it/s] 75%|███████▌  | 154/204 [00:02<00:00, 80.31it/s] 80%|███████▉  | 163/204 [00:02<00:00, 71.09it/s] 84%|████████▍ | 171/204 [00:02<00:00, 63.15it/s] 87%|████████▋ | 178/204 [00:02<00:00, 64.09it/s] 92%|█████████▏| 187/204 [00:02<00:00, 70.28it/s] 96%|█████████▌| 196/204 [00:03<00:00, 75.10it/s]100%|██████████| 204/204 [00:03<00:00, 65.05it/s]
26032 images processed, 3.1991615295410156 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:37,  2.07it/s] 11%|█▏        | 9/79 [00:00<00:03, 17.71it/s] 16%|█▋        | 13/79 [00:00<00:03, 21.76it/s] 23%|██▎       | 18/79 [00:00<00:02, 26.46it/s] 33%|███▎      | 26/79 [00:01<00:01, 31.80it/s] 39%|███▉      | 31/79 [00:01<00:01, 35.37it/s] 47%|████▋     | 37/79 [00:01<00:01, 40.30it/s] 53%|█████▎    | 42/79 [00:01<00:01, 36.93it/s] 61%|██████    | 48/79 [00:01<00:00, 41.27it/s] 68%|██████▊   | 54/79 [00:01<00:00, 45.50it/s] 75%|███████▍  | 59/79 [00:01<00:00, 39.68it/s] 81%|████████  | 64/79 [00:01<00:00, 41.74it/s] 87%|████████▋ | 69/79 [00:02<00:00, 43.40it/s] 94%|█████████▎| 74/79 [00:02<00:00, 44.45it/s]100%|██████████| 79/79 [00:02<00:00, 35.04it/s]
10000 images processed, 2.2909984588623047 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:29,  2.61it/s]  9%|▉         | 7/79 [00:00<00:03, 18.09it/s] 20%|██        | 16/79 [00:00<00:01, 38.01it/s] 32%|███▏      | 25/79 [00:00<00:01, 52.45it/s] 43%|████▎     | 34/79 [00:00<00:00, 62.76it/s] 54%|█████▍    | 43/79 [00:00<00:00, 69.98it/s] 66%|██████▌   | 52/79 [00:00<00:00, 75.15it/s] 77%|███████▋  | 61/79 [00:01<00:00, 62.42it/s] 87%|████████▋ | 69/79 [00:01<00:00, 60.08it/s] 99%|█████████▊| 78/79 [00:01<00:00, 65.92it/s]100%|██████████| 79/79 [00:01<00:00, 54.55it/s]
10000 images processed, 1.4650647640228271 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:23,  2.91it/s] 13%|█▎        | 9/70 [00:00<00:02, 25.23it/s] 26%|██▌       | 18/70 [00:00<00:01, 43.69it/s] 39%|███▊      | 27/70 [00:00<00:00, 56.96it/s] 51%|█████▏    | 36/70 [00:00<00:00, 65.56it/s] 64%|██████▍   | 45/70 [00:00<00:00, 70.66it/s] 76%|███████▌  | 53/70 [00:01<00:00, 58.33it/s] 86%|████████▌ | 60/70 [00:01<00:00, 56.94it/s] 99%|█████████▊| 69/70 [00:01<00:00, 64.84it/s]100%|██████████| 70/70 [00:01<00:00, 53.45it/s]
8925 images processed, 1.3479092121124268 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:00<00:39,  1.13it/s]  4%|▍         | 2/45 [00:00<00:18,  2.35it/s] 16%|█▌        | 7/45 [00:01<00:03,  9.89it/s] 22%|██▏       | 10/45 [00:01<00:03,  9.42it/s] 27%|██▋       | 12/45 [00:01<00:03,  9.42it/s] 38%|███▊      | 17/45 [00:01<00:02, 11.61it/s] 42%|████▏     | 19/45 [00:02<00:02, 12.60it/s] 47%|████▋     | 21/45 [00:02<00:02, 10.45it/s] 56%|█████▌    | 25/45 [00:02<00:01, 14.75it/s] 62%|██████▏   | 28/45 [00:02<00:01, 10.60it/s] 73%|███████▎  | 33/45 [00:03<00:00, 12.87it/s] 78%|███████▊  | 35/45 [00:03<00:00, 11.75it/s] 87%|████████▋ | 39/45 [00:03<00:00, 15.26it/s] 91%|█████████ | 41/45 [00:03<00:00, 14.68it/s] 96%|█████████▌| 43/45 [00:04<00:00, 12.05it/s]100%|██████████| 45/45 [00:04<00:00, 12.93it/s]100%|██████████| 45/45 [00:04<00:00, 10.86it/s]
5640 images processed, 4.1660332679748535 seconds used

21.350521564483643
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.52  99.36
places365     67.84  81.18
LSUN          17.47  96.10
iSUN          72.34  81.67
dtd           37.82  91.38
AVG           39.60  89.94
Retain-Acc: 0.7408
Forget-as-OOD (retain known vs forget novel):
  FPR: 79.50 AUROC: 86.88 AUIN: 98.36
20.957513093948364
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e20-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.1-lora_r8a32d0.05-temp0.08-fullgrid
epochs=20 | cache=6 | flambda=0.1 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e20-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.1-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e20-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.1-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e20-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.1-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21843904
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<01:47,  3.63it/s]  2%|▏         | 7/391 [00:00<00:17, 21.67it/s]  3%|▎         | 12/391 [00:00<00:12, 29.88it/s]  5%|▍         | 19/391 [00:00<00:09, 39.54it/s]  7%|▋         | 27/391 [00:00<00:07, 50.88it/s]  9%|▉         | 36/391 [00:00<00:05, 61.06it/s] 12%|█▏        | 45/391 [00:00<00:05, 68.94it/s] 14%|█▍        | 54/391 [00:01<00:04, 74.03it/s] 16%|█▌        | 62/391 [00:01<00:05, 64.36it/s] 18%|█▊        | 69/391 [00:01<00:05, 60.80it/s] 19%|█▉        | 76/391 [00:01<00:05, 61.49it/s] 22%|██▏       | 85/391 [00:01<00:04, 68.39it/s] 24%|██▍       | 94/391 [00:01<00:04, 74.02it/s] 26%|██▋       | 103/391 [00:01<00:03, 78.05it/s] 28%|██▊       | 111/391 [00:01<00:03, 74.24it/s] 30%|███       | 119/391 [00:02<00:04, 64.08it/s] 32%|███▏      | 126/391 [00:02<00:04, 61.41it/s] 35%|███▍      | 135/391 [00:02<00:03, 67.31it/s] 37%|███▋      | 144/391 [00:02<00:03, 72.59it/s] 39%|███▉      | 153/391 [00:02<00:03, 76.36it/s] 41%|████      | 161/391 [00:02<00:03, 71.65it/s] 43%|████▎     | 169/391 [00:02<00:03, 64.21it/s] 45%|████▌     | 176/391 [00:02<00:03, 61.12it/s] 47%|████▋     | 185/391 [00:02<00:03, 67.30it/s] 50%|████▉     | 194/391 [00:03<00:02, 72.22it/s] 52%|█████▏    | 203/391 [00:03<00:02, 76.68it/s] 54%|█████▍    | 211/391 [00:03<00:02, 76.13it/s] 56%|█████▌    | 219/391 [00:03<00:02, 64.22it/s] 58%|█████▊    | 226/391 [00:03<00:02, 61.38it/s] 60%|██████    | 235/391 [00:03<00:02, 67.69it/s] 62%|██████▏   | 244/391 [00:03<00:02, 73.04it/s] 65%|██████▍   | 253/391 [00:03<00:01, 77.30it/s] 67%|██████▋   | 262/391 [00:04<00:01, 80.56it/s] 69%|██████▉   | 271/391 [00:04<00:01, 74.21it/s] 71%|███████▏  | 279/391 [00:04<00:01, 66.44it/s] 73%|███████▎  | 286/391 [00:04<00:01, 62.83it/s] 75%|███████▌  | 295/391 [00:04<00:01, 69.29it/s] 78%|███████▊  | 304/391 [00:04<00:01, 74.18it/s] 80%|████████  | 313/391 [00:04<00:00, 78.08it/s] 82%|████████▏ | 322/391 [00:04<00:00, 74.36it/s] 84%|████████▍ | 330/391 [00:05<00:00, 65.16it/s] 86%|████████▌ | 337/391 [00:05<00:00, 62.13it/s] 88%|████████▊ | 346/391 [00:05<00:00, 68.84it/s] 91%|█████████ | 355/391 [00:05<00:00, 72.82it/s] 93%|█████████▎| 364/391 [00:05<00:00, 76.88it/s] 95%|█████████▌| 372/391 [00:05<00:00, 72.55it/s] 97%|█████████▋| 380/391 [00:05<00:00, 64.59it/s] 99%|█████████▉| 387/391 [00:05<00:00, 61.71it/s]100%|██████████| 391/391 [00:05<00:00, 65.63it/s]
50000 images processed, 6.039362192153931 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:27,  2.82it/s] 13%|█▎        | 10/79 [00:00<00:02, 27.67it/s] 24%|██▍       | 19/79 [00:00<00:01, 45.14it/s] 35%|███▌      | 28/79 [00:00<00:00, 58.07it/s] 46%|████▌     | 36/79 [00:00<00:00, 63.93it/s] 56%|█████▌    | 44/79 [00:00<00:00, 56.58it/s] 65%|██████▍   | 51/79 [00:01<00:00, 55.42it/s] 75%|███████▍  | 59/79 [00:01<00:00, 61.33it/s] 86%|████████▌ | 68/79 [00:01<00:00, 68.66it/s] 97%|█████████▋| 77/79 [00:01<00:00, 74.42it/s]100%|██████████| 79/79 [00:01<00:00, 56.21it/s]
10000 images processed, 1.428466796875 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:04,  3.15it/s]  4%|▍         | 8/204 [00:00<00:08, 23.15it/s]  7%|▋         | 14/204 [00:00<00:05, 33.87it/s] 12%|█▏        | 24/204 [00:00<00:03, 52.63it/s] 17%|█▋        | 34/204 [00:00<00:02, 65.51it/s] 21%|██        | 43/204 [00:00<00:02, 72.17it/s] 26%|██▌       | 53/204 [00:00<00:01, 78.29it/s] 30%|███       | 62/204 [00:01<00:01, 81.11it/s] 35%|███▌      | 72/204 [00:01<00:01, 84.50it/s] 40%|███▉      | 81/204 [00:01<00:01, 84.03it/s] 44%|████▍     | 90/204 [00:01<00:01, 85.37it/s] 49%|████▊     | 99/204 [00:01<00:01, 84.84it/s] 53%|█████▎    | 108/204 [00:01<00:01, 83.86it/s] 58%|█████▊    | 118/204 [00:01<00:00, 86.97it/s] 62%|██████▏   | 127/204 [00:01<00:00, 87.82it/s] 67%|██████▋   | 137/204 [00:01<00:00, 89.57it/s] 72%|███████▏  | 146/204 [00:02<00:00, 78.09it/s] 76%|███████▌  | 155/204 [00:02<00:00, 80.41it/s] 80%|████████  | 164/204 [00:02<00:00, 78.99it/s] 85%|████████▍ | 173/204 [00:02<00:00, 80.91it/s] 89%|████████▉ | 182/204 [00:02<00:00, 81.66it/s] 94%|█████████▎| 191/204 [00:02<00:00, 76.39it/s] 98%|█████████▊| 199/204 [00:02<00:00, 65.99it/s]100%|██████████| 204/204 [00:02<00:00, 70.24it/s]
26032 images processed, 2.9515058994293213 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:39,  1.97it/s]  8%|▊         | 6/79 [00:00<00:06, 12.04it/s] 14%|█▍        | 11/79 [00:00<00:03, 20.83it/s] 23%|██▎       | 18/79 [00:00<00:01, 32.36it/s] 32%|███▏      | 25/79 [00:00<00:01, 38.65it/s] 38%|███▊      | 30/79 [00:01<00:01, 39.47it/s] 44%|████▍     | 35/79 [00:01<00:01, 42.08it/s] 51%|█████     | 40/79 [00:01<00:00, 43.49it/s] 62%|██████▏   | 49/79 [00:01<00:00, 50.97it/s] 70%|██████▉   | 55/79 [00:01<00:00, 42.71it/s] 77%|███████▋  | 61/79 [00:01<00:00, 44.27it/s] 85%|████████▍ | 67/79 [00:01<00:00, 46.91it/s] 94%|█████████▎| 74/79 [00:02<00:00, 47.99it/s]100%|██████████| 79/79 [00:02<00:00, 48.12it/s]100%|██████████| 79/79 [00:02<00:00, 37.53it/s]
10000 images processed, 2.147416830062866 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:27,  2.81it/s] 11%|█▏        | 9/79 [00:00<00:02, 24.18it/s] 23%|██▎       | 18/79 [00:00<00:01, 42.60it/s] 34%|███▍      | 27/79 [00:00<00:00, 55.84it/s] 46%|████▌     | 36/79 [00:00<00:00, 65.18it/s] 57%|█████▋    | 45/79 [00:00<00:00, 70.27it/s] 67%|██████▋   | 53/79 [00:01<00:00, 58.16it/s] 76%|███████▌  | 60/79 [00:01<00:00, 56.79it/s] 87%|████████▋ | 69/79 [00:01<00:00, 64.79it/s] 99%|█████████▊| 78/79 [00:01<00:00, 71.15it/s]100%|██████████| 79/79 [00:01<00:00, 55.99it/s]
10000 images processed, 1.4328546524047852 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:26,  2.59it/s]  9%|▊         | 6/70 [00:00<00:04, 14.55it/s] 16%|█▌        | 11/70 [00:00<00:02, 23.99it/s] 26%|██▌       | 18/70 [00:00<00:01, 35.87it/s] 39%|███▊      | 27/70 [00:00<00:00, 50.48it/s] 51%|█████▏    | 36/70 [00:00<00:00, 61.11it/s] 64%|██████▍   | 45/70 [00:01<00:00, 68.41it/s] 76%|███████▌  | 53/70 [00:01<00:00, 69.17it/s] 87%|████████▋ | 61/70 [00:01<00:00, 59.22it/s] 97%|█████████▋| 68/70 [00:01<00:00, 57.76it/s]100%|██████████| 70/70 [00:01<00:00, 47.47it/s]
8925 images processed, 1.5043957233428955 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:01<00:45,  1.03s/it] 16%|█▌        | 7/45 [00:01<00:04,  7.91it/s] 22%|██▏       | 10/45 [00:01<00:04,  8.02it/s] 27%|██▋       | 12/45 [00:01<00:03,  9.49it/s] 31%|███       | 14/45 [00:01<00:02, 10.85it/s] 38%|███▊      | 17/45 [00:02<00:02,  9.40it/s] 44%|████▍     | 20/45 [00:02<00:02, 11.75it/s] 53%|█████▎    | 24/45 [00:02<00:01, 16.29it/s] 60%|██████    | 27/45 [00:02<00:01, 12.80it/s] 67%|██████▋   | 30/45 [00:02<00:01, 13.96it/s] 73%|███████▎  | 33/45 [00:03<00:01,  9.52it/s] 91%|█████████ | 41/45 [00:03<00:00, 11.93it/s]100%|██████████| 45/45 [00:04<00:00, 11.20it/s]
5640 images processed, 4.040559768676758 seconds used

21.1426784992218
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.51  99.36
places365     67.95  81.18
LSUN          17.35  96.12
iSUN          72.30  81.63
dtd           37.84  91.36
AVG           39.59  89.93
Retain-Acc: 0.7409
Forget-as-OOD (retain known vs forget novel):
  FPR: 79.50 AUROC: 86.85 AUIN: 98.35
16.759540796279907
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e50-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.1-lora_r8a32d0.05-temp0.08-fullgrid
epochs=50 | cache=6 | flambda=0.1 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e50-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.1-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e50-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.1-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e50-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.1-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21843904
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<02:05,  3.12it/s]  3%|▎         | 10/391 [00:00<00:13, 29.11it/s]  4%|▍         | 16/391 [00:00<00:10, 37.43it/s]  7%|▋         | 26/391 [00:00<00:06, 54.31it/s]  9%|▉         | 36/391 [00:00<00:05, 65.66it/s] 12%|█▏        | 45/391 [00:00<00:04, 71.69it/s] 14%|█▍        | 54/391 [00:00<00:04, 76.81it/s] 16%|█▌        | 63/391 [00:01<00:04, 80.46it/s] 18%|█▊        | 72/391 [00:01<00:04, 71.96it/s] 20%|██        | 80/391 [00:01<00:04, 65.01it/s] 22%|██▏       | 87/391 [00:01<00:04, 62.20it/s] 25%|██▍       | 96/391 [00:01<00:04, 68.49it/s] 27%|██▋       | 105/391 [00:01<00:03, 73.77it/s] 29%|██▉       | 114/391 [00:01<00:03, 77.85it/s] 31%|███▏      | 123/391 [00:01<00:03, 81.06it/s] 34%|███▍      | 132/391 [00:02<00:03, 83.32it/s] 36%|███▌      | 141/391 [00:02<00:03, 69.22it/s] 38%|███▊      | 149/391 [00:02<00:03, 63.06it/s] 40%|████      | 157/391 [00:02<00:03, 66.56it/s] 42%|████▏     | 166/391 [00:02<00:03, 71.57it/s] 45%|████▍     | 174/391 [00:02<00:03, 70.56it/s] 47%|████▋     | 182/391 [00:02<00:03, 68.53it/s] 49%|████▊     | 190/391 [00:02<00:02, 71.04it/s] 51%|█████     | 198/391 [00:03<00:02, 67.27it/s] 52%|█████▏    | 205/391 [00:03<00:03, 61.21it/s] 54%|█████▍    | 212/391 [00:03<00:03, 59.49it/s] 57%|█████▋    | 221/391 [00:03<00:02, 66.28it/s] 59%|█████▉    | 230/391 [00:03<00:02, 70.73it/s] 61%|██████    | 239/391 [00:03<00:02, 74.96it/s] 63%|██████▎   | 248/391 [00:03<00:01, 78.69it/s] 65%|██████▌   | 256/391 [00:03<00:01, 69.33it/s] 68%|██████▊   | 264/391 [00:04<00:01, 64.80it/s] 69%|██████▉   | 271/391 [00:04<00:01, 62.15it/s] 72%|███████▏  | 280/391 [00:04<00:01, 68.58it/s] 74%|███████▍  | 289/391 [00:04<00:01, 73.74it/s] 76%|███████▌  | 298/391 [00:04<00:01, 77.78it/s] 79%|███████▊  | 307/391 [00:04<00:01, 80.25it/s] 81%|████████  | 316/391 [00:04<00:01, 74.57it/s] 83%|████████▎ | 324/391 [00:04<00:01, 65.98it/s] 85%|████████▍ | 331/391 [00:04<00:00, 62.52it/s] 87%|████████▋ | 340/391 [00:05<00:00, 68.40it/s] 89%|████████▉ | 349/391 [00:05<00:00, 73.03it/s] 92%|█████████▏| 358/391 [00:05<00:00, 77.19it/s] 94%|█████████▍| 367/391 [00:05<00:00, 80.39it/s] 96%|█████████▌| 376/391 [00:05<00:00, 70.10it/s] 98%|█████████▊| 384/391 [00:05<00:00, 65.20it/s]100%|██████████| 391/391 [00:05<00:00, 62.28it/s]100%|██████████| 391/391 [00:05<00:00, 67.09it/s]
50000 images processed, 5.933064699172974 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:29,  2.68it/s] 11%|█▏        | 9/79 [00:00<00:02, 23.77it/s] 23%|██▎       | 18/79 [00:00<00:01, 41.94it/s] 34%|███▍      | 27/79 [00:00<00:00, 54.94it/s] 46%|████▌     | 36/79 [00:00<00:00, 64.40it/s] 57%|█████▋    | 45/79 [00:00<00:00, 68.19it/s] 67%|██████▋   | 53/79 [00:01<00:00, 58.56it/s] 76%|███████▌  | 60/79 [00:01<00:00, 56.73it/s] 87%|████████▋ | 69/79 [00:01<00:00, 63.50it/s] 99%|█████████▊| 78/79 [00:01<00:00, 69.60it/s]100%|██████████| 79/79 [00:01<00:00, 54.40it/s]
10000 images processed, 1.475949764251709 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:21,  2.49it/s]  4%|▍         | 8/204 [00:00<00:09, 19.80it/s]  8%|▊         | 17/204 [00:00<00:04, 38.35it/s] 13%|█▎        | 26/204 [00:00<00:03, 51.93it/s] 17%|█▋        | 35/204 [00:00<00:02, 61.28it/s] 22%|██▏       | 44/204 [00:00<00:02, 68.46it/s] 25%|██▌       | 52/204 [00:01<00:02, 61.17it/s] 29%|██▉       | 59/204 [00:01<00:02, 57.65it/s] 32%|███▏      | 66/204 [00:01<00:02, 59.95it/s] 37%|███▋      | 75/204 [00:01<00:01, 66.89it/s] 41%|████      | 83/204 [00:01<00:01, 70.37it/s] 45%|████▌     | 92/204 [00:01<00:01, 74.79it/s] 49%|████▉     | 100/204 [00:01<00:01, 75.21it/s] 53%|█████▎    | 108/204 [00:01<00:01, 61.39it/s] 56%|█████▋    | 115/204 [00:02<00:01, 58.23it/s] 61%|██████    | 124/204 [00:02<00:01, 65.21it/s] 65%|██████▌   | 133/204 [00:02<00:01, 70.09it/s] 70%|██████▉   | 142/204 [00:02<00:00, 74.49it/s] 74%|███████▍  | 151/204 [00:02<00:00, 77.37it/s] 78%|███████▊  | 159/204 [00:02<00:00, 64.90it/s] 81%|████████▏ | 166/204 [00:02<00:00, 58.43it/s] 86%|████████▌ | 175/204 [00:02<00:00, 64.43it/s] 90%|█████████ | 184/204 [00:03<00:00, 69.46it/s] 95%|█████████▍| 193/204 [00:03<00:00, 73.57it/s] 99%|█████████▉| 202/204 [00:03<00:00, 77.08it/s]100%|██████████| 204/204 [00:03<00:00, 62.05it/s]
26032 images processed, 3.3414318561553955 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:53,  1.46it/s]  8%|▊         | 6/79 [00:00<00:07,  9.51it/s] 15%|█▌        | 12/79 [00:00<00:03, 18.69it/s] 25%|██▌       | 20/79 [00:01<00:01, 31.55it/s] 33%|███▎      | 26/79 [00:01<00:01, 31.27it/s] 41%|████      | 32/79 [00:01<00:01, 36.14it/s] 48%|████▊     | 38/79 [00:01<00:01, 40.63it/s] 54%|█████▍    | 43/79 [00:01<00:01, 34.18it/s] 62%|██████▏   | 49/79 [00:01<00:00, 36.35it/s] 72%|███████▏  | 57/79 [00:02<00:00, 36.51it/s] 80%|███████▉  | 63/79 [00:02<00:00, 40.00it/s] 86%|████████▌ | 68/79 [00:02<00:00, 40.81it/s] 92%|█████████▏| 73/79 [00:02<00:00, 38.92it/s] 99%|█████████▊| 78/79 [00:02<00:00, 41.03it/s]100%|██████████| 79/79 [00:02<00:00, 31.69it/s]
10000 images processed, 2.532012939453125 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:49,  1.57it/s] 11%|█▏        | 9/79 [00:00<00:04, 15.89it/s] 23%|██▎       | 18/79 [00:00<00:01, 30.89it/s] 34%|███▍      | 27/79 [00:00<00:01, 43.73it/s] 46%|████▌     | 36/79 [00:01<00:00, 54.44it/s] 56%|█████▌    | 44/79 [00:01<00:00, 52.51it/s] 65%|██████▍   | 51/79 [00:01<00:00, 51.48it/s] 73%|███████▎  | 58/79 [00:01<00:00, 55.69it/s] 85%|████████▍ | 67/79 [00:01<00:00, 63.66it/s] 96%|█████████▌| 76/79 [00:01<00:00, 70.01it/s]100%|██████████| 79/79 [00:01<00:00, 46.60it/s]
10000 images processed, 1.7198340892791748 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:32,  2.14it/s]  9%|▊         | 6/70 [00:00<00:04, 13.23it/s] 17%|█▋        | 12/70 [00:00<00:02, 24.65it/s] 30%|███       | 21/70 [00:00<00:01, 40.64it/s] 43%|████▎     | 30/70 [00:00<00:00, 53.21it/s] 56%|█████▌    | 39/70 [00:00<00:00, 61.65it/s] 67%|██████▋   | 47/70 [00:01<00:00, 58.34it/s] 77%|███████▋  | 54/70 [00:01<00:00, 56.97it/s] 87%|████████▋ | 61/70 [00:01<00:00, 56.14it/s]100%|██████████| 70/70 [00:01<00:00, 63.40it/s]100%|██████████| 70/70 [00:01<00:00, 46.13it/s]
8925 images processed, 1.555938959121704 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:00<00:41,  1.06it/s]  4%|▍         | 2/45 [00:01<00:20,  2.15it/s] 16%|█▌        | 7/45 [00:01<00:04,  9.34it/s] 22%|██▏       | 10/45 [00:01<00:04,  8.23it/s] 31%|███       | 14/45 [00:01<00:02, 11.25it/s] 38%|███▊      | 17/45 [00:01<00:02, 13.08it/s] 42%|████▏     | 19/45 [00:02<00:02, 12.69it/s] 47%|████▋     | 21/45 [00:02<00:01, 12.29it/s] 56%|█████▌    | 25/45 [00:02<00:01, 15.34it/s] 60%|██████    | 27/45 [00:02<00:01, 14.00it/s] 64%|██████▍   | 29/45 [00:02<00:01, 13.63it/s] 69%|██████▉   | 31/45 [00:02<00:00, 14.03it/s] 73%|███████▎  | 33/45 [00:03<00:00, 12.23it/s] 78%|███████▊  | 35/45 [00:03<00:00, 13.71it/s] 84%|████████▍ | 38/45 [00:03<00:00, 16.96it/s] 89%|████████▉ | 40/45 [00:03<00:00, 17.63it/s] 93%|█████████▎| 42/45 [00:03<00:00,  9.98it/s] 98%|█████████▊| 44/45 [00:04<00:00,  9.91it/s]100%|██████████| 45/45 [00:04<00:00, 10.89it/s]
5640 images processed, 4.155870676040649 seconds used

22.612935781478882
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           4.79  98.96
places365     77.97  78.26
LSUN          30.69  94.29
iSUN          81.22  78.28
dtd           46.99  89.48
AVG           48.33  87.85
Retain-Acc: 0.7411
Forget-as-OOD (retain known vs forget novel):
  FPR: 55.80 AUROC: 89.04 AUIN: 98.60
27.628483295440674
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e5-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl0.1-lora_r8a32d0.05-temp0.08-fullgrid
epochs=5 | cache=6 | flambda=0.1 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl0.1-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl0.1-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl0.1-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21843904
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<02:48,  2.32it/s]  2%|▏         | 6/391 [00:00<00:27, 13.92it/s]  3%|▎         | 12/391 [00:00<00:14, 25.78it/s]  5%|▌         | 21/391 [00:00<00:08, 42.75it/s]  7%|▋         | 28/391 [00:00<00:07, 49.99it/s]  9%|▉         | 35/391 [00:00<00:06, 53.58it/s] 11%|█         | 43/391 [00:01<00:05, 60.43it/s] 13%|█▎        | 50/391 [00:01<00:06, 55.71it/s] 15%|█▍        | 57/391 [00:01<00:06, 50.65it/s] 16%|█▌        | 63/391 [00:01<00:06, 48.63it/s] 18%|█▊        | 72/391 [00:01<00:05, 57.16it/s] 20%|██        | 79/391 [00:01<00:05, 58.82it/s] 22%|██▏       | 86/391 [00:01<00:05, 60.42it/s] 24%|██▍       | 95/391 [00:01<00:04, 66.59it/s] 26%|██▌       | 102/391 [00:02<00:04, 63.70it/s] 28%|██▊       | 109/391 [00:02<00:05, 52.70it/s] 29%|██▉       | 115/391 [00:02<00:05, 53.68it/s] 31%|███       | 121/391 [00:02<00:05, 53.44it/s] 33%|███▎      | 128/391 [00:02<00:04, 56.27it/s] 35%|███▍      | 135/391 [00:02<00:04, 58.91it/s] 37%|███▋      | 143/391 [00:02<00:03, 64.53it/s] 39%|███▊      | 151/391 [00:02<00:03, 66.59it/s] 40%|████      | 158/391 [00:03<00:03, 61.40it/s] 42%|████▏     | 165/391 [00:03<00:04, 54.37it/s] 44%|████▎     | 171/391 [00:03<00:04, 54.96it/s] 45%|████▌     | 177/391 [00:03<00:04, 53.13it/s] 47%|████▋     | 184/391 [00:03<00:03, 55.78it/s] 49%|████▉     | 193/391 [00:03<00:03, 63.97it/s] 51%|█████     | 200/391 [00:03<00:02, 65.18it/s] 53%|█████▎    | 207/391 [00:03<00:02, 64.79it/s] 55%|█████▍    | 215/391 [00:03<00:02, 67.04it/s] 57%|█████▋    | 222/391 [00:04<00:02, 58.86it/s] 59%|█████▊    | 229/391 [00:04<00:03, 51.63it/s] 60%|██████    | 235/391 [00:04<00:03, 51.66it/s] 62%|██████▏   | 244/391 [00:04<00:02, 59.18it/s] 64%|██████▍   | 251/391 [00:04<00:02, 59.64it/s] 66%|██████▌   | 259/391 [00:04<00:02, 63.20it/s] 68%|██████▊   | 267/391 [00:04<00:01, 66.85it/s] 70%|███████   | 274/391 [00:05<00:01, 59.35it/s] 72%|███████▏  | 281/391 [00:05<00:02, 52.95it/s] 73%|███████▎  | 287/391 [00:05<00:02, 50.56it/s] 75%|███████▌  | 294/391 [00:05<00:01, 54.55it/s] 77%|███████▋  | 300/391 [00:05<00:01, 55.17it/s] 79%|███████▉  | 308/391 [00:05<00:01, 60.28it/s] 81%|████████  | 316/391 [00:05<00:01, 63.50it/s] 83%|████████▎ | 323/391 [00:05<00:01, 52.89it/s] 84%|████████▍ | 329/391 [00:06<00:01, 50.80it/s] 86%|████████▌ | 335/391 [00:06<00:01, 51.43it/s] 87%|████████▋ | 342/391 [00:06<00:00, 54.31it/s] 89%|████████▉ | 349/391 [00:06<00:00, 57.13it/s] 91%|█████████▏| 357/391 [00:06<00:00, 62.84it/s] 93%|█████████▎| 365/391 [00:06<00:00, 65.64it/s] 95%|█████████▌| 372/391 [00:06<00:00, 61.70it/s] 97%|█████████▋| 379/391 [00:06<00:00, 52.87it/s] 98%|█████████▊| 385/391 [00:07<00:00, 53.70it/s]100%|██████████| 391/391 [00:07<00:00, 52.28it/s]100%|██████████| 391/391 [00:07<00:00, 54.63it/s]
50000 images processed, 7.2331743240356445 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:28,  2.78it/s]  8%|▊         | 6/79 [00:00<00:04, 15.85it/s] 14%|█▍        | 11/79 [00:00<00:02, 24.32it/s] 19%|█▉        | 15/79 [00:00<00:02, 28.52it/s] 28%|██▊       | 22/79 [00:00<00:01, 39.62it/s] 39%|███▉      | 31/79 [00:00<00:00, 52.87it/s] 48%|████▊     | 38/79 [00:01<00:00, 56.27it/s] 57%|█████▋    | 45/79 [00:01<00:00, 57.39it/s] 68%|██████▊   | 54/79 [00:01<00:00, 65.84it/s] 77%|███████▋  | 61/79 [00:01<00:00, 66.44it/s] 86%|████████▌ | 68/79 [00:01<00:00, 53.55it/s] 94%|█████████▎| 74/79 [00:01<00:00, 50.76it/s]100%|██████████| 79/79 [00:01<00:00, 45.31it/s]
10000 images processed, 1.777045488357544 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:13,  2.74it/s]  4%|▍         | 8/204 [00:00<00:09, 21.23it/s]  8%|▊         | 17/204 [00:00<00:04, 40.00it/s] 12%|█▏        | 24/204 [00:00<00:04, 41.68it/s] 15%|█▍        | 30/204 [00:00<00:04, 40.35it/s] 17%|█▋        | 35/204 [00:01<00:04, 39.64it/s] 20%|██        | 41/204 [00:01<00:03, 44.09it/s] 23%|██▎       | 46/204 [00:01<00:03, 44.40it/s] 26%|██▌       | 53/204 [00:01<00:03, 49.53it/s] 30%|██▉       | 61/204 [00:01<00:02, 57.29it/s] 33%|███▎      | 68/204 [00:01<00:02, 53.96it/s] 36%|███▋      | 74/204 [00:01<00:02, 47.30it/s] 39%|███▉      | 80/204 [00:01<00:02, 48.55it/s] 43%|████▎     | 88/204 [00:01<00:02, 55.06it/s] 47%|████▋     | 95/204 [00:02<00:01, 57.17it/s] 50%|█████     | 102/204 [00:02<00:01, 59.49it/s] 54%|█████▍    | 110/204 [00:02<00:01, 60.46it/s] 57%|█████▋    | 117/204 [00:02<00:01, 53.31it/s] 61%|██████▏   | 125/204 [00:02<00:01, 58.32it/s] 66%|██████▌   | 134/204 [00:02<00:01, 65.61it/s] 69%|██████▉   | 141/204 [00:02<00:00, 66.24it/s] 73%|███████▎  | 148/204 [00:02<00:00, 65.35it/s] 77%|███████▋  | 157/204 [00:03<00:00, 71.09it/s] 81%|████████▏ | 166/204 [00:03<00:00, 74.06it/s] 85%|████████▌ | 174/204 [00:03<00:00, 70.55it/s] 89%|████████▉ | 182/204 [00:03<00:00, 72.51it/s] 93%|█████████▎| 190/204 [00:03<00:00, 72.93it/s] 97%|█████████▋| 198/204 [00:03<00:00, 69.59it/s]100%|██████████| 204/204 [00:03<00:00, 54.99it/s]
26032 images processed, 3.7594847679138184 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:45,  1.70it/s]  6%|▋         | 5/79 [00:00<00:08,  9.14it/s] 14%|█▍        | 11/79 [00:00<00:03, 20.18it/s] 22%|██▏       | 17/79 [00:00<00:02, 28.50it/s] 28%|██▊       | 22/79 [00:01<00:01, 32.91it/s] 34%|███▍      | 27/79 [00:01<00:01, 34.11it/s] 41%|████      | 32/79 [00:01<00:01, 35.82it/s] 48%|████▊     | 38/79 [00:01<00:01, 39.43it/s] 56%|█████▌    | 44/79 [00:01<00:00, 42.66it/s] 65%|██████▍   | 51/79 [00:01<00:00, 46.94it/s] 72%|███████▏  | 57/79 [00:01<00:00, 50.06it/s] 80%|███████▉  | 63/79 [00:01<00:00, 44.34it/s] 86%|████████▌ | 68/79 [00:02<00:00, 42.14it/s] 92%|█████████▏| 73/79 [00:02<00:00, 39.79it/s]100%|██████████| 79/79 [00:02<00:00, 34.52it/s]
10000 images processed, 2.328939437866211 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:35,  2.17it/s]  9%|▉         | 7/79 [00:00<00:04, 15.63it/s] 16%|█▋        | 13/79 [00:00<00:02, 26.03it/s] 24%|██▍       | 19/79 [00:00<00:01, 34.30it/s] 35%|███▌      | 28/79 [00:00<00:01, 48.23it/s] 44%|████▍     | 35/79 [00:01<00:00, 51.07it/s] 53%|█████▎    | 42/79 [00:01<00:00, 54.87it/s] 62%|██████▏   | 49/79 [00:01<00:00, 53.64it/s] 70%|██████▉   | 55/79 [00:01<00:00, 47.36it/s] 77%|███████▋  | 61/79 [00:01<00:00, 45.68it/s] 89%|████████▊ | 70/79 [00:01<00:00, 55.79it/s] 97%|█████████▋| 77/79 [00:01<00:00, 58.74it/s]100%|██████████| 79/79 [00:01<00:00, 43.96it/s]
10000 images processed, 1.8239378929138184 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:28,  2.41it/s]  7%|▋         | 5/70 [00:00<00:05, 11.60it/s] 16%|█▌        | 11/70 [00:00<00:02, 23.57it/s] 27%|██▋       | 19/70 [00:00<00:01, 38.32it/s] 37%|███▋      | 26/70 [00:00<00:00, 45.66it/s] 46%|████▌     | 32/70 [00:00<00:00, 49.10it/s] 56%|█████▌    | 39/70 [00:01<00:00, 53.34it/s] 64%|██████▍   | 45/70 [00:01<00:00, 46.07it/s] 73%|███████▎  | 51/70 [00:01<00:00, 42.72it/s] 86%|████████▌ | 60/70 [00:01<00:00, 53.06it/s] 94%|█████████▍| 66/70 [00:01<00:00, 54.51it/s]100%|██████████| 70/70 [00:01<00:00, 41.70it/s]
8925 images processed, 1.7093515396118164 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:00<00:38,  1.13it/s]  4%|▍         | 2/45 [00:01<00:19,  2.26it/s] 20%|██        | 9/45 [00:01<00:03,  9.91it/s] 24%|██▍       | 11/45 [00:01<00:03,  9.00it/s] 31%|███       | 14/45 [00:01<00:02, 11.55it/s] 38%|███▊      | 17/45 [00:01<00:02, 12.79it/s] 42%|████▏     | 19/45 [00:02<00:01, 13.16it/s] 49%|████▉     | 22/45 [00:02<00:01, 13.03it/s] 56%|█████▌    | 25/45 [00:02<00:01, 14.00it/s] 60%|██████    | 27/45 [00:02<00:01, 13.87it/s] 67%|██████▋   | 30/45 [00:02<00:01, 12.54it/s] 73%|███████▎  | 33/45 [00:03<00:01, 11.44it/s] 78%|███████▊  | 35/45 [00:03<00:00, 10.12it/s] 89%|████████▉ | 40/45 [00:03<00:00, 14.50it/s] 93%|█████████▎| 42/45 [00:04<00:00,  8.81it/s]100%|██████████| 45/45 [00:04<00:00, 10.58it/s]
5640 images processed, 4.279787302017212 seconds used

24.557666063308716
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.52  99.36
places365     67.86  81.18
LSUN          17.60  96.07
iSUN          72.34  81.68
dtd           37.85  91.39
AVG           39.63  89.93
Retain-Acc: 0.7406
Forget-as-OOD (retain known vs forget novel):
  FPR: 79.50 AUROC: 86.90 AUIN: 98.36
28.644190311431885
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e10-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl0.1-lora_r8a32d0.05-temp0.08-fullgrid
epochs=10 | cache=6 | flambda=0.1 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e10-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl0.1-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e10-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl0.1-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e10-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl0.1-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21843904
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<03:03,  2.12it/s]  1%|▏         | 5/391 [00:00<00:36, 10.59it/s]  2%|▏         | 9/391 [00:00<00:21, 17.53it/s]  3%|▎         | 13/391 [00:00<00:17, 21.73it/s]  4%|▍         | 17/391 [00:00<00:14, 25.99it/s]  6%|▌         | 22/391 [00:01<00:11, 31.59it/s]  7%|▋         | 28/391 [00:01<00:09, 37.50it/s]  9%|▊         | 34/391 [00:01<00:08, 40.75it/s] 10%|▉         | 39/391 [00:01<00:08, 41.89it/s] 11%|█▏        | 44/391 [00:01<00:08, 41.73it/s] 13%|█▎        | 50/391 [00:01<00:07, 46.08it/s] 14%|█▍        | 56/391 [00:01<00:07, 47.01it/s] 16%|█▌        | 61/391 [00:01<00:07, 46.34it/s] 17%|█▋        | 66/391 [00:01<00:07, 43.65it/s] 18%|█▊        | 71/391 [00:02<00:07, 41.34it/s] 19%|█▉        | 76/391 [00:02<00:08, 38.22it/s] 20%|██        | 80/391 [00:02<00:08, 36.89it/s] 21%|██▏       | 84/391 [00:02<00:08, 35.00it/s] 23%|██▎       | 89/391 [00:02<00:07, 38.47it/s] 24%|██▍       | 95/391 [00:02<00:06, 42.76it/s] 26%|██▌       | 100/391 [00:02<00:06, 42.99it/s] 27%|██▋       | 105/391 [00:02<00:06, 43.23it/s] 28%|██▊       | 110/391 [00:03<00:06, 43.36it/s] 30%|██▉       | 116/391 [00:03<00:05, 46.61it/s] 31%|███       | 121/391 [00:03<00:05, 46.26it/s] 32%|███▏      | 126/391 [00:03<00:05, 45.25it/s] 34%|███▎      | 131/391 [00:03<00:05, 44.69it/s] 35%|███▌      | 137/391 [00:03<00:05, 48.27it/s] 36%|███▋      | 142/391 [00:03<00:05, 43.78it/s] 38%|███▊      | 147/391 [00:03<00:06, 38.60it/s] 39%|███▉      | 152/391 [00:04<00:06, 35.90it/s] 40%|████      | 157/391 [00:04<00:06, 38.35it/s] 42%|████▏     | 163/391 [00:04<00:05, 42.50it/s] 43%|████▎     | 168/391 [00:04<00:05, 42.06it/s] 44%|████▍     | 173/391 [00:04<00:05, 42.15it/s] 46%|████▌     | 179/391 [00:04<00:04, 45.70it/s] 47%|████▋     | 184/391 [00:04<00:04, 46.34it/s] 48%|████▊     | 189/391 [00:04<00:04, 45.28it/s] 50%|████▉     | 194/391 [00:05<00:04, 44.07it/s] 51%|█████     | 200/391 [00:05<00:04, 47.39it/s] 52%|█████▏    | 205/391 [00:05<00:03, 47.95it/s] 54%|█████▎    | 210/391 [00:05<00:03, 46.73it/s] 55%|█████▍    | 215/391 [00:05<00:04, 39.71it/s] 56%|█████▋    | 220/391 [00:05<00:04, 36.92it/s] 57%|█████▋    | 224/391 [00:05<00:04, 35.75it/s] 59%|█████▊    | 229/391 [00:05<00:04, 37.20it/s] 60%|█████▉    | 234/391 [00:06<00:04, 37.96it/s] 61%|██████▏   | 240/391 [00:06<00:03, 41.78it/s] 63%|██████▎   | 246/391 [00:06<00:03, 45.40it/s] 64%|██████▍   | 252/391 [00:06<00:02, 46.41it/s] 66%|██████▌   | 257/391 [00:06<00:02, 46.37it/s] 67%|██████▋   | 262/391 [00:06<00:02, 44.98it/s] 69%|██████▊   | 268/391 [00:06<00:02, 48.22it/s] 70%|███████   | 274/391 [00:06<00:02, 48.05it/s] 71%|███████▏  | 279/391 [00:06<00:02, 46.87it/s] 73%|███████▎  | 284/391 [00:07<00:02, 43.24it/s] 74%|███████▍  | 289/391 [00:07<00:02, 39.92it/s] 75%|███████▌  | 294/391 [00:07<00:02, 37.93it/s] 76%|███████▌  | 298/391 [00:07<00:02, 35.07it/s] 77%|███████▋  | 303/391 [00:07<00:02, 36.98it/s] 79%|███████▉  | 309/391 [00:07<00:01, 42.42it/s] 80%|████████  | 314/391 [00:07<00:01, 43.75it/s] 82%|████████▏ | 319/391 [00:07<00:01, 42.90it/s] 83%|████████▎ | 324/391 [00:08<00:01, 43.92it/s] 84%|████████▍ | 330/391 [00:08<00:01, 46.11it/s] 86%|████████▌ | 336/391 [00:08<00:01, 48.15it/s] 87%|████████▋ | 341/391 [00:08<00:01, 46.36it/s] 88%|████████▊ | 346/391 [00:08<00:01, 44.69it/s] 90%|█████████ | 352/391 [00:08<00:00, 47.65it/s] 91%|█████████▏| 357/391 [00:08<00:00, 44.22it/s] 93%|█████████▎| 362/391 [00:08<00:00, 38.04it/s] 94%|█████████▎| 366/391 [00:09<00:00, 38.04it/s] 95%|█████████▍| 370/391 [00:09<00:00, 36.21it/s] 96%|█████████▌| 375/391 [00:09<00:00, 36.34it/s] 97%|█████████▋| 380/391 [00:09<00:00, 39.34it/s] 99%|█████████▊| 386/391 [00:09<00:00, 43.28it/s]100%|██████████| 391/391 [00:09<00:00, 44.79it/s]100%|██████████| 391/391 [00:09<00:00, 40.45it/s]
50000 images processed, 9.76131296157837 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:34,  2.24it/s]  6%|▋         | 5/79 [00:00<00:06, 10.96it/s] 10%|█         | 8/79 [00:00<00:04, 15.69it/s] 18%|█▊        | 14/79 [00:00<00:02, 27.14it/s] 24%|██▍       | 19/79 [00:00<00:01, 32.69it/s] 30%|███       | 24/79 [00:00<00:01, 35.51it/s] 37%|███▋      | 29/79 [00:01<00:01, 38.26it/s] 44%|████▍     | 35/79 [00:01<00:01, 42.90it/s] 51%|█████     | 40/79 [00:01<00:00, 42.81it/s] 57%|█████▋    | 45/79 [00:01<00:00, 41.24it/s] 63%|██████▎   | 50/79 [00:01<00:00, 43.22it/s] 71%|███████   | 56/79 [00:01<00:00, 45.51it/s] 77%|███████▋  | 61/79 [00:01<00:00, 45.41it/s] 84%|████████▎ | 66/79 [00:01<00:00, 39.33it/s] 90%|████████▉ | 71/79 [00:02<00:00, 38.24it/s] 95%|█████████▍| 75/79 [00:02<00:00, 36.66it/s]100%|██████████| 79/79 [00:02<00:00, 35.99it/s]100%|██████████| 79/79 [00:02<00:00, 33.70it/s]
10000 images processed, 2.365771770477295 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:16,  2.66it/s]  3%|▎         | 6/204 [00:00<00:12, 15.32it/s]  5%|▌         | 11/204 [00:00<00:07, 24.25it/s]  7%|▋         | 15/204 [00:00<00:06, 28.47it/s] 10%|▉         | 20/204 [00:00<00:05, 32.39it/s] 12%|█▏        | 25/204 [00:00<00:04, 35.81it/s] 15%|█▍        | 30/204 [00:01<00:04, 39.58it/s] 17%|█▋        | 35/204 [00:01<00:04, 41.81it/s] 20%|█▉        | 40/204 [00:01<00:04, 39.57it/s] 22%|██▏       | 45/204 [00:01<00:04, 34.49it/s] 24%|██▍       | 49/204 [00:01<00:04, 34.71it/s] 26%|██▌       | 53/204 [00:01<00:04, 31.67it/s] 28%|██▊       | 57/204 [00:01<00:04, 33.30it/s] 30%|███       | 62/204 [00:01<00:03, 36.70it/s] 33%|███▎      | 67/204 [00:02<00:03, 39.45it/s] 35%|███▌      | 72/204 [00:02<00:03, 40.88it/s] 38%|███▊      | 77/204 [00:02<00:03, 41.35it/s] 40%|████      | 82/204 [00:02<00:03, 40.31it/s] 43%|████▎     | 88/204 [00:02<00:02, 43.42it/s] 46%|████▌     | 93/204 [00:02<00:02, 41.89it/s] 48%|████▊     | 98/204 [00:02<00:02, 39.58it/s] 50%|█████     | 103/204 [00:02<00:02, 36.84it/s] 52%|█████▏    | 107/204 [00:03<00:02, 33.60it/s] 54%|█████▍    | 111/204 [00:03<00:02, 31.35it/s] 56%|█████▋    | 115/204 [00:03<00:02, 32.69it/s] 59%|█████▉    | 121/204 [00:03<00:02, 39.12it/s] 62%|██████▏   | 126/204 [00:03<00:01, 40.08it/s] 64%|██████▍   | 131/204 [00:03<00:01, 39.23it/s] 67%|██████▋   | 137/204 [00:03<00:01, 43.14it/s] 70%|███████   | 143/204 [00:03<00:01, 45.11it/s] 73%|███████▎  | 148/204 [00:04<00:01, 43.95it/s] 75%|███████▌  | 153/204 [00:04<00:01, 43.15it/s] 78%|███████▊  | 159/204 [00:04<00:00, 46.77it/s] 80%|████████  | 164/204 [00:04<00:00, 42.51it/s] 83%|████████▎ | 169/204 [00:04<00:00, 35.36it/s] 85%|████████▍ | 173/204 [00:04<00:00, 34.64it/s] 87%|████████▋ | 177/204 [00:04<00:00, 34.61it/s] 89%|████████▉ | 182/204 [00:05<00:00, 37.67it/s] 92%|█████████▏| 187/204 [00:05<00:00, 39.56it/s] 94%|█████████▍| 192/204 [00:05<00:00, 38.77it/s] 97%|█████████▋| 198/204 [00:05<00:00, 43.33it/s]100%|██████████| 204/204 [00:05<00:00, 45.94it/s]100%|██████████| 204/204 [00:05<00:00, 37.26it/s]
26032 images processed, 5.518769264221191 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:38,  2.00it/s]  6%|▋         | 5/79 [00:00<00:07, 10.08it/s] 11%|█▏        | 9/79 [00:00<00:04, 17.05it/s] 18%|█▊        | 14/79 [00:00<00:02, 24.66it/s] 25%|██▌       | 20/79 [00:00<00:01, 33.76it/s] 33%|███▎      | 26/79 [00:01<00:01, 38.74it/s] 41%|████      | 32/79 [00:01<00:01, 43.69it/s] 47%|████▋     | 37/79 [00:01<00:01, 41.99it/s] 54%|█████▍    | 43/79 [00:01<00:00, 40.15it/s] 61%|██████    | 48/79 [00:01<00:00, 37.32it/s] 66%|██████▌   | 52/79 [00:01<00:00, 37.62it/s] 71%|███████   | 56/79 [00:01<00:00, 37.56it/s] 78%|███████▊  | 62/79 [00:01<00:00, 43.04it/s] 86%|████████▌ | 68/79 [00:02<00:00, 46.16it/s] 94%|█████████▎| 74/79 [00:02<00:00, 49.58it/s]100%|██████████| 79/79 [00:02<00:00, 35.86it/s]
10000 images processed, 2.2362656593322754 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:30,  2.52it/s]  8%|▊         | 6/79 [00:00<00:04, 14.73it/s] 11%|█▏        | 9/79 [00:00<00:03, 18.65it/s] 18%|█▊        | 14/79 [00:00<00:02, 26.40it/s] 25%|██▌       | 20/79 [00:00<00:01, 34.91it/s] 34%|███▍      | 27/79 [00:00<00:01, 43.17it/s] 43%|████▎     | 34/79 [00:01<00:00, 49.08it/s] 51%|█████     | 40/79 [00:01<00:00, 48.86it/s] 58%|█████▊    | 46/79 [00:01<00:00, 47.03it/s] 66%|██████▌   | 52/79 [00:01<00:00, 48.91it/s] 73%|███████▎  | 58/79 [00:01<00:00, 44.01it/s] 80%|███████▉  | 63/79 [00:01<00:00, 40.40it/s] 86%|████████▌ | 68/79 [00:01<00:00, 37.12it/s] 94%|█████████▎| 74/79 [00:02<00:00, 41.59it/s]100%|██████████| 79/79 [00:02<00:00, 37.85it/s]
10000 images processed, 2.109706401824951 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:28,  2.40it/s]  7%|▋         | 5/70 [00:00<00:05, 11.36it/s] 11%|█▏        | 8/70 [00:00<00:03, 15.80it/s] 17%|█▋        | 12/70 [00:00<00:02, 20.54it/s] 23%|██▎       | 16/70 [00:00<00:02, 25.24it/s] 33%|███▎      | 23/70 [00:00<00:01, 35.76it/s] 41%|████▏     | 29/70 [00:01<00:00, 41.92it/s] 49%|████▊     | 34/70 [00:01<00:00, 42.57it/s] 56%|█████▌    | 39/70 [00:01<00:00, 44.04it/s] 66%|██████▌   | 46/70 [00:01<00:00, 48.65it/s] 76%|███████▌  | 53/70 [00:01<00:00, 51.59it/s] 84%|████████▍ | 59/70 [00:01<00:00, 44.47it/s] 91%|█████████▏| 64/70 [00:01<00:00, 39.12it/s] 99%|█████████▊| 69/70 [00:02<00:00, 37.59it/s]100%|██████████| 70/70 [00:02<00:00, 33.61it/s]
8925 images processed, 2.1156606674194336 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:00<00:41,  1.07it/s] 16%|█▌        | 7/45 [00:01<00:04,  8.63it/s] 22%|██▏       | 10/45 [00:01<00:04,  8.19it/s] 31%|███       | 14/45 [00:01<00:02, 10.55it/s] 38%|███▊      | 17/45 [00:01<00:02, 10.29it/s] 49%|████▉     | 22/45 [00:02<00:01, 11.88it/s] 56%|█████▌    | 25/45 [00:02<00:01, 11.92it/s] 67%|██████▋   | 30/45 [00:02<00:01, 12.77it/s] 73%|███████▎  | 33/45 [00:03<00:01, 11.04it/s] 82%|████████▏ | 37/45 [00:03<00:00, 14.01it/s] 89%|████████▉ | 40/45 [00:03<00:00, 16.06it/s] 96%|█████████▌| 43/45 [00:04<00:00, 10.18it/s]100%|██████████| 45/45 [00:04<00:00, 10.83it/s]
5640 images processed, 4.177084922790527 seconds used

29.993707418441772
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.52  99.36
places365     67.89  81.18
LSUN          17.59  96.07
iSUN          72.35  81.67
dtd           37.87  91.39
AVG           39.64  89.93
Retain-Acc: 0.7407
Forget-as-OOD (retain known vs forget novel):
  FPR: 79.50 AUROC: 86.90 AUIN: 98.36
28.92065954208374
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e20-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl0.1-lora_r8a32d0.05-temp0.08-fullgrid
epochs=20 | cache=6 | flambda=0.1 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e20-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl0.1-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e20-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl0.1-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e20-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl0.1-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21843904
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<02:22,  2.74it/s]  2%|▏         | 8/391 [00:00<00:17, 21.41it/s]  4%|▎         | 14/391 [00:00<00:12, 31.31it/s]  5%|▍         | 19/391 [00:00<00:10, 35.93it/s]  6%|▋         | 25/391 [00:00<00:08, 41.28it/s]  8%|▊         | 32/391 [00:00<00:07, 48.75it/s] 10%|▉         | 39/391 [00:01<00:06, 53.40it/s] 12%|█▏        | 45/391 [00:01<00:06, 52.57it/s] 13%|█▎        | 51/391 [00:01<00:06, 52.08it/s] 15%|█▍        | 57/391 [00:01<00:06, 53.73it/s] 16%|█▋        | 64/391 [00:01<00:05, 56.70it/s] 18%|█▊        | 71/391 [00:01<00:05, 58.27it/s] 20%|█▉        | 77/391 [00:01<00:05, 54.79it/s] 21%|██        | 83/391 [00:01<00:05, 53.35it/s] 23%|██▎       | 90/391 [00:01<00:05, 56.66it/s] 25%|██▍       | 97/391 [00:02<00:05, 57.16it/s] 26%|██▋       | 103/391 [00:02<00:05, 54.25it/s] 28%|██▊       | 109/391 [00:02<00:05, 53.30it/s] 30%|██▉       | 116/391 [00:02<00:04, 57.52it/s] 31%|███▏      | 123/391 [00:02<00:04, 59.94it/s] 33%|███▎      | 130/391 [00:02<00:04, 57.08it/s] 35%|███▍      | 136/391 [00:02<00:04, 54.14it/s] 37%|███▋      | 143/391 [00:02<00:04, 56.72it/s] 38%|███▊      | 149/391 [00:02<00:04, 54.98it/s] 40%|███▉      | 155/391 [00:03<00:04, 52.99it/s] 41%|████      | 161/391 [00:03<00:04, 54.09it/s] 43%|████▎     | 168/391 [00:03<00:04, 55.53it/s] 45%|████▍     | 175/391 [00:03<00:03, 57.13it/s] 46%|████▋     | 181/391 [00:03<00:03, 57.32it/s] 48%|████▊     | 187/391 [00:03<00:03, 57.28it/s] 49%|████▉     | 193/391 [00:03<00:03, 57.88it/s] 51%|█████     | 200/391 [00:03<00:03, 59.39it/s] 53%|█████▎    | 207/391 [00:03<00:03, 60.31it/s] 55%|█████▍    | 214/391 [00:04<00:03, 53.13it/s] 56%|█████▋    | 220/391 [00:04<00:03, 47.87it/s] 58%|█████▊    | 225/391 [00:04<00:03, 45.47it/s] 59%|█████▉    | 231/391 [00:04<00:03, 48.70it/s] 61%|██████    | 238/391 [00:04<00:02, 52.79it/s] 62%|██████▏   | 244/391 [00:04<00:02, 54.57it/s] 64%|██████▍   | 251/391 [00:04<00:02, 57.31it/s] 66%|██████▌   | 258/391 [00:04<00:02, 58.96it/s] 68%|██████▊   | 264/391 [00:05<00:02, 58.60it/s] 69%|██████▉   | 271/391 [00:05<00:01, 60.17it/s] 71%|███████   | 278/391 [00:05<00:01, 59.22it/s] 73%|███████▎  | 284/391 [00:05<00:02, 50.77it/s] 74%|███████▍  | 290/391 [00:05<00:02, 49.11it/s] 76%|███████▌  | 296/391 [00:05<00:02, 47.13it/s] 77%|███████▋  | 301/391 [00:05<00:01, 47.57it/s] 78%|███████▊  | 306/391 [00:05<00:01, 47.65it/s] 80%|████████  | 313/391 [00:06<00:01, 51.22it/s] 82%|████████▏ | 320/391 [00:06<00:01, 54.47it/s] 84%|████████▎ | 327/391 [00:06<00:01, 55.44it/s] 85%|████████▌ | 333/391 [00:06<00:01, 53.91it/s] 87%|████████▋ | 339/391 [00:06<00:00, 52.22it/s] 88%|████████▊ | 346/391 [00:06<00:00, 55.52it/s] 90%|█████████ | 352/391 [00:06<00:00, 49.32it/s] 92%|█████████▏| 358/391 [00:06<00:00, 44.14it/s] 93%|█████████▎| 363/391 [00:07<00:00, 40.92it/s] 94%|█████████▍| 369/391 [00:07<00:00, 44.71it/s] 96%|█████████▌| 376/391 [00:07<00:00, 49.08it/s] 98%|█████████▊| 382/391 [00:07<00:00, 48.76it/s] 99%|█████████▉| 388/391 [00:07<00:00, 48.83it/s]100%|██████████| 391/391 [00:07<00:00, 51.13it/s]
50000 images processed, 7.7398223876953125 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:21,  3.67it/s] 11%|█▏        | 9/79 [00:00<00:02, 28.32it/s] 20%|██        | 16/79 [00:00<00:01, 40.51it/s] 28%|██▊       | 22/79 [00:00<00:01, 42.85it/s] 35%|███▌      | 28/79 [00:00<00:01, 43.74it/s] 44%|████▍     | 35/79 [00:00<00:00, 49.29it/s] 53%|█████▎    | 42/79 [00:00<00:00, 54.13it/s] 62%|██████▏   | 49/79 [00:01<00:00, 55.79it/s] 70%|██████▉   | 55/79 [00:01<00:00, 45.17it/s] 76%|███████▌  | 60/79 [00:01<00:00, 41.56it/s] 82%|████████▏ | 65/79 [00:01<00:00, 41.33it/s] 91%|█████████ | 72/79 [00:01<00:00, 46.27it/s] 97%|█████████▋| 77/79 [00:01<00:00, 47.04it/s]100%|██████████| 79/79 [00:01<00:00, 43.29it/s]
10000 images processed, 1.8542399406433105 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:14,  2.74it/s]  3%|▎         | 6/204 [00:00<00:12, 15.92it/s]  5%|▌         | 11/204 [00:00<00:07, 24.64it/s]  8%|▊         | 17/204 [00:00<00:05, 33.44it/s] 12%|█▏        | 24/204 [00:00<00:04, 42.87it/s] 15%|█▌        | 31/204 [00:00<00:03, 48.52it/s] 18%|█▊        | 37/204 [00:01<00:03, 47.34it/s] 21%|██        | 43/204 [00:01<00:04, 39.72it/s] 24%|██▎       | 48/204 [00:01<00:03, 39.49it/s] 26%|██▌       | 53/204 [00:01<00:04, 37.55it/s] 28%|██▊       | 58/204 [00:01<00:03, 39.77it/s] 32%|███▏      | 65/204 [00:01<00:03, 45.27it/s] 35%|███▌      | 72/204 [00:01<00:02, 48.85it/s] 38%|███▊      | 78/204 [00:02<00:02, 47.30it/s] 41%|████      | 84/204 [00:02<00:02, 48.73it/s] 45%|████▍     | 91/204 [00:02<00:02, 53.03it/s] 48%|████▊     | 97/204 [00:02<00:02, 46.04it/s] 50%|█████     | 102/204 [00:02<00:02, 39.22it/s] 52%|█████▏    | 107/204 [00:02<00:02, 37.78it/s] 56%|█████▌    | 114/204 [00:02<00:02, 44.02it/s] 58%|█████▊    | 119/204 [00:02<00:01, 43.70it/s] 61%|██████    | 124/204 [00:03<00:01, 43.02it/s] 64%|██████▍   | 131/204 [00:03<00:01, 48.46it/s] 67%|██████▋   | 137/204 [00:03<00:01, 51.31it/s] 70%|███████   | 143/204 [00:03<00:01, 48.43it/s] 73%|███████▎  | 148/204 [00:03<00:01, 43.22it/s] 75%|███████▌  | 153/204 [00:03<00:01, 40.77it/s] 77%|███████▋  | 158/204 [00:03<00:01, 40.05it/s] 80%|███████▉  | 163/204 [00:03<00:01, 40.13it/s] 82%|████████▏ | 168/204 [00:04<00:00, 42.06it/s] 86%|████████▌ | 175/204 [00:04<00:00, 48.28it/s] 89%|████████▊ | 181/204 [00:04<00:00, 51.16it/s] 92%|█████████▏| 187/204 [00:04<00:00, 49.91it/s] 95%|█████████▍| 193/204 [00:04<00:00, 48.63it/s] 97%|█████████▋| 198/204 [00:04<00:00, 48.82it/s]100%|█████████▉| 203/204 [00:04<00:00, 44.53it/s]100%|██████████| 204/204 [00:04<00:00, 42.32it/s]
26032 images processed, 4.875285387039185 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:41,  1.88it/s]  5%|▌         | 4/79 [00:00<00:09,  7.57it/s] 11%|█▏        | 9/79 [00:00<00:04, 16.67it/s] 20%|██        | 16/79 [00:00<00:02, 28.87it/s] 29%|██▉       | 23/79 [00:00<00:01, 39.04it/s] 37%|███▋      | 29/79 [00:01<00:01, 35.78it/s] 43%|████▎     | 34/79 [00:01<00:01, 35.69it/s] 49%|████▉     | 39/79 [00:01<00:01, 38.74it/s] 59%|█████▉    | 47/79 [00:01<00:00, 48.65it/s] 67%|██████▋   | 53/79 [00:01<00:00, 50.48it/s] 75%|███████▍  | 59/79 [00:01<00:00, 46.81it/s] 82%|████████▏ | 65/79 [00:01<00:00, 47.03it/s] 91%|█████████ | 72/79 [00:02<00:00, 49.68it/s] 99%|█████████▊| 78/79 [00:02<00:00, 40.73it/s]100%|██████████| 79/79 [00:02<00:00, 35.25it/s]
10000 images processed, 2.2859320640563965 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:30,  2.54it/s]  9%|▉         | 7/79 [00:00<00:04, 16.99it/s] 16%|█▋        | 13/79 [00:00<00:02, 28.02it/s] 25%|██▌       | 20/79 [00:00<00:01, 38.02it/s] 33%|███▎      | 26/79 [00:00<00:01, 41.85it/s] 41%|████      | 32/79 [00:00<00:01, 42.83it/s] 48%|████▊     | 38/79 [00:01<00:00, 46.07it/s] 56%|█████▌    | 44/79 [00:01<00:00, 48.92it/s] 63%|██████▎   | 50/79 [00:01<00:00, 40.39it/s] 70%|██████▉   | 55/79 [00:01<00:00, 36.61it/s] 76%|███████▌  | 60/79 [00:01<00:00, 38.49it/s] 84%|████████▎ | 66/79 [00:01<00:00, 42.61it/s] 90%|████████▉ | 71/79 [00:01<00:00, 43.71it/s] 96%|█████████▌| 76/79 [00:02<00:00, 44.40it/s]100%|██████████| 79/79 [00:02<00:00, 38.38it/s]
10000 images processed, 2.08103084564209 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:30,  2.24it/s]  6%|▌         | 4/70 [00:00<00:07,  8.81it/s] 10%|█         | 7/70 [00:00<00:04, 13.83it/s] 16%|█▌        | 11/70 [00:00<00:03, 19.10it/s] 23%|██▎       | 16/70 [00:00<00:02, 26.57it/s] 33%|███▎      | 23/70 [00:01<00:01, 36.87it/s] 41%|████▏     | 29/70 [00:01<00:00, 42.73it/s] 49%|████▊     | 34/70 [00:01<00:00, 43.85it/s] 56%|█████▌    | 39/70 [00:01<00:00, 43.84it/s] 64%|██████▍   | 45/70 [00:01<00:00, 48.22it/s] 73%|███████▎  | 51/70 [00:01<00:00, 48.92it/s] 81%|████████▏ | 57/70 [00:01<00:00, 44.25it/s] 89%|████████▊ | 62/70 [00:01<00:00, 39.38it/s] 96%|█████████▌| 67/70 [00:01<00:00, 40.94it/s]100%|██████████| 70/70 [00:02<00:00, 33.68it/s]
8925 images processed, 2.1104915142059326 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:00<00:40,  1.09it/s]  4%|▍         | 2/45 [00:01<00:19,  2.22it/s] 18%|█▊        | 8/45 [00:01<00:03, 11.14it/s] 24%|██▍       | 11/45 [00:01<00:03,  9.21it/s] 36%|███▌      | 16/45 [00:01<00:01, 14.72it/s] 42%|████▏     | 19/45 [00:02<00:02, 11.52it/s] 51%|█████     | 23/45 [00:02<00:01, 12.23it/s] 58%|█████▊    | 26/45 [00:02<00:01, 13.11it/s] 62%|██████▏   | 28/45 [00:02<00:01, 12.82it/s] 69%|██████▉   | 31/45 [00:02<00:00, 14.11it/s] 73%|███████▎  | 33/45 [00:03<00:00, 13.02it/s] 78%|███████▊  | 35/45 [00:03<00:00, 10.41it/s] 89%|████████▉ | 40/45 [00:03<00:00, 16.32it/s] 96%|█████████▌| 43/45 [00:04<00:00,  9.66it/s]100%|██████████| 45/45 [00:04<00:00, 10.76it/s]
5640 images processed, 4.208784341812134 seconds used

26.8754780292511
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.52  99.36
places365     67.91  81.18
LSUN          17.57  96.08
iSUN          72.36  81.67
dtd           37.87  91.39
AVG           39.65  89.93
Retain-Acc: 0.7407
Forget-as-OOD (retain known vs forget novel):
  FPR: 79.50 AUROC: 86.89 AUIN: 98.36
27.323745727539062
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e50-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl0.1-lora_r8a32d0.05-temp0.08-fullgrid
epochs=50 | cache=6 | flambda=0.1 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e50-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl0.1-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e50-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl0.1-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e50-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl0.1-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21843904
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<03:07,  2.08it/s]  1%|▏         | 5/391 [00:00<00:37, 10.30it/s]  2%|▏         | 9/391 [00:00<00:22, 17.22it/s]  4%|▍         | 16/391 [00:00<00:12, 30.27it/s]  6%|▌         | 22/391 [00:00<00:09, 37.78it/s]  7%|▋         | 27/391 [00:01<00:08, 40.88it/s]  8%|▊         | 32/391 [00:01<00:08, 42.70it/s] 10%|▉         | 38/391 [00:01<00:07, 47.39it/s] 11%|█▏        | 44/391 [00:01<00:06, 50.77it/s] 13%|█▎        | 51/391 [00:01<00:06, 52.69it/s] 15%|█▍        | 57/391 [00:01<00:07, 45.62it/s] 16%|█▌        | 62/391 [00:01<00:08, 41.04it/s] 17%|█▋        | 67/391 [00:01<00:08, 39.89it/s] 19%|█▉        | 74/391 [00:02<00:06, 45.73it/s] 21%|██        | 81/391 [00:02<00:06, 50.54it/s] 23%|██▎       | 88/391 [00:02<00:05, 53.64it/s] 24%|██▍       | 94/391 [00:02<00:05, 52.01it/s] 26%|██▌       | 100/391 [00:02<00:05, 50.91it/s] 27%|██▋       | 106/391 [00:02<00:05, 52.84it/s] 29%|██▊       | 112/391 [00:02<00:05, 48.75it/s] 30%|██▉       | 117/391 [00:02<00:06, 44.01it/s] 31%|███       | 122/391 [00:03<00:06, 40.21it/s] 32%|███▏      | 127/391 [00:03<00:06, 41.05it/s] 34%|███▍      | 134/391 [00:03<00:05, 47.19it/s] 36%|███▌      | 140/391 [00:03<00:05, 49.91it/s] 37%|███▋      | 146/391 [00:03<00:04, 49.34it/s] 39%|███▉      | 152/391 [00:03<00:04, 48.75it/s] 41%|████      | 159/391 [00:03<00:04, 52.31it/s] 42%|████▏     | 166/391 [00:03<00:04, 55.77it/s] 44%|████▍     | 172/391 [00:04<00:04, 47.83it/s] 46%|████▌     | 178/391 [00:04<00:05, 42.30it/s] 47%|████▋     | 183/391 [00:04<00:05, 40.48it/s] 48%|████▊     | 189/391 [00:04<00:04, 44.40it/s] 50%|████▉     | 194/391 [00:04<00:04, 45.33it/s] 51%|█████     | 199/391 [00:04<00:04, 46.48it/s] 52%|█████▏    | 205/391 [00:04<00:03, 48.21it/s] 54%|█████▍    | 211/391 [00:04<00:03, 49.43it/s] 55%|█████▌    | 217/391 [00:05<00:04, 41.52it/s] 57%|█████▋    | 222/391 [00:05<00:04, 39.41it/s] 58%|█████▊    | 227/391 [00:05<00:04, 38.52it/s] 60%|█████▉    | 234/391 [00:05<00:03, 44.51it/s] 61%|██████    | 239/391 [00:05<00:03, 45.32it/s] 62%|██████▏   | 244/391 [00:05<00:03, 46.21it/s] 64%|██████▍   | 250/391 [00:05<00:02, 48.77it/s] 66%|██████▌   | 257/391 [00:05<00:02, 53.66it/s] 68%|██████▊   | 264/391 [00:05<00:02, 56.76it/s] 69%|██████▉   | 270/391 [00:06<00:02, 57.58it/s] 71%|███████   | 276/391 [00:06<00:02, 49.12it/s] 72%|███████▏  | 282/391 [00:06<00:02, 42.66it/s] 73%|███████▎  | 287/391 [00:06<00:02, 42.22it/s] 75%|███████▌  | 294/391 [00:06<00:02, 47.24it/s] 77%|███████▋  | 301/391 [00:06<00:01, 51.06it/s] 79%|███████▊  | 307/391 [00:06<00:01, 51.14it/s] 80%|████████  | 313/391 [00:07<00:01, 51.20it/s] 82%|████████▏ | 319/391 [00:07<00:01, 52.33it/s] 83%|████████▎ | 325/391 [00:07<00:01, 53.25it/s] 85%|████████▍ | 332/391 [00:07<00:01, 56.13it/s] 86%|████████▋ | 338/391 [00:07<00:00, 53.24it/s] 88%|████████▊ | 344/391 [00:07<00:01, 43.62it/s] 89%|████████▉ | 349/391 [00:07<00:01, 41.09it/s] 91%|█████████ | 354/391 [00:07<00:00, 41.47it/s] 92%|█████████▏| 361/391 [00:08<00:00, 46.86it/s] 94%|█████████▍| 368/391 [00:08<00:00, 50.40it/s] 96%|█████████▌| 374/391 [00:08<00:00, 49.88it/s] 97%|█████████▋| 380/391 [00:08<00:00, 49.37it/s] 99%|█████████▉| 387/391 [00:08<00:00, 53.09it/s]100%|██████████| 391/391 [00:08<00:00, 45.44it/s]
50000 images processed, 8.729309558868408 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:31,  2.47it/s]  6%|▋         | 5/79 [00:00<00:06, 12.12it/s] 11%|█▏        | 9/79 [00:00<00:03, 17.96it/s] 18%|█▊        | 14/79 [00:00<00:02, 24.47it/s] 24%|██▍       | 19/79 [00:00<00:02, 29.69it/s] 32%|███▏      | 25/79 [00:00<00:01, 37.35it/s] 39%|███▉      | 31/79 [00:01<00:01, 41.59it/s] 47%|████▋     | 37/79 [00:01<00:00, 45.87it/s] 53%|█████▎    | 42/79 [00:01<00:00, 45.28it/s] 59%|█████▉    | 47/79 [00:01<00:00, 45.76it/s] 67%|██████▋   | 53/79 [00:01<00:00, 46.41it/s] 73%|███████▎  | 58/79 [00:01<00:00, 43.90it/s] 80%|███████▉  | 63/79 [00:01<00:00, 43.07it/s] 86%|████████▌ | 68/79 [00:01<00:00, 39.60it/s] 92%|█████████▏| 73/79 [00:02<00:00, 41.78it/s]100%|██████████| 79/79 [00:02<00:00, 45.21it/s]100%|██████████| 79/79 [00:02<00:00, 36.28it/s]
10000 images processed, 2.208240270614624 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:39,  2.05it/s]  2%|▏         | 5/204 [00:00<00:19, 10.10it/s]  4%|▍         | 9/204 [00:00<00:11, 16.38it/s]  6%|▌         | 12/204 [00:00<00:09, 19.33it/s]  8%|▊         | 17/204 [00:00<00:07, 26.44it/s] 12%|█▏        | 24/204 [00:01<00:04, 36.75it/s] 15%|█▌        | 31/204 [00:01<00:04, 43.17it/s] 18%|█▊        | 36/204 [00:01<00:03, 43.67it/s] 20%|██        | 41/204 [00:01<00:03, 44.40it/s] 24%|██▎       | 48/204 [00:01<00:03, 50.11it/s] 26%|██▋       | 54/204 [00:01<00:03, 48.72it/s] 29%|██▉       | 60/204 [00:01<00:03, 41.10it/s] 32%|███▏      | 65/204 [00:02<00:03, 37.13it/s] 35%|███▍      | 71/204 [00:02<00:03, 41.85it/s] 38%|███▊      | 77/204 [00:02<00:02, 44.06it/s] 40%|████      | 82/204 [00:02<00:02, 44.06it/s] 43%|████▎     | 87/204 [00:02<00:02, 44.04it/s] 46%|████▌     | 94/204 [00:02<00:02, 49.48it/s] 49%|████▉     | 100/204 [00:02<00:02, 51.42it/s] 52%|█████▏    | 106/204 [00:02<00:01, 50.90it/s] 55%|█████▍    | 112/204 [00:03<00:02, 40.76it/s] 57%|█████▋    | 117/204 [00:03<00:02, 39.76it/s] 60%|█████▉    | 122/204 [00:03<00:02, 40.13it/s] 63%|██████▎   | 128/204 [00:03<00:01, 44.50it/s] 65%|██████▌   | 133/204 [00:03<00:01, 44.39it/s] 68%|██████▊   | 138/204 [00:03<00:01, 44.79it/s] 71%|███████   | 144/204 [00:03<00:01, 47.95it/s] 74%|███████▍  | 151/204 [00:03<00:01, 51.97it/s] 77%|███████▋  | 157/204 [00:03<00:00, 54.15it/s] 80%|███████▉  | 163/204 [00:04<00:00, 52.78it/s] 83%|████████▎ | 169/204 [00:04<00:00, 41.05it/s] 85%|████████▌ | 174/204 [00:04<00:00, 40.65it/s] 88%|████████▊ | 179/204 [00:04<00:00, 40.25it/s] 91%|█████████ | 185/204 [00:04<00:00, 43.99it/s] 93%|█████████▎| 190/204 [00:04<00:00, 43.55it/s] 96%|█████████▌| 195/204 [00:04<00:00, 44.42it/s] 99%|█████████▉| 202/204 [00:04<00:00, 50.71it/s]100%|██████████| 204/204 [00:04<00:00, 40.97it/s]
26032 images processed, 5.036971569061279 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:41,  1.87it/s]  6%|▋         | 5/79 [00:00<00:07,  9.88it/s] 13%|█▎        | 10/79 [00:00<00:03, 18.58it/s] 19%|█▉        | 15/79 [00:00<00:02, 26.08it/s] 25%|██▌       | 20/79 [00:00<00:01, 32.15it/s] 33%|███▎      | 26/79 [00:01<00:01, 38.94it/s] 39%|███▉      | 31/79 [00:01<00:01, 39.63it/s] 47%|████▋     | 37/79 [00:01<00:01, 37.95it/s] 53%|█████▎    | 42/79 [00:01<00:00, 39.94it/s] 59%|█████▉    | 47/79 [00:01<00:00, 40.09it/s] 67%|██████▋   | 53/79 [00:01<00:00, 36.52it/s] 73%|███████▎  | 58/79 [00:01<00:00, 37.83it/s] 80%|███████▉  | 63/79 [00:02<00:00, 39.86it/s] 86%|████████▌ | 68/79 [00:02<00:00, 41.30it/s] 92%|█████████▏| 73/79 [00:02<00:00, 43.50it/s] 99%|█████████▊| 78/79 [00:02<00:00, 38.52it/s]100%|██████████| 79/79 [00:02<00:00, 33.02it/s]
10000 images processed, 2.437452554702759 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:31,  2.51it/s]  8%|▊         | 6/79 [00:00<00:04, 14.90it/s] 16%|█▋        | 13/79 [00:00<00:02, 28.24it/s] 23%|██▎       | 18/79 [00:00<00:02, 28.38it/s] 28%|██▊       | 22/79 [00:00<00:02, 28.34it/s] 33%|███▎      | 26/79 [00:01<00:01, 30.54it/s] 39%|███▉      | 31/79 [00:01<00:01, 34.02it/s] 46%|████▌     | 36/79 [00:01<00:01, 37.85it/s] 52%|█████▏    | 41/79 [00:01<00:00, 40.48it/s] 59%|█████▉    | 47/79 [00:01<00:00, 45.59it/s] 67%|██████▋   | 53/79 [00:01<00:00, 49.57it/s] 75%|███████▍  | 59/79 [00:01<00:00, 49.70it/s] 82%|████████▏ | 65/79 [00:01<00:00, 48.18it/s] 90%|████████▉ | 71/79 [00:01<00:00, 50.10it/s] 97%|█████████▋| 77/79 [00:02<00:00, 45.49it/s]100%|██████████| 79/79 [00:02<00:00, 37.06it/s]
10000 images processed, 2.1508548259735107 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:26,  2.57it/s]  7%|▋         | 5/70 [00:00<00:05, 12.45it/s] 13%|█▎        | 9/70 [00:00<00:03, 19.47it/s] 20%|██        | 14/70 [00:00<00:02, 26.95it/s] 29%|██▊       | 20/70 [00:00<00:01, 35.36it/s] 37%|███▋      | 26/70 [00:00<00:01, 40.27it/s] 44%|████▍     | 31/70 [00:01<00:00, 41.65it/s] 51%|█████▏    | 36/70 [00:01<00:00, 42.91it/s] 60%|██████    | 42/70 [00:01<00:00, 47.39it/s] 67%|██████▋   | 47/70 [00:01<00:00, 48.04it/s] 74%|███████▍  | 52/70 [00:01<00:00, 39.98it/s] 81%|████████▏ | 57/70 [00:01<00:00, 36.54it/s] 89%|████████▊ | 62/70 [00:01<00:00, 38.85it/s] 99%|█████████▊| 69/70 [00:01<00:00, 46.32it/s]100%|██████████| 70/70 [00:01<00:00, 36.15it/s]
8925 images processed, 1.9774231910705566 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:01<00:44,  1.00s/it]  4%|▍         | 2/45 [00:01<00:23,  1.86it/s] 13%|█▎        | 6/45 [00:01<00:05,  6.94it/s] 20%|██        | 9/45 [00:01<00:03, 10.42it/s] 27%|██▋       | 12/45 [00:01<00:04,  8.21it/s] 31%|███       | 14/45 [00:02<00:03,  9.05it/s] 40%|████      | 18/45 [00:02<00:03,  8.90it/s] 49%|████▉     | 22/45 [00:02<00:02, 10.51it/s] 58%|█████▊    | 26/45 [00:03<00:01, 10.12it/s] 67%|██████▋   | 30/45 [00:03<00:01, 11.59it/s] 76%|███████▌  | 34/45 [00:03<00:01, 10.18it/s] 87%|████████▋ | 39/45 [00:04<00:00, 14.22it/s] 93%|█████████▎| 42/45 [00:04<00:00,  9.22it/s]100%|██████████| 45/45 [00:04<00:00,  9.26it/s]
5640 images processed, 4.8815624713897705 seconds used

29.20719027519226
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.52  99.36
places365     67.88  81.18
LSUN          17.51  96.09
iSUN          72.36  81.66
dtd           37.89  91.38
AVG           39.63  89.93
Retain-Acc: 0.7408
Forget-as-OOD (retain known vs forget novel):
  FPR: 79.50 AUROC: 86.88 AUIN: 98.36
27.517948150634766
