[re-eval] manifest: evaluation_results/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-fullgrid_runs.csv
[re-eval] forget_csv: 0,8,11,40,51,66,67,88,94,57 | score: mahalanobis
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid
epochs=5 | cache=6 | flambda=1.0 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21610432
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<02:21,  2.76it/s]  2%|▏         | 6/391 [00:00<00:24, 15.96it/s]  3%|▎         | 12/391 [00:00<00:13, 27.30it/s]  6%|▌         | 22/391 [00:00<00:07, 46.99it/s]  8%|▊         | 32/391 [00:00<00:05, 61.03it/s] 11%|█         | 42/391 [00:00<00:04, 71.11it/s] 13%|█▎        | 52/391 [00:01<00:04, 77.60it/s] 16%|█▌        | 61/391 [00:01<00:04, 74.21it/s] 18%|█▊        | 69/391 [00:01<00:04, 65.09it/s] 20%|█▉        | 77/391 [00:01<00:04, 64.93it/s] 22%|██▏       | 87/391 [00:01<00:04, 71.98it/s] 25%|██▍       | 97/391 [00:01<00:03, 77.82it/s] 27%|██▋       | 106/391 [00:01<00:03, 80.70it/s] 29%|██▉       | 115/391 [00:01<00:03, 80.47it/s] 32%|███▏      | 124/391 [00:02<00:03, 67.88it/s] 34%|███▍      | 132/391 [00:02<00:03, 65.26it/s] 36%|███▋      | 142/391 [00:02<00:03, 72.31it/s] 39%|███▉      | 152/391 [00:02<00:03, 78.08it/s] 41%|████▏     | 162/391 [00:02<00:02, 82.42it/s] 44%|████▍     | 172/391 [00:02<00:02, 85.34it/s] 46%|████▋     | 181/391 [00:02<00:02, 71.73it/s] 48%|████▊     | 189/391 [00:02<00:03, 64.92it/s] 51%|█████     | 199/391 [00:03<00:02, 72.33it/s] 53%|█████▎    | 209/391 [00:03<00:02, 77.91it/s] 56%|█████▌    | 219/391 [00:03<00:02, 82.47it/s] 59%|█████▊    | 229/391 [00:03<00:01, 85.09it/s] 61%|██████    | 238/391 [00:03<00:02, 71.95it/s] 63%|██████▎   | 246/391 [00:03<00:02, 64.69it/s] 65%|██████▌   | 256/391 [00:03<00:01, 71.41it/s] 68%|██████▊   | 266/391 [00:03<00:01, 77.11it/s] 71%|███████   | 276/391 [00:04<00:01, 81.15it/s] 73%|███████▎  | 285/391 [00:04<00:01, 75.78it/s] 75%|███████▍  | 293/391 [00:04<00:01, 66.60it/s] 77%|███████▋  | 300/391 [00:04<00:01, 65.79it/s] 79%|███████▉  | 310/391 [00:04<00:01, 72.92it/s] 82%|████████▏ | 320/391 [00:04<00:00, 79.00it/s] 84%|████████▍ | 330/391 [00:04<00:00, 83.22it/s] 87%|████████▋ | 339/391 [00:04<00:00, 83.83it/s] 89%|████████▉ | 348/391 [00:05<00:00, 68.50it/s] 91%|█████████ | 356/391 [00:05<00:00, 65.64it/s] 94%|█████████▎| 366/391 [00:05<00:00, 72.99it/s] 96%|█████████▌| 375/391 [00:05<00:00, 76.45it/s] 98%|█████████▊| 385/391 [00:05<00:00, 82.00it/s]100%|██████████| 391/391 [00:05<00:00, 70.38it/s]
50000 images processed, 5.666778802871704 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:21,  3.56it/s] 13%|█▎        | 10/79 [00:00<00:02, 32.63it/s] 24%|██▍       | 19/79 [00:00<00:01, 51.11it/s] 34%|███▍      | 27/79 [00:00<00:00, 52.99it/s] 43%|████▎     | 34/79 [00:00<00:00, 51.13it/s] 52%|█████▏    | 41/79 [00:00<00:00, 54.62it/s] 63%|██████▎   | 50/79 [00:00<00:00, 63.07it/s] 75%|███████▍  | 59/79 [00:01<00:00, 70.11it/s] 85%|████████▍ | 67/79 [00:01<00:00, 69.07it/s] 95%|█████████▍| 75/79 [00:01<00:00, 62.17it/s]100%|██████████| 79/79 [00:01<00:00, 54.39it/s]
10000 images processed, 1.476505994796753 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:10,  2.87it/s]  3%|▎         | 7/204 [00:00<00:10, 18.30it/s]  6%|▌         | 12/204 [00:00<00:07, 26.14it/s]  9%|▉         | 18/204 [00:00<00:05, 35.42it/s] 13%|█▎        | 27/204 [00:00<00:03, 50.45it/s] 18%|█▊        | 36/204 [00:00<00:02, 60.75it/s] 22%|██▏       | 45/204 [00:01<00:02, 66.33it/s] 26%|██▌       | 53/204 [00:01<00:02, 57.58it/s] 29%|██▉       | 60/204 [00:01<00:02, 58.03it/s] 34%|███▍      | 69/204 [00:01<00:02, 64.65it/s] 38%|███▊      | 78/204 [00:01<00:01, 70.36it/s] 42%|████▏     | 86/204 [00:01<00:01, 70.60it/s] 46%|████▌     | 94/204 [00:01<00:01, 61.13it/s] 50%|████▉     | 101/204 [00:01<00:01, 60.24it/s] 54%|█████▍    | 110/204 [00:02<00:01, 66.24it/s] 59%|█████▉    | 120/204 [00:02<00:01, 73.05it/s] 63%|██████▎   | 129/204 [00:02<00:00, 76.76it/s] 67%|██████▋   | 137/204 [00:02<00:01, 66.46it/s] 71%|███████   | 144/204 [00:02<00:00, 60.03it/s] 75%|███████▌  | 153/204 [00:02<00:00, 66.59it/s] 79%|███████▉  | 162/204 [00:02<00:00, 72.54it/s] 84%|████████▍ | 171/204 [00:02<00:00, 76.87it/s] 89%|████████▊ | 181/204 [00:02<00:00, 81.69it/s] 93%|█████████▎| 190/204 [00:03<00:00, 82.17it/s] 98%|█████████▊| 199/204 [00:03<00:00, 65.85it/s]100%|██████████| 204/204 [00:03<00:00, 60.34it/s]
26032 images processed, 3.4339280128479004 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:35,  2.19it/s]  8%|▊         | 6/79 [00:00<00:05, 13.39it/s] 14%|█▍        | 11/79 [00:00<00:03, 22.45it/s] 22%|██▏       | 17/79 [00:00<00:02, 30.80it/s] 32%|███▏      | 25/79 [00:00<00:01, 38.02it/s] 38%|███▊      | 30/79 [00:01<00:01, 39.95it/s] 46%|████▌     | 36/79 [00:01<00:00, 43.75it/s] 56%|█████▌    | 44/79 [00:01<00:00, 52.63it/s] 63%|██████▎   | 50/79 [00:01<00:00, 46.60it/s] 71%|███████   | 56/79 [00:01<00:00, 46.26it/s] 78%|███████▊  | 62/79 [00:01<00:00, 48.07it/s] 86%|████████▌ | 68/79 [00:01<00:00, 40.12it/s] 92%|█████████▏| 73/79 [00:01<00:00, 41.56it/s]100%|██████████| 79/79 [00:02<00:00, 38.52it/s]
10000 images processed, 2.084650993347168 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:24,  3.14it/s]  9%|▉         | 7/79 [00:00<00:03, 20.69it/s] 18%|█▊        | 14/79 [00:00<00:01, 33.70it/s] 27%|██▋       | 21/79 [00:00<00:01, 43.92it/s] 39%|███▉      | 31/79 [00:00<00:00, 59.80it/s] 52%|█████▏    | 41/79 [00:00<00:00, 70.72it/s] 66%|██████▌   | 52/79 [00:00<00:00, 80.46it/s] 78%|███████▊  | 62/79 [00:01<00:00, 84.03it/s] 92%|█████████▏| 73/79 [00:01<00:00, 89.82it/s]100%|██████████| 79/79 [00:01<00:00, 64.51it/s]
10000 images processed, 1.244950771331787 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:23,  2.96it/s] 16%|█▌        | 11/70 [00:00<00:01, 31.58it/s] 31%|███▏      | 22/70 [00:00<00:00, 53.63it/s] 47%|████▋     | 33/70 [00:00<00:00, 68.62it/s] 61%|██████▏   | 43/70 [00:00<00:00, 76.86it/s] 76%|███████▌  | 53/70 [00:00<00:00, 72.52it/s] 90%|█████████ | 63/70 [00:01<00:00, 79.08it/s]100%|██████████| 70/70 [00:01<00:00, 64.18it/s]
8925 images processed, 1.124896764755249 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:00<00:43,  1.01it/s]  4%|▍         | 2/45 [00:01<00:21,  2.02it/s] 16%|█▌        | 7/45 [00:01<00:04,  8.89it/s] 22%|██▏       | 10/45 [00:01<00:04,  7.63it/s] 33%|███▎      | 15/45 [00:01<00:02, 12.90it/s] 40%|████      | 18/45 [00:02<00:02, 11.53it/s] 51%|█████     | 23/45 [00:02<00:01, 16.60it/s] 58%|█████▊    | 26/45 [00:02<00:01, 12.44it/s] 67%|██████▋   | 30/45 [00:02<00:01, 14.78it/s] 73%|███████▎  | 33/45 [00:03<00:01, 10.82it/s] 82%|████████▏ | 37/45 [00:03<00:00, 14.20it/s] 91%|█████████ | 41/45 [00:03<00:00, 13.28it/s] 96%|█████████▌| 43/45 [00:04<00:00,  9.33it/s]100%|██████████| 45/45 [00:04<00:00, 10.43it/s]
5640 images processed, 4.336724281311035 seconds used

21.19862937927246
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.53  99.36
places365     67.87  81.18
LSUN          17.60  96.07
iSUN          72.36  81.68
dtd           37.87  91.39
AVG           39.65  89.93
Retain-Acc: 0.7406
Forget-as-OOD (retain known vs forget novel):
  FPR: 79.50 AUROC: 86.90 AUIN: 98.36
17.446058750152588
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e10-lr0.001-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid
epochs=10 | cache=6 | flambda=1.0 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e10-lr0.001-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e10-lr0.001-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e10-lr0.001-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21610432
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<02:38,  2.47it/s]  2%|▏         | 6/391 [00:00<00:26, 14.70it/s]  3%|▎         | 12/391 [00:00<00:14, 25.81it/s]  6%|▌         | 22/391 [00:00<00:08, 44.76it/s]  8%|▊         | 32/391 [00:00<00:06, 58.95it/s] 10%|█         | 41/391 [00:00<00:05, 66.95it/s] 13%|█▎        | 49/391 [00:01<00:05, 67.79it/s] 15%|█▍        | 57/391 [00:01<00:05, 60.34it/s] 16%|█▋        | 64/391 [00:01<00:05, 59.68it/s] 19%|█▉        | 74/391 [00:01<00:04, 68.81it/s] 21%|██▏       | 84/391 [00:01<00:04, 75.28it/s] 24%|██▍       | 93/391 [00:01<00:03, 77.98it/s] 26%|██▌       | 102/391 [00:01<00:04, 69.55it/s] 28%|██▊       | 110/391 [00:01<00:04, 62.01it/s] 30%|███       | 119/391 [00:02<00:04, 67.99it/s] 33%|███▎      | 129/391 [00:02<00:03, 74.14it/s] 35%|███▌      | 138/391 [00:02<00:03, 77.84it/s] 38%|███▊      | 147/391 [00:02<00:03, 76.02it/s] 40%|███▉      | 155/391 [00:02<00:03, 64.70it/s] 41%|████▏     | 162/391 [00:02<00:03, 63.21it/s] 44%|████▍     | 172/391 [00:02<00:03, 70.67it/s] 46%|████▋     | 181/391 [00:02<00:02, 75.07it/s] 48%|████▊     | 189/391 [00:03<00:02, 73.83it/s] 50%|█████     | 197/391 [00:03<00:03, 64.31it/s] 52%|█████▏    | 204/391 [00:03<00:03, 62.15it/s] 54%|█████▍    | 213/391 [00:03<00:02, 68.15it/s] 57%|█████▋    | 222/391 [00:03<00:02, 72.83it/s] 59%|█████▉    | 230/391 [00:03<00:02, 74.07it/s] 61%|██████    | 238/391 [00:03<00:02, 64.04it/s] 63%|██████▎   | 245/391 [00:03<00:02, 61.52it/s] 65%|██████▍   | 254/391 [00:04<00:02, 68.48it/s] 68%|██████▊   | 264/391 [00:04<00:01, 74.99it/s] 70%|██████▉   | 273/391 [00:04<00:01, 75.38it/s] 72%|███████▏  | 281/391 [00:04<00:01, 65.07it/s] 74%|███████▎  | 288/391 [00:04<00:01, 61.98it/s] 76%|███████▌  | 298/391 [00:04<00:01, 69.70it/s] 79%|███████▉  | 308/391 [00:04<00:01, 74.08it/s] 81%|████████▏ | 318/391 [00:04<00:00, 77.57it/s] 83%|████████▎ | 326/391 [00:05<00:00, 66.62it/s] 85%|████████▌ | 333/391 [00:05<00:00, 62.16it/s] 88%|████████▊ | 343/391 [00:05<00:00, 69.67it/s] 90%|█████████ | 352/391 [00:05<00:00, 74.62it/s] 93%|█████████▎| 362/391 [00:05<00:00, 78.90it/s] 95%|█████████▍| 371/391 [00:05<00:00, 66.30it/s] 97%|█████████▋| 379/391 [00:05<00:00, 63.07it/s] 99%|█████████▉| 389/391 [00:05<00:00, 71.17it/s]100%|██████████| 391/391 [00:05<00:00, 65.18it/s]
50000 images processed, 6.094470024108887 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:24,  3.18it/s] 14%|█▍        | 11/79 [00:00<00:02, 32.63it/s] 25%|██▌       | 20/79 [00:00<00:01, 49.29it/s] 38%|███▊      | 30/79 [00:00<00:00, 62.95it/s] 48%|████▊     | 38/79 [00:00<00:00, 57.77it/s] 57%|█████▋    | 45/79 [00:00<00:00, 54.02it/s] 68%|██████▊   | 54/79 [00:01<00:00, 62.93it/s] 80%|███████▉  | 63/79 [00:01<00:00, 70.05it/s] 92%|█████████▏| 73/79 [00:01<00:00, 76.89it/s]100%|██████████| 79/79 [00:01<00:00, 59.74it/s]
10000 images processed, 1.3566746711730957 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:01,  3.33it/s]  3%|▎         | 6/204 [00:00<00:10, 18.31it/s]  5%|▌         | 11/204 [00:00<00:07, 26.80it/s]  8%|▊         | 16/204 [00:00<00:05, 32.43it/s] 12%|█▏        | 25/204 [00:00<00:03, 48.75it/s] 17%|█▋        | 34/204 [00:00<00:02, 59.91it/s] 21%|██        | 42/204 [00:00<00:02, 65.31it/s] 25%|██▍       | 50/204 [00:01<00:02, 56.07it/s] 28%|██▊       | 57/204 [00:01<00:02, 56.55it/s] 32%|███▏      | 66/204 [00:01<00:02, 63.89it/s] 37%|███▋      | 75/204 [00:01<00:01, 70.25it/s] 41%|████      | 83/204 [00:01<00:01, 65.86it/s] 44%|████▍     | 90/204 [00:01<00:01, 57.30it/s] 48%|████▊     | 98/204 [00:01<00:01, 62.24it/s] 53%|█████▎    | 108/204 [00:01<00:01, 70.45it/s] 57%|█████▋    | 117/204 [00:02<00:01, 75.46it/s] 61%|██████▏   | 125/204 [00:02<00:01, 69.07it/s] 65%|██████▌   | 133/204 [00:02<00:01, 59.72it/s] 69%|██████▉   | 141/204 [00:02<00:00, 63.97it/s] 74%|███████▎  | 150/204 [00:02<00:00, 68.69it/s] 77%|███████▋  | 158/204 [00:02<00:00, 62.56it/s] 81%|████████  | 165/204 [00:02<00:00, 56.66it/s] 85%|████████▌ | 174/204 [00:03<00:00, 63.78it/s] 90%|█████████ | 184/204 [00:03<00:00, 71.03it/s] 95%|█████████▌| 194/204 [00:03<00:00, 76.82it/s] 99%|█████████▉| 202/204 [00:03<00:00, 69.58it/s]100%|██████████| 204/204 [00:03<00:00, 59.58it/s]
26032 images processed, 3.47806715965271 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:34,  2.27it/s]  8%|▊         | 6/79 [00:00<00:05, 13.80it/s] 16%|█▋        | 13/79 [00:00<00:02, 27.85it/s] 23%|██▎       | 18/79 [00:00<00:01, 30.93it/s] 29%|██▉       | 23/79 [00:00<00:01, 34.79it/s] 38%|███▊      | 30/79 [00:01<00:01, 43.27it/s] 46%|████▌     | 36/79 [00:01<00:00, 47.63it/s] 53%|█████▎    | 42/79 [00:01<00:00, 44.04it/s] 59%|█████▉    | 47/79 [00:01<00:00, 44.66it/s] 70%|██████▉   | 55/79 [00:01<00:00, 52.33it/s] 77%|███████▋  | 61/79 [00:01<00:00, 45.87it/s] 84%|████████▎ | 66/79 [00:01<00:00, 46.61it/s] 92%|█████████▏| 73/79 [00:01<00:00, 51.03it/s]100%|██████████| 79/79 [00:01<00:00, 41.12it/s]
10000 images processed, 1.964646339416504 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:25,  3.02it/s]  8%|▊         | 6/79 [00:00<00:04, 16.40it/s] 14%|█▍        | 11/79 [00:00<00:02, 25.60it/s] 23%|██▎       | 18/79 [00:00<00:01, 38.05it/s] 33%|███▎      | 26/79 [00:00<00:01, 49.88it/s] 42%|████▏     | 33/79 [00:00<00:00, 55.19it/s] 51%|█████     | 40/79 [00:01<00:00, 49.35it/s] 59%|█████▉    | 47/79 [00:01<00:00, 54.01it/s] 71%|███████   | 56/79 [00:01<00:00, 62.19it/s] 80%|███████▉  | 63/79 [00:01<00:00, 57.53it/s] 94%|█████████▎| 74/79 [00:01<00:00, 69.65it/s]100%|██████████| 79/79 [00:01<00:00, 51.19it/s]
10000 images processed, 1.5613954067230225 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:21,  3.26it/s]  9%|▊         | 6/70 [00:00<00:03, 17.57it/s] 20%|██        | 14/70 [00:00<00:01, 36.31it/s] 31%|███▏      | 22/70 [00:00<00:01, 47.73it/s] 43%|████▎     | 30/70 [00:00<00:00, 56.14it/s] 56%|█████▌    | 39/70 [00:00<00:00, 64.86it/s] 69%|██████▊   | 48/70 [00:00<00:00, 68.87it/s] 81%|████████▏ | 57/70 [00:01<00:00, 73.06it/s] 93%|█████████▎| 65/70 [00:01<00:00, 74.20it/s]100%|██████████| 70/70 [00:01<00:00, 57.09it/s]
8925 images processed, 1.2558748722076416 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:00<00:42,  1.04it/s]  4%|▍         | 2/45 [00:01<00:22,  1.92it/s] 20%|██        | 9/45 [00:01<00:03,  9.15it/s] 24%|██▍       | 11/45 [00:01<00:04,  8.24it/s] 33%|███▎      | 15/45 [00:01<00:02, 12.34it/s] 40%|████      | 18/45 [00:02<00:02, 10.53it/s] 49%|████▉     | 22/45 [00:02<00:01, 13.92it/s] 56%|█████▌    | 25/45 [00:02<00:01, 14.82it/s] 60%|██████    | 27/45 [00:02<00:01, 12.24it/s] 67%|██████▋   | 30/45 [00:02<00:01, 14.37it/s] 73%|███████▎  | 33/45 [00:03<00:01, 11.02it/s] 78%|███████▊  | 35/45 [00:03<00:00, 10.22it/s] 89%|████████▉ | 40/45 [00:03<00:00, 15.53it/s] 96%|█████████▌| 43/45 [00:04<00:00,  9.47it/s]100%|██████████| 45/45 [00:04<00:00, 10.25it/s]
5640 images processed, 4.43267297744751 seconds used

21.88139247894287
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.53  99.36
places365     67.87  81.18
LSUN          17.60  96.07
iSUN          72.36  81.68
dtd           37.87  91.39
AVG           39.65  89.93
Retain-Acc: 0.7406
Forget-as-OOD (retain known vs forget novel):
  FPR: 79.50 AUROC: 86.90 AUIN: 98.36
10.16464352607727
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e20-lr0.001-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid
epochs=20 | cache=6 | flambda=1.0 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e20-lr0.001-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e20-lr0.001-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e20-lr0.001-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21610432
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<01:49,  3.55it/s]  3%|▎         | 10/391 [00:00<00:11, 32.59it/s]  4%|▍         | 16/391 [00:00<00:09, 39.66it/s]  6%|▌         | 22/391 [00:00<00:08, 43.38it/s]  7%|▋         | 28/391 [00:00<00:07, 46.84it/s] 10%|▉         | 38/391 [00:00<00:05, 61.24it/s] 12%|█▏        | 48/391 [00:00<00:04, 70.83it/s] 15%|█▍        | 58/391 [00:01<00:04, 78.13it/s] 17%|█▋        | 68/391 [00:01<00:03, 83.14it/s] 20%|█▉        | 77/391 [00:01<00:04, 71.52it/s] 22%|██▏       | 85/391 [00:01<00:04, 63.79it/s] 24%|██▍       | 95/391 [00:01<00:04, 70.74it/s] 27%|██▋       | 105/391 [00:01<00:03, 77.23it/s] 29%|██▉       | 115/391 [00:01<00:03, 81.48it/s] 32%|███▏      | 125/391 [00:01<00:03, 85.37it/s] 34%|███▍      | 134/391 [00:02<00:03, 77.29it/s] 37%|███▋      | 143/391 [00:02<00:03, 66.60it/s] 39%|███▊      | 151/391 [00:02<00:03, 69.35it/s] 41%|████      | 160/391 [00:02<00:03, 74.14it/s] 43%|████▎     | 170/391 [00:02<00:02, 79.89it/s] 46%|████▌     | 180/391 [00:02<00:02, 83.97it/s] 48%|████▊     | 189/391 [00:02<00:02, 71.09it/s] 50%|█████     | 197/391 [00:02<00:03, 64.11it/s] 53%|█████▎    | 207/391 [00:03<00:02, 70.88it/s] 55%|█████▌    | 216/391 [00:03<00:02, 75.05it/s] 58%|█████▊    | 226/391 [00:03<00:02, 80.39it/s] 60%|██████    | 235/391 [00:03<00:01, 78.23it/s] 62%|██████▏   | 244/391 [00:03<00:02, 66.91it/s] 64%|██████▍   | 252/391 [00:03<00:02, 66.36it/s] 67%|██████▋   | 262/391 [00:03<00:01, 73.26it/s] 70%|██████▉   | 272/391 [00:03<00:01, 78.74it/s] 72%|███████▏  | 281/391 [00:04<00:01, 81.58it/s] 74%|███████▍  | 290/391 [00:04<00:01, 78.91it/s] 76%|███████▋  | 299/391 [00:04<00:01, 67.22it/s] 79%|███████▊  | 307/391 [00:04<00:01, 66.59it/s] 81%|████████  | 317/391 [00:04<00:01, 72.97it/s] 84%|████████▎ | 327/391 [00:04<00:00, 78.66it/s] 86%|████████▌ | 336/391 [00:04<00:00, 79.77it/s] 88%|████████▊ | 345/391 [00:04<00:00, 66.87it/s] 90%|█████████ | 353/391 [00:05<00:00, 64.57it/s] 93%|█████████▎| 363/391 [00:05<00:00, 71.93it/s] 95%|█████████▌| 373/391 [00:05<00:00, 77.07it/s] 98%|█████████▊| 383/391 [00:05<00:00, 81.65it/s]100%|██████████| 391/391 [00:05<00:00, 69.85it/s]
50000 images processed, 5.700195789337158 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:23,  3.31it/s]  9%|▉         | 7/79 [00:00<00:03, 20.27it/s] 16%|█▋        | 13/79 [00:00<00:02, 32.05it/s] 29%|██▉       | 23/79 [00:00<00:01, 50.88it/s] 42%|████▏     | 33/79 [00:00<00:00, 63.83it/s] 54%|█████▍    | 43/79 [00:00<00:00, 72.72it/s] 65%|██████▍   | 51/79 [00:01<00:00, 62.99it/s] 73%|███████▎  | 58/79 [00:01<00:00, 58.43it/s] 86%|████████▌ | 68/79 [00:01<00:00, 67.16it/s] 97%|█████████▋| 77/79 [00:01<00:00, 73.05it/s]100%|██████████| 79/79 [00:01<00:00, 56.63it/s]
10000 images processed, 1.4443233013153076 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:44,  1.95it/s]  5%|▍         | 10/204 [00:00<00:09, 21.12it/s] 10%|▉         | 20/204 [00:00<00:04, 39.20it/s] 14%|█▍        | 29/204 [00:00<00:03, 51.80it/s] 19%|█▉        | 39/204 [00:00<00:02, 62.94it/s] 24%|██▎       | 48/204 [00:01<00:02, 60.40it/s] 27%|██▋       | 56/204 [00:01<00:02, 54.97it/s] 31%|███▏      | 64/204 [00:01<00:02, 60.63it/s] 36%|███▌      | 73/204 [00:01<00:01, 67.56it/s] 40%|████      | 82/204 [00:01<00:01, 73.26it/s] 44%|████▍     | 90/204 [00:01<00:01, 61.82it/s] 48%|████▊     | 97/204 [00:01<00:01, 58.19it/s] 52%|█████▏    | 107/204 [00:01<00:01, 66.48it/s] 57%|█████▋    | 117/204 [00:02<00:01, 73.41it/s] 62%|██████▏   | 127/204 [00:02<00:00, 78.73it/s] 67%|██████▋   | 136/204 [00:02<00:00, 69.12it/s] 71%|███████   | 144/204 [00:02<00:00, 61.54it/s] 75%|███████▌  | 153/204 [00:02<00:00, 67.81it/s] 79%|███████▉  | 162/204 [00:02<00:00, 72.99it/s] 84%|████████▍ | 172/204 [00:02<00:00, 78.52it/s] 89%|████████▊ | 181/204 [00:03<00:00, 68.21it/s] 93%|█████████▎| 189/204 [00:03<00:00, 61.30it/s] 98%|█████████▊| 199/204 [00:03<00:00, 69.31it/s]100%|██████████| 204/204 [00:03<00:00, 60.56it/s]
26032 images processed, 3.4183218479156494 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:40,  1.91it/s] 11%|█▏        | 9/79 [00:00<00:04, 16.03it/s] 18%|█▊        | 14/79 [00:00<00:02, 22.67it/s] 28%|██▊       | 22/79 [00:00<00:01, 34.87it/s] 35%|███▌      | 28/79 [00:01<00:01, 36.02it/s] 42%|████▏     | 33/79 [00:01<00:01, 38.24it/s] 48%|████▊     | 38/79 [00:01<00:01, 40.90it/s] 54%|█████▍    | 43/79 [00:01<00:00, 40.45it/s] 61%|██████    | 48/79 [00:01<00:00, 41.26it/s] 67%|██████▋   | 53/79 [00:01<00:00, 42.60it/s] 78%|███████▊  | 62/79 [00:01<00:00, 53.79it/s] 86%|████████▌ | 68/79 [00:01<00:00, 48.57it/s] 94%|█████████▎| 74/79 [00:02<00:00, 47.57it/s]100%|██████████| 79/79 [00:02<00:00, 37.11it/s]
10000 images processed, 2.168149471282959 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:40,  1.94it/s]  9%|▉         | 7/79 [00:00<00:04, 14.53it/s] 15%|█▌        | 12/79 [00:00<00:03, 22.13it/s] 22%|██▏       | 17/79 [00:00<00:02, 28.40it/s] 34%|███▍      | 27/79 [00:00<00:01, 45.53it/s] 47%|████▋     | 37/79 [00:01<00:00, 58.57it/s] 59%|█████▉    | 47/79 [00:01<00:00, 68.12it/s] 70%|██████▉   | 55/79 [00:01<00:00, 70.28it/s] 80%|███████▉  | 63/79 [00:01<00:00, 59.75it/s] 89%|████████▊ | 70/79 [00:01<00:00, 59.98it/s]100%|██████████| 79/79 [00:01<00:00, 47.72it/s]
10000 images processed, 1.6895976066589355 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:35,  1.97it/s] 16%|█▌        | 11/70 [00:00<00:02, 23.03it/s] 30%|███       | 21/70 [00:00<00:01, 40.46it/s] 43%|████▎     | 30/70 [00:00<00:00, 52.76it/s] 54%|█████▍    | 38/70 [00:00<00:00, 56.96it/s] 66%|██████▌   | 46/70 [00:01<00:00, 52.06it/s] 76%|███████▌  | 53/70 [00:01<00:00, 56.14it/s] 90%|█████████ | 63/70 [00:01<00:00, 66.24it/s]100%|██████████| 70/70 [00:01<00:00, 49.74it/s]
8925 images processed, 1.4388773441314697 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:01<00:46,  1.05s/it]  4%|▍         | 2/45 [00:01<00:21,  2.00it/s] 20%|██        | 9/45 [00:01<00:04,  8.63it/s] 24%|██▍       | 11/45 [00:01<00:03,  8.89it/s] 38%|███▊      | 17/45 [00:02<00:02, 11.74it/s] 42%|████▏     | 19/45 [00:02<00:02, 12.40it/s] 51%|█████     | 23/45 [00:02<00:01, 16.50it/s] 58%|█████▊    | 26/45 [00:02<00:01, 12.12it/s] 69%|██████▉   | 31/45 [00:02<00:00, 16.95it/s] 76%|███████▌  | 34/45 [00:03<00:01, 10.45it/s] 87%|████████▋ | 39/45 [00:03<00:00, 14.66it/s] 93%|█████████▎| 42/45 [00:04<00:00,  9.79it/s]100%|██████████| 45/45 [00:04<00:00, 10.57it/s]
5640 images processed, 4.282869577407837 seconds used

22.037299871444702
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.53  99.36
places365     67.87  81.18
LSUN          17.60  96.07
iSUN          72.36  81.68
dtd           37.87  91.39
AVG           39.65  89.93
Retain-Acc: 0.7406
Forget-as-OOD (retain known vs forget novel):
  FPR: 79.50 AUROC: 86.90 AUIN: 98.36
21.372133493423462
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e50-lr0.001-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid
epochs=50 | cache=6 | flambda=1.0 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e50-lr0.001-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e50-lr0.001-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e50-lr0.001-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21610432
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<03:14,  2.00it/s]  2%|▏         | 6/391 [00:00<00:31, 12.30it/s]  3%|▎         | 11/391 [00:00<00:18, 21.02it/s]  5%|▌         | 20/391 [00:00<00:09, 38.06it/s]  7%|▋         | 29/391 [00:00<00:07, 51.34it/s] 10%|▉         | 39/391 [00:01<00:05, 62.99it/s] 12%|█▏        | 47/391 [00:01<00:05, 63.29it/s] 14%|█▍        | 55/391 [00:01<00:06, 55.76it/s] 16%|█▌        | 63/391 [00:01<00:05, 60.39it/s] 18%|█▊        | 71/391 [00:01<00:04, 64.36it/s] 20%|██        | 79/391 [00:01<00:04, 64.46it/s] 22%|██▏       | 86/391 [00:01<00:05, 57.45it/s] 24%|██▍       | 93/391 [00:01<00:05, 59.03it/s] 26%|██▌       | 102/391 [00:02<00:04, 66.46it/s] 29%|██▊       | 112/391 [00:02<00:03, 71.23it/s] 31%|███       | 120/391 [00:02<00:04, 67.45it/s] 32%|███▏      | 127/391 [00:02<00:04, 61.48it/s] 34%|███▍      | 134/391 [00:02<00:04, 61.92it/s] 37%|███▋      | 144/391 [00:02<00:03, 70.50it/s] 39%|███▉      | 153/391 [00:02<00:03, 74.02it/s] 41%|████      | 161/391 [00:02<00:03, 72.58it/s] 43%|████▎     | 169/391 [00:03<00:03, 64.10it/s] 45%|████▌     | 176/391 [00:03<00:03, 62.02it/s] 47%|████▋     | 185/391 [00:03<00:02, 69.02it/s] 50%|████▉     | 195/391 [00:03<00:02, 75.75it/s] 52%|█████▏    | 203/391 [00:03<00:02, 73.61it/s] 54%|█████▍    | 211/391 [00:03<00:02, 63.40it/s] 56%|█████▌    | 218/391 [00:03<00:02, 60.84it/s] 58%|█████▊    | 228/391 [00:03<00:02, 68.79it/s] 61%|██████    | 237/391 [00:04<00:02, 73.61it/s] 63%|██████▎   | 245/391 [00:04<00:02, 69.69it/s] 65%|██████▍   | 253/391 [00:04<00:02, 62.78it/s] 66%|██████▋   | 260/391 [00:04<00:02, 62.19it/s] 69%|██████▉   | 270/391 [00:04<00:01, 69.97it/s] 72%|███████▏  | 280/391 [00:04<00:01, 76.48it/s] 74%|███████▍  | 289/391 [00:04<00:01, 79.77it/s] 76%|███████▌  | 298/391 [00:04<00:01, 71.82it/s] 78%|███████▊  | 306/391 [00:05<00:01, 64.26it/s] 80%|████████  | 314/391 [00:05<00:01, 66.46it/s] 83%|████████▎ | 323/391 [00:05<00:00, 71.37it/s] 85%|████████▌ | 333/391 [00:05<00:00, 77.46it/s] 87%|████████▋ | 342/391 [00:05<00:00, 77.48it/s] 90%|████████▉ | 350/391 [00:05<00:00, 65.63it/s] 91%|█████████▏| 357/391 [00:05<00:00, 62.66it/s] 94%|█████████▍| 367/391 [00:05<00:00, 70.24it/s] 96%|█████████▋| 377/391 [00:05<00:00, 76.06it/s] 99%|█████████▉| 387/391 [00:06<00:00, 81.43it/s]100%|██████████| 391/391 [00:06<00:00, 63.59it/s]
50000 images processed, 6.244095325469971 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:25,  3.06it/s] 13%|█▎        | 10/79 [00:00<00:02, 29.27it/s] 23%|██▎       | 18/79 [00:00<00:01, 42.58it/s] 32%|███▏      | 25/79 [00:00<00:01, 44.65it/s] 39%|███▉      | 31/79 [00:00<00:01, 46.99it/s] 51%|█████     | 40/79 [00:00<00:00, 58.22it/s] 61%|██████    | 48/79 [00:01<00:00, 63.67it/s] 71%|███████   | 56/79 [00:01<00:00, 67.69it/s] 81%|████████  | 64/79 [00:01<00:00, 59.91it/s] 90%|████████▉ | 71/79 [00:01<00:00, 57.62it/s]100%|██████████| 79/79 [00:01<00:00, 52.62it/s]
10000 images processed, 1.5344910621643066 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:31,  2.23it/s]  3%|▎         | 6/204 [00:00<00:14, 13.51it/s]  7%|▋         | 15/204 [00:00<00:05, 32.11it/s] 12%|█▏        | 24/204 [00:00<00:03, 46.78it/s] 16%|█▌        | 32/204 [00:00<00:03, 54.01it/s] 19%|█▉        | 39/204 [00:01<00:03, 49.68it/s] 22%|██▏       | 45/204 [00:01<00:03, 50.38it/s] 26%|██▋       | 54/204 [00:01<00:02, 60.46it/s] 31%|███▏      | 64/204 [00:01<00:02, 69.71it/s] 36%|███▌      | 73/204 [00:01<00:01, 74.76it/s] 40%|███▉      | 81/204 [00:01<00:01, 68.05it/s] 44%|████▎     | 89/204 [00:01<00:01, 58.37it/s] 48%|████▊     | 98/204 [00:01<00:01, 65.67it/s] 53%|█████▎    | 108/204 [00:02<00:01, 72.49it/s] 58%|█████▊    | 118/204 [00:02<00:01, 78.16it/s] 62%|██████▏   | 127/204 [00:02<00:01, 75.27it/s] 66%|██████▌   | 135/204 [00:02<00:01, 63.66it/s] 70%|██████▉   | 142/204 [00:02<00:00, 64.46it/s] 75%|███████▍  | 152/204 [00:02<00:00, 72.02it/s] 79%|███████▉  | 162/204 [00:02<00:00, 77.71it/s] 84%|████████▍ | 171/204 [00:02<00:00, 79.18it/s] 88%|████████▊ | 180/204 [00:03<00:00, 63.73it/s] 92%|█████████▏| 187/204 [00:03<00:00, 62.58it/s] 97%|█████████▋| 197/204 [00:03<00:00, 70.44it/s]100%|██████████| 204/204 [00:03<00:00, 60.76it/s]
26032 images processed, 3.4097516536712646 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:44,  1.77it/s]  8%|▊         | 6/79 [00:00<00:06, 11.33it/s] 19%|█▉        | 15/79 [00:00<00:02, 28.64it/s] 27%|██▋       | 21/79 [00:00<00:01, 29.05it/s] 33%|███▎      | 26/79 [00:01<00:01, 31.66it/s] 43%|████▎     | 34/79 [00:01<00:01, 35.10it/s] 49%|████▉     | 39/79 [00:01<00:01, 37.00it/s] 58%|█████▊    | 46/79 [00:01<00:00, 43.48it/s] 65%|██████▍   | 51/79 [00:01<00:00, 38.09it/s] 71%|███████   | 56/79 [00:01<00:00, 39.50it/s] 80%|███████▉  | 63/79 [00:01<00:00, 46.14it/s] 87%|████████▋ | 69/79 [00:02<00:00, 38.40it/s] 94%|█████████▎| 74/79 [00:02<00:00, 40.51it/s]100%|██████████| 79/79 [00:02<00:00, 34.54it/s]
10000 images processed, 2.3275816440582275 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:33,  2.34it/s] 13%|█▎        | 10/79 [00:00<00:02, 23.77it/s] 25%|██▌       | 20/79 [00:00<00:01, 42.55it/s] 37%|███▋      | 29/79 [00:00<00:00, 55.13it/s] 47%|████▋     | 37/79 [00:00<00:00, 50.61it/s] 56%|█████▌    | 44/79 [00:01<00:00, 51.21it/s] 68%|██████▊   | 54/79 [00:01<00:00, 61.94it/s] 80%|███████▉  | 63/79 [00:01<00:00, 69.03it/s] 92%|█████████▏| 73/79 [00:01<00:00, 75.56it/s]100%|██████████| 79/79 [00:01<00:00, 54.57it/s]
10000 images processed, 1.477607011795044 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:29,  2.37it/s] 13%|█▎        | 9/70 [00:00<00:02, 21.75it/s] 26%|██▌       | 18/70 [00:00<00:01, 39.26it/s] 39%|███▊      | 27/70 [00:00<00:00, 51.97it/s] 51%|█████▏    | 36/70 [00:00<00:00, 59.75it/s] 63%|██████▎   | 44/70 [00:01<00:00, 53.60it/s] 73%|███████▎  | 51/70 [00:01<00:00, 55.48it/s] 87%|████████▋ | 61/70 [00:01<00:00, 65.70it/s]100%|██████████| 70/70 [00:01<00:00, 51.74it/s]
8925 images processed, 1.3897652626037598 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:00<00:43,  1.00it/s] 20%|██        | 9/45 [00:01<00:04,  7.57it/s] 24%|██▍       | 11/45 [00:01<00:04,  8.20it/s] 38%|███▊      | 17/45 [00:02<00:02, 10.94it/s] 42%|████▏     | 19/45 [00:02<00:02, 10.48it/s] 56%|█████▌    | 25/45 [00:02<00:01, 13.53it/s] 60%|██████    | 27/45 [00:02<00:01, 12.70it/s] 73%|███████▎  | 33/45 [00:03<00:00, 12.70it/s] 78%|███████▊  | 35/45 [00:03<00:00, 11.19it/s] 91%|█████████ | 41/45 [00:03<00:00, 15.58it/s] 96%|█████████▌| 43/45 [00:04<00:00,  9.96it/s]100%|██████████| 45/45 [00:04<00:00, 10.58it/s]
5640 images processed, 4.276960372924805 seconds used

22.449440240859985
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.53  99.36
places365     67.87  81.18
LSUN          17.60  96.07
iSUN          72.36  81.68
dtd           37.87  91.39
AVG           39.65  89.93
Retain-Acc: 0.7406
Forget-as-OOD (retain known vs forget novel):
  FPR: 79.50 AUROC: 86.90 AUIN: 98.36
29.40086603164673
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e5-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid
epochs=5 | cache=6 | flambda=1.0 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21610432
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<02:48,  2.31it/s]  2%|▏         | 7/391 [00:00<00:23, 16.04it/s]  4%|▍         | 16/391 [00:00<00:10, 34.18it/s]  6%|▋         | 25/391 [00:00<00:07, 47.70it/s]  8%|▊         | 32/391 [00:00<00:07, 49.05it/s] 10%|▉         | 39/391 [00:01<00:07, 49.40it/s] 12%|█▏        | 47/391 [00:01<00:06, 55.66it/s] 14%|█▍        | 55/391 [00:01<00:05, 61.47it/s] 17%|█▋        | 65/391 [00:01<00:04, 70.64it/s] 19%|█▊        | 73/391 [00:01<00:05, 63.21it/s] 20%|██        | 80/391 [00:01<00:05, 59.03it/s] 23%|██▎       | 88/391 [00:01<00:04, 63.66it/s] 25%|██▌       | 98/391 [00:01<00:04, 72.20it/s] 27%|██▋       | 107/391 [00:01<00:03, 75.77it/s] 29%|██▉       | 115/391 [00:02<00:03, 69.50it/s] 31%|███▏      | 123/391 [00:02<00:04, 60.96it/s] 34%|███▍      | 132/391 [00:02<00:03, 66.26it/s] 36%|███▋      | 142/391 [00:02<00:03, 73.64it/s] 39%|███▊      | 151/391 [00:02<00:03, 76.31it/s] 41%|████      | 159/391 [00:02<00:03, 70.50it/s] 43%|████▎     | 167/391 [00:02<00:03, 62.67it/s] 45%|████▍     | 174/391 [00:03<00:03, 63.61it/s] 47%|████▋     | 184/391 [00:03<00:02, 71.15it/s] 50%|████▉     | 194/391 [00:03<00:02, 77.50it/s] 52%|█████▏    | 202/391 [00:03<00:02, 73.08it/s] 54%|█████▎    | 210/391 [00:03<00:02, 63.47it/s] 55%|█████▌    | 217/391 [00:03<00:02, 61.58it/s] 58%|█████▊    | 227/391 [00:03<00:02, 69.40it/s] 60%|██████    | 236/391 [00:03<00:02, 73.74it/s] 62%|██████▏   | 244/391 [00:03<00:02, 68.29it/s] 64%|██████▍   | 252/391 [00:04<00:02, 61.61it/s] 66%|██████▋   | 260/391 [00:04<00:02, 64.92it/s] 69%|██████▉   | 270/391 [00:04<00:01, 72.79it/s] 72%|███████▏  | 280/391 [00:04<00:01, 79.02it/s] 74%|███████▍  | 290/391 [00:04<00:01, 82.74it/s] 76%|███████▋  | 299/391 [00:04<00:01, 70.08it/s] 79%|███████▊  | 307/391 [00:04<00:01, 63.81it/s] 81%|████████  | 317/391 [00:05<00:01, 71.04it/s] 83%|████████▎ | 325/391 [00:05<00:00, 72.20it/s] 85%|████████▌ | 333/391 [00:05<00:00, 68.78it/s] 87%|████████▋ | 341/391 [00:05<00:00, 61.63it/s] 89%|████████▉ | 348/391 [00:05<00:00, 62.81it/s] 91%|█████████▏| 357/391 [00:05<00:00, 69.18it/s] 94%|█████████▍| 367/391 [00:05<00:00, 76.33it/s] 96%|█████████▌| 375/391 [00:05<00:00, 75.27it/s] 98%|█████████▊| 383/391 [00:06<00:00, 64.92it/s]100%|█████████▉| 390/391 [00:06<00:00, 62.53it/s]100%|██████████| 391/391 [00:06<00:00, 63.55it/s]
50000 images processed, 6.267539739608765 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:26,  2.94it/s] 13%|█▎        | 10/79 [00:00<00:02, 28.12it/s] 22%|██▏       | 17/79 [00:00<00:01, 39.87it/s] 29%|██▉       | 23/79 [00:00<00:01, 42.65it/s] 37%|███▋      | 29/79 [00:00<00:01, 45.12it/s] 48%|████▊     | 38/79 [00:00<00:00, 55.88it/s] 59%|█████▉    | 47/79 [00:01<00:00, 65.00it/s] 71%|███████   | 56/79 [00:01<00:00, 70.64it/s] 81%|████████  | 64/79 [00:01<00:00, 61.68it/s] 90%|████████▉ | 71/79 [00:01<00:00, 58.54it/s]100%|██████████| 79/79 [00:01<00:00, 52.59it/s]
10000 images processed, 1.5391967296600342 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:28,  2.30it/s]  3%|▎         | 6/204 [00:00<00:14, 13.86it/s]  7%|▋         | 15/204 [00:00<00:05, 32.72it/s] 12%|█▏        | 24/204 [00:00<00:03, 46.73it/s] 15%|█▌        | 31/204 [00:00<00:03, 52.29it/s] 19%|█▊        | 38/204 [00:01<00:03, 49.28it/s] 22%|██▏       | 44/204 [00:01<00:03, 50.09it/s] 26%|██▌       | 53/204 [00:01<00:02, 60.10it/s] 31%|███       | 63/204 [00:01<00:02, 68.92it/s] 36%|███▌      | 73/204 [00:01<00:01, 74.72it/s] 40%|███▉      | 81/204 [00:01<00:01, 62.93it/s] 43%|████▎     | 88/204 [00:01<00:01, 58.52it/s] 48%|████▊     | 97/204 [00:01<00:01, 64.58it/s] 52%|█████▏    | 107/204 [00:02<00:01, 72.09it/s] 56%|█████▋    | 115/204 [00:02<00:01, 58.93it/s] 60%|█████▉    | 122/204 [00:02<00:01, 58.08it/s] 65%|██████▍   | 132/204 [00:02<00:01, 66.94it/s] 69%|██████▉   | 141/204 [00:02<00:00, 72.11it/s] 74%|███████▍  | 151/204 [00:02<00:00, 78.32it/s] 78%|███████▊  | 160/204 [00:02<00:00, 78.34it/s] 83%|████████▎ | 169/204 [00:02<00:00, 63.12it/s] 87%|████████▋ | 177/204 [00:03<00:00, 65.64it/s] 92%|█████████▏| 187/204 [00:03<00:00, 72.17it/s] 97%|█████████▋| 197/204 [00:03<00:00, 78.08it/s]100%|██████████| 204/204 [00:03<00:00, 60.64it/s]
26032 images processed, 3.4131996631622314 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:45,  1.73it/s]  8%|▊         | 6/79 [00:00<00:06, 10.91it/s] 14%|█▍        | 11/79 [00:00<00:03, 18.80it/s] 20%|██        | 16/79 [00:00<00:02, 25.14it/s] 27%|██▋       | 21/79 [00:01<00:01, 30.22it/s] 33%|███▎      | 26/79 [00:01<00:01, 34.61it/s] 39%|███▉      | 31/79 [00:01<00:01, 38.50it/s] 46%|████▌     | 36/79 [00:01<00:01, 40.90it/s] 52%|█████▏    | 41/79 [00:01<00:00, 42.88it/s] 58%|█████▊    | 46/79 [00:01<00:00, 37.52it/s] 65%|██████▍   | 51/79 [00:01<00:00, 34.35it/s] 70%|██████▉   | 55/79 [00:01<00:00, 33.05it/s] 76%|███████▌  | 60/79 [00:02<00:00, 36.25it/s] 82%|████████▏ | 65/79 [00:02<00:00, 38.11it/s] 89%|████████▊ | 70/79 [00:02<00:00, 40.11it/s] 95%|█████████▍| 75/79 [00:02<00:00, 41.13it/s]100%|██████████| 79/79 [00:02<00:00, 32.22it/s]
10000 images processed, 2.495565891265869 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:31,  2.44it/s]  8%|▊         | 6/79 [00:00<00:05, 14.25it/s] 14%|█▍        | 11/79 [00:00<00:03, 22.53it/s] 20%|██        | 16/79 [00:00<00:02, 29.23it/s] 27%|██▋       | 21/79 [00:00<00:01, 33.65it/s] 33%|███▎      | 26/79 [00:00<00:01, 37.23it/s] 39%|███▉      | 31/79 [00:01<00:01, 36.92it/s] 46%|████▌     | 36/79 [00:01<00:01, 33.45it/s] 51%|█████     | 40/79 [00:01<00:01, 31.99it/s] 56%|█████▌    | 44/79 [00:01<00:01, 33.22it/s] 62%|██████▏   | 49/79 [00:01<00:00, 36.99it/s] 68%|██████▊   | 54/79 [00:01<00:00, 39.96it/s] 75%|███████▍  | 59/79 [00:01<00:00, 42.17it/s] 81%|████████  | 64/79 [00:01<00:00, 43.79it/s] 87%|████████▋ | 69/79 [00:02<00:00, 44.98it/s] 94%|█████████▎| 74/79 [00:02<00:00, 46.29it/s]100%|██████████| 79/79 [00:02<00:00, 35.14it/s]
10000 images processed, 2.2677693367004395 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:28,  2.39it/s]  9%|▊         | 6/70 [00:00<00:04, 14.31it/s] 16%|█▌        | 11/70 [00:00<00:02, 23.49it/s] 23%|██▎       | 16/70 [00:00<00:01, 30.19it/s] 30%|███       | 21/70 [00:00<00:01, 35.03it/s] 37%|███▋      | 26/70 [00:00<00:01, 38.32it/s] 44%|████▍     | 31/70 [00:01<00:00, 39.67it/s] 51%|█████▏    | 36/70 [00:01<00:00, 35.09it/s] 57%|█████▋    | 40/70 [00:01<00:00, 33.33it/s] 63%|██████▎   | 44/70 [00:01<00:00, 32.43it/s] 70%|███████   | 49/70 [00:01<00:00, 35.86it/s] 77%|███████▋  | 54/70 [00:01<00:00, 38.76it/s] 84%|████████▍ | 59/70 [00:01<00:00, 39.94it/s] 91%|█████████▏| 64/70 [00:01<00:00, 41.51it/s]100%|██████████| 70/70 [00:02<00:00, 43.84it/s]100%|██████████| 70/70 [00:02<00:00, 33.69it/s]
8925 images processed, 2.119396448135376 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:01<00:48,  1.09s/it] 11%|█         | 5/45 [00:01<00:07,  5.42it/s] 20%|██        | 9/45 [00:01<00:05,  6.72it/s] 24%|██▍       | 11/45 [00:01<00:04,  8.21it/s] 33%|███▎      | 15/45 [00:01<00:02, 12.39it/s] 40%|████      | 18/45 [00:02<00:02, 10.20it/s] 47%|████▋     | 21/45 [00:02<00:01, 12.87it/s] 53%|█████▎    | 24/45 [00:02<00:01, 14.83it/s] 60%|██████    | 27/45 [00:02<00:01, 11.52it/s] 67%|██████▋   | 30/45 [00:03<00:01, 13.00it/s] 73%|███████▎  | 33/45 [00:03<00:01, 10.46it/s] 78%|███████▊  | 35/45 [00:03<00:00, 10.94it/s] 91%|█████████ | 41/45 [00:03<00:00, 13.68it/s] 96%|█████████▌| 43/45 [00:04<00:00,  9.34it/s]100%|██████████| 45/45 [00:04<00:00,  9.94it/s]
5640 images processed, 4.556050539016724 seconds used

24.37040066719055
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.53  99.36
places365     67.87  81.18
LSUN          17.60  96.07
iSUN          72.36  81.68
dtd           37.87  91.39
AVG           39.65  89.93
Retain-Acc: 0.7406
Forget-as-OOD (retain known vs forget novel):
  FPR: 79.50 AUROC: 86.90 AUIN: 98.36
24.827778100967407
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e10-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid
epochs=10 | cache=6 | flambda=1.0 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e10-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e10-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e10-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21610432
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<02:36,  2.49it/s]  2%|▏         | 9/391 [00:00<00:17, 21.82it/s]  4%|▎         | 14/391 [00:00<00:13, 28.77it/s]  5%|▍         | 19/391 [00:00<00:10, 34.13it/s]  7%|▋         | 27/391 [00:00<00:07, 45.76it/s]  9%|▉         | 35/391 [00:00<00:06, 53.84it/s] 11%|█         | 42/391 [00:01<00:06, 57.22it/s] 13%|█▎        | 49/391 [00:01<00:06, 53.33it/s] 14%|█▍        | 55/391 [00:01<00:06, 52.40it/s] 17%|█▋        | 65/391 [00:01<00:05, 63.17it/s] 19%|█▉        | 75/391 [00:01<00:04, 71.78it/s] 21%|██▏       | 84/391 [00:01<00:04, 75.14it/s] 24%|██▎       | 92/391 [00:01<00:04, 68.83it/s] 26%|██▌       | 100/391 [00:01<00:04, 61.61it/s] 28%|██▊       | 108/391 [00:02<00:04, 64.17it/s] 30%|██▉       | 117/391 [00:02<00:03, 70.20it/s] 32%|███▏      | 127/391 [00:02<00:03, 76.70it/s] 35%|███▍      | 136/391 [00:02<00:03, 78.91it/s] 37%|███▋      | 145/391 [00:02<00:03, 65.49it/s] 39%|███▉      | 153/391 [00:02<00:03, 63.53it/s] 41%|████▏     | 162/391 [00:02<00:03, 69.58it/s] 44%|████▍     | 172/391 [00:02<00:02, 75.79it/s] 46%|████▋     | 181/391 [00:03<00:02, 78.98it/s] 49%|████▉     | 191/391 [00:03<00:02, 80.27it/s] 51%|█████     | 200/391 [00:03<00:02, 67.29it/s] 53%|█████▎    | 208/391 [00:03<00:02, 64.72it/s] 56%|█████▌    | 218/391 [00:03<00:02, 72.15it/s] 58%|█████▊    | 227/391 [00:03<00:02, 76.40it/s] 61%|██████    | 237/391 [00:03<00:01, 81.43it/s] 63%|██████▎   | 246/391 [00:03<00:01, 77.63it/s] 65%|██████▍   | 254/391 [00:04<00:02, 66.83it/s] 67%|██████▋   | 262/391 [00:04<00:01, 65.36it/s] 69%|██████▉   | 271/391 [00:04<00:01, 71.27it/s] 72%|███████▏  | 281/391 [00:04<00:01, 77.53it/s] 74%|███████▍  | 290/391 [00:04<00:01, 79.52it/s] 76%|███████▋  | 299/391 [00:04<00:01, 76.22it/s] 79%|███████▊  | 307/391 [00:04<00:01, 65.59it/s] 80%|████████  | 314/391 [00:04<00:01, 64.71it/s] 82%|████████▏ | 322/391 [00:05<00:01, 68.56it/s] 85%|████████▍ | 331/391 [00:05<00:00, 73.81it/s] 87%|████████▋ | 339/391 [00:05<00:00, 66.60it/s] 88%|████████▊ | 346/391 [00:05<00:00, 61.37it/s] 90%|█████████ | 353/391 [00:05<00:00, 62.51it/s] 93%|█████████▎| 363/391 [00:05<00:00, 71.44it/s] 95%|█████████▌| 373/391 [00:05<00:00, 78.14it/s] 98%|█████████▊| 383/391 [00:05<00:00, 83.04it/s]100%|██████████| 391/391 [00:05<00:00, 66.03it/s]
50000 images processed, 6.029631614685059 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:19,  3.94it/s] 10%|█         | 8/79 [00:00<00:02, 27.51it/s] 23%|██▎       | 18/79 [00:00<00:01, 49.30it/s] 34%|███▍      | 27/79 [00:00<00:00, 60.88it/s] 44%|████▍     | 35/79 [00:00<00:00, 55.19it/s] 53%|█████▎    | 42/79 [00:00<00:00, 54.06it/s] 65%|██████▍   | 51/79 [00:00<00:00, 63.12it/s] 76%|███████▌  | 60/79 [00:01<00:00, 68.89it/s] 87%|████████▋ | 69/79 [00:01<00:00, 74.30it/s] 97%|█████████▋| 77/79 [00:01<00:00, 63.71it/s]100%|██████████| 79/79 [00:01<00:00, 55.75it/s]
10000 images processed, 1.4489593505859375 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<00:57,  3.53it/s]  3%|▎         | 6/204 [00:00<00:10, 18.27it/s]  7%|▋         | 15/204 [00:00<00:04, 40.36it/s] 12%|█▏        | 24/204 [00:00<00:03, 55.12it/s] 16%|█▌        | 33/204 [00:00<00:02, 64.44it/s] 20%|██        | 41/204 [00:00<00:02, 62.66it/s] 24%|██▎       | 48/204 [00:00<00:02, 57.06it/s] 27%|██▋       | 55/204 [00:01<00:02, 58.60it/s] 31%|███▏      | 64/204 [00:01<00:02, 66.56it/s] 36%|███▌      | 73/204 [00:01<00:01, 71.41it/s] 41%|████      | 83/204 [00:01<00:01, 78.16it/s] 45%|████▌     | 92/204 [00:01<00:01, 71.05it/s] 49%|████▉     | 100/204 [00:01<00:01, 60.28it/s] 54%|█████▍    | 110/204 [00:01<00:01, 67.16it/s] 59%|█████▉    | 120/204 [00:01<00:01, 73.29it/s] 63%|██████▎   | 129/204 [00:02<00:00, 77.27it/s] 68%|██████▊   | 138/204 [00:02<00:00, 72.39it/s] 72%|███████▏  | 146/204 [00:02<00:00, 62.23it/s] 75%|███████▌  | 153/204 [00:02<00:00, 63.14it/s] 79%|███████▉  | 162/204 [00:02<00:00, 69.45it/s] 84%|████████▍ | 171/204 [00:02<00:00, 74.22it/s] 88%|████████▊ | 179/204 [00:02<00:00, 62.64it/s] 91%|█████████ | 186/204 [00:03<00:00, 58.15it/s] 96%|█████████▌| 196/204 [00:03<00:00, 66.44it/s]100%|██████████| 204/204 [00:03<00:00, 63.10it/s]
26032 images processed, 3.293325901031494 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:37,  2.06it/s] 11%|█▏        | 9/79 [00:00<00:04, 17.08it/s] 22%|██▏       | 17/79 [00:00<00:02, 27.45it/s] 32%|███▏      | 25/79 [00:00<00:01, 35.56it/s] 42%|████▏     | 33/79 [00:01<00:01, 40.19it/s] 52%|█████▏    | 41/79 [00:01<00:00, 43.89it/s] 62%|██████▏   | 49/79 [00:01<00:00, 46.96it/s] 72%|███████▏  | 57/79 [00:01<00:00, 48.79it/s] 80%|███████▉  | 63/79 [00:01<00:00, 50.33it/s] 87%|████████▋ | 69/79 [00:01<00:00, 48.66it/s] 95%|█████████▍| 75/79 [00:01<00:00, 50.09it/s]100%|██████████| 79/79 [00:01<00:00, 40.51it/s]
10000 images processed, 1.9851622581481934 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:24,  3.20it/s]  8%|▊         | 6/79 [00:00<00:04, 17.18it/s] 19%|█▉        | 15/79 [00:00<00:01, 37.88it/s] 30%|███       | 24/79 [00:00<00:01, 52.07it/s] 42%|████▏     | 33/79 [00:00<00:00, 61.59it/s] 52%|█████▏    | 41/79 [00:00<00:00, 53.98it/s] 61%|██████    | 48/79 [00:01<00:00, 54.40it/s] 72%|███████▏  | 57/79 [00:01<00:00, 62.11it/s] 85%|████████▍ | 67/79 [00:01<00:00, 70.79it/s] 97%|█████████▋| 77/79 [00:01<00:00, 77.58it/s]100%|██████████| 79/79 [00:01<00:00, 56.65it/s]
10000 images processed, 1.4150795936584473 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:24,  2.84it/s]  9%|▊         | 6/70 [00:00<00:04, 15.56it/s] 16%|█▌        | 11/70 [00:00<00:02, 24.61it/s] 29%|██▊       | 20/70 [00:00<00:01, 41.97it/s] 41%|████▏     | 29/70 [00:00<00:00, 54.53it/s] 53%|█████▎    | 37/70 [00:00<00:00, 61.51it/s] 63%|██████▎   | 44/70 [00:01<00:00, 52.97it/s] 73%|███████▎  | 51/70 [00:01<00:00, 53.07it/s] 87%|████████▋ | 61/70 [00:01<00:00, 63.75it/s]100%|██████████| 70/70 [00:01<00:00, 49.82it/s]
8925 images processed, 1.4389331340789795 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:00<00:39,  1.12it/s]  4%|▍         | 2/45 [00:01<00:21,  2.02it/s] 16%|█▌        | 7/45 [00:01<00:04,  8.87it/s] 22%|██▏       | 10/45 [00:01<00:04,  8.37it/s] 31%|███       | 14/45 [00:01<00:02, 12.11it/s] 38%|███▊      | 17/45 [00:01<00:02, 13.87it/s] 44%|████▍     | 20/45 [00:02<00:01, 14.42it/s] 49%|████▉     | 22/45 [00:02<00:02, 11.50it/s] 56%|█████▌    | 25/45 [00:02<00:01, 13.64it/s] 67%|██████▋   | 30/45 [00:03<00:01, 11.55it/s] 73%|███████▎  | 33/45 [00:03<00:00, 12.50it/s] 82%|████████▏ | 37/45 [00:03<00:00, 16.26it/s] 91%|█████████ | 41/45 [00:03<00:00, 12.86it/s] 96%|█████████▌| 43/45 [00:04<00:00, 11.22it/s]100%|██████████| 45/45 [00:04<00:00, 11.03it/s]
5640 images processed, 4.1121132373809814 seconds used

21.3377366065979
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.53  99.36
places365     67.87  81.18
LSUN          17.60  96.07
iSUN          72.36  81.68
dtd           37.87  91.39
AVG           39.65  89.93
Retain-Acc: 0.7406
Forget-as-OOD (retain known vs forget novel):
  FPR: 79.50 AUROC: 86.90 AUIN: 98.36
27.14602494239807
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e20-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid
epochs=20 | cache=6 | flambda=1.0 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e20-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e20-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e20-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21610432
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<02:16,  2.85it/s]  3%|▎         | 12/391 [00:00<00:11, 33.23it/s]  6%|▌         | 23/391 [00:00<00:06, 54.34it/s]  8%|▊         | 32/391 [00:00<00:06, 57.78it/s] 11%|█         | 42/391 [00:00<00:05, 67.88it/s] 13%|█▎        | 52/391 [00:00<00:04, 75.41it/s] 16%|█▌        | 62/391 [00:01<00:04, 80.39it/s] 18%|█▊        | 71/391 [00:01<00:03, 82.13it/s] 20%|██        | 80/391 [00:01<00:04, 67.68it/s] 23%|██▎       | 88/391 [00:01<00:04, 65.08it/s] 25%|██▌       | 98/391 [00:01<00:04, 72.46it/s] 28%|██▊       | 108/391 [00:01<00:03, 78.43it/s] 30%|███       | 118/391 [00:01<00:03, 82.71it/s] 33%|███▎      | 128/391 [00:01<00:03, 83.97it/s] 35%|███▌      | 137/391 [00:02<00:03, 69.25it/s] 37%|███▋      | 145/391 [00:02<00:03, 66.20it/s] 39%|███▉      | 154/391 [00:02<00:03, 71.84it/s] 42%|████▏     | 164/391 [00:02<00:02, 77.34it/s] 45%|████▍     | 174/391 [00:02<00:02, 81.38it/s] 47%|████▋     | 183/391 [00:02<00:02, 69.50it/s] 49%|████▉     | 191/391 [00:02<00:03, 63.45it/s] 51%|█████▏    | 201/391 [00:02<00:02, 71.05it/s] 54%|█████▍    | 211/391 [00:03<00:02, 76.68it/s] 57%|█████▋    | 221/391 [00:03<00:02, 81.39it/s] 59%|█████▉    | 230/391 [00:03<00:01, 82.88it/s] 61%|██████    | 239/391 [00:03<00:02, 68.54it/s] 63%|██████▎   | 247/391 [00:03<00:02, 65.37it/s] 66%|██████▌   | 257/391 [00:03<00:01, 72.56it/s] 68%|██████▊   | 267/391 [00:03<00:01, 78.14it/s] 71%|███████   | 277/391 [00:03<00:01, 82.24it/s] 73%|███████▎  | 286/391 [00:04<00:01, 73.34it/s] 75%|███████▌  | 294/391 [00:04<00:01, 65.15it/s] 77%|███████▋  | 303/391 [00:04<00:01, 69.23it/s] 80%|███████▉  | 312/391 [00:04<00:01, 73.80it/s] 82%|████████▏ | 322/391 [00:04<00:00, 79.65it/s] 85%|████████▍ | 331/391 [00:04<00:00, 78.58it/s] 87%|████████▋ | 340/391 [00:04<00:00, 66.72it/s] 89%|████████▉ | 348/391 [00:04<00:00, 65.41it/s] 92%|█████████▏| 358/391 [00:05<00:00, 72.14it/s] 94%|█████████▍| 367/391 [00:05<00:00, 75.26it/s] 96%|█████████▌| 376/391 [00:05<00:00, 78.78it/s] 98%|█████████▊| 385/391 [00:05<00:00, 66.14it/s]100%|██████████| 391/391 [00:05<00:00, 69.63it/s]
50000 images processed, 5.7147605419158936 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:19,  4.08it/s]  8%|▊         | 6/79 [00:00<00:03, 20.71it/s] 14%|█▍        | 11/79 [00:00<00:02, 30.45it/s] 25%|██▌       | 20/79 [00:00<00:01, 48.80it/s] 37%|███▋      | 29/79 [00:00<00:00, 61.52it/s] 49%|████▉     | 39/79 [00:00<00:00, 72.10it/s] 62%|██████▏   | 49/79 [00:00<00:00, 79.01it/s] 73%|███████▎  | 58/79 [00:01<00:00, 65.69it/s] 84%|████████▎ | 66/79 [00:01<00:00, 61.45it/s] 96%|█████████▌| 76/79 [00:01<00:00, 70.14it/s]100%|██████████| 79/79 [00:01<00:00, 58.65it/s]
10000 images processed, 1.3681204319000244 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:15,  2.69it/s]  3%|▎         | 6/204 [00:00<00:13, 15.18it/s]  5%|▌         | 11/204 [00:00<00:07, 24.16it/s] 10%|▉         | 20/204 [00:00<00:04, 41.73it/s] 15%|█▍        | 30/204 [00:00<00:03, 56.85it/s] 20%|█▉        | 40/204 [00:00<00:02, 67.42it/s] 24%|██▍       | 49/204 [00:01<00:02, 72.48it/s] 28%|██▊       | 57/204 [00:01<00:02, 60.69it/s] 31%|███▏      | 64/204 [00:01<00:02, 59.31it/s] 36%|███▋      | 74/204 [00:01<00:01, 67.91it/s] 41%|████      | 84/204 [00:01<00:01, 74.76it/s] 46%|████▌     | 94/204 [00:01<00:01, 79.55it/s] 50%|█████     | 103/204 [00:01<00:01, 69.27it/s] 54%|█████▍    | 111/204 [00:01<00:01, 61.96it/s] 59%|█████▉    | 121/204 [00:02<00:01, 69.60it/s] 64%|██████▍   | 131/204 [00:02<00:00, 75.30it/s] 69%|██████▉   | 141/204 [00:02<00:00, 80.05it/s] 74%|███████▎  | 150/204 [00:02<00:00, 72.15it/s] 77%|███████▋  | 158/204 [00:02<00:00, 62.14it/s] 82%|████████▏ | 168/204 [00:02<00:00, 69.23it/s] 87%|████████▋ | 178/204 [00:02<00:00, 75.34it/s] 92%|█████████▏| 188/204 [00:02<00:00, 80.02it/s] 97%|█████████▋| 198/204 [00:03<00:00, 84.00it/s]100%|██████████| 204/204 [00:03<00:00, 63.63it/s]
26032 images processed, 3.2488996982574463 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:41,  1.88it/s] 11%|█▏        | 9/79 [00:00<00:04, 15.21it/s] 18%|█▊        | 14/79 [00:00<00:03, 21.52it/s] 24%|██▍       | 19/79 [00:00<00:02, 27.40it/s] 32%|███▏      | 25/79 [00:01<00:01, 29.53it/s] 38%|███▊      | 30/79 [00:01<00:01, 32.94it/s] 44%|████▍     | 35/79 [00:01<00:01, 36.26it/s] 52%|█████▏    | 41/79 [00:01<00:01, 34.80it/s] 58%|█████▊    | 46/79 [00:01<00:00, 37.74it/s] 65%|██████▍   | 51/79 [00:01<00:00, 39.63it/s] 72%|███████▏  | 57/79 [00:01<00:00, 35.65it/s] 78%|███████▊  | 62/79 [00:02<00:00, 38.12it/s] 85%|████████▍ | 67/79 [00:02<00:00, 40.31it/s] 92%|█████████▏| 73/79 [00:02<00:00, 39.23it/s] 99%|█████████▊| 78/79 [00:02<00:00, 40.92it/s]100%|██████████| 79/79 [00:02<00:00, 32.25it/s]
10000 images processed, 2.478273391723633 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:23,  3.39it/s] 14%|█▍        | 11/79 [00:00<00:01, 34.14it/s] 27%|██▋       | 21/79 [00:00<00:01, 53.61it/s] 39%|███▉      | 31/79 [00:00<00:00, 66.24it/s] 51%|█████     | 40/79 [00:00<00:00, 69.78it/s] 61%|██████    | 48/79 [00:00<00:00, 59.40it/s] 70%|██████▉   | 55/79 [00:01<00:00, 59.71it/s] 81%|████████  | 64/79 [00:01<00:00, 67.47it/s] 94%|█████████▎| 74/79 [00:01<00:00, 75.30it/s]100%|██████████| 79/79 [00:01<00:00, 61.92it/s]
10000 images processed, 1.2924137115478516 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:21,  3.16it/s] 13%|█▎        | 9/70 [00:00<00:02, 26.33it/s] 20%|██        | 14/70 [00:00<00:01, 31.97it/s] 27%|██▋       | 19/70 [00:00<00:01, 36.63it/s] 39%|███▊      | 27/70 [00:00<00:00, 48.19it/s] 53%|█████▎    | 37/70 [00:00<00:00, 60.90it/s] 67%|██████▋   | 47/70 [00:00<00:00, 70.62it/s] 79%|███████▊  | 55/70 [00:01<00:00, 63.97it/s] 89%|████████▊ | 62/70 [00:01<00:00, 57.44it/s]100%|██████████| 70/70 [00:01<00:00, 62.53it/s]100%|██████████| 70/70 [00:01<00:00, 50.63it/s]
8925 images processed, 1.4178094863891602 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:00<00:41,  1.06it/s]  7%|▋         | 3/45 [00:01<00:12,  3.47it/s] 18%|█▊        | 8/45 [00:01<00:03, 10.43it/s] 24%|██▍       | 11/45 [00:01<00:03,  8.91it/s] 31%|███       | 14/45 [00:01<00:03,  9.57it/s] 38%|███▊      | 17/45 [00:02<00:02, 11.71it/s] 42%|████▏     | 19/45 [00:02<00:02, 12.52it/s] 49%|████▉     | 22/45 [00:02<00:02, 10.00it/s] 58%|█████▊    | 26/45 [00:02<00:01, 13.56it/s] 67%|██████▋   | 30/45 [00:03<00:01,  9.63it/s] 76%|███████▌  | 34/45 [00:03<00:00, 12.79it/s] 84%|████████▍ | 38/45 [00:03<00:00, 12.70it/s] 91%|█████████ | 41/45 [00:03<00:00, 13.69it/s] 96%|█████████▌| 43/45 [00:04<00:00, 11.30it/s]100%|██████████| 45/45 [00:04<00:00, 10.60it/s]
5640 images processed, 4.271830797195435 seconds used

21.615713357925415
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.53  99.36
places365     67.87  81.18
LSUN          17.60  96.07
iSUN          72.36  81.68
dtd           37.87  91.39
AVG           39.65  89.93
Retain-Acc: 0.7406
Forget-as-OOD (retain known vs forget novel):
  FPR: 79.50 AUROC: 86.90 AUIN: 98.36
17.33540368080139
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e50-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid
epochs=50 | cache=6 | flambda=1.0 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e50-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e50-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e50-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21610432
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<02:32,  2.55it/s]  3%|▎         | 10/391 [00:00<00:15, 25.40it/s]  5%|▍         | 19/391 [00:00<00:08, 42.58it/s]  7%|▋         | 29/391 [00:00<00:06, 57.62it/s] 10%|▉         | 39/391 [00:00<00:05, 68.49it/s] 12%|█▏        | 48/391 [00:01<00:05, 59.99it/s] 14%|█▍        | 56/391 [00:01<00:05, 58.48it/s] 17%|█▋        | 66/391 [00:01<00:04, 67.08it/s] 19%|█▉        | 76/391 [00:01<00:04, 73.53it/s] 22%|██▏       | 85/391 [00:01<00:03, 76.70it/s] 24%|██▍       | 94/391 [00:01<00:04, 65.24it/s] 26%|██▌       | 102/391 [00:01<00:04, 62.06it/s] 29%|██▊       | 112/391 [00:01<00:03, 69.98it/s] 31%|███       | 122/391 [00:02<00:03, 76.09it/s] 34%|███▍      | 132/391 [00:02<00:03, 80.97it/s] 36%|███▋      | 142/391 [00:02<00:03, 82.63it/s] 39%|███▊      | 151/391 [00:02<00:03, 68.30it/s] 41%|████      | 159/391 [00:02<00:03, 65.45it/s] 43%|████▎     | 169/391 [00:02<00:03, 71.99it/s] 46%|████▌     | 179/391 [00:02<00:02, 77.14it/s] 48%|████▊     | 189/391 [00:02<00:02, 81.08it/s] 51%|█████     | 198/391 [00:03<00:02, 69.53it/s] 53%|█████▎    | 206/391 [00:03<00:02, 63.54it/s] 55%|█████▌    | 216/391 [00:03<00:02, 70.89it/s] 58%|█████▊    | 226/391 [00:03<00:02, 77.11it/s] 60%|██████    | 236/391 [00:03<00:01, 80.95it/s] 63%|██████▎   | 246/391 [00:03<00:01, 82.87it/s] 65%|██████▌   | 255/391 [00:03<00:01, 68.58it/s] 67%|██████▋   | 263/391 [00:03<00:01, 65.98it/s] 70%|██████▉   | 273/391 [00:04<00:01, 73.26it/s] 72%|███████▏  | 283/391 [00:04<00:01, 78.71it/s] 75%|███████▍  | 293/391 [00:04<00:01, 82.79it/s] 77%|███████▋  | 302/391 [00:04<00:01, 76.85it/s] 79%|███████▉  | 310/391 [00:04<00:01, 67.18it/s] 81%|████████▏ | 318/391 [00:04<00:01, 66.98it/s] 84%|████████▎ | 327/391 [00:04<00:00, 72.23it/s] 86%|████████▌ | 336/391 [00:04<00:00, 76.23it/s] 88%|████████▊ | 345/391 [00:05<00:00, 77.14it/s] 90%|█████████ | 353/391 [00:05<00:00, 66.03it/s] 92%|█████████▏| 360/391 [00:05<00:00, 63.02it/s] 95%|█████████▍| 370/391 [00:05<00:00, 71.43it/s] 97%|█████████▋| 380/391 [00:05<00:00, 77.59it/s]100%|█████████▉| 390/391 [00:05<00:00, 82.94it/s]100%|██████████| 391/391 [00:05<00:00, 69.08it/s]
50000 images processed, 5.773651123046875 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:29,  2.66it/s]  8%|▊         | 6/79 [00:00<00:04, 15.54it/s] 14%|█▍        | 11/79 [00:00<00:02, 25.09it/s] 25%|██▌       | 20/79 [00:00<00:01, 43.08it/s] 38%|███▊      | 30/79 [00:00<00:00, 58.56it/s] 49%|████▉     | 39/79 [00:00<00:00, 67.56it/s] 59%|█████▉    | 47/79 [00:00<00:00, 69.69it/s] 70%|██████▉   | 55/79 [00:01<00:00, 60.92it/s] 78%|███████▊  | 62/79 [00:01<00:00, 59.18it/s] 91%|█████████ | 72/79 [00:01<00:00, 68.84it/s]100%|██████████| 79/79 [00:01<00:00, 53.70it/s]
10000 images processed, 1.503608226776123 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:10,  2.87it/s]  3%|▎         | 6/204 [00:00<00:12, 15.87it/s]  5%|▌         | 11/204 [00:00<00:07, 25.01it/s]  9%|▉         | 19/204 [00:00<00:04, 39.87it/s] 14%|█▍        | 29/204 [00:00<00:03, 55.76it/s] 19%|█▉        | 39/204 [00:00<00:02, 66.80it/s] 24%|██▎       | 48/204 [00:00<00:02, 73.40it/s] 27%|██▋       | 56/204 [00:01<00:02, 71.18it/s] 31%|███▏      | 64/204 [00:01<00:02, 60.89it/s] 35%|███▍      | 71/204 [00:01<00:02, 62.40it/s] 40%|███▉      | 81/204 [00:01<00:01, 71.07it/s] 45%|████▍     | 91/204 [00:01<00:01, 77.09it/s] 50%|████▉     | 101/204 [00:01<00:01, 81.26it/s] 54%|█████▍    | 110/204 [00:01<00:01, 74.84it/s] 58%|█████▊    | 118/204 [00:02<00:01, 63.42it/s] 62%|██████▏   | 126/204 [00:02<00:01, 67.23it/s] 67%|██████▋   | 136/204 [00:02<00:00, 74.09it/s] 72%|███████▏  | 146/204 [00:02<00:00, 79.42it/s] 76%|███████▋  | 156/204 [00:02<00:00, 83.39it/s] 81%|████████  | 165/204 [00:02<00:00, 73.87it/s] 85%|████████▍ | 173/204 [00:02<00:00, 63.07it/s] 89%|████████▉ | 182/204 [00:02<00:00, 67.74it/s] 94%|█████████▍| 192/204 [00:03<00:00, 74.33it/s] 99%|█████████▉| 202/204 [00:03<00:00, 79.73it/s]100%|██████████| 204/204 [00:03<00:00, 64.85it/s]
26032 images processed, 3.2111189365386963 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:37,  2.09it/s] 11%|█▏        | 9/79 [00:00<00:04, 16.30it/s] 18%|█▊        | 14/79 [00:00<00:02, 22.91it/s] 27%|██▋       | 21/79 [00:00<00:01, 33.46it/s] 33%|███▎      | 26/79 [00:01<00:01, 34.60it/s] 39%|███▉      | 31/79 [00:01<00:01, 36.95it/s] 46%|████▌     | 36/79 [00:01<00:01, 39.49it/s] 54%|█████▍    | 43/79 [00:01<00:00, 46.28it/s] 62%|██████▏   | 49/79 [00:01<00:00, 38.41it/s] 71%|███████   | 56/79 [00:01<00:00, 44.80it/s] 78%|███████▊  | 62/79 [00:01<00:00, 37.26it/s] 85%|████████▍ | 67/79 [00:02<00:00, 39.35it/s] 92%|█████████▏| 73/79 [00:02<00:00, 38.21it/s] 99%|█████████▊| 78/79 [00:02<00:00, 39.98it/s]100%|██████████| 79/79 [00:02<00:00, 34.48it/s]
10000 images processed, 2.334548234939575 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:26,  2.98it/s] 13%|█▎        | 10/79 [00:00<00:02, 28.35it/s] 25%|██▌       | 20/79 [00:00<00:01, 48.65it/s] 37%|███▋      | 29/79 [00:00<00:00, 60.15it/s] 47%|████▋     | 37/79 [00:00<00:00, 56.29it/s] 56%|█████▌    | 44/79 [00:00<00:00, 52.26it/s] 68%|██████▊   | 54/79 [00:01<00:00, 62.46it/s] 81%|████████  | 64/79 [00:01<00:00, 70.77it/s] 94%|█████████▎| 74/79 [00:01<00:00, 77.17it/s]100%|██████████| 79/79 [00:01<00:00, 59.13it/s]
10000 images processed, 1.3590459823608398 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:26,  2.62it/s]  9%|▊         | 6/70 [00:00<00:04, 14.91it/s] 16%|█▌        | 11/70 [00:00<00:02, 23.88it/s] 29%|██▊       | 20/70 [00:00<00:01, 41.91it/s] 43%|████▎     | 30/70 [00:00<00:00, 57.00it/s] 57%|█████▋    | 40/70 [00:00<00:00, 67.27it/s] 70%|███████   | 49/70 [00:01<00:00, 72.92it/s] 83%|████████▎ | 58/70 [00:01<00:00, 60.80it/s] 93%|█████████▎| 65/70 [00:01<00:00, 60.14it/s]100%|██████████| 70/70 [00:01<00:00, 49.74it/s]
8925 images processed, 1.4482421875 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:01<00:47,  1.08s/it]  4%|▍         | 2/45 [00:01<00:22,  1.92it/s] 20%|██        | 9/45 [00:01<00:04,  8.66it/s] 24%|██▍       | 11/45 [00:01<00:03,  8.62it/s] 38%|███▊      | 17/45 [00:02<00:02, 12.04it/s] 42%|████▏     | 19/45 [00:02<00:02, 11.18it/s] 49%|████▉     | 22/45 [00:02<00:01, 13.51it/s] 56%|█████▌    | 25/45 [00:02<00:01, 15.68it/s] 60%|██████    | 27/45 [00:02<00:01, 11.33it/s] 71%|███████   | 32/45 [00:03<00:00, 16.91it/s] 78%|███████▊  | 35/45 [00:03<00:01,  9.90it/s] 91%|█████████ | 41/45 [00:03<00:00, 14.18it/s] 98%|█████████▊| 44/45 [00:04<00:00,  9.68it/s]100%|██████████| 45/45 [00:04<00:00, 10.05it/s]
5640 images processed, 4.500296354293823 seconds used

21.804104566574097
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.53  99.36
places365     67.87  81.18
LSUN          17.60  96.07
iSUN          72.36  81.68
dtd           37.87  91.39
AVG           39.65  89.93
Retain-Acc: 0.7406
Forget-as-OOD (retain known vs forget novel):
  FPR: 79.50 AUROC: 86.90 AUIN: 98.36
37.91390514373779
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e5-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid
epochs=5 | cache=6 | flambda=1.0 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21610432
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<01:57,  3.32it/s]  3%|▎         | 10/391 [00:00<00:12, 30.50it/s]  5%|▍         | 19/391 [00:00<00:07, 48.90it/s]  7%|▋         | 29/391 [00:00<00:05, 62.89it/s]  9%|▉         | 37/391 [00:00<00:06, 56.12it/s] 11%|█▏        | 44/391 [00:00<00:06, 54.04it/s] 14%|█▎        | 53/391 [00:01<00:05, 61.22it/s] 16%|█▌        | 62/391 [00:01<00:04, 68.61it/s] 18%|█▊        | 72/391 [00:01<00:04, 75.59it/s] 21%|██        | 81/391 [00:01<00:04, 64.58it/s] 23%|██▎       | 89/391 [00:01<00:05, 60.32it/s] 25%|██▌       | 98/391 [00:01<00:04, 67.14it/s] 27%|██▋       | 107/391 [00:01<00:03, 72.27it/s] 30%|██▉       | 116/391 [00:01<00:03, 73.08it/s] 32%|███▏      | 124/391 [00:02<00:04, 63.84it/s] 34%|███▎      | 131/391 [00:02<00:04, 60.21it/s] 36%|███▌      | 141/391 [00:02<00:03, 68.28it/s] 39%|███▊      | 151/391 [00:02<00:03, 74.54it/s] 41%|████      | 160/391 [00:02<00:02, 78.55it/s] 43%|████▎     | 169/391 [00:02<00:02, 74.53it/s] 45%|████▌     | 177/391 [00:02<00:03, 65.25it/s] 47%|████▋     | 185/391 [00:02<00:03, 68.12it/s] 50%|████▉     | 195/391 [00:03<00:02, 74.30it/s] 52%|█████▏    | 204/391 [00:03<00:02, 74.53it/s] 54%|█████▍    | 212/391 [00:03<00:02, 69.05it/s] 57%|█████▋    | 222/391 [00:03<00:02, 75.56it/s] 60%|█████▉    | 233/391 [00:03<00:01, 82.88it/s] 62%|██████▏   | 242/391 [00:03<00:01, 84.53it/s] 64%|██████▍   | 252/391 [00:03<00:01, 86.63it/s] 67%|██████▋   | 262/391 [00:03<00:01, 89.19it/s] 70%|██████▉   | 272/391 [00:03<00:01, 91.65it/s] 72%|███████▏  | 282/391 [00:04<00:01, 91.06it/s] 75%|███████▍  | 292/391 [00:04<00:01, 92.06it/s] 77%|███████▋  | 302/391 [00:04<00:00, 92.15it/s] 80%|███████▉  | 312/391 [00:04<00:00, 93.03it/s] 83%|████████▎ | 323/391 [00:04<00:00, 95.38it/s] 85%|████████▌ | 333/391 [00:04<00:00, 95.00it/s] 88%|████████▊ | 343/391 [00:04<00:00, 94.16it/s] 90%|█████████ | 353/391 [00:04<00:00, 82.33it/s] 93%|█████████▎| 363/391 [00:04<00:00, 86.12it/s] 95%|█████████▌| 373/391 [00:05<00:00, 88.31it/s] 98%|█████████▊| 383/391 [00:05<00:00, 88.17it/s]100%|██████████| 391/391 [00:05<00:00, 74.31it/s]
50000 images processed, 5.3633105754852295 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:27,  2.81it/s] 14%|█▍        | 11/79 [00:00<00:02, 29.66it/s] 27%|██▋       | 21/79 [00:00<00:01, 48.31it/s] 38%|███▊      | 30/79 [00:00<00:00, 59.07it/s] 49%|████▉     | 39/79 [00:00<00:00, 67.86it/s] 61%|██████    | 48/79 [00:00<00:00, 59.66it/s] 71%|███████   | 56/79 [00:01<00:00, 57.87it/s] 82%|████████▏ | 65/79 [00:01<00:00, 65.14it/s] 95%|█████████▍| 75/79 [00:01<00:00, 73.29it/s]100%|██████████| 79/79 [00:01<00:00, 57.66it/s]
10000 images processed, 1.4113774299621582 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:08,  2.98it/s]  3%|▎         | 7/204 [00:00<00:10, 19.16it/s]  8%|▊         | 17/204 [00:00<00:04, 41.28it/s] 12%|█▏        | 25/204 [00:00<00:03, 51.97it/s] 17%|█▋        | 34/204 [00:00<00:02, 62.08it/s] 21%|██        | 43/204 [00:00<00:02, 69.32it/s] 25%|██▌       | 51/204 [00:00<00:02, 71.87it/s] 29%|██▉       | 59/204 [00:01<00:02, 67.86it/s] 33%|███▎      | 67/204 [00:01<00:02, 58.12it/s] 37%|███▋      | 75/204 [00:01<00:02, 63.04it/s] 41%|████      | 84/204 [00:01<00:01, 69.29it/s] 46%|████▌     | 93/204 [00:01<00:01, 72.95it/s] 50%|█████     | 103/204 [00:01<00:01, 78.02it/s] 55%|█████▍    | 112/204 [00:01<00:01, 79.07it/s] 59%|█████▉    | 121/204 [00:02<00:01, 64.24it/s] 63%|██████▎   | 128/204 [00:02<00:01, 62.08it/s] 67%|██████▋   | 137/204 [00:02<00:00, 67.35it/s] 72%|███████▏  | 146/204 [00:02<00:00, 71.65it/s] 76%|███████▋  | 156/204 [00:02<00:00, 77.00it/s] 80%|████████  | 164/204 [00:02<00:00, 73.26it/s] 84%|████████▍ | 172/204 [00:02<00:00, 60.90it/s] 88%|████████▊ | 180/204 [00:02<00:00, 65.07it/s] 93%|█████████▎| 190/204 [00:02<00:00, 72.34it/s] 98%|█████████▊| 200/204 [00:03<00:00, 78.62it/s]100%|██████████| 204/204 [00:03<00:00, 64.81it/s]
26032 images processed, 3.189049243927002 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:40,  1.91it/s]  8%|▊         | 6/79 [00:00<00:06, 11.91it/s] 18%|█▊        | 14/79 [00:00<00:02, 27.05it/s] 24%|██▍       | 19/79 [00:00<00:02, 27.36it/s] 30%|███       | 24/79 [00:01<00:01, 32.01it/s] 39%|███▉      | 31/79 [00:01<00:01, 40.43it/s] 47%|████▋     | 37/79 [00:01<00:00, 44.97it/s] 54%|█████▍    | 43/79 [00:01<00:00, 43.32it/s] 61%|██████    | 48/79 [00:01<00:00, 43.87it/s] 71%|███████   | 56/79 [00:01<00:00, 51.85it/s] 78%|███████▊  | 62/79 [00:01<00:00, 45.84it/s] 85%|████████▍ | 67/79 [00:01<00:00, 46.10it/s] 91%|█████████ | 72/79 [00:01<00:00, 46.99it/s]100%|██████████| 79/79 [00:02<00:00, 38.49it/s]
10000 images processed, 2.095188856124878 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:33,  2.36it/s]  8%|▊         | 6/79 [00:00<00:05, 14.21it/s] 19%|█▉        | 15/79 [00:00<00:01, 33.48it/s] 30%|███       | 24/79 [00:00<00:01, 47.55it/s] 42%|████▏     | 33/79 [00:00<00:00, 57.99it/s] 52%|█████▏    | 41/79 [00:01<00:00, 55.53it/s] 61%|██████    | 48/79 [00:01<00:00, 51.42it/s] 73%|███████▎  | 58/79 [00:01<00:00, 61.59it/s] 85%|████████▍ | 67/79 [00:01<00:00, 68.46it/s] 97%|█████████▋| 77/79 [00:01<00:00, 75.76it/s]100%|██████████| 79/79 [00:01<00:00, 52.77it/s]
10000 images processed, 1.5163967609405518 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:25,  2.75it/s] 11%|█▏        | 8/70 [00:00<00:02, 21.51it/s] 19%|█▊        | 13/70 [00:00<00:02, 28.06it/s] 27%|██▋       | 19/70 [00:00<00:01, 35.70it/s] 37%|███▋      | 26/70 [00:00<00:00, 44.20it/s] 50%|█████     | 35/70 [00:00<00:00, 56.62it/s] 64%|██████▍   | 45/70 [00:01<00:00, 67.10it/s] 77%|███████▋  | 54/70 [00:01<00:00, 72.56it/s] 91%|█████████▏| 64/70 [00:01<00:00, 79.49it/s]100%|██████████| 70/70 [00:01<00:00, 52.43it/s]
8925 images processed, 1.3643741607666016 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:00<00:36,  1.22it/s]  4%|▍         | 2/45 [00:01<00:20,  2.05it/s] 18%|█▊        | 8/45 [00:01<00:03, 10.55it/s] 24%|██▍       | 11/45 [00:01<00:03,  8.52it/s] 38%|███▊      | 17/45 [00:01<00:02, 13.65it/s] 44%|████▍     | 20/45 [00:02<00:02, 12.06it/s] 56%|█████▌    | 25/45 [00:02<00:01, 15.00it/s] 62%|██████▏   | 28/45 [00:02<00:01, 12.94it/s] 71%|███████   | 32/45 [00:02<00:00, 16.38it/s] 78%|███████▊  | 35/45 [00:03<00:00, 10.03it/s] 89%|████████▉ | 40/45 [00:03<00:00, 14.17it/s] 96%|█████████▌| 43/45 [00:04<00:00,  9.28it/s]100%|██████████| 45/45 [00:04<00:00, 10.58it/s]
5640 images processed, 4.280499219894409 seconds used

20.90840196609497
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.53  99.36
places365     67.87  81.18
LSUN          17.60  96.07
iSUN          72.36  81.68
dtd           37.87  91.39
AVG           39.65  89.93
Retain-Acc: 0.7406
Forget-as-OOD (retain known vs forget novel):
  FPR: 79.50 AUROC: 86.90 AUIN: 98.36
20.440917015075684
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e10-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid
epochs=10 | cache=6 | flambda=1.0 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e10-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e10-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e10-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21610432
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<02:00,  3.23it/s]  2%|▏         | 6/391 [00:00<00:22, 17.32it/s]  3%|▎         | 11/391 [00:00<00:14, 26.58it/s]  5%|▍         | 18/391 [00:00<00:09, 37.98it/s]  7%|▋         | 28/391 [00:00<00:06, 54.32it/s] 10%|▉         | 38/391 [00:00<00:05, 66.50it/s] 12%|█▏        | 47/391 [00:00<00:04, 69.66it/s] 14%|█▍        | 55/391 [00:01<00:05, 60.85it/s] 16%|█▌        | 62/391 [00:01<00:05, 59.51it/s] 18%|█▊        | 71/391 [00:01<00:04, 66.85it/s] 21%|██        | 81/391 [00:01<00:04, 74.15it/s] 23%|██▎       | 90/391 [00:01<00:03, 77.67it/s] 25%|██▌       | 99/391 [00:01<00:04, 68.96it/s] 27%|██▋       | 107/391 [00:01<00:04, 59.72it/s] 30%|██▉       | 116/391 [00:02<00:04, 65.65it/s] 32%|███▏      | 126/391 [00:02<00:03, 72.19it/s] 35%|███▍      | 135/391 [00:02<00:03, 75.21it/s] 37%|███▋      | 143/391 [00:02<00:03, 68.82it/s] 39%|███▊      | 151/391 [00:02<00:03, 60.53it/s] 41%|████      | 159/391 [00:02<00:03, 63.99it/s] 43%|████▎     | 168/391 [00:02<00:03, 69.91it/s] 46%|████▌     | 178/391 [00:02<00:02, 75.60it/s] 48%|████▊     | 186/391 [00:03<00:02, 70.95it/s] 50%|████▉     | 194/391 [00:03<00:03, 62.70it/s] 51%|█████▏    | 201/391 [00:03<00:03, 54.96it/s] 53%|█████▎    | 207/391 [00:03<00:03, 52.46it/s] 54%|█████▍    | 213/391 [00:03<00:03, 50.53it/s] 56%|█████▌    | 219/391 [00:03<00:03, 51.24it/s] 58%|█████▊    | 225/391 [00:03<00:03, 50.37it/s] 59%|█████▉    | 231/391 [00:03<00:03, 49.51it/s] 60%|██████    | 236/391 [00:04<00:03, 49.32it/s] 62%|██████▏   | 241/391 [00:04<00:03, 48.53it/s] 63%|██████▎   | 247/391 [00:04<00:02, 49.08it/s] 64%|██████▍   | 252/391 [00:04<00:02, 48.95it/s] 66%|██████▌   | 257/391 [00:04<00:03, 43.57it/s] 67%|██████▋   | 262/391 [00:04<00:03, 39.60it/s] 68%|██████▊   | 267/391 [00:04<00:03, 37.30it/s] 70%|██████▉   | 272/391 [00:04<00:03, 39.41it/s] 71%|███████   | 277/391 [00:05<00:02, 41.74it/s] 72%|███████▏  | 282/391 [00:05<00:02, 43.04it/s] 73%|███████▎  | 287/391 [00:05<00:02, 44.81it/s] 75%|███████▍  | 292/391 [00:05<00:02, 45.18it/s] 76%|███████▌  | 297/391 [00:05<00:02, 46.05it/s] 77%|███████▋  | 302/391 [00:05<00:01, 46.68it/s] 79%|███████▊  | 307/391 [00:05<00:01, 47.14it/s] 80%|███████▉  | 312/391 [00:05<00:01, 47.52it/s] 81%|████████  | 317/391 [00:05<00:01, 47.68it/s] 82%|████████▏ | 322/391 [00:06<00:01, 46.39it/s] 84%|████████▎ | 327/391 [00:06<00:01, 40.84it/s] 85%|████████▍ | 332/391 [00:06<00:01, 37.44it/s] 86%|████████▌ | 336/391 [00:06<00:01, 35.88it/s] 87%|████████▋ | 342/391 [00:06<00:01, 39.88it/s] 89%|████████▊ | 347/391 [00:06<00:01, 42.12it/s] 90%|█████████ | 352/391 [00:06<00:00, 43.85it/s] 91%|█████████▏| 357/391 [00:06<00:00, 45.07it/s] 93%|█████████▎| 363/391 [00:07<00:00, 46.58it/s] 94%|█████████▍| 368/391 [00:07<00:00, 47.22it/s] 95%|█████████▌| 373/391 [00:07<00:00, 47.64it/s] 97%|█████████▋| 378/391 [00:07<00:00, 48.00it/s] 98%|█████████▊| 383/391 [00:07<00:00, 48.22it/s] 99%|█████████▉| 388/391 [00:07<00:00, 48.37it/s]100%|██████████| 391/391 [00:07<00:00, 51.48it/s]
50000 images processed, 7.709104299545288 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:23,  3.29it/s]  8%|▊         | 6/79 [00:00<00:04, 17.88it/s] 14%|█▍        | 11/79 [00:00<00:02, 27.61it/s] 20%|██        | 16/79 [00:00<00:01, 34.18it/s] 27%|██▋       | 21/79 [00:00<00:01, 38.67it/s] 33%|███▎      | 26/79 [00:00<00:01, 41.93it/s] 39%|███▉      | 31/79 [00:00<00:01, 43.76it/s] 46%|████▌     | 36/79 [00:01<00:00, 44.76it/s] 52%|█████▏    | 41/79 [00:01<00:00, 45.67it/s] 58%|█████▊    | 46/79 [00:01<00:00, 46.55it/s] 65%|██████▍   | 51/79 [00:01<00:00, 42.84it/s] 71%|███████   | 56/79 [00:01<00:00, 38.80it/s] 77%|███████▋  | 61/79 [00:01<00:00, 36.89it/s] 82%|████████▏ | 65/79 [00:01<00:00, 37.15it/s] 89%|████████▊ | 70/79 [00:01<00:00, 40.15it/s] 95%|█████████▍| 75/79 [00:01<00:00, 42.45it/s]100%|██████████| 79/79 [00:02<00:00, 38.09it/s]
10000 images processed, 2.1125295162200928 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:18,  2.60it/s]  3%|▎         | 6/204 [00:00<00:13, 14.77it/s]  5%|▌         | 11/204 [00:00<00:08, 22.90it/s]  8%|▊         | 16/204 [00:00<00:06, 29.00it/s] 11%|█         | 22/204 [00:00<00:05, 36.03it/s] 13%|█▎        | 27/204 [00:00<00:04, 37.59it/s] 16%|█▌        | 32/204 [00:01<00:04, 39.99it/s] 20%|██        | 41/204 [00:01<00:03, 52.53it/s] 24%|██▎       | 48/204 [00:01<00:02, 55.82it/s] 26%|██▋       | 54/204 [00:01<00:02, 51.79it/s] 29%|██▉       | 60/204 [00:01<00:02, 50.60it/s] 32%|███▏      | 66/204 [00:01<00:02, 47.13it/s] 35%|███▍      | 71/204 [00:01<00:03, 40.76it/s] 37%|███▋      | 76/204 [00:02<00:03, 36.69it/s] 39%|███▉      | 80/204 [00:02<00:03, 34.81it/s] 42%|████▏     | 85/204 [00:02<00:03, 37.56it/s] 44%|████▍     | 90/204 [00:02<00:02, 38.32it/s] 47%|████▋     | 95/204 [00:02<00:02, 39.52it/s] 49%|████▉     | 100/204 [00:02<00:02, 41.70it/s] 51%|█████▏    | 105/204 [00:02<00:02, 42.48it/s] 54%|█████▍    | 110/204 [00:02<00:02, 40.47it/s] 58%|█████▊    | 118/204 [00:02<00:01, 49.26it/s] 61%|██████    | 124/204 [00:03<00:01, 47.03it/s] 63%|██████▎   | 129/204 [00:03<00:01, 44.94it/s] 67%|██████▋   | 137/204 [00:03<00:01, 52.86it/s] 72%|███████▏  | 146/204 [00:03<00:00, 60.71it/s] 75%|███████▌  | 153/204 [00:03<00:00, 56.04it/s] 78%|███████▊  | 159/204 [00:03<00:00, 53.84it/s] 81%|████████  | 165/204 [00:03<00:00, 54.45it/s] 84%|████████▍ | 171/204 [00:03<00:00, 54.15it/s] 87%|████████▋ | 177/204 [00:04<00:00, 45.02it/s] 89%|████████▉ | 182/204 [00:04<00:00, 40.28it/s] 92%|█████████▏| 187/204 [00:04<00:00, 39.05it/s] 95%|█████████▍| 193/204 [00:04<00:00, 42.44it/s] 97%|█████████▋| 198/204 [00:04<00:00, 43.92it/s]100%|██████████| 204/204 [00:04<00:00, 46.37it/s]100%|██████████| 204/204 [00:04<00:00, 42.52it/s]
26032 images processed, 4.8502631187438965 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:40,  1.93it/s]  5%|▌         | 4/79 [00:00<00:09,  7.94it/s]  9%|▉         | 7/79 [00:00<00:05, 12.84it/s] 15%|█▌        | 12/79 [00:00<00:03, 21.22it/s] 22%|██▏       | 17/79 [00:00<00:02, 28.10it/s] 28%|██▊       | 22/79 [00:01<00:01, 33.05it/s] 35%|███▌      | 28/79 [00:01<00:01, 38.34it/s] 42%|████▏     | 33/79 [00:01<00:01, 41.32it/s] 48%|████▊     | 38/79 [00:01<00:00, 43.02it/s] 54%|█████▍    | 43/79 [00:01<00:00, 37.93it/s] 61%|██████    | 48/79 [00:01<00:00, 34.63it/s] 66%|██████▌   | 52/79 [00:01<00:00, 33.46it/s] 71%|███████   | 56/79 [00:01<00:00, 33.86it/s] 77%|███████▋  | 61/79 [00:02<00:00, 36.89it/s] 84%|████████▎ | 66/79 [00:02<00:00, 38.56it/s] 91%|█████████ | 72/79 [00:02<00:00, 43.10it/s]100%|██████████| 79/79 [00:02<00:00, 33.27it/s]
10000 images processed, 2.413982391357422 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:43,  1.77it/s]  9%|▉         | 7/79 [00:00<00:05, 13.28it/s] 19%|█▉        | 15/79 [00:00<00:02, 27.36it/s] 29%|██▉       | 23/79 [00:00<00:01, 37.77it/s] 37%|███▋      | 29/79 [00:01<00:01, 38.59it/s] 44%|████▍     | 35/79 [00:01<00:01, 38.78it/s] 51%|█████     | 40/79 [00:01<00:00, 39.42it/s] 57%|█████▋    | 45/79 [00:01<00:00, 41.41it/s] 63%|██████▎   | 50/79 [00:01<00:00, 42.30it/s] 71%|███████   | 56/79 [00:01<00:00, 44.93it/s] 77%|███████▋  | 61/79 [00:01<00:00, 43.81it/s] 84%|████████▎ | 66/79 [00:01<00:00, 38.12it/s] 90%|████████▉ | 71/79 [00:02<00:00, 35.99it/s] 96%|█████████▌| 76/79 [00:02<00:00, 37.63it/s]100%|██████████| 79/79 [00:02<00:00, 34.55it/s]
10000 images processed, 2.325873374938965 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:24,  2.78it/s] 13%|█▎        | 9/70 [00:00<00:02, 24.15it/s] 23%|██▎       | 16/70 [00:00<00:01, 35.93it/s] 31%|███▏      | 22/70 [00:00<00:01, 37.33it/s] 40%|████      | 28/70 [00:00<00:00, 42.71it/s] 50%|█████     | 35/70 [00:00<00:00, 49.89it/s] 60%|██████    | 42/70 [00:01<00:00, 52.83it/s] 69%|██████▊   | 48/70 [00:01<00:00, 41.55it/s] 76%|███████▌  | 53/70 [00:01<00:00, 38.02it/s] 83%|████████▎ | 58/70 [00:01<00:00, 40.24it/s] 91%|█████████▏| 64/70 [00:01<00:00, 44.51it/s] 99%|█████████▊| 69/70 [00:01<00:00, 45.46it/s]100%|██████████| 70/70 [00:01<00:00, 39.61it/s]
8925 images processed, 1.8108735084533691 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:01<00:46,  1.05s/it]  7%|▋         | 3/45 [00:01<00:13,  3.22it/s] 16%|█▌        | 7/45 [00:01<00:05,  7.53it/s] 20%|██        | 9/45 [00:01<00:04,  7.26it/s] 27%|██▋       | 12/45 [00:01<00:03, 10.07it/s] 36%|███▌      | 16/45 [00:01<00:02, 12.98it/s] 40%|████      | 18/45 [00:02<00:02,  9.38it/s] 49%|████▉     | 22/45 [00:02<00:01, 13.04it/s] 53%|█████▎    | 24/45 [00:02<00:01, 12.94it/s] 58%|█████▊    | 26/45 [00:02<00:01, 10.43it/s] 67%|██████▋   | 30/45 [00:03<00:01, 12.99it/s] 71%|███████   | 32/45 [00:03<00:00, 13.71it/s] 76%|███████▌  | 34/45 [00:03<00:01,  8.05it/s] 89%|████████▉ | 40/45 [00:04<00:00, 13.45it/s] 93%|█████████▎| 42/45 [00:04<00:00, 10.70it/s]100%|██████████| 45/45 [00:04<00:00, 10.25it/s]
5640 images processed, 4.411128759384155 seconds used

27.686011791229248
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.53  99.36
places365     67.87  81.18
LSUN          17.60  96.07
iSUN          72.36  81.68
dtd           37.87  91.39
AVG           39.65  89.93
Retain-Acc: 0.7406
Forget-as-OOD (retain known vs forget novel):
  FPR: 79.50 AUROC: 86.90 AUIN: 98.36
35.863953590393066
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e20-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid
epochs=20 | cache=6 | flambda=1.0 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e20-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e20-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e20-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21610432
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<02:45,  2.35it/s]  3%|▎         | 11/391 [00:00<00:14, 26.42it/s]  5%|▌         | 21/391 [00:00<00:08, 44.59it/s]  8%|▊         | 31/391 [00:00<00:06, 58.52it/s] 10%|█         | 40/391 [00:00<00:05, 66.62it/s] 13%|█▎        | 50/391 [00:00<00:04, 74.93it/s] 15%|█▌        | 60/391 [00:01<00:04, 79.90it/s] 18%|█▊        | 69/391 [00:01<00:03, 82.61it/s] 20%|██        | 79/391 [00:01<00:03, 85.15it/s] 23%|██▎       | 88/391 [00:01<00:03, 86.28it/s] 25%|██▍       | 97/391 [00:01<00:03, 86.47it/s] 27%|██▋       | 107/391 [00:01<00:03, 88.79it/s] 30%|██▉       | 117/391 [00:01<00:03, 90.04it/s] 32%|███▏      | 127/391 [00:01<00:02, 91.69it/s] 35%|███▌      | 137/391 [00:01<00:02, 91.74it/s] 38%|███▊      | 147/391 [00:02<00:02, 91.92it/s] 40%|████      | 157/391 [00:02<00:02, 91.05it/s] 43%|████▎     | 167/391 [00:02<00:02, 90.08it/s] 45%|████▌     | 177/391 [00:02<00:02, 89.53it/s] 48%|████▊     | 186/391 [00:02<00:02, 89.33it/s] 50%|█████     | 196/391 [00:02<00:02, 90.14it/s] 53%|█████▎    | 206/391 [00:02<00:02, 89.74it/s] 55%|█████▍    | 215/391 [00:02<00:01, 89.57it/s] 58%|█████▊    | 225/391 [00:02<00:01, 90.88it/s] 60%|██████    | 235/391 [00:02<00:01, 91.57it/s] 63%|██████▎   | 245/391 [00:03<00:01, 92.46it/s] 65%|██████▌   | 255/391 [00:03<00:01, 89.88it/s] 68%|██████▊   | 265/391 [00:03<00:01, 88.99it/s] 70%|███████   | 275/391 [00:03<00:01, 90.70it/s] 73%|███████▎  | 285/391 [00:03<00:01, 91.13it/s] 75%|███████▌  | 295/391 [00:03<00:01, 90.30it/s] 78%|███████▊  | 305/391 [00:03<00:00, 91.03it/s] 81%|████████  | 315/391 [00:03<00:00, 89.97it/s] 83%|████████▎ | 325/391 [00:03<00:00, 91.16it/s] 86%|████████▌ | 335/391 [00:04<00:00, 91.46it/s] 88%|████████▊ | 345/391 [00:04<00:00, 92.16it/s] 91%|█████████ | 355/391 [00:04<00:00, 92.99it/s] 93%|█████████▎| 365/391 [00:04<00:00, 93.53it/s] 96%|█████████▌| 375/391 [00:04<00:00, 92.01it/s] 98%|█████████▊| 385/391 [00:04<00:00, 93.38it/s]100%|██████████| 391/391 [00:04<00:00, 83.27it/s]
50000 images processed, 4.7671332359313965 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:25,  3.05it/s] 14%|█▍        | 11/79 [00:00<00:02, 31.48it/s] 25%|██▌       | 20/79 [00:00<00:01, 48.77it/s] 38%|███▊      | 30/79 [00:00<00:00, 62.94it/s] 49%|████▉     | 39/79 [00:00<00:00, 69.15it/s] 62%|██████▏   | 49/79 [00:00<00:00, 75.78it/s] 75%|███████▍  | 59/79 [00:00<00:00, 80.91it/s] 87%|████████▋ | 69/79 [00:01<00:00, 84.05it/s]100%|██████████| 79/79 [00:01<00:00, 86.53it/s]100%|██████████| 79/79 [00:01<00:00, 66.41it/s]
10000 images processed, 1.210148811340332 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:09,  2.91it/s]  5%|▍         | 10/204 [00:00<00:06, 28.11it/s] 10%|▉         | 20/204 [00:00<00:03, 48.00it/s] 14%|█▍        | 29/204 [00:00<00:02, 59.40it/s] 19%|█▊        | 38/204 [00:00<00:02, 67.81it/s] 23%|██▎       | 47/204 [00:00<00:02, 74.10it/s] 28%|██▊       | 57/204 [00:00<00:01, 79.95it/s] 33%|███▎      | 67/204 [00:01<00:01, 84.10it/s] 38%|███▊      | 77/204 [00:01<00:01, 86.34it/s] 43%|████▎     | 87/204 [00:01<00:01, 87.22it/s] 48%|████▊     | 97/204 [00:01<00:01, 88.21it/s] 52%|█████▏    | 106/204 [00:01<00:01, 88.54it/s] 57%|█████▋    | 116/204 [00:01<00:00, 89.90it/s] 62%|██████▏   | 126/204 [00:01<00:00, 91.06it/s] 67%|██████▋   | 136/204 [00:01<00:00, 90.21it/s] 72%|███████▏  | 146/204 [00:01<00:00, 89.69it/s] 76%|███████▌  | 155/204 [00:02<00:00, 89.73it/s] 81%|████████  | 165/204 [00:02<00:00, 90.66it/s] 86%|████████▌ | 175/204 [00:02<00:00, 89.37it/s] 91%|█████████ | 185/204 [00:02<00:00, 90.50it/s] 96%|█████████▌| 195/204 [00:02<00:00, 92.43it/s]100%|██████████| 204/204 [00:02<00:00, 79.03it/s]
26032 images processed, 2.6221706867218018 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:36,  2.15it/s] 11%|█▏        | 9/79 [00:00<00:04, 17.21it/s] 22%|██▏       | 17/79 [00:00<00:02, 26.85it/s] 32%|███▏      | 25/79 [00:00<00:01, 32.80it/s] 42%|████▏     | 33/79 [00:01<00:01, 39.03it/s] 52%|█████▏    | 41/79 [00:01<00:00, 42.35it/s] 61%|██████    | 48/79 [00:01<00:00, 46.81it/s] 68%|██████▊   | 54/79 [00:01<00:00, 42.93it/s] 75%|███████▍  | 59/79 [00:01<00:00, 43.28it/s] 84%|████████▎ | 66/79 [00:01<00:00, 49.41it/s] 92%|█████████▏| 73/79 [00:01<00:00, 49.86it/s]100%|██████████| 79/79 [00:02<00:00, 49.61it/s]100%|██████████| 79/79 [00:02<00:00, 38.41it/s]
10000 images processed, 2.091616153717041 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:37,  2.06it/s] 14%|█▍        | 11/79 [00:00<00:02, 23.76it/s] 27%|██▋       | 21/79 [00:00<00:01, 41.14it/s] 37%|███▋      | 29/79 [00:00<00:00, 50.25it/s] 48%|████▊     | 38/79 [00:00<00:00, 60.14it/s] 59%|█████▉    | 47/79 [00:01<00:00, 67.46it/s] 71%|███████   | 56/79 [00:01<00:00, 73.40it/s] 84%|████████▎ | 66/79 [00:01<00:00, 79.22it/s] 96%|█████████▌| 76/79 [00:01<00:00, 84.51it/s]100%|██████████| 79/79 [00:01<00:00, 58.35it/s]
10000 images processed, 1.3765289783477783 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:24,  2.78it/s] 11%|█▏        | 8/70 [00:00<00:02, 21.46it/s] 26%|██▌       | 18/70 [00:00<00:01, 42.87it/s] 40%|████      | 28/70 [00:00<00:00, 57.70it/s] 53%|█████▎    | 37/70 [00:00<00:00, 66.85it/s] 66%|██████▌   | 46/70 [00:00<00:00, 73.06it/s] 79%|███████▊  | 55/70 [00:00<00:00, 75.44it/s] 93%|█████████▎| 65/70 [00:01<00:00, 81.39it/s]100%|██████████| 70/70 [00:01<00:00, 60.50it/s]
8925 images processed, 1.192380666732788 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:01<00:44,  1.00s/it] 20%|██        | 9/45 [00:01<00:05,  7.13it/s] 31%|███       | 14/45 [00:01<00:02, 10.81it/s] 38%|███▊      | 17/45 [00:02<00:03,  8.94it/s] 49%|████▉     | 22/45 [00:02<00:01, 13.07it/s] 56%|█████▌    | 25/45 [00:02<00:01, 10.23it/s] 67%|██████▋   | 30/45 [00:02<00:01, 14.01it/s] 73%|███████▎  | 33/45 [00:03<00:01, 10.08it/s] 91%|█████████ | 41/45 [00:03<00:00, 12.91it/s] 96%|█████████▌| 43/45 [00:04<00:00, 11.73it/s]100%|██████████| 45/45 [00:04<00:00, 10.74it/s]
5640 images processed, 4.211486577987671 seconds used

19.178243160247803
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.53  99.36
places365     67.87  81.18
LSUN          17.60  96.07
iSUN          72.36  81.68
dtd           37.87  91.39
AVG           39.65  89.93
Retain-Acc: 0.7406
Forget-as-OOD (retain known vs forget novel):
  FPR: 79.50 AUROC: 86.90 AUIN: 98.36
26.775789976119995
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e50-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid
epochs=50 | cache=6 | flambda=1.0 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e50-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e50-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e50-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl1.0-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21610432
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<02:46,  2.34it/s]  3%|▎         | 10/391 [00:00<00:16, 23.68it/s]  5%|▌         | 20/391 [00:00<00:08, 42.34it/s]  8%|▊         | 30/391 [00:00<00:06, 56.23it/s] 10%|█         | 40/391 [00:00<00:05, 66.37it/s] 13%|█▎        | 50/391 [00:00<00:04, 74.73it/s] 15%|█▌        | 60/391 [00:01<00:04, 80.55it/s] 18%|█▊        | 70/391 [00:01<00:03, 83.55it/s] 20%|██        | 80/391 [00:01<00:03, 85.70it/s] 23%|██▎       | 90/391 [00:01<00:03, 88.32it/s] 26%|██▌       | 100/391 [00:01<00:03, 90.09it/s] 28%|██▊       | 110/391 [00:01<00:03, 90.70it/s] 31%|███       | 120/391 [00:01<00:02, 90.96it/s] 33%|███▎      | 130/391 [00:01<00:02, 92.12it/s] 36%|███▌      | 140/391 [00:01<00:02, 90.02it/s] 38%|███▊      | 150/391 [00:02<00:02, 90.56it/s] 41%|████      | 160/391 [00:02<00:02, 88.32it/s] 43%|████▎     | 169/391 [00:02<00:02, 88.00it/s] 46%|████▌     | 178/391 [00:02<00:02, 88.42it/s] 48%|████▊     | 187/391 [00:02<00:02, 88.51it/s] 50%|█████     | 196/391 [00:02<00:02, 88.33it/s] 53%|█████▎    | 206/391 [00:02<00:02, 89.71it/s] 55%|█████▌    | 216/391 [00:02<00:01, 90.75it/s] 58%|█████▊    | 226/391 [00:02<00:01, 91.21it/s] 60%|██████    | 236/391 [00:03<00:01, 92.47it/s] 63%|██████▎   | 246/391 [00:03<00:01, 90.43it/s] 65%|██████▌   | 256/391 [00:03<00:01, 90.21it/s] 68%|██████▊   | 266/391 [00:03<00:01, 91.00it/s] 71%|███████   | 276/391 [00:03<00:01, 92.20it/s] 73%|███████▎  | 286/391 [00:03<00:01, 92.60it/s] 76%|███████▌  | 296/391 [00:03<00:01, 92.96it/s] 78%|███████▊  | 306/391 [00:03<00:00, 88.27it/s] 81%|████████  | 315/391 [00:03<00:00, 86.76it/s] 83%|████████▎ | 324/391 [00:04<00:00, 87.35it/s] 85%|████████▌ | 334/391 [00:04<00:00, 89.79it/s] 88%|████████▊ | 344/391 [00:04<00:00, 91.33it/s] 91%|█████████ | 354/391 [00:04<00:00, 92.59it/s] 93%|█████████▎| 364/391 [00:04<00:00, 89.09it/s] 95%|█████████▌| 373/391 [00:04<00:00, 88.45it/s] 98%|█████████▊| 383/391 [00:04<00:00, 89.55it/s]100%|██████████| 391/391 [00:04<00:00, 82.46it/s]
50000 images processed, 4.822489976882935 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:25,  3.07it/s] 14%|█▍        | 11/79 [00:00<00:02, 32.22it/s] 27%|██▋       | 21/79 [00:00<00:01, 51.28it/s] 39%|███▉      | 31/79 [00:00<00:00, 64.40it/s] 51%|█████     | 40/79 [00:00<00:00, 70.37it/s] 62%|██████▏   | 49/79 [00:00<00:00, 73.46it/s] 75%|███████▍  | 59/79 [00:00<00:00, 79.26it/s] 87%|████████▋ | 69/79 [00:01<00:00, 83.77it/s]100%|██████████| 79/79 [00:01<00:00, 86.23it/s]100%|██████████| 79/79 [00:01<00:00, 66.52it/s]
10000 images processed, 1.225942611694336 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:18,  2.58it/s]  5%|▌         | 11/204 [00:00<00:06, 28.18it/s] 10%|▉         | 20/204 [00:00<00:04, 44.26it/s] 15%|█▍        | 30/204 [00:00<00:03, 57.72it/s] 20%|█▉        | 40/204 [00:00<00:02, 68.10it/s] 24%|██▍       | 49/204 [00:00<00:02, 72.61it/s] 28%|██▊       | 58/204 [00:01<00:01, 77.01it/s] 33%|███▎      | 67/204 [00:01<00:01, 80.14it/s] 38%|███▊      | 77/204 [00:01<00:01, 83.57it/s] 43%|████▎     | 87/204 [00:01<00:01, 85.79it/s] 47%|████▋     | 96/204 [00:01<00:01, 86.86it/s] 52%|█████▏    | 106/204 [00:01<00:01, 89.38it/s] 57%|█████▋    | 116/204 [00:01<00:00, 90.44it/s] 62%|██████▏   | 126/204 [00:01<00:00, 90.43it/s] 67%|██████▋   | 136/204 [00:01<00:00, 91.42it/s] 72%|███████▏  | 146/204 [00:01<00:00, 90.48it/s] 76%|███████▋  | 156/204 [00:02<00:00, 91.00it/s] 81%|████████▏ | 166/204 [00:02<00:00, 89.08it/s] 86%|████████▋ | 176/204 [00:02<00:00, 89.59it/s] 91%|█████████ | 185/204 [00:02<00:00, 89.49it/s] 95%|█████████▌| 194/204 [00:02<00:00, 89.14it/s]100%|██████████| 204/204 [00:02<00:00, 90.37it/s]100%|██████████| 204/204 [00:02<00:00, 77.14it/s]
26032 images processed, 2.6890511512756348 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:39,  1.96it/s]  9%|▉         | 7/79 [00:00<00:04, 14.53it/s] 15%|█▌        | 12/79 [00:00<00:02, 22.60it/s] 23%|██▎       | 18/79 [00:00<00:02, 28.56it/s] 33%|███▎      | 26/79 [00:01<00:01, 35.84it/s] 43%|████▎     | 34/79 [00:01<00:01, 41.48it/s] 53%|█████▎    | 42/79 [00:01<00:00, 43.84it/s] 62%|██████▏   | 49/79 [00:01<00:00, 48.95it/s] 70%|██████▉   | 55/79 [00:01<00:00, 47.33it/s] 77%|███████▋  | 61/79 [00:01<00:00, 44.97it/s] 86%|████████▌ | 68/79 [00:01<00:00, 46.35it/s] 95%|█████████▍| 75/79 [00:01<00:00, 50.78it/s]100%|██████████| 79/79 [00:02<00:00, 38.38it/s]
10000 images processed, 2.0944042205810547 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:32,  2.37it/s] 13%|█▎        | 10/79 [00:00<00:02, 24.28it/s] 24%|██▍       | 19/79 [00:00<00:01, 40.97it/s] 35%|███▌      | 28/79 [00:00<00:00, 54.08it/s] 47%|████▋     | 37/79 [00:00<00:00, 63.97it/s] 59%|█████▉    | 47/79 [00:00<00:00, 72.83it/s] 72%|███████▏  | 57/79 [00:01<00:00, 79.02it/s] 85%|████████▍ | 67/79 [00:01<00:00, 83.42it/s] 97%|█████████▋| 77/79 [00:01<00:00, 86.86it/s]100%|██████████| 79/79 [00:01<00:00, 62.11it/s]
10000 images processed, 1.2901268005371094 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:25,  2.66it/s] 16%|█▌        | 11/70 [00:00<00:02, 28.69it/s] 29%|██▊       | 20/70 [00:00<00:01, 45.65it/s] 41%|████▏     | 29/70 [00:00<00:00, 57.57it/s] 54%|█████▍    | 38/70 [00:00<00:00, 65.54it/s] 67%|██████▋   | 47/70 [00:00<00:00, 71.92it/s] 80%|████████  | 56/70 [00:01<00:00, 76.65it/s] 94%|█████████▍| 66/70 [00:01<00:00, 82.14it/s]100%|██████████| 70/70 [00:01<00:00, 60.73it/s]
8925 images processed, 1.1832849979400635 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:00<00:41,  1.05it/s]  7%|▋         | 3/45 [00:01<00:11,  3.51it/s] 16%|█▌        | 7/45 [00:01<00:04,  8.63it/s] 20%|██        | 9/45 [00:01<00:03,  9.09it/s] 24%|██▍       | 11/45 [00:01<00:03,  9.47it/s] 31%|███       | 14/45 [00:01<00:02, 11.02it/s] 38%|███▊      | 17/45 [00:01<00:02, 12.24it/s] 42%|████▏     | 19/45 [00:02<00:02, 12.79it/s] 49%|████▉     | 22/45 [00:02<00:01, 12.38it/s] 56%|█████▌    | 25/45 [00:02<00:01, 13.88it/s] 60%|██████    | 27/45 [00:02<00:01, 14.87it/s] 67%|██████▋   | 30/45 [00:02<00:01, 12.49it/s] 73%|███████▎  | 33/45 [00:03<00:01, 11.65it/s] 82%|████████▏ | 37/45 [00:03<00:00, 15.80it/s] 91%|█████████ | 41/45 [00:03<00:00, 13.11it/s] 96%|█████████▌| 43/45 [00:04<00:00, 10.73it/s]100%|██████████| 45/45 [00:04<00:00, 10.94it/s]
5640 images processed, 4.140878200531006 seconds used

19.12144708633423
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.53  99.36
places365     67.87  81.18
LSUN          17.60  96.07
iSUN          72.36  81.68
dtd           37.87  91.39
AVG           39.65  89.93
Retain-Acc: 0.7406
Forget-as-OOD (retain known vs forget novel):
  FPR: 79.50 AUROC: 86.90 AUIN: 98.36
27.149430513381958
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid
epochs=5 | cache=6 | flambda=0.5 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21610432
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<01:59,  3.26it/s]  2%|▏         | 8/391 [00:00<00:15, 24.08it/s]  5%|▍         | 18/391 [00:00<00:08, 46.03it/s]  7%|▋         | 28/391 [00:00<00:05, 60.72it/s]  9%|▉         | 37/391 [00:00<00:05, 66.31it/s] 12%|█▏        | 45/391 [00:00<00:05, 58.62it/s] 13%|█▎        | 52/391 [00:01<00:05, 60.92it/s] 16%|█▌        | 62/391 [00:01<00:04, 69.60it/s] 18%|█▊        | 71/391 [00:01<00:04, 73.89it/s] 20%|██        | 79/391 [00:01<00:04, 65.61it/s] 23%|██▎       | 90/391 [00:01<00:04, 75.08it/s] 26%|██▌       | 100/391 [00:01<00:03, 80.15it/s] 28%|██▊       | 110/391 [00:01<00:03, 85.35it/s] 31%|███       | 121/391 [00:01<00:02, 90.56it/s] 34%|███▎      | 131/391 [00:01<00:02, 92.37it/s] 36%|███▌      | 141/391 [00:02<00:02, 92.51it/s] 39%|███▊      | 151/391 [00:02<00:02, 92.27it/s] 41%|████      | 161/391 [00:02<00:02, 92.97it/s] 44%|████▎     | 171/391 [00:02<00:02, 92.29it/s] 46%|████▋     | 181/391 [00:02<00:02, 92.66it/s] 49%|████▉     | 191/391 [00:02<00:02, 93.06it/s] 51%|█████▏    | 201/391 [00:02<00:02, 92.34it/s] 54%|█████▍    | 211/391 [00:02<00:01, 91.60it/s] 57%|█████▋    | 221/391 [00:02<00:01, 91.92it/s] 59%|█████▉    | 231/391 [00:03<00:01, 91.48it/s] 62%|██████▏   | 241/391 [00:03<00:01, 90.97it/s] 64%|██████▍   | 251/391 [00:03<00:01, 90.86it/s] 67%|██████▋   | 261/391 [00:03<00:01, 90.93it/s] 69%|██████▉   | 271/391 [00:03<00:01, 92.27it/s] 72%|███████▏  | 281/391 [00:03<00:01, 93.19it/s] 74%|███████▍  | 291/391 [00:03<00:01, 93.98it/s] 77%|███████▋  | 301/391 [00:03<00:00, 95.58it/s] 80%|███████▉  | 311/391 [00:03<00:00, 94.83it/s] 82%|████████▏ | 321/391 [00:03<00:00, 95.92it/s] 85%|████████▍ | 331/391 [00:04<00:00, 96.01it/s] 87%|████████▋ | 341/391 [00:04<00:00, 93.91it/s] 90%|████████▉ | 351/391 [00:04<00:00, 92.06it/s] 92%|█████████▏| 361/391 [00:04<00:00, 92.60it/s] 95%|█████████▌| 372/391 [00:04<00:00, 95.93it/s] 98%|█████████▊| 383/391 [00:04<00:00, 97.74it/s]100%|██████████| 391/391 [00:04<00:00, 83.35it/s]
50000 images processed, 4.79325532913208 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:20,  3.82it/s] 14%|█▍        | 11/79 [00:00<00:01, 36.67it/s] 27%|██▋       | 21/79 [00:00<00:01, 55.69it/s] 38%|███▊      | 30/79 [00:00<00:00, 65.54it/s] 49%|████▉     | 39/79 [00:00<00:00, 72.94it/s] 61%|██████    | 48/79 [00:00<00:00, 76.75it/s] 73%|███████▎  | 58/79 [00:00<00:00, 81.90it/s] 85%|████████▍ | 67/79 [00:00<00:00, 84.27it/s] 97%|█████████▋| 77/79 [00:01<00:00, 87.93it/s]100%|██████████| 79/79 [00:01<00:00, 70.09it/s]
10000 images processed, 1.1466338634490967 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:14,  2.73it/s]  5%|▍         | 10/204 [00:00<00:07, 26.80it/s]  9%|▉         | 19/204 [00:00<00:04, 44.12it/s] 14%|█▎        | 28/204 [00:00<00:03, 57.07it/s] 18%|█▊        | 37/204 [00:00<00:02, 66.18it/s] 23%|██▎       | 47/204 [00:00<00:02, 74.38it/s] 28%|██▊       | 57/204 [00:00<00:01, 79.17it/s] 32%|███▏      | 66/204 [00:01<00:01, 81.79it/s] 37%|███▋      | 75/204 [00:01<00:01, 83.20it/s] 42%|████▏     | 85/204 [00:01<00:01, 85.93it/s] 47%|████▋     | 95/204 [00:01<00:01, 88.25it/s] 51%|█████▏    | 105/204 [00:01<00:01, 90.03it/s] 56%|█████▋    | 115/204 [00:01<00:00, 90.55it/s] 61%|██████▏   | 125/204 [00:01<00:00, 89.26it/s] 66%|██████▌   | 135/204 [00:01<00:00, 90.47it/s] 71%|███████   | 145/204 [00:01<00:00, 91.08it/s] 76%|███████▌  | 155/204 [00:02<00:00, 91.41it/s] 81%|████████  | 165/204 [00:02<00:00, 90.03it/s] 86%|████████▌ | 175/204 [00:02<00:00, 87.13it/s] 91%|█████████ | 185/204 [00:02<00:00, 88.49it/s] 96%|█████████▌| 195/204 [00:02<00:00, 89.21it/s]100%|██████████| 204/204 [00:02<00:00, 88.93it/s]100%|██████████| 204/204 [00:02<00:00, 77.45it/s]
26032 images processed, 2.6848719120025635 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:37,  2.10it/s] 11%|█▏        | 9/79 [00:00<00:03, 18.00it/s] 22%|██▏       | 17/79 [00:00<00:02, 28.71it/s] 32%|███▏      | 25/79 [00:00<00:01, 35.59it/s] 42%|████▏     | 33/79 [00:01<00:01, 40.90it/s] 52%|█████▏    | 41/79 [00:01<00:00, 44.28it/s] 62%|██████▏   | 49/79 [00:01<00:00, 47.08it/s] 72%|███████▏  | 57/79 [00:01<00:00, 48.95it/s] 81%|████████  | 64/79 [00:01<00:00, 52.39it/s] 89%|████████▊ | 70/79 [00:01<00:00, 49.87it/s] 96%|█████████▌| 76/79 [00:01<00:00, 49.35it/s]100%|██████████| 79/79 [00:01<00:00, 40.71it/s]
10000 images processed, 1.9712882041931152 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:33,  2.33it/s] 14%|█▍        | 11/79 [00:00<00:02, 26.09it/s] 27%|██▋       | 21/79 [00:00<00:01, 44.10it/s] 38%|███▊      | 30/79 [00:00<00:00, 56.21it/s] 51%|█████     | 40/79 [00:00<00:00, 66.39it/s] 63%|██████▎   | 50/79 [00:00<00:00, 74.00it/s] 76%|███████▌  | 60/79 [00:01<00:00, 79.52it/s] 89%|████████▊ | 70/79 [00:01<00:00, 84.18it/s]100%|██████████| 79/79 [00:01<00:00, 62.37it/s]
10000 images processed, 1.2882142066955566 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:30,  2.26it/s] 14%|█▍        | 10/70 [00:00<00:02, 23.61it/s] 27%|██▋       | 19/70 [00:00<00:01, 40.72it/s] 40%|████      | 28/70 [00:00<00:00, 53.76it/s] 53%|█████▎    | 37/70 [00:00<00:00, 62.85it/s] 66%|██████▌   | 46/70 [00:00<00:00, 70.12it/s] 80%|████████  | 56/70 [00:01<00:00, 77.00it/s] 94%|█████████▍| 66/70 [00:01<00:00, 82.31it/s]100%|██████████| 70/70 [00:01<00:00, 57.79it/s]
8925 images processed, 1.2489423751831055 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:00<00:41,  1.07it/s]  4%|▍         | 2/45 [00:01<00:19,  2.23it/s] 16%|█▌        | 7/45 [00:01<00:04,  8.89it/s] 20%|██        | 9/45 [00:01<00:03,  9.34it/s] 24%|██▍       | 11/45 [00:01<00:03,  9.99it/s] 33%|███▎      | 15/45 [00:01<00:02, 13.45it/s] 38%|███▊      | 17/45 [00:01<00:02, 11.84it/s] 44%|████▍     | 20/45 [00:02<00:01, 13.44it/s] 51%|█████     | 23/45 [00:02<00:01, 11.72it/s] 62%|██████▏   | 28/45 [00:02<00:01, 13.60it/s] 67%|██████▋   | 30/45 [00:02<00:01, 14.46it/s] 71%|███████   | 32/45 [00:03<00:01, 12.49it/s] 76%|███████▌  | 34/45 [00:03<00:00, 13.12it/s] 80%|████████  | 36/45 [00:03<00:00, 12.05it/s] 87%|████████▋ | 39/45 [00:03<00:00, 14.15it/s] 91%|█████████ | 41/45 [00:03<00:00, 12.44it/s] 96%|█████████▌| 43/45 [00:04<00:00, 10.07it/s]100%|██████████| 45/45 [00:04<00:00, 10.91it/s]
5640 images processed, 4.148294687271118 seconds used

18.933320999145508
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.53  99.36
places365     67.87  81.18
LSUN          17.60  96.07
iSUN          72.36  81.68
dtd           37.87  91.39
AVG           39.65  89.93
Retain-Acc: 0.7406
Forget-as-OOD (retain known vs forget novel):
  FPR: 79.50 AUROC: 86.90 AUIN: 98.36
38.194355487823486
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e10-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid
epochs=10 | cache=6 | flambda=0.5 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e10-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e10-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e10-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21610432
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<02:22,  2.74it/s]  3%|▎         | 11/391 [00:00<00:12, 29.39it/s]  5%|▍         | 19/391 [00:00<00:08, 43.56it/s]  7%|▋         | 28/391 [00:00<00:06, 56.80it/s] 10%|▉         | 38/391 [00:00<00:05, 67.77it/s] 12%|█▏        | 47/391 [00:00<00:04, 74.16it/s] 15%|█▍        | 57/391 [00:00<00:04, 79.37it/s] 17%|█▋        | 67/391 [00:01<00:03, 82.97it/s] 20%|█▉        | 77/391 [00:01<00:03, 86.41it/s] 22%|██▏       | 87/391 [00:01<00:03, 87.83it/s] 25%|██▍       | 97/391 [00:01<00:03, 87.49it/s] 27%|██▋       | 106/391 [00:01<00:03, 86.67it/s] 30%|██▉       | 116/391 [00:01<00:03, 88.68it/s] 32%|███▏      | 125/391 [00:01<00:03, 88.27it/s] 34%|███▍      | 134/391 [00:01<00:02, 88.29it/s] 37%|███▋      | 144/391 [00:01<00:02, 89.34it/s] 39%|███▉      | 154/391 [00:02<00:02, 91.16it/s] 42%|████▏     | 164/391 [00:02<00:02, 91.23it/s] 45%|████▍     | 174/391 [00:02<00:02, 91.53it/s] 47%|████▋     | 184/391 [00:02<00:02, 91.40it/s] 50%|████▉     | 194/391 [00:02<00:02, 89.88it/s] 52%|█████▏    | 203/391 [00:02<00:02, 89.09it/s] 54%|█████▍    | 213/391 [00:02<00:01, 90.29it/s] 57%|█████▋    | 223/391 [00:02<00:01, 89.53it/s] 60%|█████▉    | 233/391 [00:02<00:01, 89.96it/s] 62%|██████▏   | 243/391 [00:03<00:01, 90.22it/s] 65%|██████▍   | 253/391 [00:03<00:01, 90.29it/s] 67%|██████▋   | 263/391 [00:03<00:01, 91.23it/s] 70%|██████▉   | 273/391 [00:03<00:01, 90.45it/s] 72%|███████▏  | 283/391 [00:03<00:01, 87.31it/s] 75%|███████▍  | 292/391 [00:03<00:01, 87.05it/s] 77%|███████▋  | 301/391 [00:03<00:01, 87.47it/s] 80%|███████▉  | 311/391 [00:03<00:00, 88.66it/s] 82%|████████▏ | 320/391 [00:03<00:00, 86.85it/s] 84%|████████▍ | 330/391 [00:04<00:00, 89.33it/s] 87%|████████▋ | 340/391 [00:04<00:00, 88.95it/s] 90%|████████▉ | 350/391 [00:04<00:00, 90.23it/s] 92%|█████████▏| 360/391 [00:04<00:00, 90.47it/s] 95%|█████████▍| 370/391 [00:04<00:00, 89.35it/s] 97%|█████████▋| 379/391 [00:04<00:00, 89.40it/s] 99%|█████████▉| 389/391 [00:04<00:00, 91.36it/s]100%|██████████| 391/391 [00:04<00:00, 82.87it/s]
50000 images processed, 4.8264031410217285 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:23,  3.36it/s] 11%|█▏        | 9/79 [00:00<00:02, 28.18it/s] 24%|██▍       | 19/79 [00:00<00:01, 49.66it/s] 35%|███▌      | 28/79 [00:00<00:00, 60.73it/s] 48%|████▊     | 38/79 [00:00<00:00, 70.59it/s] 59%|█████▉    | 47/79 [00:00<00:00, 75.96it/s] 72%|███████▏  | 57/79 [00:00<00:00, 79.98it/s] 84%|████████▎ | 66/79 [00:01<00:00, 81.70it/s] 96%|█████████▌| 76/79 [00:01<00:00, 85.70it/s]100%|██████████| 79/79 [00:01<00:00, 66.84it/s]
10000 images processed, 1.2020752429962158 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:02,  3.24it/s]  5%|▌         | 11/204 [00:00<00:05, 32.98it/s] 10%|█         | 21/204 [00:00<00:03, 52.21it/s] 15%|█▌        | 31/204 [00:00<00:02, 64.53it/s] 20%|██        | 41/204 [00:00<00:02, 71.99it/s] 25%|██▍       | 50/204 [00:00<00:02, 73.84it/s] 29%|██▉       | 59/204 [00:00<00:01, 77.30it/s] 33%|███▎      | 68/204 [00:01<00:01, 80.66it/s] 38%|███▊      | 78/204 [00:01<00:01, 84.55it/s] 43%|████▎     | 87/204 [00:01<00:01, 84.34it/s] 47%|████▋     | 96/204 [00:01<00:01, 85.63it/s] 51%|█████▏    | 105/204 [00:01<00:01, 86.52it/s] 56%|█████▌    | 114/204 [00:01<00:01, 85.72it/s] 60%|██████    | 123/204 [00:01<00:00, 85.14it/s] 65%|██████▍   | 132/204 [00:01<00:00, 84.17it/s] 69%|██████▉   | 141/204 [00:01<00:00, 85.55it/s] 74%|███████▎  | 150/204 [00:02<00:00, 85.57it/s] 78%|███████▊  | 159/204 [00:02<00:00, 86.36it/s] 82%|████████▏ | 168/204 [00:02<00:00, 85.80it/s] 87%|████████▋ | 177/204 [00:02<00:00, 84.02it/s] 92%|█████████▏| 187/204 [00:02<00:00, 86.23it/s] 97%|█████████▋| 197/204 [00:02<00:00, 89.13it/s]100%|██████████| 204/204 [00:02<00:00, 77.59it/s]
26032 images processed, 2.6743662357330322 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:38,  2.03it/s] 11%|█▏        | 9/79 [00:00<00:03, 17.74it/s] 22%|██▏       | 17/79 [00:00<00:02, 25.51it/s] 32%|███▏      | 25/79 [00:01<00:01, 31.75it/s] 42%|████▏     | 33/79 [00:01<00:01, 36.70it/s] 51%|█████     | 40/79 [00:01<00:00, 43.45it/s] 58%|█████▊    | 46/79 [00:01<00:00, 41.55it/s] 65%|██████▍   | 51/79 [00:01<00:00, 38.66it/s] 73%|███████▎  | 58/79 [00:01<00:00, 40.81it/s] 84%|████████▎ | 66/79 [00:01<00:00, 42.56it/s] 94%|█████████▎| 74/79 [00:02<00:00, 45.64it/s]100%|██████████| 79/79 [00:02<00:00, 37.17it/s]
10000 images processed, 2.1568727493286133 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:27,  2.88it/s] 14%|█▍        | 11/79 [00:00<00:02, 31.13it/s] 25%|██▌       | 20/79 [00:00<00:01, 48.18it/s] 38%|███▊      | 30/79 [00:00<00:00, 62.11it/s] 51%|█████     | 40/79 [00:00<00:00, 71.63it/s] 63%|██████▎   | 50/79 [00:00<00:00, 77.63it/s] 76%|███████▌  | 60/79 [00:00<00:00, 82.11it/s] 89%|████████▊ | 70/79 [00:01<00:00, 85.91it/s]100%|██████████| 79/79 [00:01<00:00, 67.24it/s]
10000 images processed, 1.193605661392212 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:27,  2.51it/s] 16%|█▌        | 11/70 [00:00<00:02, 27.77it/s] 29%|██▊       | 20/70 [00:00<00:01, 44.27it/s] 43%|████▎     | 30/70 [00:00<00:00, 58.19it/s] 57%|█████▋    | 40/70 [00:00<00:00, 68.98it/s] 71%|███████▏  | 50/70 [00:00<00:00, 76.00it/s] 86%|████████▌ | 60/70 [00:01<00:00, 81.25it/s]100%|██████████| 70/70 [00:01<00:00, 84.54it/s]100%|██████████| 70/70 [00:01<00:00, 61.13it/s]
8925 images processed, 1.1747448444366455 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:00<00:39,  1.11it/s]  4%|▍         | 2/45 [00:01<00:21,  2.03it/s] 20%|██        | 9/45 [00:01<00:03,  9.96it/s] 24%|██▍       | 11/45 [00:01<00:04,  8.40it/s] 38%|███▊      | 17/45 [00:01<00:02, 12.94it/s] 42%|████▏     | 19/45 [00:02<00:02, 11.18it/s] 49%|████▉     | 22/45 [00:02<00:01, 13.74it/s] 53%|█████▎    | 24/45 [00:02<00:01, 13.68it/s] 58%|█████▊    | 26/45 [00:02<00:01, 10.91it/s] 67%|██████▋   | 30/45 [00:03<00:01, 11.97it/s] 73%|███████▎  | 33/45 [00:03<00:00, 14.62it/s] 78%|███████▊  | 35/45 [00:03<00:00, 10.53it/s] 87%|████████▋ | 39/45 [00:03<00:00, 13.18it/s] 93%|█████████▎| 42/45 [00:04<00:00,  9.85it/s]100%|██████████| 45/45 [00:04<00:00, 10.66it/s]
5640 images processed, 4.241735219955444 seconds used

19.199593544006348
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.53  99.36
places365     67.87  81.18
LSUN          17.60  96.07
iSUN          72.36  81.68
dtd           37.87  91.39
AVG           39.65  89.93
Retain-Acc: 0.7406
Forget-as-OOD (retain known vs forget novel):
  FPR: 79.50 AUROC: 86.90 AUIN: 98.36
27.806519031524658
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e20-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid
epochs=20 | cache=6 | flambda=0.5 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e20-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e20-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e20-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21610432
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<02:55,  2.22it/s]  2%|▏         | 6/391 [00:00<00:28, 13.34it/s]  3%|▎         | 11/391 [00:00<00:17, 22.21it/s]  5%|▍         | 18/391 [00:00<00:11, 33.77it/s]  7%|▋         | 28/391 [00:00<00:07, 50.44it/s] 10%|▉         | 38/391 [00:00<00:05, 62.84it/s] 12%|█▏        | 48/391 [00:01<00:04, 71.08it/s] 15%|█▍        | 57/391 [00:01<00:04, 75.21it/s] 17%|█▋        | 66/391 [00:01<00:04, 65.40it/s] 19%|█▉        | 74/391 [00:01<00:05, 58.89it/s] 21%|██        | 81/391 [00:01<00:05, 56.42it/s] 23%|██▎       | 88/391 [00:01<00:05, 54.59it/s] 24%|██▍       | 94/391 [00:01<00:05, 52.99it/s] 26%|██▌       | 100/391 [00:02<00:05, 52.03it/s] 27%|██▋       | 106/391 [00:02<00:05, 51.54it/s] 29%|██▊       | 112/391 [00:02<00:05, 49.07it/s] 30%|██▉       | 117/391 [00:02<00:05, 48.65it/s] 31%|███       | 122/391 [00:02<00:05, 48.25it/s] 32%|███▏      | 127/391 [00:02<00:05, 48.11it/s] 34%|███▍      | 132/391 [00:02<00:05, 48.15it/s] 36%|███▌      | 139/391 [00:02<00:04, 52.98it/s] 38%|███▊      | 149/391 [00:02<00:03, 63.85it/s] 40%|████      | 158/391 [00:03<00:03, 70.66it/s] 43%|████▎     | 168/391 [00:03<00:02, 77.25it/s] 46%|████▌     | 178/391 [00:03<00:02, 81.71it/s] 48%|████▊     | 188/391 [00:03<00:02, 83.68it/s] 50%|█████     | 197/391 [00:03<00:02, 83.91it/s] 53%|█████▎    | 207/391 [00:03<00:02, 86.27it/s] 55%|█████▌    | 216/391 [00:03<00:02, 86.20it/s] 58%|█████▊    | 226/391 [00:03<00:01, 85.70it/s] 60%|██████    | 235/391 [00:04<00:02, 71.13it/s] 62%|██████▏   | 243/391 [00:04<00:02, 63.76it/s] 64%|██████▍   | 250/391 [00:04<00:02, 59.53it/s] 66%|██████▌   | 257/391 [00:04<00:02, 56.69it/s] 67%|██████▋   | 263/391 [00:04<00:02, 55.26it/s] 69%|██████▉   | 269/391 [00:04<00:02, 54.20it/s] 70%|███████   | 275/391 [00:04<00:02, 53.76it/s] 72%|███████▏  | 281/391 [00:04<00:02, 51.95it/s] 73%|███████▎  | 287/391 [00:05<00:02, 51.33it/s] 75%|███████▍  | 293/391 [00:05<00:01, 51.61it/s] 76%|███████▋  | 299/391 [00:05<00:01, 51.40it/s] 78%|███████▊  | 305/391 [00:05<00:01, 50.28it/s] 80%|███████▉  | 311/391 [00:05<00:01, 48.15it/s] 81%|████████  | 316/391 [00:05<00:01, 48.06it/s] 82%|████████▏ | 321/391 [00:05<00:01, 47.99it/s] 83%|████████▎ | 326/391 [00:05<00:01, 48.24it/s] 85%|████████▍ | 332/391 [00:05<00:01, 49.42it/s] 86%|████████▋ | 338/391 [00:06<00:01, 51.37it/s] 88%|████████▊ | 344/391 [00:06<00:00, 52.10it/s] 90%|████████▉ | 350/391 [00:06<00:00, 51.26it/s] 91%|█████████ | 356/391 [00:06<00:00, 51.18it/s] 93%|█████████▎| 362/391 [00:06<00:00, 50.16it/s] 94%|█████████▍| 368/391 [00:06<00:00, 51.66it/s] 96%|█████████▌| 374/391 [00:06<00:00, 51.10it/s] 97%|█████████▋| 380/391 [00:06<00:00, 50.06it/s] 99%|█████████▊| 386/391 [00:07<00:00, 49.36it/s]100%|██████████| 391/391 [00:07<00:00, 48.81it/s]100%|██████████| 391/391 [00:07<00:00, 54.70it/s]
50000 images processed, 7.246831178665161 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:29,  2.67it/s]  8%|▊         | 6/79 [00:00<00:04, 15.70it/s] 14%|█▍        | 11/79 [00:00<00:02, 25.06it/s] 25%|██▌       | 20/79 [00:00<00:01, 42.86it/s] 38%|███▊      | 30/79 [00:00<00:00, 57.86it/s] 49%|████▉     | 39/79 [00:00<00:00, 66.31it/s] 61%|██████    | 48/79 [00:00<00:00, 72.66it/s] 72%|███████▏  | 57/79 [00:01<00:00, 77.56it/s] 84%|████████▎ | 66/79 [00:01<00:00, 80.96it/s] 96%|█████████▌| 76/79 [00:01<00:00, 85.34it/s]100%|██████████| 79/79 [00:01<00:00, 58.86it/s]
10000 images processed, 1.3621063232421875 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:18,  2.58it/s]  4%|▍         | 9/204 [00:00<00:08, 22.77it/s]  7%|▋         | 14/204 [00:00<00:06, 29.73it/s]  9%|▉         | 19/204 [00:00<00:05, 35.02it/s] 12%|█▏        | 25/204 [00:00<00:04, 40.93it/s] 15%|█▍        | 30/204 [00:00<00:04, 42.79it/s] 18%|█▊        | 37/204 [00:01<00:03, 49.78it/s] 21%|██        | 43/204 [00:01<00:03, 49.58it/s] 24%|██▍       | 49/204 [00:01<00:03, 49.42it/s] 27%|██▋       | 55/204 [00:01<00:03, 49.09it/s] 30%|██▉       | 61/204 [00:01<00:02, 51.06it/s] 33%|███▎      | 67/204 [00:01<00:02, 50.48it/s] 36%|███▌      | 73/204 [00:01<00:02, 49.05it/s] 39%|███▉      | 80/204 [00:01<00:02, 53.69it/s] 44%|████▎     | 89/204 [00:01<00:01, 63.09it/s] 48%|████▊     | 98/204 [00:02<00:01, 70.27it/s] 53%|█████▎    | 108/204 [00:02<00:01, 77.16it/s] 58%|█████▊    | 118/204 [00:02<00:01, 81.59it/s] 63%|██████▎   | 128/204 [00:02<00:00, 82.27it/s] 67%|██████▋   | 137/204 [00:02<00:00, 68.06it/s] 71%|███████   | 145/204 [00:02<00:00, 61.24it/s] 75%|███████▍  | 152/204 [00:02<00:00, 56.52it/s] 77%|███████▋  | 158/204 [00:03<00:00, 53.43it/s] 80%|████████  | 164/204 [00:03<00:00, 51.77it/s] 83%|████████▎ | 170/204 [00:03<00:00, 51.29it/s] 86%|████████▋ | 176/204 [00:03<00:00, 50.83it/s] 89%|████████▉ | 182/204 [00:03<00:00, 49.56it/s] 92%|█████████▏| 188/204 [00:03<00:00, 49.60it/s] 95%|█████████▍| 193/204 [00:03<00:00, 49.28it/s] 97%|█████████▋| 198/204 [00:03<00:00, 49.04it/s]100%|█████████▉| 203/204 [00:03<00:00, 48.84it/s]100%|██████████| 204/204 [00:03<00:00, 51.27it/s]
26032 images processed, 4.022894382476807 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:46,  1.67it/s] 10%|█         | 8/79 [00:00<00:04, 14.61it/s] 15%|█▌        | 12/79 [00:00<00:03, 18.97it/s] 22%|██▏       | 17/79 [00:00<00:02, 22.72it/s] 32%|███▏      | 25/79 [00:01<00:01, 30.15it/s] 41%|████      | 32/79 [00:01<00:01, 38.32it/s] 47%|████▋     | 37/79 [00:01<00:01, 31.64it/s] 57%|█████▋    | 45/79 [00:01<00:00, 35.09it/s] 67%|██████▋   | 53/79 [00:01<00:00, 39.07it/s] 76%|███████▌  | 60/79 [00:01<00:00, 44.07it/s] 82%|████████▏ | 65/79 [00:02<00:00, 42.44it/s] 89%|████████▊ | 70/79 [00:02<00:00, 41.74it/s] 97%|█████████▋| 77/79 [00:02<00:00, 39.04it/s]100%|██████████| 79/79 [00:02<00:00, 32.32it/s]
10000 images processed, 2.487999677658081 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:39,  1.99it/s]  9%|▉         | 7/79 [00:00<00:04, 14.51it/s] 20%|██        | 16/79 [00:00<00:01, 31.63it/s] 28%|██▊       | 22/79 [00:00<00:01, 38.49it/s] 38%|███▊      | 30/79 [00:00<00:01, 48.43it/s] 51%|█████     | 40/79 [00:01<00:00, 60.45it/s] 61%|██████    | 48/79 [00:01<00:00, 60.91it/s] 72%|███████▏  | 57/79 [00:01<00:00, 65.97it/s] 84%|████████▎ | 66/79 [00:01<00:00, 70.95it/s] 95%|█████████▍| 75/79 [00:01<00:00, 74.28it/s]100%|██████████| 79/79 [00:01<00:00, 50.77it/s]
10000 images processed, 1.5794966220855713 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:35,  1.93it/s] 11%|█▏        | 8/70 [00:00<00:03, 16.46it/s] 24%|██▍       | 17/70 [00:00<00:01, 33.58it/s] 37%|███▋      | 26/70 [00:00<00:00, 46.96it/s] 49%|████▊     | 34/70 [00:00<00:00, 51.78it/s] 61%|██████▏   | 43/70 [00:01<00:00, 60.33it/s] 74%|███████▍  | 52/70 [00:01<00:00, 66.92it/s] 87%|████████▋ | 61/70 [00:01<00:00, 71.92it/s]100%|██████████| 70/70 [00:01<00:00, 50.81it/s]
8925 images processed, 1.405740737915039 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:00<00:42,  1.04it/s]  4%|▍         | 2/45 [00:01<00:20,  2.08it/s] 16%|█▌        | 7/45 [00:01<00:04,  8.91it/s] 22%|██▏       | 10/45 [00:01<00:04,  8.30it/s] 31%|███       | 14/45 [00:01<00:02, 11.14it/s] 38%|███▊      | 17/45 [00:01<00:02, 13.26it/s] 42%|████▏     | 19/45 [00:02<00:02, 13.00it/s] 47%|████▋     | 21/45 [00:02<00:01, 13.76it/s] 51%|█████     | 23/45 [00:02<00:01, 11.93it/s] 56%|█████▌    | 25/45 [00:02<00:01, 10.36it/s] 62%|██████▏   | 28/45 [00:02<00:01, 13.23it/s] 67%|██████▋   | 30/45 [00:03<00:01, 11.40it/s] 73%|███████▎  | 33/45 [00:03<00:01,  9.11it/s] 91%|█████████ | 41/45 [00:04<00:00, 11.54it/s]100%|██████████| 45/45 [00:04<00:00, 10.76it/s]
5640 images processed, 4.204235553741455 seconds used

24.140899419784546
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.53  99.36
places365     67.87  81.18
LSUN          17.60  96.07
iSUN          72.36  81.68
dtd           37.87  91.39
AVG           39.65  89.93
Retain-Acc: 0.7406
Forget-as-OOD (retain known vs forget novel):
  FPR: 79.50 AUROC: 86.90 AUIN: 98.36
9.975018501281738
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e50-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid
epochs=50 | cache=6 | flambda=0.5 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e50-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e50-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e50-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21610432
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<02:15,  2.87it/s]  2%|▏         | 8/391 [00:00<00:17, 22.26it/s]  5%|▍         | 18/391 [00:00<00:08, 43.86it/s]  7%|▋         | 28/391 [00:00<00:06, 59.29it/s] 10%|▉         | 38/391 [00:00<00:05, 69.99it/s] 12%|█▏        | 47/391 [00:00<00:04, 70.81it/s] 14%|█▍        | 55/391 [00:01<00:05, 62.82it/s] 16%|█▌        | 62/391 [00:01<00:05, 60.93it/s] 18%|█▊        | 72/391 [00:01<00:04, 69.15it/s] 21%|██        | 82/391 [00:01<00:04, 76.29it/s] 24%|██▎       | 92/391 [00:01<00:03, 80.59it/s] 26%|██▌       | 101/391 [00:01<00:03, 72.89it/s] 28%|██▊       | 109/391 [00:01<00:04, 64.33it/s] 30%|██▉       | 117/391 [00:01<00:04, 67.08it/s] 32%|███▏      | 127/391 [00:02<00:03, 74.30it/s] 35%|███▌      | 137/391 [00:02<00:03, 79.73it/s] 38%|███▊      | 147/391 [00:02<00:02, 83.91it/s] 40%|███▉      | 156/391 [00:02<00:03, 75.56it/s] 42%|████▏     | 164/391 [00:02<00:03, 66.39it/s] 44%|████▎     | 171/391 [00:02<00:03, 66.92it/s] 46%|████▋     | 181/391 [00:02<00:02, 74.25it/s] 49%|████▉     | 191/391 [00:02<00:02, 79.46it/s] 51%|█████▏    | 201/391 [00:02<00:02, 83.61it/s] 54%|█████▎    | 210/391 [00:03<00:02, 77.01it/s] 56%|█████▌    | 218/391 [00:03<00:02, 67.19it/s] 58%|█████▊    | 226/391 [00:03<00:02, 66.90it/s] 60%|██████    | 236/391 [00:03<00:02, 73.93it/s] 63%|██████▎   | 246/391 [00:03<00:01, 78.95it/s] 65%|██████▌   | 256/391 [00:03<00:01, 82.73it/s] 68%|██████▊   | 265/391 [00:03<00:01, 81.60it/s] 70%|███████   | 274/391 [00:04<00:01, 68.80it/s] 72%|███████▏  | 282/391 [00:04<00:01, 66.44it/s] 74%|███████▍  | 291/391 [00:04<00:01, 71.90it/s] 77%|███████▋  | 301/391 [00:04<00:01, 77.76it/s] 80%|███████▉  | 311/391 [00:04<00:00, 81.72it/s] 82%|████████▏ | 320/391 [00:04<00:00, 75.31it/s] 84%|████████▍ | 328/391 [00:04<00:00, 66.20it/s] 86%|████████▌ | 335/391 [00:04<00:00, 66.70it/s] 88%|████████▊ | 345/391 [00:04<00:00, 73.94it/s] 91%|█████████ | 355/391 [00:05<00:00, 79.04it/s] 93%|█████████▎| 365/391 [00:05<00:00, 83.38it/s] 96%|█████████▌| 375/391 [00:05<00:00, 84.42it/s] 98%|█████████▊| 384/391 [00:05<00:00, 69.39it/s]100%|██████████| 391/391 [00:05<00:00, 69.58it/s]
50000 images processed, 5.720583200454712 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:25,  3.03it/s] 14%|█▍        | 11/79 [00:00<00:02, 31.63it/s] 27%|██▋       | 21/79 [00:00<00:01, 50.39it/s] 39%|███▉      | 31/79 [00:00<00:00, 63.31it/s] 49%|████▉     | 39/79 [00:00<00:00, 65.03it/s] 59%|█████▉    | 47/79 [00:00<00:00, 59.18it/s] 68%|██████▊   | 54/79 [00:01<00:00, 58.44it/s] 81%|████████  | 64/79 [00:01<00:00, 67.86it/s] 94%|█████████▎| 74/79 [00:01<00:00, 75.42it/s]100%|██████████| 79/79 [00:01<00:00, 59.42it/s]
10000 images processed, 1.3540751934051514 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:16,  2.64it/s]  5%|▌         | 11/204 [00:00<00:06, 28.99it/s] 10%|█         | 21/204 [00:00<00:03, 48.76it/s] 16%|█▌        | 32/204 [00:00<00:02, 64.68it/s] 21%|██        | 42/204 [00:00<00:02, 72.71it/s] 25%|██▌       | 52/204 [00:00<00:01, 78.82it/s] 30%|██▉       | 61/204 [00:01<00:01, 81.67it/s] 35%|███▍      | 71/204 [00:01<00:01, 84.91it/s] 40%|███▉      | 81/204 [00:01<00:01, 87.33it/s] 45%|████▍     | 91/204 [00:01<00:01, 89.04it/s] 50%|████▉     | 101/204 [00:01<00:01, 89.08it/s] 54%|█████▍    | 111/204 [00:01<00:01, 89.77it/s] 59%|█████▉    | 121/204 [00:01<00:00, 91.14it/s] 64%|██████▍   | 131/204 [00:01<00:00, 91.44it/s] 69%|██████▉   | 141/204 [00:01<00:00, 91.86it/s] 74%|███████▍  | 151/204 [00:01<00:00, 91.53it/s] 79%|███████▉  | 161/204 [00:02<00:00, 91.39it/s] 84%|████████▍ | 171/204 [00:02<00:00, 90.00it/s] 89%|████████▊ | 181/204 [00:02<00:00, 90.49it/s] 94%|█████████▎| 191/204 [00:02<00:00, 89.41it/s] 99%|█████████▊| 201/204 [00:02<00:00, 90.89it/s]100%|██████████| 204/204 [00:02<00:00, 79.22it/s]
26032 images processed, 2.6325786113739014 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:40,  1.91it/s] 11%|█▏        | 9/79 [00:00<00:04, 16.67it/s] 22%|██▏       | 17/79 [00:00<00:02, 26.33it/s] 32%|███▏      | 25/79 [00:01<00:01, 33.68it/s] 39%|███▉      | 31/79 [00:01<00:01, 38.84it/s] 46%|████▌     | 36/79 [00:01<00:01, 38.91it/s] 53%|█████▎    | 42/79 [00:01<00:00, 40.47it/s] 63%|██████▎   | 50/79 [00:01<00:00, 43.84it/s] 73%|███████▎  | 58/79 [00:01<00:00, 45.48it/s] 84%|████████▎ | 66/79 [00:01<00:00, 46.35it/s] 92%|█████████▏| 73/79 [00:01<00:00, 51.20it/s]100%|██████████| 79/79 [00:02<00:00, 52.68it/s]100%|██████████| 79/79 [00:02<00:00, 38.19it/s]
10000 images processed, 2.1083972454071045 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:27,  2.85it/s] 11%|█▏        | 9/79 [00:00<00:02, 25.07it/s] 24%|██▍       | 19/79 [00:00<00:01, 45.76it/s] 37%|███▋      | 29/79 [00:00<00:00, 60.14it/s] 49%|████▉     | 39/79 [00:00<00:00, 70.22it/s] 62%|██████▏   | 49/79 [00:00<00:00, 77.14it/s] 75%|███████▍  | 59/79 [00:00<00:00, 82.02it/s] 87%|████████▋ | 69/79 [00:01<00:00, 85.37it/s]100%|██████████| 79/79 [00:01<00:00, 66.13it/s]
10000 images processed, 1.2122886180877686 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:21,  3.16it/s] 16%|█▌        | 11/70 [00:00<00:01, 32.49it/s] 30%|███       | 21/70 [00:00<00:00, 51.85it/s] 44%|████▍     | 31/70 [00:00<00:00, 64.32it/s] 59%|█████▊    | 41/70 [00:00<00:00, 72.66it/s] 73%|███████▎  | 51/70 [00:00<00:00, 78.91it/s] 87%|████████▋ | 61/70 [00:00<00:00, 82.48it/s]100%|██████████| 70/70 [00:01<00:00, 65.61it/s]
8925 images processed, 1.101060390472412 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:01<00:50,  1.15s/it] 20%|██        | 9/45 [00:01<00:05,  6.34it/s] 22%|██▏       | 10/45 [00:01<00:05,  6.31it/s] 31%|███       | 14/45 [00:02<00:03,  8.97it/s] 38%|███▊      | 17/45 [00:02<00:03,  9.04it/s] 49%|████▉     | 22/45 [00:02<00:02, 10.38it/s] 56%|█████▌    | 25/45 [00:03<00:01, 10.53it/s] 67%|██████▋   | 30/45 [00:03<00:01, 10.57it/s] 73%|███████▎  | 33/45 [00:03<00:01,  9.67it/s] 91%|█████████ | 41/45 [00:04<00:00, 11.87it/s]100%|██████████| 45/45 [00:04<00:00, 10.00it/s]
5640 images processed, 4.52251935005188 seconds used

20.531986951828003
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.53  99.36
places365     67.87  81.18
LSUN          17.60  96.07
iSUN          72.36  81.68
dtd           37.87  91.39
AVG           39.65  89.93
Retain-Acc: 0.7406
Forget-as-OOD (retain known vs forget novel):
  FPR: 79.50 AUROC: 86.90 AUIN: 98.36
9.911046743392944
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e5-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid
epochs=5 | cache=6 | flambda=0.5 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21610432
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<01:50,  3.54it/s]  3%|▎         | 12/391 [00:00<00:09, 38.47it/s]  6%|▌         | 23/391 [00:00<00:06, 59.16it/s]  8%|▊         | 31/391 [00:00<00:05, 60.19it/s] 10%|█         | 41/391 [00:00<00:04, 70.63it/s] 13%|█▎        | 51/391 [00:00<00:04, 77.08it/s] 16%|█▌        | 61/391 [00:00<00:04, 81.24it/s] 18%|█▊        | 70/391 [00:01<00:04, 74.75it/s] 20%|█▉        | 78/391 [00:01<00:04, 65.57it/s] 22%|██▏       | 85/391 [00:01<00:04, 65.49it/s] 24%|██▍       | 95/391 [00:01<00:04, 73.27it/s] 27%|██▋       | 105/391 [00:01<00:03, 79.11it/s] 29%|██▉       | 115/391 [00:01<00:03, 83.21it/s] 32%|███▏      | 124/391 [00:01<00:03, 81.61it/s] 34%|███▍      | 133/391 [00:01<00:03, 68.65it/s] 36%|███▌      | 141/391 [00:02<00:03, 66.07it/s] 39%|███▊      | 151/391 [00:02<00:03, 73.23it/s] 41%|████      | 161/391 [00:02<00:02, 78.48it/s] 44%|████▎     | 171/391 [00:02<00:02, 82.85it/s] 46%|████▌     | 180/391 [00:02<00:02, 82.15it/s] 48%|████▊     | 189/391 [00:02<00:02, 69.01it/s] 50%|█████     | 197/391 [00:02<00:02, 66.36it/s] 53%|█████▎    | 207/391 [00:02<00:02, 73.71it/s] 55%|█████▌    | 217/391 [00:03<00:02, 79.15it/s] 58%|█████▊    | 227/391 [00:03<00:01, 83.50it/s] 61%|██████    | 237/391 [00:03<00:01, 86.90it/s] 63%|██████▎   | 246/391 [00:03<00:01, 75.53it/s] 65%|██████▍   | 254/391 [00:03<00:02, 66.47it/s] 67%|██████▋   | 262/391 [00:03<00:01, 68.75it/s] 69%|██████▉   | 271/391 [00:03<00:01, 74.07it/s] 72%|███████▏  | 281/391 [00:03<00:01, 79.27it/s] 74%|███████▍  | 291/391 [00:04<00:01, 83.50it/s] 77%|███████▋  | 300/391 [00:04<00:01, 72.53it/s] 79%|███████▉  | 308/391 [00:04<00:01, 63.43it/s] 81%|████████▏ | 318/391 [00:04<00:01, 71.06it/s] 84%|████████▍ | 328/391 [00:04<00:00, 76.44it/s] 86%|████████▋ | 338/391 [00:04<00:00, 81.48it/s] 89%|████████▉ | 348/391 [00:04<00:00, 84.92it/s] 91%|█████████▏| 357/391 [00:04<00:00, 69.58it/s] 93%|█████████▎| 365/391 [00:05<00:00, 65.33it/s] 96%|█████████▌| 375/391 [00:05<00:00, 71.58it/s] 98%|█████████▊| 385/391 [00:05<00:00, 77.99it/s]100%|██████████| 391/391 [00:05<00:00, 72.46it/s]
50000 images processed, 5.5022242069244385 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:25,  3.03it/s] 10%|█         | 8/79 [00:00<00:03, 22.45it/s] 16%|█▋        | 13/79 [00:00<00:02, 30.20it/s] 24%|██▍       | 19/79 [00:00<00:01, 37.28it/s] 34%|███▍      | 27/79 [00:00<00:01, 49.45it/s] 47%|████▋     | 37/79 [00:00<00:00, 62.41it/s] 59%|█████▉    | 47/79 [00:00<00:00, 71.89it/s] 72%|███████▏  | 57/79 [00:01<00:00, 78.56it/s] 84%|████████▎ | 66/79 [00:01<00:00, 74.26it/s] 94%|█████████▎| 74/79 [00:01<00:00, 65.12it/s]100%|██████████| 79/79 [00:01<00:00, 53.55it/s]
10000 images processed, 1.511014461517334 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:08,  2.95it/s]  5%|▌         | 11/204 [00:00<00:06, 30.52it/s]  8%|▊         | 17/204 [00:00<00:05, 35.12it/s] 11%|█         | 22/204 [00:00<00:04, 38.14it/s] 15%|█▍        | 30/204 [00:00<00:03, 49.02it/s] 20%|█▉        | 40/204 [00:00<00:02, 62.04it/s] 25%|██▍       | 50/204 [00:01<00:02, 71.34it/s] 29%|██▉       | 60/204 [00:01<00:01, 77.78it/s] 34%|███▍      | 69/204 [00:01<00:01, 70.22it/s] 38%|███▊      | 77/204 [00:01<00:02, 60.25it/s] 43%|████▎     | 87/204 [00:01<00:01, 68.37it/s] 48%|████▊     | 97/204 [00:01<00:01, 74.76it/s] 52%|█████▏    | 107/204 [00:01<00:01, 79.80it/s] 57%|█████▋    | 117/204 [00:01<00:01, 81.82it/s] 62%|██████▏   | 126/204 [00:02<00:01, 65.97it/s] 66%|██████▌   | 134/204 [00:02<00:01, 65.29it/s] 71%|███████   | 144/204 [00:02<00:00, 72.28it/s] 75%|███████▌  | 154/204 [00:02<00:00, 77.80it/s] 80%|███████▉  | 163/204 [00:02<00:00, 80.96it/s] 84%|████████▍ | 172/204 [00:02<00:00, 77.05it/s] 88%|████████▊ | 180/204 [00:02<00:00, 64.73it/s] 92%|█████████▏| 187/204 [00:02<00:00, 65.50it/s] 97%|█████████▋| 197/204 [00:03<00:00, 73.29it/s]100%|██████████| 204/204 [00:03<00:00, 65.10it/s]
26032 images processed, 3.175469160079956 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:38,  2.00it/s] 11%|█▏        | 9/79 [00:00<00:04, 15.93it/s] 18%|█▊        | 14/79 [00:00<00:02, 22.52it/s] 28%|██▊       | 22/79 [00:00<00:01, 35.39it/s] 35%|███▌      | 28/79 [00:01<00:01, 33.69it/s] 42%|████▏     | 33/79 [00:01<00:01, 36.78it/s] 52%|█████▏    | 41/79 [00:01<00:00, 42.22it/s] 59%|█████▉    | 47/79 [00:01<00:00, 45.17it/s] 67%|██████▋   | 53/79 [00:01<00:00, 43.61it/s] 76%|███████▌  | 60/79 [00:01<00:00, 49.39it/s] 84%|████████▎ | 66/79 [00:01<00:00, 44.12it/s] 90%|████████▉ | 71/79 [00:01<00:00, 45.05it/s] 99%|█████████▊| 78/79 [00:02<00:00, 50.80it/s]100%|██████████| 79/79 [00:02<00:00, 37.59it/s]
10000 images processed, 2.1356394290924072 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:26,  2.95it/s] 13%|█▎        | 10/79 [00:00<00:02, 28.44it/s] 25%|██▌       | 20/79 [00:00<00:01, 48.64it/s] 38%|███▊      | 30/79 [00:00<00:00, 62.33it/s] 48%|████▊     | 38/79 [00:00<00:00, 57.91it/s] 57%|█████▋    | 45/79 [00:00<00:00, 53.37it/s] 70%|██████▉   | 55/79 [00:01<00:00, 63.47it/s] 81%|████████  | 64/79 [00:01<00:00, 70.13it/s] 94%|█████████▎| 74/79 [00:01<00:00, 77.26it/s]100%|██████████| 79/79 [00:01<00:00, 59.53it/s]
10000 images processed, 1.3463351726531982 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:22,  3.08it/s] 11%|█▏        | 8/70 [00:00<00:02, 22.02it/s] 19%|█▊        | 13/70 [00:00<00:01, 29.16it/s] 26%|██▌       | 18/70 [00:00<00:01, 34.85it/s] 40%|████      | 28/70 [00:00<00:00, 52.77it/s] 54%|█████▍    | 38/70 [00:00<00:00, 65.31it/s] 69%|██████▊   | 48/70 [00:00<00:00, 73.92it/s] 83%|████████▎ | 58/70 [00:01<00:00, 79.79it/s] 96%|█████████▌| 67/70 [00:01<00:00, 64.23it/s]100%|██████████| 70/70 [00:01<00:00, 51.88it/s]
8925 images processed, 1.3796799182891846 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:00<00:33,  1.30it/s]  4%|▍         | 2/45 [00:00<00:17,  2.44it/s] 16%|█▌        | 7/45 [00:01<00:03, 10.29it/s] 22%|██▏       | 10/45 [00:01<00:04,  8.06it/s] 31%|███       | 14/45 [00:01<00:02, 11.96it/s] 38%|███▊      | 17/45 [00:01<00:01, 14.54it/s] 44%|████▍     | 20/45 [00:02<00:02, 11.36it/s] 51%|█████     | 23/45 [00:02<00:01, 13.82it/s] 58%|█████▊    | 26/45 [00:02<00:01, 11.19it/s] 67%|██████▋   | 30/45 [00:02<00:01, 13.29it/s] 73%|███████▎  | 33/45 [00:02<00:00, 14.98it/s] 78%|███████▊  | 35/45 [00:03<00:00, 10.55it/s] 89%|████████▉ | 40/45 [00:03<00:00, 15.82it/s] 96%|█████████▌| 43/45 [00:04<00:00, 10.04it/s]100%|██████████| 45/45 [00:04<00:00, 10.89it/s]
5640 images processed, 4.15485405921936 seconds used

20.873964548110962
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.53  99.36
places365     67.87  81.18
LSUN          17.60  96.07
iSUN          72.36  81.68
dtd           37.87  91.39
AVG           39.65  89.93
Retain-Acc: 0.7406
Forget-as-OOD (retain known vs forget novel):
  FPR: 79.50 AUROC: 86.90 AUIN: 98.36
9.264619827270508
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e10-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid
epochs=10 | cache=6 | flambda=0.5 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e10-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e10-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e10-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21610432
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<02:17,  2.83it/s]  3%|▎         | 11/391 [00:00<00:12, 30.28it/s]  5%|▌         | 21/391 [00:00<00:07, 49.65it/s]  8%|▊         | 31/391 [00:00<00:05, 63.12it/s] 10%|█         | 41/391 [00:00<00:04, 72.54it/s] 13%|█▎        | 51/391 [00:00<00:04, 78.64it/s] 16%|█▌        | 61/391 [00:00<00:03, 82.88it/s] 18%|█▊        | 71/391 [00:01<00:03, 86.30it/s] 21%|██        | 81/391 [00:01<00:03, 88.62it/s] 23%|██▎       | 91/391 [00:01<00:03, 90.15it/s] 26%|██▌       | 101/391 [00:01<00:03, 90.58it/s] 28%|██▊       | 111/391 [00:01<00:03, 91.11it/s] 31%|███       | 121/391 [00:01<00:02, 92.02it/s] 34%|███▎      | 131/391 [00:01<00:02, 92.80it/s] 36%|███▌      | 141/391 [00:01<00:02, 92.78it/s] 39%|███▊      | 151/391 [00:01<00:02, 92.76it/s] 41%|████      | 161/391 [00:02<00:02, 93.12it/s] 44%|████▎     | 171/391 [00:02<00:02, 93.29it/s] 46%|████▋     | 181/391 [00:02<00:02, 93.60it/s] 49%|████▉     | 191/391 [00:02<00:02, 93.86it/s] 51%|█████▏    | 201/391 [00:02<00:02, 94.17it/s] 54%|█████▍    | 211/391 [00:02<00:01, 93.04it/s] 57%|█████▋    | 221/391 [00:02<00:01, 92.53it/s] 59%|█████▉    | 231/391 [00:02<00:01, 92.97it/s] 62%|██████▏   | 241/391 [00:02<00:01, 92.32it/s] 64%|██████▍   | 251/391 [00:03<00:01, 93.33it/s] 67%|██████▋   | 261/391 [00:03<00:01, 93.60it/s] 69%|██████▉   | 271/391 [00:03<00:01, 93.86it/s] 72%|███████▏  | 281/391 [00:03<00:01, 94.05it/s] 74%|███████▍  | 291/391 [00:03<00:01, 94.08it/s] 77%|███████▋  | 301/391 [00:03<00:00, 94.12it/s] 80%|███████▉  | 311/391 [00:03<00:00, 93.68it/s] 82%|████████▏ | 321/391 [00:03<00:00, 93.78it/s] 85%|████████▍ | 331/391 [00:03<00:00, 93.92it/s] 87%|████████▋ | 341/391 [00:03<00:00, 93.83it/s] 90%|████████▉ | 351/391 [00:04<00:00, 93.21it/s] 92%|█████████▏| 361/391 [00:04<00:00, 92.96it/s] 95%|█████████▍| 371/391 [00:04<00:00, 92.26it/s] 97%|█████████▋| 381/391 [00:04<00:00, 93.21it/s]100%|██████████| 391/391 [00:04<00:00, 92.22it/s]100%|██████████| 391/391 [00:04<00:00, 86.35it/s]
50000 images processed, 4.606154918670654 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:26,  2.97it/s] 14%|█▍        | 11/79 [00:00<00:02, 31.35it/s] 27%|██▋       | 21/79 [00:00<00:01, 50.57it/s] 39%|███▉      | 31/79 [00:00<00:00, 63.98it/s] 52%|█████▏    | 41/79 [00:00<00:00, 73.26it/s] 65%|██████▍   | 51/79 [00:00<00:00, 79.32it/s] 76%|███████▌  | 60/79 [00:00<00:00, 81.51it/s] 89%|████████▊ | 70/79 [00:01<00:00, 84.52it/s]100%|██████████| 79/79 [00:01<00:00, 66.91it/s]
10000 images processed, 1.2088282108306885 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:15,  2.68it/s]  5%|▍         | 10/204 [00:00<00:07, 26.15it/s]  9%|▉         | 19/204 [00:00<00:04, 43.57it/s] 14%|█▎        | 28/204 [00:00<00:03, 56.52it/s] 18%|█▊        | 37/204 [00:00<00:02, 65.95it/s] 23%|██▎       | 46/204 [00:00<00:02, 72.90it/s] 27%|██▋       | 56/204 [00:00<00:01, 78.96it/s] 32%|███▏      | 66/204 [00:01<00:01, 83.39it/s] 37%|███▋      | 76/204 [00:01<00:01, 86.14it/s] 42%|████▏     | 86/204 [00:01<00:01, 88.16it/s] 47%|████▋     | 96/204 [00:01<00:01, 89.57it/s] 52%|█████▏    | 106/204 [00:01<00:01, 90.73it/s] 57%|█████▋    | 116/204 [00:01<00:00, 91.51it/s] 62%|██████▏   | 126/204 [00:01<00:00, 91.50it/s] 67%|██████▋   | 136/204 [00:01<00:00, 92.11it/s] 72%|███████▏  | 146/204 [00:01<00:00, 91.89it/s] 76%|███████▋  | 156/204 [00:02<00:00, 90.80it/s] 81%|████████▏ | 166/204 [00:02<00:00, 90.93it/s] 86%|████████▋ | 176/204 [00:02<00:00, 90.30it/s] 91%|█████████ | 186/204 [00:02<00:00, 89.94it/s] 96%|█████████▌| 196/204 [00:02<00:00, 90.92it/s]100%|██████████| 204/204 [00:02<00:00, 78.02it/s]
26032 images processed, 2.6752865314483643 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:38,  2.00it/s] 11%|█▏        | 9/79 [00:00<00:04, 16.71it/s] 22%|██▏       | 17/79 [00:00<00:02, 26.58it/s] 32%|███▏      | 25/79 [00:00<00:01, 33.75it/s] 42%|████▏     | 33/79 [00:01<00:01, 38.18it/s] 52%|█████▏    | 41/79 [00:01<00:00, 41.68it/s] 62%|██████▏   | 49/79 [00:01<00:00, 43.31it/s] 72%|███████▏  | 57/79 [00:01<00:00, 41.65it/s] 82%|████████▏ | 65/79 [00:01<00:00, 42.88it/s] 92%|█████████▏| 73/79 [00:02<00:00, 44.69it/s]100%|██████████| 79/79 [00:02<00:00, 37.74it/s]
10000 images processed, 2.1276943683624268 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:28,  2.70it/s] 14%|█▍        | 11/79 [00:00<00:02, 29.31it/s] 27%|██▋       | 21/79 [00:00<00:01, 48.29it/s] 39%|███▉      | 31/79 [00:00<00:00, 61.85it/s] 52%|█████▏    | 41/79 [00:00<00:00, 71.36it/s] 65%|██████▍   | 51/79 [00:00<00:00, 77.74it/s] 77%|███████▋  | 61/79 [00:01<00:00, 82.35it/s] 90%|████████▉ | 71/79 [00:01<00:00, 85.90it/s]100%|██████████| 79/79 [00:01<00:00, 66.16it/s]
10000 images processed, 1.2149665355682373 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:26,  2.62it/s] 16%|█▌        | 11/70 [00:00<00:02, 28.66it/s] 30%|███       | 21/70 [00:00<00:01, 47.07it/s] 44%|████▍     | 31/70 [00:00<00:00, 60.66it/s] 59%|█████▊    | 41/70 [00:00<00:00, 70.64it/s] 73%|███████▎  | 51/70 [00:00<00:00, 77.12it/s] 87%|████████▋ | 61/70 [00:01<00:00, 82.28it/s]100%|██████████| 70/70 [00:01<00:00, 62.37it/s]
8925 images processed, 1.1520919799804688 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:00<00:41,  1.05it/s]  4%|▍         | 2/45 [00:01<00:19,  2.16it/s] 20%|██        | 9/45 [00:01<00:03,  9.16it/s] 24%|██▍       | 11/45 [00:01<00:03,  8.93it/s] 33%|███▎      | 15/45 [00:01<00:02, 13.24it/s] 40%|████      | 18/45 [00:02<00:02, 10.40it/s] 49%|████▉     | 22/45 [00:02<00:01, 13.46it/s] 56%|█████▌    | 25/45 [00:02<00:01, 13.18it/s] 60%|██████    | 27/45 [00:02<00:01, 13.05it/s] 67%|██████▋   | 30/45 [00:02<00:01, 13.02it/s] 73%|███████▎  | 33/45 [00:03<00:01, 11.29it/s] 78%|███████▊  | 35/45 [00:03<00:00, 11.11it/s] 91%|█████████ | 41/45 [00:03<00:00, 13.57it/s] 96%|█████████▌| 43/45 [00:04<00:00,  9.93it/s]100%|██████████| 45/45 [00:04<00:00, 10.47it/s]
5640 images processed, 4.319355010986328 seconds used

19.097620725631714
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.53  99.36
places365     67.87  81.18
LSUN          17.60  96.07
iSUN          72.36  81.68
dtd           37.87  91.39
AVG           39.65  89.93
Retain-Acc: 0.7406
Forget-as-OOD (retain known vs forget novel):
  FPR: 79.50 AUROC: 86.90 AUIN: 98.36
10.455851078033447
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e20-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid
epochs=20 | cache=6 | flambda=0.5 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e20-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e20-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e20-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21610432
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<02:24,  2.70it/s]  2%|▏         | 7/391 [00:00<00:21, 17.85it/s]  4%|▍         | 16/391 [00:00<00:09, 37.65it/s]  7%|▋         | 26/391 [00:00<00:06, 54.15it/s]  9%|▉         | 36/391 [00:00<00:05, 65.62it/s] 12%|█▏        | 45/391 [00:00<00:04, 69.40it/s] 14%|█▎        | 53/391 [00:01<00:05, 61.05it/s] 15%|█▌        | 60/391 [00:01<00:05, 59.53it/s] 18%|█▊        | 69/391 [00:01<00:04, 66.83it/s] 20%|██        | 79/391 [00:01<00:04, 74.52it/s] 23%|██▎       | 88/391 [00:01<00:03, 78.26it/s] 25%|██▍       | 97/391 [00:01<00:04, 73.44it/s] 27%|██▋       | 105/391 [00:01<00:04, 64.14it/s] 29%|██▊       | 112/391 [00:01<00:04, 64.79it/s] 31%|███       | 122/391 [00:02<00:03, 72.20it/s] 34%|███▍      | 132/391 [00:02<00:03, 78.02it/s] 36%|███▌      | 141/391 [00:02<00:03, 80.41it/s] 38%|███▊      | 150/391 [00:02<00:03, 68.65it/s] 40%|████      | 158/391 [00:02<00:03, 62.75it/s] 43%|████▎     | 168/391 [00:02<00:03, 69.73it/s] 46%|████▌     | 178/391 [00:02<00:02, 76.16it/s] 48%|████▊     | 188/391 [00:02<00:02, 80.80it/s] 50%|█████     | 197/391 [00:03<00:02, 73.48it/s] 52%|█████▏    | 205/391 [00:03<00:02, 65.17it/s] 54%|█████▍    | 212/391 [00:03<00:02, 66.27it/s] 57%|█████▋    | 222/391 [00:03<00:02, 73.55it/s] 59%|█████▉    | 232/391 [00:03<00:02, 78.89it/s] 62%|██████▏   | 242/391 [00:03<00:01, 82.29it/s] 64%|██████▍   | 251/391 [00:03<00:01, 72.73it/s] 66%|██████▌   | 259/391 [00:03<00:02, 63.14it/s] 69%|██████▊   | 268/391 [00:04<00:01, 69.12it/s] 71%|███████   | 278/391 [00:04<00:01, 75.61it/s] 74%|███████▎  | 288/391 [00:04<00:01, 80.54it/s] 76%|███████▌  | 298/391 [00:04<00:01, 84.48it/s] 79%|███████▊  | 307/391 [00:04<00:01, 74.63it/s] 81%|████████  | 315/391 [00:04<00:01, 65.89it/s] 83%|████████▎ | 323/391 [00:04<00:00, 68.97it/s] 85%|████████▌ | 333/391 [00:04<00:00, 75.61it/s] 88%|████████▊ | 343/391 [00:05<00:00, 80.67it/s] 90%|█████████ | 353/391 [00:05<00:00, 84.30it/s] 93%|█████████▎| 362/391 [00:05<00:00, 69.51it/s] 95%|█████████▍| 370/391 [00:05<00:00, 64.90it/s] 97%|█████████▋| 380/391 [00:05<00:00, 71.97it/s]100%|█████████▉| 390/391 [00:05<00:00, 78.36it/s]100%|██████████| 391/391 [00:05<00:00, 68.70it/s]
50000 images processed, 5.775314569473267 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:24,  3.16it/s] 14%|█▍        | 11/79 [00:00<00:02, 32.54it/s] 27%|██▋       | 21/79 [00:00<00:01, 51.91it/s] 38%|███▊      | 30/79 [00:00<00:00, 63.14it/s] 48%|████▊     | 38/79 [00:00<00:00, 58.48it/s] 57%|█████▋    | 45/79 [00:00<00:00, 55.40it/s] 68%|██████▊   | 54/79 [00:01<00:00, 62.79it/s] 81%|████████  | 64/79 [00:01<00:00, 71.30it/s] 94%|█████████▎| 74/79 [00:01<00:00, 78.09it/s]100%|██████████| 79/79 [00:01<00:00, 60.41it/s]
10000 images processed, 1.3445940017700195 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:25,  2.38it/s]  4%|▍         | 9/204 [00:00<00:08, 21.73it/s]  9%|▉         | 18/204 [00:00<00:04, 39.49it/s] 14%|█▎        | 28/204 [00:00<00:03, 54.63it/s] 18%|█▊        | 37/204 [00:00<00:02, 63.49it/s] 22%|██▏       | 45/204 [00:01<00:02, 55.22it/s] 25%|██▌       | 52/204 [00:01<00:02, 55.49it/s] 30%|██▉       | 61/204 [00:01<00:02, 63.89it/s] 34%|███▍      | 70/204 [00:01<00:01, 70.20it/s] 39%|███▉      | 80/204 [00:01<00:01, 74.51it/s] 43%|████▎     | 88/204 [00:01<00:01, 62.41it/s] 47%|████▋     | 95/204 [00:01<00:01, 60.45it/s] 51%|█████     | 104/204 [00:01<00:01, 67.50it/s] 56%|█████▌    | 114/204 [00:01<00:01, 73.94it/s] 60%|██████    | 123/204 [00:02<00:01, 77.87it/s] 65%|██████▍   | 132/204 [00:02<00:01, 67.53it/s] 69%|██████▊   | 140/204 [00:02<00:01, 60.92it/s] 73%|███████▎  | 148/204 [00:02<00:00, 64.33it/s] 77%|███████▋  | 157/204 [00:02<00:00, 69.50it/s] 81%|████████  | 165/204 [00:02<00:00, 64.69it/s] 84%|████████▍ | 172/204 [00:02<00:00, 56.01it/s] 88%|████████▊ | 180/204 [00:03<00:00, 59.70it/s] 93%|█████████▎| 189/204 [00:03<00:00, 65.79it/s] 96%|█████████▌| 196/204 [00:03<00:00, 60.21it/s]100%|█████████▉| 203/204 [00:03<00:00, 55.34it/s]100%|██████████| 204/204 [00:03<00:00, 58.35it/s]
26032 images processed, 3.5607242584228516 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:36,  2.15it/s] 11%|█▏        | 9/79 [00:00<00:03, 18.34it/s] 16%|█▋        | 13/79 [00:00<00:03, 21.28it/s] 23%|██▎       | 18/79 [00:00<00:02, 27.28it/s] 28%|██▊       | 22/79 [00:01<00:02, 26.64it/s] 34%|███▍      | 27/79 [00:01<00:01, 30.99it/s] 39%|███▉      | 31/79 [00:01<00:01, 32.42it/s] 46%|████▌     | 36/79 [00:01<00:01, 28.19it/s] 54%|█████▍    | 43/79 [00:01<00:00, 37.02it/s] 61%|██████    | 48/79 [00:01<00:00, 31.64it/s] 66%|██████▌   | 52/79 [00:01<00:00, 31.89it/s] 76%|███████▌  | 60/79 [00:02<00:00, 32.36it/s] 86%|████████▌ | 68/79 [00:02<00:00, 33.71it/s] 92%|█████████▏| 73/79 [00:02<00:00, 36.03it/s] 97%|█████████▋| 77/79 [00:02<00:00, 36.30it/s]100%|██████████| 79/79 [00:02<00:00, 30.35it/s]
10000 images processed, 2.6504852771759033 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:33,  2.36it/s]  9%|▉         | 7/79 [00:00<00:04, 16.66it/s] 22%|██▏       | 17/79 [00:00<00:01, 37.25it/s] 34%|███▍      | 27/79 [00:00<00:00, 53.06it/s] 47%|████▋     | 37/79 [00:00<00:00, 64.52it/s] 58%|█████▊    | 46/79 [00:00<00:00, 68.06it/s] 68%|██████▊   | 54/79 [00:01<00:00, 58.45it/s] 77%|███████▋  | 61/79 [00:01<00:00, 59.68it/s] 90%|████████▉ | 71/79 [00:01<00:00, 69.00it/s]100%|██████████| 79/79 [00:01<00:00, 54.59it/s]
10000 images processed, 1.4676501750946045 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:26,  2.60it/s]  9%|▊         | 6/70 [00:00<00:04, 15.05it/s] 17%|█▋        | 12/70 [00:00<00:02, 27.27it/s] 31%|███▏      | 22/70 [00:00<00:01, 46.62it/s] 46%|████▌     | 32/70 [00:00<00:00, 60.39it/s] 60%|██████    | 42/70 [00:00<00:00, 70.06it/s] 73%|███████▎  | 51/70 [00:01<00:00, 74.44it/s] 86%|████████▌ | 60/70 [00:01<00:00, 61.38it/s] 96%|█████████▌| 67/70 [00:01<00:00, 61.28it/s]100%|██████████| 70/70 [00:01<00:00, 50.92it/s]
8925 images processed, 1.4086754322052002 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:01<00:52,  1.19s/it]  9%|▉         | 4/45 [00:01<00:10,  3.93it/s] 20%|██        | 9/45 [00:01<00:05,  6.85it/s] 33%|███▎      | 15/45 [00:01<00:02, 12.82it/s] 42%|████▏     | 19/45 [00:02<00:02,  9.79it/s] 49%|████▉     | 22/45 [00:02<00:01, 11.71it/s] 56%|█████▌    | 25/45 [00:03<00:02,  9.03it/s] 64%|██████▍   | 29/45 [00:03<00:01, 12.02it/s] 73%|███████▎  | 33/45 [00:03<00:01,  8.62it/s] 91%|█████████ | 41/45 [00:04<00:00, 11.75it/s]100%|██████████| 45/45 [00:04<00:00, 10.18it/s]
5640 images processed, 4.444152116775513 seconds used

22.432258367538452
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.53  99.36
places365     67.87  81.18
LSUN          17.60  96.07
iSUN          72.36  81.68
dtd           37.87  91.39
AVG           39.65  89.93
Retain-Acc: 0.7406
Forget-as-OOD (retain known vs forget novel):
  FPR: 79.50 AUROC: 86.90 AUIN: 98.36
9.844144105911255
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e50-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid
epochs=50 | cache=6 | flambda=0.5 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e50-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e50-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e50-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21610432
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<02:01,  3.21it/s]  2%|▏         | 6/391 [00:00<00:21, 17.67it/s]  3%|▎         | 12/391 [00:00<00:13, 28.93it/s]  5%|▌         | 20/391 [00:00<00:08, 43.49it/s]  8%|▊         | 30/391 [00:00<00:06, 58.58it/s] 10%|█         | 40/391 [00:00<00:05, 68.70it/s] 13%|█▎        | 50/391 [00:00<00:04, 75.21it/s] 15%|█▌        | 59/391 [00:01<00:05, 63.66it/s] 17%|█▋        | 67/391 [00:01<00:05, 61.52it/s] 20%|█▉        | 77/391 [00:01<00:04, 69.56it/s] 22%|██▏       | 87/391 [00:01<00:04, 75.42it/s] 25%|██▍       | 97/391 [00:01<00:03, 80.31it/s] 27%|██▋       | 106/391 [00:01<00:03, 74.49it/s] 29%|██▉       | 114/391 [00:01<00:04, 65.58it/s] 31%|███       | 121/391 [00:02<00:04, 65.67it/s] 33%|███▎      | 130/391 [00:02<00:03, 71.44it/s] 36%|███▌      | 140/391 [00:02<00:03, 77.33it/s] 38%|███▊      | 150/391 [00:02<00:03, 80.11it/s] 41%|████      | 159/391 [00:02<00:03, 67.01it/s] 43%|████▎     | 167/391 [00:02<00:03, 64.69it/s] 45%|████▌     | 176/391 [00:02<00:03, 70.50it/s] 48%|████▊     | 186/391 [00:02<00:02, 76.67it/s] 50%|█████     | 196/391 [00:02<00:02, 81.46it/s] 52%|█████▏    | 205/391 [00:03<00:02, 76.50it/s] 54%|█████▍    | 213/391 [00:03<00:02, 66.56it/s] 57%|█████▋    | 221/391 [00:03<00:02, 66.80it/s] 59%|█████▉    | 231/391 [00:03<00:02, 73.88it/s] 62%|██████▏   | 241/391 [00:03<00:01, 79.41it/s] 64%|██████▍   | 251/391 [00:03<00:01, 83.37it/s] 66%|██████▋   | 260/391 [00:03<00:01, 79.74it/s] 69%|██████▉   | 269/391 [00:04<00:01, 67.08it/s] 71%|███████   | 277/391 [00:04<00:01, 67.63it/s] 73%|███████▎  | 287/391 [00:04<00:01, 74.47it/s] 76%|███████▌  | 296/391 [00:04<00:01, 78.00it/s] 78%|███████▊  | 305/391 [00:04<00:01, 79.49it/s] 80%|████████  | 314/391 [00:04<00:01, 66.10it/s] 82%|████████▏ | 322/391 [00:04<00:01, 64.16it/s] 85%|████████▍ | 332/391 [00:04<00:00, 70.97it/s] 87%|████████▋ | 341/391 [00:05<00:00, 75.66it/s] 90%|████████▉ | 351/391 [00:05<00:00, 80.14it/s] 92%|█████████▏| 360/391 [00:05<00:00, 67.32it/s] 94%|█████████▍| 368/391 [00:05<00:00, 63.50it/s] 97%|█████████▋| 378/391 [00:05<00:00, 70.98it/s] 99%|█████████▉| 388/391 [00:05<00:00, 77.57it/s]100%|██████████| 391/391 [00:05<00:00, 68.64it/s]
50000 images processed, 5.780677795410156 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:22,  3.42it/s] 11%|█▏        | 9/79 [00:00<00:02, 28.12it/s] 24%|██▍       | 19/79 [00:00<00:01, 49.97it/s] 37%|███▋      | 29/79 [00:00<00:00, 64.12it/s] 49%|████▉     | 39/79 [00:00<00:00, 73.69it/s] 61%|██████    | 48/79 [00:00<00:00, 75.16it/s] 72%|███████▏  | 57/79 [00:01<00:00, 64.16it/s] 82%|████████▏ | 65/79 [00:01<00:00, 62.08it/s] 95%|█████████▍| 75/79 [00:01<00:00, 70.56it/s]100%|██████████| 79/79 [00:01<00:00, 60.27it/s]
10000 images processed, 1.3431649208068848 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:00,  3.38it/s]  2%|▏         | 4/204 [00:00<00:16, 11.98it/s]  3%|▎         | 7/204 [00:00<00:11, 17.29it/s]  6%|▌         | 12/204 [00:00<00:07, 26.02it/s]  8%|▊         | 17/204 [00:00<00:05, 31.89it/s] 11%|█         | 22/204 [00:00<00:04, 36.68it/s] 13%|█▎        | 27/204 [00:00<00:04, 40.10it/s] 16%|█▌        | 32/204 [00:01<00:04, 41.25it/s] 18%|█▊        | 37/204 [00:01<00:03, 43.15it/s] 21%|██        | 42/204 [00:01<00:03, 44.01it/s] 23%|██▎       | 47/204 [00:01<00:03, 44.43it/s] 25%|██▌       | 52/204 [00:01<00:03, 45.42it/s] 28%|██▊       | 57/204 [00:01<00:03, 46.11it/s] 30%|███       | 62/204 [00:01<00:03, 39.35it/s] 33%|███▎      | 67/204 [00:01<00:03, 35.65it/s] 35%|███▍      | 71/204 [00:02<00:03, 33.78it/s] 37%|███▋      | 76/204 [00:02<00:03, 36.89it/s] 40%|███▉      | 81/204 [00:02<00:03, 39.58it/s] 42%|████▏     | 86/204 [00:02<00:02, 40.93it/s] 45%|████▍     | 91/204 [00:02<00:02, 43.08it/s] 47%|████▋     | 96/204 [00:02<00:02, 44.22it/s] 50%|████▉     | 101/204 [00:02<00:02, 45.29it/s] 52%|█████▏    | 106/204 [00:02<00:02, 45.24it/s] 54%|█████▍    | 111/204 [00:02<00:02, 45.54it/s] 57%|█████▋    | 116/204 [00:03<00:01, 46.24it/s] 59%|█████▉    | 121/204 [00:03<00:01, 46.96it/s] 62%|██████▏   | 126/204 [00:03<00:01, 39.47it/s] 64%|██████▍   | 131/204 [00:03<00:02, 35.40it/s] 66%|██████▌   | 135/204 [00:03<00:02, 34.10it/s] 69%|██████▊   | 140/204 [00:03<00:01, 37.13it/s] 71%|███████   | 145/204 [00:03<00:01, 39.91it/s] 74%|███████▎  | 150/204 [00:03<00:01, 42.12it/s] 76%|███████▌  | 155/204 [00:04<00:01, 43.74it/s] 78%|███████▊  | 160/204 [00:04<00:01, 43.98it/s] 81%|████████  | 165/204 [00:04<00:00, 44.85it/s] 83%|████████▎ | 170/204 [00:04<00:00, 45.46it/s] 86%|████████▌ | 175/204 [00:04<00:00, 45.14it/s] 88%|████████▊ | 180/204 [00:04<00:00, 45.93it/s] 91%|█████████ | 185/204 [00:04<00:00, 44.15it/s] 93%|█████████▎| 190/204 [00:04<00:00, 37.65it/s] 95%|█████████▌| 194/204 [00:05<00:00, 34.89it/s] 97%|█████████▋| 198/204 [00:05<00:00, 34.15it/s]100%|█████████▉| 203/204 [00:05<00:00, 37.67it/s]100%|██████████| 204/204 [00:05<00:00, 38.80it/s]
26032 images processed, 5.301504373550415 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:43,  1.78it/s]  8%|▊         | 6/79 [00:00<00:06, 11.27it/s] 14%|█▍        | 11/79 [00:00<00:03, 19.18it/s] 20%|██        | 16/79 [00:00<00:02, 25.53it/s] 27%|██▋       | 21/79 [00:01<00:01, 31.20it/s] 33%|███▎      | 26/79 [00:01<00:01, 34.76it/s] 39%|███▉      | 31/79 [00:01<00:01, 38.20it/s] 46%|████▌     | 36/79 [00:01<00:01, 36.82it/s] 52%|█████▏    | 41/79 [00:01<00:00, 39.53it/s] 58%|█████▊    | 46/79 [00:01<00:00, 34.86it/s] 63%|██████▎   | 50/79 [00:01<00:00, 32.77it/s] 68%|██████▊   | 54/79 [00:01<00:00, 31.56it/s] 76%|███████▌  | 60/79 [00:02<00:00, 37.60it/s] 89%|████████▊ | 70/79 [00:02<00:00, 52.29it/s]100%|██████████| 79/79 [00:02<00:00, 35.20it/s]
10000 images processed, 2.2875075340270996 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:27,  2.80it/s]  8%|▊         | 6/79 [00:00<00:04, 16.08it/s] 13%|█▎        | 10/79 [00:00<00:03, 21.15it/s] 16%|█▋        | 13/79 [00:00<00:02, 23.13it/s] 20%|██        | 16/79 [00:00<00:02, 24.92it/s] 24%|██▍       | 19/79 [00:00<00:02, 25.85it/s] 30%|███       | 24/79 [00:01<00:01, 30.65it/s] 37%|███▋      | 29/79 [00:01<00:01, 34.98it/s] 43%|████▎     | 34/79 [00:01<00:01, 38.65it/s] 49%|████▉     | 39/79 [00:01<00:00, 40.94it/s] 56%|█████▌    | 44/79 [00:01<00:00, 42.15it/s] 68%|██████▊   | 54/79 [00:01<00:00, 56.70it/s] 80%|███████▉  | 63/79 [00:01<00:00, 65.07it/s] 89%|████████▊ | 70/79 [00:01<00:00, 56.63it/s] 96%|█████████▌| 76/79 [00:01<00:00, 54.46it/s]100%|██████████| 79/79 [00:01<00:00, 39.73it/s]
10000 images processed, 2.014516830444336 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:28,  2.42it/s]  9%|▊         | 6/70 [00:00<00:04, 14.52it/s] 16%|█▌        | 11/70 [00:00<00:02, 23.74it/s] 21%|██▏       | 15/70 [00:00<00:02, 26.57it/s] 27%|██▋       | 19/70 [00:00<00:01, 27.64it/s] 33%|███▎      | 23/70 [00:01<00:01, 28.70it/s] 39%|███▊      | 27/70 [00:01<00:01, 31.13it/s] 46%|████▌     | 32/70 [00:01<00:01, 35.83it/s] 53%|█████▎    | 37/70 [00:01<00:00, 39.34it/s] 60%|██████    | 42/70 [00:01<00:00, 41.92it/s] 67%|██████▋   | 47/70 [00:01<00:00, 43.68it/s] 74%|███████▍  | 52/70 [00:01<00:00, 45.05it/s] 81%|████████▏ | 57/70 [00:01<00:00, 46.04it/s] 89%|████████▊ | 62/70 [00:01<00:00, 46.71it/s] 96%|█████████▌| 67/70 [00:01<00:00, 47.20it/s]100%|██████████| 70/70 [00:02<00:00, 34.98it/s]
8925 images processed, 2.027811050415039 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:00<00:41,  1.06it/s]  7%|▋         | 3/45 [00:01<00:12,  3.47it/s] 18%|█▊        | 8/45 [00:01<00:03, 10.63it/s] 24%|██▍       | 11/45 [00:01<00:03,  8.69it/s] 33%|███▎      | 15/45 [00:01<00:02, 12.74it/s] 40%|████      | 18/45 [00:02<00:02, 10.97it/s] 49%|████▉     | 22/45 [00:02<00:01, 13.61it/s] 56%|█████▌    | 25/45 [00:02<00:01, 12.85it/s] 60%|██████    | 27/45 [00:02<00:01, 13.82it/s] 64%|██████▍   | 29/45 [00:02<00:01, 12.59it/s] 73%|███████▎  | 33/45 [00:03<00:01, 11.09it/s] 78%|███████▊  | 35/45 [00:03<00:00, 11.65it/s] 84%|████████▍ | 38/45 [00:03<00:00, 14.49it/s] 91%|█████████ | 41/45 [00:03<00:00, 12.71it/s] 96%|█████████▌| 43/45 [00:04<00:00, 11.08it/s]100%|██████████| 45/45 [00:04<00:00, 10.94it/s]
5640 images processed, 4.137360095977783 seconds used

24.632615566253662
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.53  99.36
places365     67.87  81.18
LSUN          17.60  96.07
iSUN          72.36  81.68
dtd           37.87  91.39
AVG           39.65  89.93
Retain-Acc: 0.7406
Forget-as-OOD (retain known vs forget novel):
  FPR: 79.50 AUROC: 86.90 AUIN: 98.36
10.231997728347778
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e5-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid
epochs=5 | cache=6 | flambda=0.5 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21610432
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<02:03,  3.17it/s]  3%|▎         | 10/391 [00:00<00:12, 30.22it/s]  5%|▌         | 20/391 [00:00<00:07, 50.84it/s]  8%|▊         | 30/391 [00:00<00:05, 64.80it/s] 10%|█         | 40/391 [00:00<00:04, 74.03it/s] 13%|█▎        | 50/391 [00:00<00:04, 80.46it/s] 15%|█▌        | 60/391 [00:00<00:03, 85.56it/s] 18%|█▊        | 70/391 [00:01<00:03, 88.56it/s] 20%|██        | 80/391 [00:01<00:03, 90.77it/s] 23%|██▎       | 90/391 [00:01<00:03, 92.16it/s] 26%|██▌       | 100/391 [00:01<00:03, 92.95it/s] 28%|██▊       | 110/391 [00:01<00:03, 93.05it/s] 31%|███       | 120/391 [00:01<00:02, 93.29it/s] 33%|███▎      | 130/391 [00:01<00:02, 93.58it/s] 36%|███▌      | 140/391 [00:01<00:02, 92.80it/s] 38%|███▊      | 150/391 [00:01<00:02, 93.07it/s] 41%|████      | 160/391 [00:02<00:02, 93.35it/s] 43%|████▎     | 170/391 [00:02<00:02, 93.62it/s] 46%|████▌     | 180/391 [00:02<00:02, 93.28it/s] 49%|████▊     | 190/391 [00:02<00:02, 93.66it/s] 51%|█████     | 200/391 [00:02<00:02, 93.41it/s] 54%|█████▎    | 210/391 [00:02<00:01, 93.81it/s] 56%|█████▋    | 220/391 [00:02<00:01, 94.48it/s] 59%|█████▉    | 230/391 [00:02<00:01, 94.90it/s] 61%|██████▏   | 240/391 [00:02<00:01, 95.08it/s] 64%|██████▍   | 250/391 [00:02<00:01, 92.78it/s] 66%|██████▋   | 260/391 [00:03<00:01, 93.72it/s] 69%|██████▉   | 270/391 [00:03<00:01, 94.23it/s] 72%|███████▏  | 280/391 [00:03<00:01, 94.03it/s] 74%|███████▍  | 290/391 [00:03<00:01, 91.85it/s] 77%|███████▋  | 300/391 [00:03<00:00, 92.79it/s] 79%|███████▉  | 310/391 [00:03<00:00, 93.30it/s] 82%|████████▏ | 320/391 [00:03<00:00, 93.16it/s] 84%|████████▍ | 330/391 [00:03<00:00, 93.63it/s] 87%|████████▋ | 340/391 [00:03<00:00, 94.25it/s] 90%|████████▉ | 350/391 [00:04<00:00, 94.57it/s] 92%|█████████▏| 360/391 [00:04<00:00, 92.52it/s] 95%|█████████▍| 370/391 [00:04<00:00, 93.30it/s] 97%|█████████▋| 380/391 [00:04<00:00, 93.43it/s]100%|█████████▉| 390/391 [00:04<00:00, 94.45it/s]100%|██████████| 391/391 [00:04<00:00, 87.38it/s]
50000 images processed, 4.554213762283325 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:17,  4.33it/s] 14%|█▍        | 11/79 [00:00<00:01, 40.00it/s] 27%|██▋       | 21/79 [00:00<00:00, 59.60it/s] 39%|███▉      | 31/79 [00:00<00:00, 70.78it/s] 52%|█████▏    | 41/79 [00:00<00:00, 78.44it/s] 65%|██████▍   | 51/79 [00:00<00:00, 83.07it/s] 76%|███████▌  | 60/79 [00:00<00:00, 84.80it/s] 89%|████████▊ | 70/79 [00:00<00:00, 87.65it/s]100%|██████████| 79/79 [00:01<00:00, 73.10it/s]
10000 images processed, 1.1090986728668213 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:21,  2.50it/s]  5%|▍         | 10/204 [00:00<00:07, 24.93it/s]  9%|▉         | 19/204 [00:00<00:04, 42.37it/s] 14%|█▎        | 28/204 [00:00<00:03, 55.53it/s] 19%|█▊        | 38/204 [00:00<00:02, 66.46it/s] 24%|██▎       | 48/204 [00:00<00:02, 72.93it/s] 28%|██▊       | 58/204 [00:01<00:01, 78.67it/s] 33%|███▎      | 68/204 [00:01<00:01, 83.37it/s] 38%|███▊      | 77/204 [00:01<00:01, 84.91it/s] 43%|████▎     | 87/204 [00:01<00:01, 86.78it/s] 47%|████▋     | 96/204 [00:01<00:01, 84.80it/s] 52%|█████▏    | 106/204 [00:01<00:01, 86.92it/s] 57%|█████▋    | 116/204 [00:01<00:00, 88.61it/s] 62%|██████▏   | 126/204 [00:01<00:00, 89.71it/s] 67%|██████▋   | 136/204 [00:01<00:00, 89.45it/s] 72%|███████▏  | 146/204 [00:02<00:00, 90.02it/s] 76%|███████▋  | 156/204 [00:02<00:00, 90.03it/s] 81%|████████▏ | 166/204 [00:02<00:00, 88.62it/s] 86%|████████▋ | 176/204 [00:02<00:00, 89.48it/s] 91%|█████████ | 186/204 [00:02<00:00, 90.71it/s] 96%|█████████▌| 196/204 [00:02<00:00, 92.62it/s]100%|██████████| 204/204 [00:02<00:00, 76.98it/s]
26032 images processed, 2.688527822494507 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:37,  2.10it/s] 11%|█▏        | 9/79 [00:00<00:04, 17.28it/s] 18%|█▊        | 14/79 [00:00<00:02, 23.78it/s] 24%|██▍       | 19/79 [00:00<00:02, 29.74it/s] 32%|███▏      | 25/79 [00:00<00:01, 35.98it/s] 42%|████▏     | 33/79 [00:01<00:01, 39.66it/s] 48%|████▊     | 38/79 [00:01<00:00, 41.22it/s] 56%|█████▌    | 44/79 [00:01<00:00, 45.66it/s] 62%|██████▏   | 49/79 [00:01<00:00, 40.61it/s] 68%|██████▊   | 54/79 [00:01<00:00, 41.35it/s] 75%|███████▍  | 59/79 [00:01<00:00, 42.31it/s] 82%|████████▏ | 65/79 [00:01<00:00, 40.80it/s] 89%|████████▊ | 70/79 [00:02<00:00, 41.51it/s] 95%|█████████▍| 75/79 [00:02<00:00, 42.21it/s]100%|██████████| 79/79 [00:02<00:00, 36.26it/s]
10000 images processed, 2.215374231338501 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:28,  2.78it/s]  8%|▊         | 6/79 [00:00<00:04, 15.55it/s] 14%|█▍        | 11/79 [00:00<00:02, 24.43it/s] 24%|██▍       | 19/79 [00:00<00:01, 39.73it/s] 37%|███▋      | 29/79 [00:00<00:00, 55.84it/s] 49%|████▉     | 39/79 [00:00<00:00, 67.03it/s] 61%|██████    | 48/79 [00:01<00:00, 72.45it/s] 71%|███████   | 56/79 [00:01<00:00, 62.23it/s] 80%|███████▉  | 63/79 [00:01<00:00, 57.46it/s] 92%|█████████▏| 73/79 [00:01<00:00, 66.73it/s]100%|██████████| 79/79 [00:01<00:00, 53.07it/s]
10000 images processed, 1.5082275867462158 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:22,  3.01it/s] 14%|█▍        | 10/70 [00:00<00:02, 29.05it/s] 29%|██▊       | 20/70 [00:00<00:01, 48.83it/s] 43%|████▎     | 30/70 [00:00<00:00, 62.55it/s] 57%|█████▋    | 40/70 [00:00<00:00, 72.03it/s] 70%|███████   | 49/70 [00:00<00:00, 62.82it/s] 81%|████████▏ | 57/70 [00:01<00:00, 58.92it/s] 96%|█████████▌| 67/70 [00:01<00:00, 68.04it/s]100%|██████████| 70/70 [00:01<00:00, 56.91it/s]
8925 images processed, 1.2603580951690674 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:00<00:38,  1.16it/s]  4%|▍         | 2/45 [00:01<00:18,  2.27it/s] 20%|██        | 9/45 [00:01<00:03, 10.32it/s] 24%|██▍       | 11/45 [00:01<00:03,  9.14it/s] 31%|███       | 14/45 [00:01<00:02, 11.23it/s] 40%|████      | 18/45 [00:02<00:02, 11.12it/s] 49%|████▉     | 22/45 [00:02<00:01, 14.14it/s] 58%|█████▊    | 26/45 [00:02<00:01, 12.21it/s] 67%|██████▋   | 30/45 [00:02<00:00, 15.60it/s] 73%|███████▎  | 33/45 [00:03<00:00, 13.85it/s] 78%|███████▊  | 35/45 [00:03<00:00, 11.88it/s] 91%|█████████ | 41/45 [00:03<00:00, 14.54it/s] 96%|█████████▌| 43/45 [00:03<00:00, 11.43it/s]100%|██████████| 45/45 [00:04<00:00, 11.23it/s]
5640 images processed, 4.030534982681274 seconds used

19.343434810638428
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.53  99.36
places365     67.87  81.18
LSUN          17.60  96.07
iSUN          72.36  81.68
dtd           37.87  91.39
AVG           39.65  89.93
Retain-Acc: 0.7406
Forget-as-OOD (retain known vs forget novel):
  FPR: 79.50 AUROC: 86.90 AUIN: 98.36
8.961374044418335
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e10-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid
epochs=10 | cache=6 | flambda=0.5 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e10-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e10-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e10-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21610432
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<02:07,  3.05it/s]  2%|▏         | 8/391 [00:00<00:17, 22.35it/s]  4%|▍         | 17/391 [00:00<00:08, 41.75it/s]  7%|▋         | 27/391 [00:00<00:06, 57.25it/s]  9%|▉         | 37/391 [00:00<00:05, 68.03it/s] 12%|█▏        | 45/391 [00:00<00:05, 66.12it/s] 14%|█▎        | 53/391 [00:01<00:05, 59.32it/s] 15%|█▌        | 60/391 [00:01<00:05, 61.34it/s] 18%|█▊        | 70/391 [00:01<00:04, 69.88it/s] 20%|██        | 80/391 [00:01<00:04, 76.84it/s] 23%|██▎       | 90/391 [00:01<00:03, 81.91it/s] 25%|██▌       | 99/391 [00:01<00:03, 76.67it/s] 27%|██▋       | 107/391 [00:01<00:04, 66.58it/s] 29%|██▉       | 115/391 [00:01<00:04, 66.81it/s] 32%|███▏      | 125/391 [00:02<00:03, 73.96it/s] 35%|███▍      | 135/391 [00:02<00:03, 79.44it/s] 37%|███▋      | 145/391 [00:02<00:02, 83.33it/s] 40%|███▉      | 155/391 [00:02<00:02, 84.19it/s] 42%|████▏     | 164/391 [00:02<00:03, 69.33it/s] 44%|████▍     | 172/391 [00:02<00:03, 66.31it/s] 47%|████▋     | 182/391 [00:02<00:02, 73.41it/s] 49%|████▉     | 192/391 [00:02<00:02, 78.61it/s] 52%|█████▏    | 202/391 [00:02<00:02, 82.76it/s] 54%|█████▍    | 211/391 [00:03<00:02, 78.78it/s] 56%|█████▋    | 220/391 [00:03<00:02, 67.36it/s] 58%|█████▊    | 228/391 [00:03<00:02, 67.40it/s] 61%|██████    | 238/391 [00:03<00:02, 74.39it/s] 63%|██████▎   | 248/391 [00:03<00:01, 79.40it/s] 66%|██████▌   | 258/391 [00:03<00:01, 82.79it/s] 68%|██████▊   | 267/391 [00:03<00:01, 76.80it/s] 70%|███████   | 275/391 [00:04<00:01, 67.17it/s] 72%|███████▏  | 283/391 [00:04<00:01, 66.91it/s] 75%|███████▍  | 293/391 [00:04<00:01, 73.80it/s] 77%|███████▋  | 303/391 [00:04<00:01, 78.08it/s] 80%|████████  | 313/391 [00:04<00:00, 82.38it/s] 82%|████████▏ | 322/391 [00:04<00:01, 68.58it/s] 84%|████████▍ | 330/391 [00:04<00:00, 64.29it/s] 87%|████████▋ | 339/391 [00:04<00:00, 69.51it/s] 89%|████████▉ | 349/391 [00:05<00:00, 75.74it/s] 92%|█████████▏| 359/391 [00:05<00:00, 80.57it/s] 94%|█████████▍| 368/391 [00:05<00:00, 77.41it/s] 96%|█████████▌| 376/391 [00:05<00:00, 67.87it/s] 98%|█████████▊| 384/391 [00:05<00:00, 65.47it/s]100%|██████████| 391/391 [00:05<00:00, 69.55it/s]
50000 images processed, 5.723883867263794 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:20,  3.82it/s] 10%|█         | 8/79 [00:00<00:02, 26.65it/s] 23%|██▎       | 18/79 [00:00<00:01, 49.34it/s] 35%|███▌      | 28/79 [00:00<00:00, 63.47it/s] 47%|████▋     | 37/79 [00:00<00:00, 70.16it/s] 57%|█████▋    | 45/79 [00:00<00:00, 61.00it/s] 66%|██████▌   | 52/79 [00:00<00:00, 58.08it/s] 78%|███████▊  | 62/79 [00:01<00:00, 67.59it/s] 91%|█████████ | 72/79 [00:01<00:00, 75.30it/s]100%|██████████| 79/79 [00:01<00:00, 61.56it/s]
10000 images processed, 1.3064773082733154 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:04,  3.14it/s]  5%|▌         | 11/204 [00:00<00:05, 32.28it/s] 10%|█         | 21/204 [00:00<00:03, 51.32it/s] 15%|█▌        | 31/204 [00:00<00:02, 64.22it/s] 20%|██        | 41/204 [00:00<00:02, 72.63it/s] 25%|██▌       | 51/204 [00:00<00:01, 79.05it/s] 30%|██▉       | 61/204 [00:00<00:01, 83.12it/s] 35%|███▍      | 71/204 [00:01<00:01, 86.05it/s] 40%|███▉      | 81/204 [00:01<00:01, 88.44it/s] 45%|████▍     | 91/204 [00:01<00:01, 89.78it/s] 50%|████▉     | 101/204 [00:01<00:01, 90.07it/s] 54%|█████▍    | 111/204 [00:01<00:01, 90.14it/s] 59%|█████▉    | 121/204 [00:01<00:00, 90.36it/s] 65%|██████▍   | 132/204 [00:01<00:00, 93.52it/s] 70%|██████▉   | 142/204 [00:01<00:00, 95.32it/s] 75%|███████▍  | 152/204 [00:01<00:00, 93.91it/s] 79%|███████▉  | 162/204 [00:02<00:00, 93.43it/s] 84%|████████▍ | 172/204 [00:02<00:00, 91.23it/s] 89%|████████▉ | 182/204 [00:02<00:00, 91.82it/s] 94%|█████████▍| 192/204 [00:02<00:00, 94.05it/s]100%|█████████▉| 203/204 [00:02<00:00, 96.69it/s]100%|██████████| 204/204 [00:02<00:00, 81.87it/s]
26032 images processed, 2.537506580352783 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:43,  1.80it/s] 11%|█▏        | 9/79 [00:00<00:04, 15.52it/s] 22%|██▏       | 17/79 [00:00<00:02, 24.89it/s] 32%|███▏      | 25/79 [00:01<00:01, 31.45it/s] 41%|████      | 32/79 [00:01<00:01, 38.14it/s] 47%|████▋     | 37/79 [00:01<00:01, 40.66it/s] 53%|█████▎    | 42/79 [00:01<00:00, 39.60it/s] 62%|██████▏   | 49/79 [00:01<00:00, 41.72it/s] 72%|███████▏  | 57/79 [00:01<00:00, 44.60it/s] 78%|███████▊  | 62/79 [00:01<00:00, 44.40it/s] 86%|████████▌ | 68/79 [00:02<00:00, 40.92it/s] 96%|█████████▌| 76/79 [00:02<00:00, 40.39it/s]100%|██████████| 79/79 [00:02<00:00, 35.14it/s]
10000 images processed, 2.309009552001953 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:26,  2.92it/s] 14%|█▍        | 11/79 [00:00<00:02, 30.80it/s] 25%|██▌       | 20/79 [00:00<00:01, 46.86it/s] 37%|███▋      | 29/79 [00:00<00:00, 58.38it/s] 49%|████▉     | 39/79 [00:00<00:00, 68.76it/s] 62%|██████▏   | 49/79 [00:00<00:00, 76.03it/s] 75%|███████▍  | 59/79 [00:00<00:00, 81.12it/s] 87%|████████▋ | 69/79 [00:01<00:00, 85.46it/s]100%|██████████| 79/79 [00:01<00:00, 66.39it/s]
10000 images processed, 1.2096855640411377 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:22,  3.05it/s] 11%|█▏        | 8/70 [00:00<00:02, 22.80it/s] 26%|██▌       | 18/70 [00:00<00:01, 44.60it/s] 39%|███▊      | 27/70 [00:00<00:00, 57.30it/s] 51%|█████▏    | 36/70 [00:00<00:00, 66.47it/s] 66%|██████▌   | 46/70 [00:00<00:00, 74.18it/s] 79%|███████▊  | 55/70 [00:00<00:00, 78.47it/s] 93%|█████████▎| 65/70 [00:01<00:00, 83.32it/s]100%|██████████| 70/70 [00:01<00:00, 62.30it/s]
8925 images processed, 1.155289649963379 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:00<00:38,  1.14it/s]  4%|▍         | 2/45 [00:01<00:20,  2.07it/s] 20%|██        | 9/45 [00:01<00:03, 11.15it/s] 27%|██▋       | 12/45 [00:01<00:03,  9.02it/s] 40%|████      | 18/45 [00:02<00:02, 10.05it/s] 51%|█████     | 23/45 [00:02<00:01, 13.97it/s] 58%|█████▊    | 26/45 [00:02<00:01, 11.20it/s] 69%|██████▉   | 31/45 [00:02<00:00, 15.22it/s] 76%|███████▌  | 34/45 [00:03<00:01,  9.91it/s] 93%|█████████▎| 42/45 [00:04<00:00, 10.73it/s]100%|██████████| 45/45 [00:04<00:00, 10.57it/s]
5640 images processed, 4.275400638580322 seconds used

20.368926763534546
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.53  99.36
places365     67.87  81.18
LSUN          17.60  96.07
iSUN          72.36  81.68
dtd           37.87  91.39
AVG           39.65  89.93
Retain-Acc: 0.7406
Forget-as-OOD (retain known vs forget novel):
  FPR: 79.50 AUROC: 86.90 AUIN: 98.36
10.131615161895752
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e20-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid
epochs=20 | cache=6 | flambda=0.5 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e20-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e20-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e20-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21610432
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<01:59,  3.27it/s]  3%|▎         | 10/391 [00:00<00:12, 30.75it/s]  5%|▌         | 20/391 [00:00<00:07, 51.01it/s]  8%|▊         | 30/391 [00:00<00:05, 64.49it/s] 10%|▉         | 39/391 [00:00<00:05, 70.00it/s] 12%|█▏        | 48/391 [00:00<00:05, 60.09it/s] 14%|█▍        | 55/391 [00:01<00:05, 59.14it/s] 16%|█▋        | 64/391 [00:01<00:04, 66.75it/s] 19%|█▉        | 74/391 [00:01<00:04, 74.49it/s] 21%|██▏       | 84/391 [00:01<00:03, 79.91it/s] 24%|██▍       | 94/391 [00:01<00:03, 84.17it/s] 26%|██▋       | 103/391 [00:01<00:04, 67.91it/s] 28%|██▊       | 111/391 [00:01<00:04, 64.98it/s] 31%|███       | 121/391 [00:01<00:03, 72.47it/s] 34%|███▎      | 131/391 [00:02<00:03, 78.37it/s] 36%|███▌      | 141/391 [00:02<00:03, 83.02it/s] 39%|███▊      | 151/391 [00:02<00:02, 85.59it/s] 41%|████      | 160/391 [00:02<00:03, 76.88it/s] 43%|████▎     | 169/391 [00:02<00:03, 66.36it/s] 45%|████▌     | 177/391 [00:02<00:03, 69.35it/s] 48%|████▊     | 187/391 [00:02<00:02, 75.95it/s] 50%|█████     | 197/391 [00:02<00:02, 81.22it/s] 53%|█████▎    | 206/391 [00:02<00:02, 83.38it/s] 55%|█████▍    | 215/391 [00:03<00:02, 72.48it/s] 57%|█████▋    | 223/391 [00:03<00:02, 64.56it/s] 59%|█████▉    | 232/391 [00:03<00:02, 69.50it/s] 62%|██████▏   | 242/391 [00:03<00:01, 76.19it/s] 64%|██████▍   | 252/391 [00:03<00:01, 80.97it/s] 67%|██████▋   | 262/391 [00:03<00:01, 83.73it/s] 69%|██████▉   | 271/391 [00:03<00:01, 69.29it/s] 71%|███████▏  | 279/391 [00:04<00:01, 64.83it/s] 74%|███████▍  | 289/391 [00:04<00:01, 71.89it/s] 76%|███████▋  | 299/391 [00:04<00:01, 77.90it/s] 79%|███████▉  | 309/391 [00:04<00:01, 81.96it/s] 81%|████████▏ | 318/391 [00:04<00:00, 81.03it/s] 84%|████████▎ | 327/391 [00:04<00:00, 68.46it/s] 86%|████████▌ | 335/391 [00:04<00:00, 66.00it/s] 88%|████████▊ | 345/391 [00:04<00:00, 73.33it/s] 91%|█████████ | 355/391 [00:05<00:00, 79.03it/s] 93%|█████████▎| 365/391 [00:05<00:00, 82.74it/s] 96%|█████████▌| 375/391 [00:05<00:00, 85.71it/s] 98%|█████████▊| 384/391 [00:05<00:00, 70.42it/s]100%|██████████| 391/391 [00:05<00:00, 70.55it/s]
50000 images processed, 5.647629499435425 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:23,  3.37it/s]  9%|▉         | 7/79 [00:00<00:03, 21.53it/s] 22%|██▏       | 17/79 [00:00<00:01, 44.97it/s] 34%|███▍      | 27/79 [00:00<00:00, 60.40it/s] 47%|████▋     | 37/79 [00:00<00:00, 70.45it/s] 58%|█████▊    | 46/79 [00:00<00:00, 65.72it/s] 68%|██████▊   | 54/79 [00:01<00:00, 59.87it/s] 78%|███████▊  | 62/79 [00:01<00:00, 64.51it/s] 91%|█████████ | 72/79 [00:01<00:00, 72.72it/s]100%|██████████| 79/79 [00:01<00:00, 59.49it/s]
10000 images processed, 1.3518710136413574 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:14,  2.74it/s]  3%|▎         | 6/204 [00:00<00:12, 15.61it/s]  6%|▌         | 12/204 [00:00<00:06, 28.02it/s] 10%|█         | 21/204 [00:00<00:04, 45.54it/s] 15%|█▍        | 30/204 [00:00<00:02, 58.09it/s] 20%|█▉        | 40/204 [00:00<00:02, 68.52it/s] 24%|██▎       | 48/204 [00:01<00:02, 60.22it/s] 27%|██▋       | 55/204 [00:01<00:02, 56.04it/s] 32%|███▏      | 65/204 [00:01<00:02, 65.41it/s] 36%|███▋      | 74/204 [00:01<00:01, 71.46it/s] 41%|████      | 84/204 [00:01<00:01, 77.60it/s] 46%|████▌     | 94/204 [00:01<00:01, 82.22it/s] 50%|█████     | 103/204 [00:01<00:01, 65.96it/s] 54%|█████▍    | 111/204 [00:01<00:01, 64.09it/s] 59%|█████▉    | 120/204 [00:02<00:01, 70.08it/s] 64%|██████▎   | 130/204 [00:02<00:00, 75.61it/s] 69%|██████▊   | 140/204 [00:02<00:00, 80.42it/s] 73%|███████▎  | 149/204 [00:02<00:00, 68.07it/s] 77%|███████▋  | 157/204 [00:02<00:00, 62.32it/s] 82%|████████▏ | 167/204 [00:02<00:00, 69.60it/s] 87%|████████▋ | 177/204 [00:02<00:00, 75.26it/s] 92%|█████████▏| 187/204 [00:02<00:00, 79.49it/s] 96%|█████████▌| 196/204 [00:03<00:00, 69.85it/s]100%|██████████| 204/204 [00:03<00:00, 61.99it/s]100%|██████████| 204/204 [00:03<00:00, 62.09it/s]
26032 images processed, 3.3319668769836426 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:49,  1.57it/s] 11%|█▏        | 9/79 [00:00<00:04, 14.14it/s] 18%|█▊        | 14/79 [00:00<00:03, 20.31it/s] 24%|██▍       | 19/79 [00:01<00:02, 25.91it/s] 34%|███▍      | 27/79 [00:01<00:01, 33.05it/s] 41%|████      | 32/79 [00:01<00:01, 35.40it/s] 47%|████▋     | 37/79 [00:01<00:01, 37.67it/s] 54%|█████▍    | 43/79 [00:01<00:00, 39.11it/s] 61%|██████    | 48/79 [00:01<00:00, 40.23it/s] 67%|██████▋   | 53/79 [00:01<00:00, 41.73it/s] 75%|███████▍  | 59/79 [00:01<00:00, 41.35it/s] 81%|████████  | 64/79 [00:02<00:00, 41.70it/s] 87%|████████▋ | 69/79 [00:02<00:00, 42.78it/s] 95%|█████████▍| 75/79 [00:02<00:00, 43.34it/s]100%|██████████| 79/79 [00:02<00:00, 33.76it/s]
10000 images processed, 2.3760080337524414 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:29,  2.63it/s] 10%|█         | 8/79 [00:00<00:03, 20.56it/s] 23%|██▎       | 18/79 [00:00<00:01, 41.61it/s] 35%|███▌      | 28/79 [00:00<00:00, 55.78it/s] 48%|████▊     | 38/79 [00:00<00:00, 66.32it/s] 58%|█████▊    | 46/79 [00:01<00:00, 56.92it/s] 67%|██████▋   | 53/79 [00:01<00:00, 55.90it/s] 78%|███████▊  | 62/79 [00:01<00:00, 63.65it/s] 91%|█████████ | 72/79 [00:01<00:00, 71.89it/s]100%|██████████| 79/79 [00:01<00:00, 56.04it/s]
10000 images processed, 1.4432857036590576 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:19,  3.61it/s] 16%|█▌        | 11/70 [00:00<00:01, 34.94it/s] 26%|██▌       | 18/70 [00:00<00:01, 44.83it/s] 34%|███▍      | 24/70 [00:00<00:01, 44.71it/s] 43%|████▎     | 30/70 [00:00<00:00, 47.22it/s] 57%|█████▋    | 40/70 [00:00<00:00, 60.67it/s] 71%|███████▏  | 50/70 [00:00<00:00, 70.07it/s] 86%|████████▌ | 60/70 [00:01<00:00, 77.04it/s]100%|██████████| 70/70 [00:01<00:00, 79.72it/s]100%|██████████| 70/70 [00:01<00:00, 58.96it/s]
8925 images processed, 1.2210423946380615 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:00<00:37,  1.17it/s]  4%|▍         | 2/45 [00:01<00:22,  1.90it/s] 22%|██▏       | 10/45 [00:01<00:05,  6.87it/s] 40%|████      | 18/45 [00:02<00:02,  9.24it/s] 51%|█████     | 23/45 [00:02<00:01, 12.50it/s] 58%|█████▊    | 26/45 [00:02<00:01, 11.28it/s] 76%|███████▌  | 34/45 [00:03<00:00, 11.62it/s] 89%|████████▉ | 40/45 [00:03<00:00, 15.79it/s] 96%|█████████▌| 43/45 [00:04<00:00, 11.16it/s]100%|██████████| 45/45 [00:04<00:00, 10.30it/s]
5640 images processed, 4.396766424179077 seconds used

21.60494375228882
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.53  99.36
places365     67.87  81.18
LSUN          17.60  96.07
iSUN          72.36  81.68
dtd           37.87  91.39
AVG           39.65  89.93
Retain-Acc: 0.7406
Forget-as-OOD (retain known vs forget novel):
  FPR: 79.50 AUROC: 86.90 AUIN: 98.36
10.002740383148193
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e50-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid
epochs=50 | cache=6 | flambda=0.5 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e50-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e50-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e50-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl0.5-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21610432
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<01:59,  3.25it/s]  3%|▎         | 11/391 [00:00<00:11, 33.37it/s]  5%|▌         | 21/391 [00:00<00:07, 52.79it/s]  8%|▊         | 31/391 [00:00<00:05, 65.96it/s] 10%|█         | 41/391 [00:00<00:04, 74.72it/s] 13%|█▎        | 50/391 [00:00<00:04, 79.01it/s] 15%|█▌        | 60/391 [00:00<00:03, 83.21it/s] 18%|█▊        | 70/391 [00:01<00:03, 86.56it/s] 20%|██        | 80/391 [00:01<00:03, 88.92it/s] 23%|██▎       | 90/391 [00:01<00:03, 90.28it/s] 26%|██▌       | 100/391 [00:01<00:03, 91.33it/s] 28%|██▊       | 110/391 [00:01<00:03, 92.03it/s] 31%|███       | 120/391 [00:01<00:02, 92.33it/s] 33%|███▎      | 130/391 [00:01<00:02, 92.17it/s] 36%|███▌      | 140/391 [00:01<00:02, 92.82it/s] 38%|███▊      | 150/391 [00:01<00:02, 93.26it/s] 41%|████      | 160/391 [00:02<00:02, 93.65it/s] 43%|████▎     | 170/391 [00:02<00:02, 93.97it/s] 46%|████▌     | 180/391 [00:02<00:02, 94.23it/s] 49%|████▊     | 190/391 [00:02<00:02, 94.35it/s] 51%|█████     | 200/391 [00:02<00:02, 91.94it/s] 54%|█████▎    | 210/391 [00:02<00:01, 92.66it/s] 56%|█████▋    | 220/391 [00:02<00:01, 93.09it/s] 59%|█████▉    | 230/391 [00:02<00:01, 91.77it/s] 61%|██████▏   | 240/391 [00:02<00:01, 92.52it/s] 64%|██████▍   | 250/391 [00:02<00:01, 92.90it/s] 66%|██████▋   | 260/391 [00:03<00:01, 93.59it/s] 69%|██████▉   | 270/391 [00:03<00:01, 93.83it/s] 72%|███████▏  | 280/391 [00:03<00:01, 94.18it/s] 74%|███████▍  | 290/391 [00:03<00:01, 94.12it/s] 77%|███████▋  | 300/391 [00:03<00:00, 93.22it/s] 79%|███████▉  | 310/391 [00:03<00:00, 92.90it/s] 82%|████████▏ | 320/391 [00:03<00:00, 92.49it/s] 84%|████████▍ | 330/391 [00:03<00:00, 93.03it/s] 87%|████████▋ | 340/391 [00:03<00:00, 93.41it/s] 90%|████████▉ | 350/391 [00:04<00:00, 92.80it/s] 92%|█████████▏| 360/391 [00:04<00:00, 93.27it/s] 95%|█████████▍| 370/391 [00:04<00:00, 93.39it/s] 97%|█████████▋| 380/391 [00:04<00:00, 93.29it/s]100%|█████████▉| 390/391 [00:04<00:00, 94.27it/s]100%|██████████| 391/391 [00:04<00:00, 87.06it/s]
50000 images processed, 4.606600761413574 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:22,  3.54it/s] 14%|█▍        | 11/79 [00:00<00:01, 35.04it/s] 27%|██▋       | 21/79 [00:00<00:01, 54.04it/s] 39%|███▉      | 31/79 [00:00<00:00, 66.70it/s] 51%|█████     | 40/79 [00:00<00:00, 73.53it/s] 63%|██████▎   | 50/79 [00:00<00:00, 79.49it/s] 76%|███████▌  | 60/79 [00:00<00:00, 83.70it/s] 89%|████████▊ | 70/79 [00:01<00:00, 87.07it/s]100%|██████████| 79/79 [00:01<00:00, 70.06it/s]
10000 images processed, 1.1520025730133057 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<00:46,  4.35it/s]  4%|▍         | 8/204 [00:00<00:06, 28.42it/s]  9%|▉         | 18/204 [00:00<00:03, 51.36it/s] 14%|█▎        | 28/204 [00:00<00:02, 64.82it/s] 18%|█▊        | 37/204 [00:00<00:02, 72.39it/s] 23%|██▎       | 46/204 [00:00<00:02, 76.46it/s] 27%|██▋       | 56/204 [00:00<00:01, 81.37it/s] 32%|███▏      | 66/204 [00:00<00:01, 84.69it/s] 37%|███▋      | 76/204 [00:01<00:01, 86.94it/s] 42%|████▏     | 86/204 [00:01<00:01, 88.50it/s] 47%|████▋     | 95/204 [00:01<00:01, 88.33it/s] 51%|█████▏    | 105/204 [00:01<00:01, 89.52it/s] 56%|█████▋    | 115/204 [00:01<00:00, 90.10it/s] 61%|██████▏   | 125/204 [00:01<00:00, 90.52it/s] 66%|██████▌   | 135/204 [00:01<00:00, 88.87it/s] 71%|███████   | 144/204 [00:01<00:00, 88.82it/s] 75%|███████▌  | 153/204 [00:01<00:00, 88.97it/s] 80%|███████▉  | 163/204 [00:02<00:00, 90.41it/s] 85%|████████▍ | 173/204 [00:02<00:00, 90.84it/s] 90%|████████▉ | 183/204 [00:02<00:00, 90.97it/s] 95%|█████████▍| 193/204 [00:02<00:00, 91.38it/s]100%|█████████▉| 203/204 [00:02<00:00, 92.39it/s]100%|██████████| 204/204 [00:02<00:00, 81.51it/s]
26032 images processed, 2.54587721824646 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:39,  1.98it/s] 11%|█▏        | 9/79 [00:00<00:04, 17.49it/s] 22%|██▏       | 17/79 [00:00<00:02, 28.46it/s] 29%|██▉       | 23/79 [00:00<00:01, 35.03it/s] 35%|███▌      | 28/79 [00:01<00:01, 34.03it/s] 43%|████▎     | 34/79 [00:01<00:01, 39.72it/s] 49%|████▉     | 39/79 [00:01<00:00, 40.37it/s] 56%|█████▌    | 44/79 [00:01<00:00, 36.99it/s] 63%|██████▎   | 50/79 [00:01<00:00, 41.48it/s] 70%|██████▉   | 55/79 [00:01<00:00, 42.04it/s] 76%|███████▌  | 60/79 [00:01<00:00, 38.13it/s] 84%|████████▎ | 66/79 [00:01<00:00, 43.17it/s] 90%|████████▉ | 71/79 [00:02<00:00, 42.14it/s] 96%|█████████▌| 76/79 [00:02<00:00, 41.22it/s]100%|██████████| 79/79 [00:02<00:00, 35.77it/s]
10000 images processed, 2.2434921264648438 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:22,  3.54it/s] 13%|█▎        | 10/79 [00:00<00:02, 32.02it/s] 25%|██▌       | 20/79 [00:00<00:01, 52.33it/s] 38%|███▊      | 30/79 [00:00<00:00, 65.35it/s] 51%|█████     | 40/79 [00:00<00:00, 74.00it/s] 63%|██████▎   | 50/79 [00:00<00:00, 79.82it/s] 76%|███████▌  | 60/79 [00:00<00:00, 83.98it/s] 89%|████████▊ | 70/79 [00:01<00:00, 87.02it/s]100%|██████████| 79/79 [00:01<00:00, 70.44it/s]
10000 images processed, 1.1427311897277832 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:24,  2.81it/s] 16%|█▌        | 11/70 [00:00<00:01, 29.95it/s] 29%|██▊       | 20/70 [00:00<00:01, 46.85it/s] 43%|████▎     | 30/70 [00:00<00:00, 60.84it/s] 57%|█████▋    | 40/70 [00:00<00:00, 70.46it/s] 70%|███████   | 49/70 [00:00<00:00, 75.23it/s] 84%|████████▍ | 59/70 [00:00<00:00, 80.68it/s] 99%|█████████▊| 69/70 [00:01<00:00, 84.89it/s]100%|██████████| 70/70 [00:01<00:00, 62.92it/s]
8925 images processed, 1.143341064453125 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:00<00:38,  1.14it/s]  4%|▍         | 2/45 [00:00<00:18,  2.33it/s] 20%|██        | 9/45 [00:01<00:03,  9.69it/s] 24%|██▍       | 11/45 [00:01<00:03,  9.35it/s] 31%|███       | 14/45 [00:01<00:02, 12.00it/s] 38%|███▊      | 17/45 [00:01<00:02, 13.73it/s] 42%|████▏     | 19/45 [00:02<00:02, 11.79it/s] 49%|████▉     | 22/45 [00:02<00:01, 13.48it/s] 58%|█████▊    | 26/45 [00:02<00:01, 11.66it/s] 67%|██████▋   | 30/45 [00:02<00:01, 14.20it/s] 73%|███████▎  | 33/45 [00:03<00:00, 14.56it/s] 78%|███████▊  | 35/45 [00:03<00:00, 10.37it/s] 89%|████████▉ | 40/45 [00:03<00:00, 15.38it/s] 96%|█████████▌| 43/45 [00:04<00:00,  9.42it/s]100%|██████████| 45/45 [00:04<00:00, 10.62it/s]
5640 images processed, 4.258689641952515 seconds used

18.814807415008545
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.53  99.36
places365     67.87  81.18
LSUN          17.60  96.07
iSUN          72.36  81.68
dtd           37.87  91.39
AVG           39.65  89.93
Retain-Acc: 0.7406
Forget-as-OOD (retain known vs forget novel):
  FPR: 79.50 AUROC: 86.90 AUIN: 98.36
10.819339513778687
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid
epochs=5 | cache=6 | flambda=0.2 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21610432
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<01:52,  3.48it/s]  3%|▎         | 11/391 [00:00<00:10, 34.87it/s]  5%|▍         | 19/391 [00:00<00:07, 49.16it/s]  7%|▋         | 29/391 [00:00<00:05, 63.70it/s] 10%|▉         | 39/391 [00:00<00:04, 73.24it/s] 13%|█▎        | 49/391 [00:00<00:04, 79.93it/s] 15%|█▌        | 59/391 [00:00<00:03, 84.47it/s] 18%|█▊        | 69/391 [00:01<00:03, 86.84it/s] 20%|██        | 79/391 [00:01<00:03, 89.07it/s] 23%|██▎       | 89/391 [00:01<00:03, 89.74it/s] 25%|██▌       | 99/391 [00:01<00:03, 91.56it/s] 28%|██▊       | 109/391 [00:01<00:03, 92.86it/s] 30%|███       | 119/391 [00:01<00:02, 93.34it/s] 33%|███▎      | 129/391 [00:01<00:02, 93.74it/s] 36%|███▌      | 139/391 [00:01<00:02, 91.58it/s] 38%|███▊      | 149/391 [00:01<00:02, 92.80it/s] 41%|████      | 159/391 [00:01<00:02, 93.43it/s] 43%|████▎     | 169/391 [00:02<00:02, 93.75it/s] 46%|████▌     | 179/391 [00:02<00:02, 93.72it/s] 48%|████▊     | 189/391 [00:02<00:02, 93.62it/s] 51%|█████     | 199/391 [00:02<00:02, 90.63it/s] 53%|█████▎    | 209/391 [00:02<00:02, 89.93it/s] 56%|█████▌    | 219/391 [00:02<00:01, 90.16it/s] 59%|█████▊    | 229/391 [00:02<00:01, 90.28it/s] 61%|██████    | 239/391 [00:02<00:01, 90.85it/s] 64%|██████▎   | 249/391 [00:02<00:01, 91.14it/s] 66%|██████▌   | 259/391 [00:03<00:01, 91.71it/s] 69%|██████▉   | 269/391 [00:03<00:01, 92.09it/s] 71%|███████▏  | 279/391 [00:03<00:01, 92.39it/s] 74%|███████▍  | 289/391 [00:03<00:01, 91.76it/s] 76%|███████▋  | 299/391 [00:03<00:00, 92.04it/s] 79%|███████▉  | 309/391 [00:03<00:00, 92.27it/s] 82%|████████▏ | 319/391 [00:03<00:00, 92.88it/s] 84%|████████▍ | 329/391 [00:03<00:00, 92.56it/s] 87%|████████▋ | 339/391 [00:03<00:00, 92.55it/s] 89%|████████▉ | 349/391 [00:04<00:00, 92.56it/s] 92%|█████████▏| 359/391 [00:04<00:00, 93.57it/s] 94%|█████████▍| 369/391 [00:04<00:00, 93.23it/s] 97%|█████████▋| 379/391 [00:04<00:00, 92.49it/s] 99%|█████████▉| 389/391 [00:04<00:00, 93.68it/s]100%|██████████| 391/391 [00:04<00:00, 86.65it/s]
50000 images processed, 4.640310287475586 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:25,  3.03it/s] 14%|█▍        | 11/79 [00:00<00:02, 31.67it/s] 27%|██▋       | 21/79 [00:00<00:01, 51.12it/s] 39%|███▉      | 31/79 [00:00<00:00, 63.92it/s] 52%|█████▏    | 41/79 [00:00<00:00, 72.80it/s] 65%|██████▍   | 51/79 [00:00<00:00, 78.99it/s] 77%|███████▋  | 61/79 [00:00<00:00, 82.65it/s] 90%|████████▉ | 71/79 [00:01<00:00, 86.37it/s]100%|██████████| 79/79 [00:01<00:00, 67.50it/s]
10000 images processed, 1.1935391426086426 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<00:54,  3.73it/s]  5%|▌         | 11/204 [00:00<00:05, 35.97it/s] 10%|▉         | 20/204 [00:00<00:03, 53.41it/s] 15%|█▍        | 30/204 [00:00<00:02, 66.87it/s] 19%|█▉        | 39/204 [00:00<00:02, 73.92it/s] 24%|██▍       | 49/204 [00:00<00:01, 80.47it/s] 29%|██▉       | 59/204 [00:00<00:01, 84.06it/s] 34%|███▍      | 69/204 [00:01<00:01, 87.07it/s] 39%|███▊      | 79/204 [00:01<00:01, 89.04it/s] 44%|████▎     | 89/204 [00:01<00:01, 89.43it/s] 49%|████▊     | 99/204 [00:01<00:01, 90.01it/s] 53%|█████▎    | 109/204 [00:01<00:01, 90.53it/s] 58%|█████▊    | 119/204 [00:01<00:00, 90.94it/s] 63%|██████▎   | 129/204 [00:01<00:00, 90.95it/s] 68%|██████▊   | 139/204 [00:01<00:00, 91.40it/s] 73%|███████▎  | 149/204 [00:01<00:00, 91.66it/s] 78%|███████▊  | 159/204 [00:01<00:00, 92.03it/s] 83%|████████▎ | 169/204 [00:02<00:00, 92.95it/s] 88%|████████▊ | 179/204 [00:02<00:00, 92.34it/s] 93%|█████████▎| 189/204 [00:02<00:00, 92.61it/s] 98%|█████████▊| 199/204 [00:02<00:00, 93.33it/s]100%|██████████| 204/204 [00:02<00:00, 82.69it/s]
26032 images processed, 2.507596731185913 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:41,  1.89it/s] 11%|█▏        | 9/79 [00:00<00:04, 16.32it/s] 22%|██▏       | 17/79 [00:00<00:02, 24.53it/s] 32%|███▏      | 25/79 [00:01<00:01, 29.64it/s] 42%|████▏     | 33/79 [00:01<00:01, 32.49it/s] 52%|█████▏    | 41/79 [00:01<00:01, 37.39it/s] 62%|██████▏   | 49/79 [00:01<00:00, 40.27it/s] 72%|███████▏  | 57/79 [00:01<00:00, 42.40it/s] 78%|███████▊  | 62/79 [00:01<00:00, 42.79it/s] 85%|████████▍ | 67/79 [00:02<00:00, 40.90it/s] 95%|█████████▍| 75/79 [00:02<00:00, 41.44it/s]100%|██████████| 79/79 [00:02<00:00, 34.75it/s]
10000 images processed, 2.3138697147369385 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:22,  3.53it/s] 14%|█▍        | 11/79 [00:00<00:01, 35.08it/s] 27%|██▋       | 21/79 [00:00<00:01, 54.26it/s] 39%|███▉      | 31/79 [00:00<00:00, 66.86it/s] 52%|█████▏    | 41/79 [00:00<00:00, 75.06it/s] 65%|██████▍   | 51/79 [00:00<00:00, 80.50it/s] 77%|███████▋  | 61/79 [00:00<00:00, 84.11it/s] 90%|████████▉ | 71/79 [00:01<00:00, 87.16it/s]100%|██████████| 79/79 [00:01<00:00, 70.96it/s]
10000 images processed, 1.1352856159210205 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:21,  3.14it/s] 16%|█▌        | 11/70 [00:00<00:01, 32.11it/s] 30%|███       | 21/70 [00:00<00:00, 51.50it/s] 44%|████▍     | 31/70 [00:00<00:00, 64.50it/s] 59%|█████▊    | 41/70 [00:00<00:00, 73.36it/s] 71%|███████▏  | 50/70 [00:00<00:00, 77.40it/s] 86%|████████▌ | 60/70 [00:00<00:00, 82.15it/s]100%|██████████| 70/70 [00:01<00:00, 84.95it/s]100%|██████████| 70/70 [00:01<00:00, 65.39it/s]
8925 images processed, 1.1040596961975098 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:01<00:44,  1.01s/it] 16%|█▌        | 7/45 [00:01<00:04,  7.93it/s] 22%|██▏       | 10/45 [00:01<00:04,  8.00it/s] 31%|███       | 14/45 [00:01<00:02, 10.46it/s] 38%|███▊      | 17/45 [00:02<00:02,  9.39it/s] 49%|████▉     | 22/45 [00:02<00:01, 12.74it/s] 56%|█████▌    | 25/45 [00:02<00:01, 11.04it/s] 67%|██████▋   | 30/45 [00:02<00:01, 13.90it/s] 73%|███████▎  | 33/45 [00:03<00:01,  9.72it/s] 91%|█████████ | 41/45 [00:04<00:00, 11.56it/s]100%|██████████| 45/45 [00:04<00:00, 10.96it/s]
5640 images processed, 4.130263090133667 seconds used

18.70083475112915
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.53  99.36
places365     67.87  81.18
LSUN          17.60  96.07
iSUN          72.36  81.68
dtd           37.87  91.39
AVG           39.65  89.93
Retain-Acc: 0.7406
Forget-as-OOD (retain known vs forget novel):
  FPR: 79.50 AUROC: 86.90 AUIN: 98.36
11.069867134094238
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e10-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid
epochs=10 | cache=6 | flambda=0.2 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e10-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e10-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e10-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21610432
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<02:00,  3.25it/s]  3%|▎         | 10/391 [00:00<00:12, 29.62it/s]  4%|▍         | 15/391 [00:00<00:10, 35.37it/s]  5%|▌         | 21/391 [00:00<00:09, 40.46it/s]  7%|▋         | 28/391 [00:00<00:07, 48.56it/s]  9%|▉         | 37/391 [00:00<00:05, 59.95it/s] 12%|█▏        | 47/391 [00:00<00:04, 70.06it/s] 14%|█▍        | 56/391 [00:01<00:04, 74.90it/s] 16%|█▋        | 64/391 [00:01<00:05, 64.07it/s] 18%|█▊        | 71/391 [00:01<00:05, 60.12it/s] 21%|██        | 81/391 [00:01<00:04, 69.37it/s] 23%|██▎       | 91/391 [00:01<00:03, 76.49it/s] 26%|██▌       | 101/391 [00:01<00:03, 81.92it/s] 28%|██▊       | 111/391 [00:01<00:03, 85.85it/s] 31%|███       | 120/391 [00:01<00:03, 75.73it/s] 33%|███▎      | 128/391 [00:02<00:03, 66.41it/s] 35%|███▍      | 136/391 [00:02<00:03, 69.42it/s] 37%|███▋      | 145/391 [00:02<00:03, 74.68it/s] 40%|███▉      | 155/391 [00:02<00:02, 80.23it/s] 42%|████▏     | 165/391 [00:02<00:02, 84.66it/s] 45%|████▍     | 174/391 [00:02<00:02, 72.58it/s] 47%|████▋     | 182/391 [00:02<00:03, 64.73it/s] 49%|████▉     | 191/391 [00:02<00:02, 69.52it/s] 51%|█████     | 200/391 [00:03<00:02, 73.54it/s] 53%|█████▎    | 209/391 [00:03<00:02, 76.66it/s] 55%|█████▌    | 217/391 [00:03<00:02, 64.16it/s] 57%|█████▋    | 224/391 [00:03<00:02, 59.86it/s] 60%|█████▉    | 233/391 [00:03<00:02, 66.70it/s] 62%|██████▏   | 242/391 [00:03<00:02, 70.72it/s] 64%|██████▍   | 250/391 [00:03<00:02, 67.12it/s] 66%|██████▌   | 257/391 [00:03<00:02, 61.06it/s] 68%|██████▊   | 264/391 [00:04<00:02, 60.69it/s] 70%|██████▉   | 273/391 [00:04<00:01, 65.31it/s] 72%|███████▏  | 280/391 [00:04<00:01, 66.34it/s] 73%|███████▎  | 287/391 [00:04<00:01, 59.11it/s] 75%|███████▌  | 294/391 [00:04<00:01, 57.30it/s] 77%|███████▋  | 303/391 [00:04<00:01, 63.94it/s] 80%|███████▉  | 312/391 [00:04<00:01, 69.17it/s] 82%|████████▏ | 320/391 [00:04<00:01, 60.68it/s] 84%|████████▎ | 327/391 [00:05<00:01, 56.83it/s] 86%|████████▌ | 336/391 [00:05<00:00, 62.69it/s] 88%|████████▊ | 345/391 [00:05<00:00, 68.27it/s] 90%|█████████ | 353/391 [00:05<00:00, 64.16it/s] 92%|█████████▏| 360/391 [00:05<00:00, 59.67it/s] 94%|█████████▍| 367/391 [00:05<00:00, 61.92it/s] 96%|█████████▌| 376/391 [00:05<00:00, 68.98it/s] 99%|█████████▊| 386/391 [00:05<00:00, 76.74it/s]100%|██████████| 391/391 [00:05<00:00, 65.39it/s]
50000 images processed, 6.095224380493164 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:31,  2.51it/s]  9%|▉         | 7/79 [00:00<00:04, 16.85it/s] 20%|██        | 16/79 [00:00<00:01, 35.34it/s] 33%|███▎      | 26/79 [00:00<00:01, 51.45it/s] 46%|████▌     | 36/79 [00:00<00:00, 63.54it/s] 56%|█████▌    | 44/79 [00:00<00:00, 66.10it/s] 66%|██████▌   | 52/79 [00:01<00:00, 59.55it/s] 75%|███████▍  | 59/79 [00:01<00:00, 58.54it/s] 87%|████████▋ | 69/79 [00:01<00:00, 67.90it/s]100%|██████████| 79/79 [00:01<00:00, 73.74it/s]100%|██████████| 79/79 [00:01<00:00, 54.06it/s]
10000 images processed, 1.4990229606628418 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:18,  2.59it/s]  3%|▎         | 6/204 [00:00<00:13, 15.12it/s]  7%|▋         | 15/204 [00:00<00:05, 35.27it/s] 12%|█▏        | 24/204 [00:00<00:03, 50.32it/s] 17%|█▋        | 34/204 [00:00<00:02, 62.99it/s] 21%|██        | 42/204 [00:00<00:02, 56.82it/s] 24%|██▍       | 49/204 [00:01<00:02, 53.72it/s] 29%|██▉       | 59/204 [00:01<00:02, 63.74it/s] 33%|███▎      | 68/204 [00:01<00:01, 70.10it/s] 38%|███▊      | 78/204 [00:01<00:01, 76.44it/s] 43%|████▎     | 87/204 [00:01<00:01, 63.82it/s] 47%|████▋     | 95/204 [00:01<00:01, 61.41it/s] 51%|█████▏    | 105/204 [00:01<00:01, 68.98it/s] 56%|█████▋    | 115/204 [00:01<00:01, 74.82it/s] 61%|██████▏   | 125/204 [00:02<00:00, 79.79it/s] 66%|██████▌   | 134/204 [00:02<00:00, 70.01it/s] 70%|██████▉   | 142/204 [00:02<00:00, 62.15it/s] 75%|███████▍  | 152/204 [00:02<00:00, 69.23it/s] 79%|███████▉  | 161/204 [00:02<00:00, 73.51it/s] 83%|████████▎ | 170/204 [00:02<00:00, 75.80it/s] 87%|████████▋ | 178/204 [00:02<00:00, 63.48it/s] 91%|█████████ | 185/204 [00:03<00:00, 61.55it/s] 96%|█████████▌| 195/204 [00:03<00:00, 69.83it/s]100%|██████████| 204/204 [00:03<00:00, 62.36it/s]
26032 images processed, 3.3154218196868896 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:37,  2.08it/s]  8%|▊         | 6/79 [00:00<00:05, 12.63it/s] 14%|█▍        | 11/79 [00:00<00:03, 21.40it/s] 27%|██▋       | 21/79 [00:00<00:01, 37.47it/s] 33%|███▎      | 26/79 [00:00<00:01, 39.40it/s] 39%|███▉      | 31/79 [00:01<00:01, 38.62it/s] 47%|████▋     | 37/79 [00:01<00:01, 38.57it/s] 53%|█████▎    | 42/79 [00:01<00:00, 39.83it/s] 59%|█████▉    | 47/79 [00:01<00:00, 41.00it/s] 67%|██████▋   | 53/79 [00:01<00:00, 38.22it/s] 73%|███████▎  | 58/79 [00:01<00:00, 40.88it/s] 80%|███████▉  | 63/79 [00:01<00:00, 42.58it/s] 87%|████████▋ | 69/79 [00:02<00:00, 38.22it/s] 94%|█████████▎| 74/79 [00:02<00:00, 40.29it/s]100%|██████████| 79/79 [00:02<00:00, 35.23it/s]
10000 images processed, 2.276172637939453 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:27,  2.85it/s]  8%|▊         | 6/79 [00:00<00:04, 16.02it/s] 18%|█▊        | 14/79 [00:00<00:01, 34.23it/s] 30%|███       | 24/79 [00:00<00:01, 52.18it/s] 43%|████▎     | 34/79 [00:00<00:00, 64.43it/s] 54%|█████▍    | 43/79 [00:00<00:00, 67.70it/s] 65%|██████▍   | 51/79 [00:01<00:00, 58.37it/s] 73%|███████▎  | 58/79 [00:01<00:00, 59.64it/s] 86%|████████▌ | 68/79 [00:01<00:00, 69.03it/s] 99%|█████████▊| 78/79 [00:01<00:00, 76.26it/s]100%|██████████| 79/79 [00:01<00:00, 56.39it/s]
10000 images processed, 1.421689510345459 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:29,  2.33it/s]  9%|▊         | 6/70 [00:00<00:04, 13.97it/s] 20%|██        | 14/70 [00:00<00:01, 30.97it/s] 34%|███▍      | 24/70 [00:00<00:00, 48.66it/s] 49%|████▊     | 34/70 [00:00<00:00, 61.53it/s] 63%|██████▎   | 44/70 [00:00<00:00, 70.73it/s] 76%|███████▌  | 53/70 [00:01<00:00, 59.43it/s] 87%|████████▋ | 61/70 [00:01<00:00, 59.45it/s]100%|██████████| 70/70 [00:01<00:00, 50.24it/s]
8925 images processed, 1.4253997802734375 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:01<00:45,  1.04s/it] 13%|█▎        | 6/45 [00:01<00:05,  6.83it/s] 20%|██        | 9/45 [00:01<00:04,  7.33it/s] 24%|██▍       | 11/45 [00:01<00:03,  8.90it/s] 33%|███▎      | 15/45 [00:01<00:02, 13.60it/s] 40%|████      | 18/45 [00:02<00:02, 11.37it/s] 47%|████▋     | 21/45 [00:02<00:02, 11.52it/s] 56%|█████▌    | 25/45 [00:02<00:01, 13.25it/s] 62%|██████▏   | 28/45 [00:02<00:01, 15.39it/s] 67%|██████▋   | 30/45 [00:02<00:01, 13.16it/s] 73%|███████▎  | 33/45 [00:03<00:01, 10.53it/s] 84%|████████▍ | 38/45 [00:03<00:00, 15.45it/s] 91%|█████████ | 41/45 [00:03<00:00, 11.88it/s] 96%|█████████▌| 43/45 [00:04<00:00, 10.56it/s]100%|██████████| 45/45 [00:04<00:00, 10.81it/s]
5640 images processed, 4.1844282150268555 seconds used

21.997270584106445
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.53  99.36
places365     67.87  81.18
LSUN          17.60  96.07
iSUN          72.36  81.68
dtd           37.87  91.39
AVG           39.65  89.93
Retain-Acc: 0.7406
Forget-as-OOD (retain known vs forget novel):
  FPR: 79.50 AUROC: 86.90 AUIN: 98.36
10.193323850631714
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e20-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid
epochs=20 | cache=6 | flambda=0.2 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e20-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e20-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e20-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21610432
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<02:55,  2.23it/s]  3%|▎         | 11/391 [00:00<00:14, 25.46it/s]  5%|▌         | 21/391 [00:00<00:08, 43.68it/s]  8%|▊         | 31/391 [00:00<00:06, 57.67it/s] 10%|█         | 41/391 [00:00<00:05, 68.26it/s] 13%|█▎        | 51/391 [00:00<00:04, 75.87it/s] 16%|█▌        | 61/391 [00:01<00:04, 80.88it/s] 18%|█▊        | 71/391 [00:01<00:03, 83.74it/s] 21%|██        | 81/391 [00:01<00:03, 86.77it/s] 23%|██▎       | 91/391 [00:01<00:03, 88.29it/s] 26%|██▌       | 101/391 [00:01<00:03, 89.94it/s] 28%|██▊       | 111/391 [00:01<00:03, 91.37it/s] 31%|███       | 121/391 [00:01<00:02, 92.32it/s] 34%|███▎      | 131/391 [00:01<00:02, 92.86it/s] 36%|███▌      | 141/391 [00:01<00:02, 92.13it/s] 39%|███▊      | 151/391 [00:02<00:02, 92.51it/s] 41%|████      | 161/391 [00:02<00:02, 90.53it/s] 44%|████▎     | 171/391 [00:02<00:02, 91.65it/s] 46%|████▋     | 181/391 [00:02<00:02, 93.03it/s] 49%|████▉     | 191/391 [00:02<00:02, 92.09it/s] 51%|█████▏    | 201/391 [00:02<00:02, 92.74it/s] 54%|█████▍    | 211/391 [00:02<00:01, 93.46it/s] 57%|█████▋    | 221/391 [00:02<00:01, 93.60it/s] 59%|█████▉    | 231/391 [00:02<00:01, 93.92it/s] 62%|██████▏   | 241/391 [00:03<00:01, 94.00it/s] 64%|██████▍   | 251/391 [00:03<00:01, 93.55it/s] 67%|██████▋   | 261/391 [00:03<00:01, 93.41it/s] 69%|██████▉   | 271/391 [00:03<00:01, 93.83it/s] 72%|███████▏  | 281/391 [00:03<00:01, 93.26it/s] 74%|███████▍  | 291/391 [00:03<00:01, 93.47it/s] 77%|███████▋  | 301/391 [00:03<00:00, 93.91it/s] 80%|███████▉  | 311/391 [00:03<00:00, 93.94it/s] 82%|████████▏ | 321/391 [00:03<00:00, 92.19it/s] 85%|████████▍ | 331/391 [00:03<00:00, 93.03it/s] 87%|████████▋ | 341/391 [00:04<00:00, 93.42it/s] 90%|████████▉ | 351/391 [00:04<00:00, 93.73it/s] 92%|█████████▏| 361/391 [00:04<00:00, 93.53it/s] 95%|█████████▍| 371/391 [00:04<00:00, 93.06it/s] 97%|█████████▋| 381/391 [00:04<00:00, 93.52it/s]100%|██████████| 391/391 [00:04<00:00, 92.95it/s]100%|██████████| 391/391 [00:04<00:00, 84.49it/s]
50000 images processed, 4.7076921463012695 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:22,  3.44it/s] 14%|█▍        | 11/79 [00:00<00:01, 34.51it/s] 27%|██▋       | 21/79 [00:00<00:01, 54.08it/s] 39%|███▉      | 31/79 [00:00<00:00, 66.56it/s] 52%|█████▏    | 41/79 [00:00<00:00, 74.77it/s] 63%|██████▎   | 50/79 [00:00<00:00, 78.37it/s] 76%|███████▌  | 60/79 [00:00<00:00, 82.58it/s] 89%|████████▊ | 70/79 [00:01<00:00, 86.07it/s]100%|██████████| 79/79 [00:01<00:00, 87.18it/s]100%|██████████| 79/79 [00:01<00:00, 69.36it/s]
10000 images processed, 1.1621477603912354 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:36,  2.11it/s]  5%|▌         | 11/204 [00:00<00:07, 24.29it/s] 10%|█         | 21/204 [00:00<00:04, 41.81it/s] 15%|█▍        | 30/204 [00:00<00:03, 51.85it/s] 19%|█▉        | 39/204 [00:00<00:02, 61.08it/s] 24%|██▍       | 49/204 [00:01<00:02, 70.12it/s] 29%|██▉       | 59/204 [00:01<00:01, 76.52it/s] 34%|███▍      | 69/204 [00:01<00:01, 81.26it/s] 39%|███▊      | 79/204 [00:01<00:01, 84.28it/s] 44%|████▎     | 89/204 [00:01<00:01, 86.71it/s] 49%|████▊     | 99/204 [00:01<00:01, 88.52it/s] 53%|█████▎    | 109/204 [00:01<00:01, 90.34it/s] 58%|█████▊    | 119/204 [00:01<00:00, 89.33it/s] 63%|██████▎   | 129/204 [00:01<00:00, 89.89it/s] 68%|██████▊   | 139/204 [00:02<00:00, 90.55it/s] 73%|███████▎  | 149/204 [00:02<00:00, 90.92it/s] 78%|███████▊  | 159/204 [00:02<00:00, 90.68it/s] 83%|████████▎ | 169/204 [00:02<00:00, 91.15it/s] 88%|████████▊ | 179/204 [00:02<00:00, 91.32it/s] 93%|█████████▎| 189/204 [00:02<00:00, 91.73it/s] 98%|█████████▊| 199/204 [00:02<00:00, 92.65it/s]100%|██████████| 204/204 [00:02<00:00, 75.36it/s]
26032 images processed, 2.7536749839782715 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:43,  1.79it/s] 11%|█▏        | 9/79 [00:00<00:04, 15.29it/s] 22%|██▏       | 17/79 [00:00<00:02, 25.05it/s] 32%|███▏      | 25/79 [00:01<00:01, 32.91it/s] 39%|███▉      | 31/79 [00:01<00:01, 38.13it/s] 47%|████▋     | 37/79 [00:01<00:01, 36.16it/s] 57%|█████▋    | 45/79 [00:01<00:00, 36.95it/s] 67%|██████▋   | 53/79 [00:01<00:00, 37.73it/s] 77%|███████▋  | 61/79 [00:01<00:00, 37.97it/s] 87%|████████▋ | 69/79 [00:02<00:00, 38.73it/s] 97%|█████████▋| 77/79 [00:02<00:00, 43.43it/s]100%|██████████| 79/79 [00:02<00:00, 34.22it/s]
10000 images processed, 2.345160484313965 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:35,  2.17it/s] 15%|█▌        | 12/79 [00:00<00:02, 27.09it/s] 29%|██▉       | 23/79 [00:00<00:01, 46.63it/s] 41%|████      | 32/79 [00:00<00:00, 57.76it/s] 54%|█████▍    | 43/79 [00:00<00:00, 70.12it/s] 68%|██████▊   | 54/79 [00:00<00:00, 79.14it/s] 82%|████████▏ | 65/79 [00:01<00:00, 85.82it/s] 95%|█████████▍| 75/79 [00:01<00:00, 78.45it/s]100%|██████████| 79/79 [00:01<00:00, 61.20it/s]
10000 images processed, 1.3168444633483887 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:30,  2.25it/s]  9%|▊         | 6/70 [00:00<00:04, 13.55it/s] 19%|█▊        | 13/70 [00:00<00:02, 27.54it/s] 33%|███▎      | 23/70 [00:00<00:01, 45.84it/s] 47%|████▋     | 33/70 [00:00<00:00, 59.46it/s] 61%|██████▏   | 43/70 [00:00<00:00, 69.27it/s] 76%|███████▌  | 53/70 [00:01<00:00, 75.89it/s] 89%|████████▊ | 62/70 [00:01<00:00, 62.36it/s]100%|██████████| 70/70 [00:01<00:00, 61.13it/s]100%|██████████| 70/70 [00:01<00:00, 49.10it/s]
8925 images processed, 1.4586982727050781 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:01<00:45,  1.04s/it]  4%|▍         | 2/45 [00:01<00:21,  2.01it/s] 16%|█▌        | 7/45 [00:01<00:04,  8.82it/s] 22%|██▏       | 10/45 [00:01<00:04,  7.50it/s] 38%|███▊      | 17/45 [00:02<00:02, 10.23it/s] 44%|████▍     | 20/45 [00:02<00:02, 12.12it/s] 53%|█████▎    | 24/45 [00:02<00:01, 15.34it/s] 60%|██████    | 27/45 [00:02<00:01, 11.41it/s] 71%|███████   | 32/45 [00:03<00:00, 16.05it/s] 78%|███████▊  | 35/45 [00:03<00:01,  9.69it/s] 89%|████████▉ | 40/45 [00:03<00:00, 13.68it/s] 96%|█████████▌| 43/45 [00:04<00:00, 11.51it/s]100%|██████████| 45/45 [00:04<00:00, 10.52it/s]
5640 images processed, 4.303831338882446 seconds used

19.855987787246704
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.53  99.36
places365     67.87  81.18
LSUN          17.60  96.07
iSUN          72.36  81.68
dtd           37.87  91.39
AVG           39.65  89.93
Retain-Acc: 0.7406
Forget-as-OOD (retain known vs forget novel):
  FPR: 79.50 AUROC: 86.90 AUIN: 98.36
9.885947227478027
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e50-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid
epochs=50 | cache=6 | flambda=0.2 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e50-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e50-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e50-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21610432
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<02:23,  2.71it/s]  2%|▏         | 8/391 [00:00<00:17, 21.29it/s]  5%|▍         | 18/391 [00:00<00:08, 42.87it/s]  7%|▋         | 28/391 [00:00<00:06, 57.36it/s] 10%|▉         | 38/391 [00:00<00:05, 68.45it/s] 12%|█▏        | 47/391 [00:00<00:04, 73.70it/s] 14%|█▍        | 56/391 [00:01<00:05, 62.71it/s] 16%|█▋        | 64/391 [00:01<00:05, 61.66it/s] 19%|█▉        | 74/391 [00:01<00:04, 70.06it/s] 21%|██▏       | 84/391 [00:01<00:03, 76.76it/s] 24%|██▍       | 94/391 [00:01<00:03, 80.95it/s] 27%|██▋       | 104/391 [00:01<00:03, 84.81it/s] 29%|██▉       | 113/391 [00:01<00:03, 71.25it/s] 31%|███       | 121/391 [00:01<00:04, 64.57it/s] 33%|███▎      | 130/391 [00:02<00:03, 70.49it/s] 36%|███▌      | 140/391 [00:02<00:03, 76.83it/s] 38%|███▊      | 150/391 [00:02<00:02, 81.72it/s] 41%|████      | 160/391 [00:02<00:02, 85.17it/s] 43%|████▎     | 169/391 [00:02<00:03, 71.56it/s] 45%|████▌     | 177/391 [00:02<00:03, 64.79it/s] 48%|████▊     | 187/391 [00:02<00:02, 71.97it/s] 50%|█████     | 197/391 [00:02<00:02, 77.46it/s] 53%|█████▎    | 207/391 [00:03<00:02, 81.15it/s] 55%|█████▌    | 216/391 [00:03<00:02, 79.20it/s] 58%|█████▊    | 225/391 [00:03<00:02, 67.57it/s] 60%|█████▉    | 233/391 [00:03<00:02, 65.58it/s] 62%|██████▏   | 243/391 [00:03<00:02, 72.37it/s] 65%|██████▍   | 253/391 [00:03<00:01, 77.92it/s] 67%|██████▋   | 263/391 [00:03<00:01, 82.38it/s] 70%|██████▉   | 272/391 [00:03<00:01, 83.72it/s] 72%|███████▏  | 281/391 [00:04<00:01, 68.85it/s] 74%|███████▍  | 289/391 [00:04<00:01, 65.95it/s] 76%|███████▋  | 299/391 [00:04<00:01, 73.34it/s] 79%|███████▉  | 309/391 [00:04<00:01, 78.99it/s] 82%|████████▏ | 319/391 [00:04<00:00, 83.53it/s] 84%|████████▍ | 329/391 [00:04<00:00, 86.63it/s] 86%|████████▋ | 338/391 [00:04<00:00, 74.95it/s] 88%|████████▊ | 346/391 [00:04<00:00, 67.16it/s] 91%|█████████ | 354/391 [00:05<00:00, 70.02it/s] 93%|█████████▎| 364/391 [00:05<00:00, 74.80it/s] 96%|█████████▌| 374/391 [00:05<00:00, 80.00it/s] 98%|█████████▊| 384/391 [00:05<00:00, 84.11it/s]100%|██████████| 391/391 [00:05<00:00, 70.85it/s]
50000 images processed, 5.633727788925171 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:24,  3.19it/s]  8%|▊         | 6/79 [00:00<00:04, 17.64it/s] 14%|█▍        | 11/79 [00:00<00:02, 27.56it/s] 25%|██▌       | 20/79 [00:00<00:01, 45.42it/s] 38%|███▊      | 30/79 [00:00<00:00, 60.21it/s] 51%|█████     | 40/79 [00:00<00:00, 70.59it/s] 61%|██████    | 48/79 [00:00<00:00, 70.19it/s] 71%|███████   | 56/79 [00:01<00:00, 61.91it/s] 81%|████████  | 64/79 [00:01<00:00, 65.01it/s] 94%|█████████▎| 74/79 [00:01<00:00, 73.41it/s]100%|██████████| 79/79 [00:01<00:00, 56.71it/s]
10000 images processed, 1.4147143363952637 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:13,  2.77it/s]  6%|▌         | 12/204 [00:00<00:05, 32.37it/s] 11%|█▏        | 23/204 [00:00<00:03, 53.20it/s] 16%|█▌        | 32/204 [00:00<00:02, 63.51it/s] 20%|██        | 41/204 [00:00<00:02, 70.81it/s] 25%|██▌       | 51/204 [00:00<00:01, 77.57it/s] 30%|██▉       | 61/204 [00:00<00:01, 82.13it/s] 35%|███▍      | 71/204 [00:01<00:01, 86.54it/s] 40%|████      | 82/204 [00:01<00:01, 91.47it/s] 45%|████▌     | 92/204 [00:01<00:01, 90.57it/s] 50%|█████     | 103/204 [00:01<00:01, 94.07it/s] 56%|█████▌    | 114/204 [00:01<00:00, 96.58it/s] 61%|██████▏   | 125/204 [00:01<00:00, 98.18it/s] 67%|██████▋   | 136/204 [00:01<00:00, 99.01it/s] 72%|███████▏  | 146/204 [00:01<00:00, 98.65it/s] 76%|███████▋  | 156/204 [00:01<00:00, 96.30it/s] 81%|████████▏ | 166/204 [00:02<00:00, 94.94it/s] 86%|████████▋ | 176/204 [00:02<00:00, 94.08it/s] 91%|█████████ | 186/204 [00:02<00:00, 93.62it/s] 96%|█████████▌| 196/204 [00:02<00:00, 93.69it/s]100%|██████████| 204/204 [00:02<00:00, 82.22it/s]
26032 images processed, 2.5245704650878906 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:37,  2.08it/s] 11%|█▏        | 9/79 [00:00<00:03, 17.61it/s] 22%|██▏       | 17/79 [00:00<00:02, 27.95it/s] 30%|███       | 24/79 [00:00<00:01, 37.20it/s] 38%|███▊      | 30/79 [00:01<00:01, 38.35it/s] 44%|████▍     | 35/79 [00:01<00:01, 37.62it/s] 54%|█████▍    | 43/79 [00:01<00:00, 41.20it/s] 65%|██████▍   | 51/79 [00:01<00:00, 42.89it/s] 75%|███████▍  | 59/79 [00:01<00:00, 43.82it/s] 85%|████████▍ | 67/79 [00:01<00:00, 44.96it/s] 95%|█████████▍| 75/79 [00:02<00:00, 45.96it/s]100%|██████████| 79/79 [00:02<00:00, 38.24it/s]
10000 images processed, 2.0987119674682617 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:27,  2.87it/s] 14%|█▍        | 11/79 [00:00<00:02, 30.45it/s] 27%|██▋       | 21/79 [00:00<00:01, 49.38it/s] 39%|███▉      | 31/79 [00:00<00:00, 62.33it/s] 52%|█████▏    | 41/79 [00:00<00:00, 71.08it/s] 65%|██████▍   | 51/79 [00:00<00:00, 77.54it/s] 77%|███████▋  | 61/79 [00:01<00:00, 81.16it/s] 90%|████████▉ | 71/79 [00:01<00:00, 84.90it/s]100%|██████████| 79/79 [00:01<00:00, 66.58it/s]
10000 images processed, 1.212087631225586 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:20,  3.43it/s] 14%|█▍        | 10/70 [00:00<00:01, 31.82it/s] 27%|██▋       | 19/70 [00:00<00:01, 49.33it/s] 41%|████▏     | 29/70 [00:00<00:00, 63.07it/s] 56%|█████▌    | 39/70 [00:00<00:00, 71.92it/s] 70%|███████   | 49/70 [00:00<00:00, 78.18it/s] 84%|████████▍ | 59/70 [00:00<00:00, 83.56it/s] 99%|█████████▊| 69/70 [00:01<00:00, 86.86it/s]100%|██████████| 70/70 [00:01<00:00, 66.57it/s]
8925 images processed, 1.0827574729919434 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:00<00:41,  1.06it/s] 11%|█         | 5/45 [00:01<00:06,  6.10it/s] 20%|██        | 9/45 [00:01<00:04,  8.21it/s] 24%|██▍       | 11/45 [00:01<00:03,  8.78it/s] 31%|███       | 14/45 [00:01<00:02, 11.49it/s] 38%|███▊      | 17/45 [00:01<00:02, 11.25it/s] 42%|████▏     | 19/45 [00:02<00:02, 12.50it/s] 49%|████▉     | 22/45 [00:02<00:01, 13.25it/s] 56%|█████▌    | 25/45 [00:02<00:01, 13.09it/s] 67%|██████▋   | 30/45 [00:02<00:01, 12.78it/s] 73%|███████▎  | 33/45 [00:03<00:01, 11.21it/s] 91%|█████████ | 41/45 [00:03<00:00, 12.94it/s] 96%|█████████▌| 43/45 [00:04<00:00, 11.62it/s]100%|██████████| 45/45 [00:04<00:00, 10.94it/s]
5640 images processed, 4.139948129653931 seconds used

19.869827032089233
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.53  99.36
places365     67.87  81.18
LSUN          17.60  96.07
iSUN          72.36  81.68
dtd           37.87  91.39
AVG           39.65  89.93
Retain-Acc: 0.7406
Forget-as-OOD (retain known vs forget novel):
  FPR: 79.50 AUROC: 86.90 AUIN: 98.36
9.886126279830933
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e5-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid
epochs=5 | cache=6 | flambda=0.2 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21610432
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<02:15,  2.87it/s]  1%|▏         | 5/391 [00:00<00:29, 13.04it/s]  2%|▏         | 9/391 [00:00<00:19, 19.86it/s]  4%|▍         | 15/391 [00:00<00:12, 29.83it/s]  5%|▌         | 21/391 [00:00<00:10, 36.49it/s]  7%|▋         | 26/391 [00:00<00:09, 40.00it/s]  8%|▊         | 31/391 [00:01<00:08, 42.25it/s]  9%|▉         | 36/391 [00:01<00:08, 43.95it/s] 10%|█         | 41/391 [00:01<00:07, 45.09it/s] 12%|█▏        | 46/391 [00:01<00:07, 45.86it/s] 13%|█▎        | 51/391 [00:01<00:07, 46.46it/s] 15%|█▍        | 58/391 [00:01<00:06, 52.20it/s] 16%|█▋        | 64/391 [00:01<00:06, 52.54it/s] 18%|█▊        | 70/391 [00:01<00:06, 51.89it/s] 19%|█▉        | 76/391 [00:01<00:06, 52.37it/s] 22%|██▏       | 86/391 [00:01<00:04, 64.23it/s] 24%|██▍       | 94/391 [00:02<00:04, 65.70it/s] 26%|██▌       | 101/391 [00:02<00:04, 59.67it/s] 28%|██▊       | 108/391 [00:02<00:05, 55.63it/s] 29%|██▉       | 114/391 [00:02<00:05, 52.52it/s] 31%|███       | 120/391 [00:02<00:05, 45.57it/s] 32%|███▏      | 125/391 [00:02<00:06, 42.47it/s] 33%|███▎      | 130/391 [00:02<00:06, 42.21it/s] 35%|███▍      | 135/391 [00:03<00:05, 43.55it/s] 36%|███▌      | 140/391 [00:03<00:05, 44.73it/s] 37%|███▋      | 145/391 [00:03<00:05, 45.59it/s] 38%|███▊      | 150/391 [00:03<00:05, 46.22it/s] 40%|███▉      | 155/391 [00:03<00:05, 46.72it/s] 41%|████      | 160/391 [00:03<00:04, 47.01it/s] 42%|████▏     | 165/391 [00:03<00:04, 47.26it/s] 43%|████▎     | 170/391 [00:03<00:04, 47.43it/s] 45%|████▌     | 176/391 [00:03<00:04, 50.12it/s] 47%|████▋     | 182/391 [00:04<00:04, 51.61it/s] 48%|████▊     | 188/391 [00:04<00:03, 50.87it/s] 50%|████▉     | 194/391 [00:04<00:03, 51.50it/s] 52%|█████▏    | 204/391 [00:04<00:02, 63.94it/s] 54%|█████▍    | 213/391 [00:04<00:02, 69.96it/s] 57%|█████▋    | 221/391 [00:04<00:02, 62.66it/s] 58%|█████▊    | 228/391 [00:04<00:02, 57.74it/s] 60%|█████▉    | 234/391 [00:04<00:02, 54.87it/s] 61%|██████▏   | 240/391 [00:05<00:03, 49.57it/s] 63%|██████▎   | 246/391 [00:05<00:03, 43.88it/s] 64%|██████▍   | 251/391 [00:05<00:03, 41.07it/s] 65%|██████▌   | 256/391 [00:05<00:03, 42.43it/s] 67%|██████▋   | 261/391 [00:05<00:02, 43.79it/s] 68%|██████▊   | 266/391 [00:05<00:02, 44.86it/s] 69%|██████▉   | 271/391 [00:05<00:02, 45.67it/s] 71%|███████   | 276/391 [00:05<00:02, 46.29it/s] 72%|███████▏  | 281/391 [00:06<00:02, 46.70it/s] 73%|███████▎  | 286/391 [00:06<00:02, 47.25it/s] 76%|███████▌  | 296/391 [00:06<00:01, 60.81it/s] 77%|███████▋  | 303/391 [00:06<00:01, 57.80it/s] 79%|███████▉  | 309/391 [00:06<00:01, 55.56it/s] 81%|████████  | 316/391 [00:06<00:01, 57.65it/s] 83%|████████▎ | 326/391 [00:06<00:00, 67.85it/s] 86%|████████▌ | 336/391 [00:06<00:00, 75.05it/s] 88%|████████▊ | 346/391 [00:06<00:00, 78.14it/s] 91%|█████████ | 354/391 [00:07<00:00, 66.57it/s] 92%|█████████▏| 361/391 [00:07<00:00, 60.51it/s] 95%|█████████▍| 370/391 [00:07<00:00, 67.38it/s] 97%|█████████▋| 378/391 [00:07<00:00, 65.82it/s] 98%|█████████▊| 385/391 [00:07<00:00, 64.44it/s]100%|██████████| 391/391 [00:07<00:00, 51.15it/s]
50000 images processed, 7.760687351226807 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:30,  2.54it/s] 14%|█▍        | 11/79 [00:00<00:02, 27.22it/s] 24%|██▍       | 19/79 [00:00<00:01, 39.46it/s] 32%|███▏      | 25/79 [00:00<00:01, 42.20it/s] 39%|███▉      | 31/79 [00:00<00:01, 44.17it/s] 47%|████▋     | 37/79 [00:01<00:00, 44.03it/s] 58%|█████▊    | 46/79 [00:01<00:00, 54.73it/s] 71%|███████   | 56/79 [00:01<00:00, 65.10it/s] 84%|████████▎ | 66/79 [00:01<00:00, 72.95it/s] 94%|█████████▎| 74/79 [00:01<00:00, 68.03it/s]100%|██████████| 79/79 [00:01<00:00, 48.79it/s]
10000 images processed, 1.6568541526794434 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<00:59,  3.39it/s]  3%|▎         | 6/204 [00:00<00:11, 17.72it/s]  5%|▌         | 11/204 [00:00<00:07, 26.07it/s]  9%|▉         | 19/204 [00:00<00:04, 41.42it/s] 14%|█▎        | 28/204 [00:00<00:03, 54.43it/s] 18%|█▊        | 37/204 [00:00<00:02, 62.84it/s] 23%|██▎       | 47/204 [00:00<00:02, 71.55it/s] 27%|██▋       | 55/204 [00:01<00:02, 61.76it/s] 30%|███       | 62/204 [00:01<00:02, 57.35it/s] 35%|███▌      | 72/204 [00:01<00:01, 66.46it/s] 40%|███▉      | 81/204 [00:01<00:01, 72.39it/s] 45%|████▍     | 91/204 [00:01<00:01, 77.92it/s] 49%|████▉     | 100/204 [00:01<00:01, 70.63it/s] 53%|█████▎    | 108/204 [00:01<00:01, 61.09it/s] 58%|█████▊    | 118/204 [00:02<00:01, 68.39it/s] 63%|██████▎   | 128/204 [00:02<00:01, 74.48it/s] 68%|██████▊   | 138/204 [00:02<00:00, 79.27it/s] 72%|███████▏  | 147/204 [00:02<00:00, 75.85it/s] 76%|███████▌  | 155/204 [00:02<00:00, 63.67it/s] 80%|███████▉  | 163/204 [00:02<00:00, 65.91it/s] 85%|████████▍ | 173/204 [00:02<00:00, 73.05it/s] 90%|████████▉ | 183/204 [00:02<00:00, 78.06it/s] 95%|█████████▍| 193/204 [00:02<00:00, 82.28it/s] 99%|█████████▉| 202/204 [00:03<00:00, 67.86it/s]100%|██████████| 204/204 [00:03<00:00, 63.25it/s]
26032 images processed, 3.2796132564544678 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:39,  1.95it/s]  9%|▉         | 7/79 [00:00<00:04, 14.60it/s] 14%|█▍        | 11/79 [00:00<00:03, 20.02it/s] 20%|██        | 16/79 [00:00<00:02, 27.22it/s] 32%|███▏      | 25/79 [00:00<00:01, 37.72it/s] 39%|███▉      | 31/79 [00:01<00:01, 41.76it/s] 46%|████▌     | 36/79 [00:01<00:01, 41.71it/s] 53%|█████▎    | 42/79 [00:01<00:00, 45.87it/s] 62%|██████▏   | 49/79 [00:01<00:00, 45.97it/s] 68%|██████▊   | 54/79 [00:01<00:00, 45.25it/s] 75%|███████▍  | 59/79 [00:01<00:00, 46.03it/s] 82%|████████▏ | 65/79 [00:01<00:00, 49.74it/s] 90%|████████▉ | 71/79 [00:01<00:00, 49.24it/s] 97%|█████████▋| 77/79 [00:02<00:00, 48.10it/s]100%|██████████| 79/79 [00:02<00:00, 37.95it/s]
10000 images processed, 2.1164169311523438 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:29,  2.68it/s]  8%|▊         | 6/79 [00:00<00:04, 15.20it/s] 15%|█▌        | 12/79 [00:00<00:02, 27.21it/s] 28%|██▊       | 22/79 [00:00<00:01, 46.78it/s] 41%|████      | 32/79 [00:00<00:00, 60.72it/s] 53%|█████▎    | 42/79 [00:00<00:00, 70.62it/s] 65%|██████▍   | 51/79 [00:01<00:00, 67.97it/s] 75%|███████▍  | 59/79 [00:01<00:00, 59.02it/s] 86%|████████▌ | 68/79 [00:01<00:00, 64.85it/s] 99%|█████████▊| 78/79 [00:01<00:00, 72.70it/s]100%|██████████| 79/79 [00:01<00:00, 54.54it/s]
10000 images processed, 1.4684884548187256 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:24,  2.83it/s]  9%|▊         | 6/70 [00:00<00:04, 15.71it/s] 16%|█▌        | 11/70 [00:00<00:02, 24.77it/s] 27%|██▋       | 19/70 [00:00<00:01, 40.01it/s] 41%|████▏     | 29/70 [00:00<00:00, 56.08it/s] 56%|█████▌    | 39/70 [00:00<00:00, 67.45it/s] 70%|███████   | 49/70 [00:01<00:00, 75.32it/s] 83%|████████▎ | 58/70 [00:01<00:00, 62.06it/s] 94%|█████████▍| 66/70 [00:01<00:00, 61.03it/s]100%|██████████| 70/70 [00:01<00:00, 50.69it/s]
8925 images processed, 1.4139716625213623 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:00<00:32,  1.34it/s]  4%|▍         | 2/45 [00:01<00:19,  2.16it/s] 16%|█▌        | 7/45 [00:01<00:04,  9.30it/s] 22%|██▏       | 10/45 [00:01<00:04,  7.83it/s] 38%|███▊      | 17/45 [00:01<00:01, 15.92it/s] 47%|████▋     | 21/45 [00:02<00:01, 12.33it/s] 58%|█████▊    | 26/45 [00:02<00:01, 11.43it/s] 67%|██████▋   | 30/45 [00:02<00:01, 12.75it/s] 76%|███████▌  | 34/45 [00:03<00:01, 10.58it/s] 93%|█████████▎| 42/45 [00:04<00:00, 10.94it/s]100%|██████████| 45/45 [00:04<00:00, 10.72it/s]
5640 images processed, 4.215308904647827 seconds used

23.63811492919922
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.53  99.36
places365     67.87  81.18
LSUN          17.60  96.07
iSUN          72.36  81.68
dtd           37.87  91.39
AVG           39.65  89.93
Retain-Acc: 0.7406
Forget-as-OOD (retain known vs forget novel):
  FPR: 79.50 AUROC: 86.90 AUIN: 98.36
9.697315216064453
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e10-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid
epochs=10 | cache=6 | flambda=0.2 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e10-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e10-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e10-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21610432
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<01:51,  3.51it/s]  2%|▏         | 8/391 [00:00<00:15, 24.72it/s]  3%|▎         | 13/391 [00:00<00:11, 32.28it/s]  5%|▍         | 19/391 [00:00<00:09, 38.51it/s]  7%|▋         | 28/391 [00:00<00:06, 53.19it/s] 10%|▉         | 38/391 [00:00<00:05, 65.83it/s] 12%|█▏        | 48/391 [00:00<00:04, 74.43it/s] 15%|█▍        | 58/391 [00:01<00:04, 80.52it/s] 17%|█▋        | 67/391 [00:01<00:04, 70.27it/s] 19%|█▉        | 75/391 [00:01<00:05, 62.87it/s] 21%|██▏       | 84/391 [00:01<00:04, 68.92it/s] 24%|██▍       | 94/391 [00:01<00:03, 75.29it/s] 27%|██▋       | 104/391 [00:01<00:03, 80.24it/s] 29%|██▉       | 113/391 [00:01<00:03, 79.70it/s] 31%|███       | 122/391 [00:01<00:03, 67.58it/s] 33%|███▎      | 130/391 [00:02<00:03, 65.34it/s] 36%|███▌      | 140/391 [00:02<00:03, 72.31it/s] 38%|███▊      | 150/391 [00:02<00:03, 78.12it/s] 41%|████      | 160/391 [00:02<00:02, 82.66it/s] 43%|████▎     | 169/391 [00:02<00:02, 77.48it/s] 45%|████▌     | 177/391 [00:02<00:03, 67.48it/s] 47%|████▋     | 185/391 [00:02<00:03, 66.48it/s] 50%|████▉     | 194/391 [00:02<00:02, 70.97it/s] 52%|█████▏    | 204/391 [00:03<00:02, 76.97it/s] 54%|█████▍    | 212/391 [00:03<00:02, 77.76it/s] 56%|█████▋    | 220/391 [00:03<00:02, 65.97it/s] 58%|█████▊    | 227/391 [00:03<00:02, 62.65it/s] 61%|██████    | 237/391 [00:03<00:02, 70.64it/s] 63%|██████▎   | 247/391 [00:03<00:01, 75.98it/s] 66%|██████▌   | 257/391 [00:03<00:01, 80.72it/s] 68%|██████▊   | 266/391 [00:03<00:01, 72.40it/s] 70%|███████   | 274/391 [00:04<00:01, 64.47it/s] 72%|███████▏  | 282/391 [00:04<00:01, 67.72it/s] 75%|███████▍  | 292/391 [00:04<00:01, 74.98it/s] 77%|███████▋  | 302/391 [00:04<00:01, 80.44it/s] 80%|███████▉  | 312/391 [00:04<00:00, 84.34it/s] 82%|████████▏ | 321/391 [00:04<00:01, 69.92it/s] 84%|████████▍ | 329/391 [00:04<00:00, 63.85it/s] 87%|████████▋ | 339/391 [00:04<00:00, 71.40it/s] 89%|████████▉ | 349/391 [00:05<00:00, 76.77it/s] 92%|█████████▏| 359/391 [00:05<00:00, 80.94it/s] 94%|█████████▍| 369/391 [00:05<00:00, 84.75it/s] 97%|█████████▋| 378/391 [00:05<00:00, 69.86it/s] 99%|█████████▊| 386/391 [00:05<00:00, 65.24it/s]100%|██████████| 391/391 [00:05<00:00, 68.83it/s]
50000 images processed, 5.8025572299957275 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:23,  3.29it/s] 14%|█▍        | 11/79 [00:00<00:02, 33.24it/s] 27%|██▋       | 21/79 [00:00<00:01, 52.74it/s] 39%|███▉      | 31/79 [00:00<00:00, 65.73it/s] 51%|█████     | 40/79 [00:00<00:00, 59.49it/s] 61%|██████    | 48/79 [00:00<00:00, 56.61it/s] 73%|███████▎  | 58/79 [00:01<00:00, 66.02it/s] 86%|████████▌ | 68/79 [00:01<00:00, 73.60it/s] 99%|█████████▊| 78/79 [00:01<00:00, 79.70it/s]100%|██████████| 79/79 [00:01<00:00, 60.81it/s]
10000 images processed, 1.3356895446777344 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:13,  2.78it/s]  3%|▎         | 7/204 [00:00<00:10, 18.53it/s]  8%|▊         | 16/204 [00:00<00:04, 38.20it/s] 13%|█▎        | 26/204 [00:00<00:03, 54.19it/s] 17%|█▋        | 34/204 [00:00<00:02, 60.84it/s] 21%|██        | 42/204 [00:00<00:02, 54.12it/s] 24%|██▍       | 49/204 [00:01<00:02, 54.66it/s] 28%|██▊       | 58/204 [00:01<00:02, 63.08it/s] 33%|███▎      | 68/204 [00:01<00:01, 71.08it/s] 38%|███▊      | 78/204 [00:01<00:01, 76.95it/s] 43%|████▎     | 87/204 [00:01<00:01, 63.18it/s] 46%|████▌     | 94/204 [00:01<00:01, 61.31it/s] 50%|█████     | 103/204 [00:01<00:01, 67.97it/s] 55%|█████▌    | 113/204 [00:01<00:01, 74.42it/s] 59%|█████▉    | 121/204 [00:02<00:01, 67.45it/s] 63%|██████▎   | 129/204 [00:02<00:01, 59.13it/s] 67%|██████▋   | 137/204 [00:02<00:01, 63.69it/s] 72%|███████▏  | 147/204 [00:02<00:00, 70.91it/s] 77%|███████▋  | 157/204 [00:02<00:00, 76.43it/s] 81%|████████▏ | 166/204 [00:02<00:00, 78.60it/s] 86%|████████▌ | 175/204 [00:02<00:00, 63.59it/s] 89%|████████▉ | 182/204 [00:03<00:00, 63.55it/s] 94%|█████████▍| 192/204 [00:03<00:00, 71.08it/s] 99%|█████████▉| 202/204 [00:03<00:00, 77.35it/s]100%|██████████| 204/204 [00:03<00:00, 62.60it/s]
26032 images processed, 3.3083763122558594 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:40,  1.92it/s]  8%|▊         | 6/79 [00:00<00:06, 12.02it/s] 19%|█▉        | 15/79 [00:00<00:02, 29.64it/s] 27%|██▋       | 21/79 [00:00<00:01, 30.11it/s] 33%|███▎      | 26/79 [00:01<00:01, 33.82it/s] 43%|████▎     | 34/79 [00:01<00:01, 43.30it/s] 52%|█████▏    | 41/79 [00:01<00:00, 43.91it/s] 59%|█████▉    | 47/79 [00:01<00:00, 44.39it/s] 68%|██████▊   | 54/79 [00:01<00:00, 50.27it/s] 76%|███████▌  | 60/79 [00:01<00:00, 49.08it/s] 84%|████████▎ | 66/79 [00:01<00:00, 46.47it/s] 90%|████████▉ | 71/79 [00:01<00:00, 46.76it/s]100%|██████████| 79/79 [00:02<00:00, 39.24it/s]
10000 images processed, 2.048802375793457 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:31,  2.46it/s] 13%|█▎        | 10/79 [00:00<00:02, 25.01it/s] 24%|██▍       | 19/79 [00:00<00:01, 42.37it/s] 37%|███▋      | 29/79 [00:00<00:00, 57.25it/s] 49%|████▉     | 39/79 [00:00<00:00, 66.34it/s] 61%|██████    | 48/79 [00:01<00:00, 56.38it/s] 70%|██████▉   | 55/79 [00:01<00:00, 58.04it/s] 82%|████████▏ | 65/79 [00:01<00:00, 67.01it/s] 95%|█████████▍| 75/79 [00:01<00:00, 74.41it/s]100%|██████████| 79/79 [00:01<00:00, 56.46it/s]
10000 images processed, 1.4205937385559082 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:24,  2.83it/s]  9%|▊         | 6/70 [00:00<00:04, 15.71it/s] 16%|█▌        | 11/70 [00:00<00:02, 24.77it/s] 29%|██▊       | 20/70 [00:00<00:01, 42.81it/s] 43%|████▎     | 30/70 [00:00<00:00, 58.03it/s] 57%|█████▋    | 40/70 [00:00<00:00, 67.98it/s] 70%|███████   | 49/70 [00:01<00:00, 71.04it/s] 81%|████████▏ | 57/70 [00:01<00:00, 60.20it/s] 91%|█████████▏| 64/70 [00:01<00:00, 60.43it/s]100%|██████████| 70/70 [00:01<00:00, 50.97it/s]
8925 images processed, 1.4064996242523193 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:00<00:37,  1.18it/s]  7%|▋         | 3/45 [00:00<00:10,  3.89it/s] 20%|██        | 9/45 [00:01<00:03,  9.45it/s] 24%|██▍       | 11/45 [00:01<00:03,  9.67it/s] 31%|███       | 14/45 [00:01<00:02, 11.93it/s] 38%|███▊      | 17/45 [00:01<00:02, 12.14it/s] 42%|████▏     | 19/45 [00:02<00:02, 12.96it/s] 49%|████▉     | 22/45 [00:02<00:01, 13.36it/s] 53%|█████▎    | 24/45 [00:02<00:01, 12.03it/s] 60%|██████    | 27/45 [00:02<00:01, 12.87it/s] 67%|██████▋   | 30/45 [00:02<00:01, 13.56it/s] 71%|███████   | 32/45 [00:02<00:00, 13.71it/s] 76%|███████▌  | 34/45 [00:03<00:00, 12.62it/s] 87%|████████▋ | 39/45 [00:03<00:00, 15.25it/s] 91%|█████████ | 41/45 [00:03<00:00, 12.49it/s] 96%|█████████▌| 43/45 [00:03<00:00, 11.57it/s]100%|██████████| 45/45 [00:03<00:00, 11.48it/s]
5640 images processed, 3.9503464698791504 seconds used

21.078212022781372
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.53  99.36
places365     67.87  81.18
LSUN          17.60  96.07
iSUN          72.36  81.68
dtd           37.87  91.39
AVG           39.65  89.93
Retain-Acc: 0.7406
Forget-as-OOD (retain known vs forget novel):
  FPR: 79.50 AUROC: 86.90 AUIN: 98.36
10.323628664016724
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e20-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid
epochs=20 | cache=6 | flambda=0.2 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e20-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e20-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e20-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21610432
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<02:16,  2.86it/s]  3%|▎         | 11/391 [00:00<00:12, 30.35it/s]  5%|▌         | 21/391 [00:00<00:07, 48.95it/s]  8%|▊         | 31/391 [00:00<00:05, 62.42it/s] 10%|█         | 41/391 [00:00<00:04, 71.28it/s] 13%|█▎        | 51/391 [00:00<00:04, 77.92it/s] 16%|█▌        | 61/391 [00:00<00:03, 82.75it/s] 18%|█▊        | 71/391 [00:01<00:03, 85.91it/s] 21%|██        | 81/391 [00:01<00:03, 88.35it/s] 23%|██▎       | 91/391 [00:01<00:03, 89.97it/s] 26%|██▌       | 101/391 [00:01<00:03, 91.14it/s] 28%|██▊       | 111/391 [00:01<00:03, 92.01it/s] 31%|███       | 121/391 [00:01<00:02, 92.29it/s] 34%|███▎      | 131/391 [00:01<00:02, 93.01it/s] 36%|███▌      | 141/391 [00:01<00:02, 93.38it/s] 39%|███▊      | 151/391 [00:01<00:02, 93.21it/s] 41%|████      | 161/391 [00:02<00:02, 93.47it/s] 44%|████▎     | 171/391 [00:02<00:02, 91.43it/s] 46%|████▋     | 181/391 [00:02<00:02, 92.01it/s] 49%|████▉     | 191/391 [00:02<00:02, 92.27it/s] 51%|█████▏    | 201/391 [00:02<00:02, 92.36it/s] 54%|█████▍    | 211/391 [00:02<00:01, 90.22it/s] 57%|█████▋    | 221/391 [00:02<00:01, 90.80it/s] 59%|█████▉    | 231/391 [00:02<00:01, 91.84it/s] 62%|██████▏   | 241/391 [00:02<00:01, 92.55it/s] 64%|██████▍   | 251/391 [00:03<00:01, 92.72it/s] 67%|██████▋   | 261/391 [00:03<00:01, 93.46it/s] 69%|██████▉   | 271/391 [00:03<00:01, 93.28it/s] 72%|███████▏  | 281/391 [00:03<00:01, 90.57it/s] 74%|███████▍  | 291/391 [00:03<00:01, 91.43it/s] 77%|███████▋  | 301/391 [00:03<00:00, 90.99it/s] 80%|███████▉  | 311/391 [00:03<00:00, 91.79it/s] 82%|████████▏ | 321/391 [00:03<00:00, 92.53it/s] 85%|████████▍ | 331/391 [00:03<00:00, 93.13it/s] 87%|████████▋ | 341/391 [00:04<00:00, 93.40it/s] 90%|████████▉ | 351/391 [00:04<00:00, 91.60it/s] 92%|█████████▏| 361/391 [00:04<00:00, 92.74it/s] 95%|█████████▍| 371/391 [00:04<00:00, 92.80it/s] 97%|█████████▋| 381/391 [00:04<00:00, 92.54it/s]100%|██████████| 391/391 [00:04<00:00, 91.44it/s]100%|██████████| 391/391 [00:04<00:00, 85.62it/s]
50000 images processed, 4.679877519607544 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:27,  2.87it/s] 14%|█▍        | 11/79 [00:00<00:02, 30.63it/s] 27%|██▋       | 21/79 [00:00<00:01, 49.66it/s] 39%|███▉      | 31/79 [00:00<00:00, 62.66it/s] 52%|█████▏    | 41/79 [00:00<00:00, 71.46it/s] 65%|██████▍   | 51/79 [00:00<00:00, 78.51it/s] 77%|███████▋  | 61/79 [00:00<00:00, 82.92it/s] 90%|████████▉ | 71/79 [00:01<00:00, 85.71it/s]100%|██████████| 79/79 [00:01<00:00, 66.46it/s]
10000 images processed, 1.2263975143432617 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:13,  2.75it/s]  5%|▍         | 10/204 [00:00<00:07, 27.14it/s] 10%|▉         | 20/204 [00:00<00:03, 46.84it/s] 15%|█▍        | 30/204 [00:00<00:02, 60.70it/s] 20%|█▉        | 40/204 [00:00<00:02, 70.16it/s] 25%|██▍       | 50/204 [00:00<00:02, 76.66it/s] 29%|██▉       | 60/204 [00:01<00:01, 81.79it/s] 34%|███▍      | 70/204 [00:01<00:01, 84.79it/s] 39%|███▉      | 80/204 [00:01<00:01, 87.16it/s] 44%|████▍     | 90/204 [00:01<00:01, 87.54it/s] 49%|████▉     | 100/204 [00:01<00:01, 88.79it/s] 54%|█████▍    | 110/204 [00:01<00:01, 88.85it/s] 59%|█████▉    | 120/204 [00:01<00:00, 88.47it/s] 64%|██████▎   | 130/204 [00:01<00:00, 89.48it/s] 69%|██████▊   | 140/204 [00:01<00:00, 88.95it/s] 74%|███████▎  | 150/204 [00:02<00:00, 89.11it/s] 78%|███████▊  | 160/204 [00:02<00:00, 90.37it/s] 83%|████████▎ | 170/204 [00:02<00:00, 91.34it/s] 88%|████████▊ | 180/204 [00:02<00:00, 91.06it/s] 93%|█████████▎| 190/204 [00:02<00:00, 91.62it/s] 98%|█████████▊| 200/204 [00:02<00:00, 91.99it/s]100%|██████████| 204/204 [00:02<00:00, 78.73it/s]
26032 images processed, 2.6571033000946045 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:38,  2.05it/s] 11%|█▏        | 9/79 [00:00<00:03, 17.59it/s] 22%|██▏       | 17/79 [00:00<00:02, 27.90it/s] 32%|███▏      | 25/79 [00:00<00:01, 34.97it/s] 42%|████▏     | 33/79 [00:01<00:01, 39.60it/s] 52%|█████▏    | 41/79 [00:01<00:00, 42.97it/s] 62%|██████▏   | 49/79 [00:01<00:00, 45.60it/s] 72%|███████▏  | 57/79 [00:01<00:00, 48.78it/s] 82%|████████▏ | 65/79 [00:01<00:00, 50.95it/s] 92%|█████████▏| 73/79 [00:01<00:00, 51.45it/s]100%|██████████| 79/79 [00:01<00:00, 41.15it/s]
10000 images processed, 1.962263822555542 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:30,  2.60it/s] 13%|█▎        | 10/79 [00:00<00:02, 26.03it/s] 25%|██▌       | 20/79 [00:00<00:01, 45.55it/s] 37%|███▋      | 29/79 [00:00<00:00, 56.63it/s] 49%|████▉     | 39/79 [00:00<00:00, 67.39it/s] 61%|██████    | 48/79 [00:00<00:00, 70.88it/s] 72%|███████▏  | 57/79 [00:01<00:00, 73.57it/s] 84%|████████▎ | 66/79 [00:01<00:00, 76.32it/s] 96%|█████████▌| 76/79 [00:01<00:00, 81.85it/s]100%|██████████| 79/79 [00:01<00:00, 61.89it/s]
10000 images processed, 1.2974746227264404 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:23,  2.88it/s] 14%|█▍        | 10/70 [00:00<00:02, 27.50it/s] 27%|██▋       | 19/70 [00:00<00:01, 44.83it/s] 39%|███▊      | 27/70 [00:00<00:00, 53.81it/s] 50%|█████     | 35/70 [00:00<00:00, 61.29it/s] 63%|██████▎   | 44/70 [00:00<00:00, 68.42it/s] 76%|███████▌  | 53/70 [00:00<00:00, 74.29it/s] 90%|█████████ | 63/70 [00:01<00:00, 79.77it/s]100%|██████████| 70/70 [00:01<00:00, 60.18it/s]
8925 images processed, 1.1927051544189453 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:01<00:44,  1.01s/it] 20%|██        | 9/45 [00:01<00:05,  7.04it/s] 38%|███▊      | 17/45 [00:02<00:03,  9.13it/s] 56%|█████▌    | 25/45 [00:02<00:01, 11.55it/s] 67%|██████▋   | 30/45 [00:02<00:01, 14.76it/s] 73%|███████▎  | 33/45 [00:03<00:01, 11.03it/s] 91%|█████████ | 41/45 [00:03<00:00, 13.08it/s]100%|██████████| 45/45 [00:03<00:00, 11.61it/s]
5640 images processed, 3.900209426879883 seconds used

18.653201818466187
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.53  99.36
places365     67.87  81.18
LSUN          17.60  96.07
iSUN          72.36  81.68
dtd           37.87  91.39
AVG           39.65  89.93
Retain-Acc: 0.7406
Forget-as-OOD (retain known vs forget novel):
  FPR: 79.50 AUROC: 86.90 AUIN: 98.36
9.559208631515503
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e50-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid
epochs=50 | cache=6 | flambda=0.2 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e50-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e50-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e50-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21610432
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<02:33,  2.54it/s]  2%|▏         | 6/391 [00:00<00:25, 15.00it/s]  3%|▎         | 11/391 [00:00<00:15, 24.28it/s]  5%|▍         | 18/391 [00:00<00:10, 36.94it/s]  7%|▋         | 28/391 [00:00<00:06, 53.26it/s]  9%|▉         | 37/391 [00:00<00:05, 63.60it/s] 12%|█▏        | 47/391 [00:01<00:04, 72.73it/s] 14%|█▍        | 56/391 [00:01<00:05, 63.82it/s] 16%|█▋        | 64/391 [00:01<00:05, 59.55it/s] 19%|█▉        | 74/391 [00:01<00:04, 68.34it/s] 21%|██▏       | 84/391 [00:01<00:04, 75.34it/s] 24%|██▍       | 94/391 [00:01<00:03, 80.59it/s] 27%|██▋       | 104/391 [00:01<00:03, 83.94it/s] 29%|██▉       | 113/391 [00:01<00:03, 70.90it/s] 31%|███       | 121/391 [00:02<00:04, 64.37it/s] 34%|███▎      | 131/391 [00:02<00:03, 71.39it/s] 36%|███▌      | 141/391 [00:02<00:03, 77.33it/s] 38%|███▊      | 150/391 [00:02<00:02, 80.42it/s] 41%|████      | 159/391 [00:02<00:03, 75.64it/s] 43%|████▎     | 167/391 [00:02<00:03, 66.32it/s] 45%|████▍     | 174/391 [00:02<00:03, 65.47it/s] 47%|████▋     | 184/391 [00:02<00:02, 72.75it/s] 50%|████▉     | 194/391 [00:03<00:02, 78.84it/s] 52%|█████▏    | 204/391 [00:03<00:02, 82.90it/s] 54%|█████▍    | 213/391 [00:03<00:02, 74.91it/s] 57%|█████▋    | 221/391 [00:03<00:02, 66.85it/s] 58%|█████▊    | 228/391 [00:03<00:02, 66.40it/s] 61%|██████    | 238/391 [00:03<00:02, 73.64it/s] 63%|██████▎   | 248/391 [00:03<00:01, 78.70it/s] 66%|██████▌   | 258/391 [00:03<00:01, 82.34it/s] 68%|██████▊   | 267/391 [00:04<00:01, 76.61it/s] 70%|███████   | 275/391 [00:04<00:01, 66.95it/s] 72%|███████▏  | 282/391 [00:04<00:01, 65.91it/s] 75%|███████▍  | 292/391 [00:04<00:01, 73.53it/s] 77%|███████▋  | 302/391 [00:04<00:01, 79.14it/s] 80%|███████▉  | 312/391 [00:04<00:00, 83.00it/s] 82%|████████▏ | 322/391 [00:04<00:00, 83.89it/s] 85%|████████▍ | 331/391 [00:04<00:00, 69.13it/s] 87%|████████▋ | 339/391 [00:05<00:00, 66.16it/s] 89%|████████▉ | 349/391 [00:05<00:00, 73.48it/s] 92%|█████████▏| 359/391 [00:05<00:00, 77.36it/s] 94%|█████████▍| 369/391 [00:05<00:00, 81.77it/s] 97%|█████████▋| 378/391 [00:05<00:00, 71.17it/s] 99%|█████████▊| 386/391 [00:05<00:00, 63.93it/s]100%|██████████| 391/391 [00:05<00:00, 67.61it/s]
50000 images processed, 5.911309719085693 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:25,  3.01it/s] 14%|█▍        | 11/79 [00:00<00:02, 31.29it/s] 22%|██▏       | 17/79 [00:00<00:01, 37.42it/s] 29%|██▉       | 23/79 [00:00<00:01, 41.53it/s] 37%|███▋      | 29/79 [00:00<00:01, 45.91it/s] 49%|████▉     | 39/79 [00:00<00:00, 59.47it/s] 62%|██████▏   | 49/79 [00:01<00:00, 69.73it/s] 75%|███████▍  | 59/79 [00:01<00:00, 77.11it/s] 87%|████████▋ | 69/79 [00:01<00:00, 82.52it/s] 99%|█████████▊| 78/79 [00:01<00:00, 73.25it/s]100%|██████████| 79/79 [00:01<00:00, 57.01it/s]
10000 images processed, 1.421098232269287 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<00:57,  3.52it/s]  5%|▍         | 10/204 [00:00<00:06, 31.64it/s]  8%|▊         | 16/204 [00:00<00:05, 36.22it/s] 10%|█         | 21/204 [00:00<00:04, 39.30it/s] 14%|█▍        | 29/204 [00:00<00:03, 50.84it/s] 19%|█▉        | 39/204 [00:00<00:02, 63.96it/s] 24%|██▍       | 49/204 [00:00<00:02, 72.81it/s] 29%|██▉       | 59/204 [00:01<00:01, 78.54it/s] 33%|███▎      | 68/204 [00:01<00:02, 63.51it/s] 37%|███▋      | 76/204 [00:01<00:02, 62.25it/s] 42%|████▏     | 86/204 [00:01<00:01, 70.09it/s] 47%|████▋     | 95/204 [00:01<00:01, 74.74it/s] 51%|█████▏    | 105/204 [00:01<00:01, 79.86it/s] 56%|█████▌    | 114/204 [00:01<00:01, 73.97it/s] 60%|█████▉    | 122/204 [00:02<00:01, 62.65it/s] 64%|██████▎   | 130/204 [00:02<00:01, 66.58it/s] 69%|██████▊   | 140/204 [00:02<00:00, 72.97it/s] 74%|███████▎  | 150/204 [00:02<00:00, 78.27it/s] 78%|███████▊  | 160/204 [00:02<00:00, 82.24it/s] 83%|████████▎ | 169/204 [00:02<00:00, 67.52it/s] 87%|████████▋ | 177/204 [00:02<00:00, 63.93it/s] 92%|█████████▏| 187/204 [00:02<00:00, 70.99it/s] 97%|█████████▋| 197/204 [00:03<00:00, 77.07it/s]100%|██████████| 204/204 [00:03<00:00, 66.05it/s]
26032 images processed, 3.1268794536590576 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:35,  2.17it/s] 11%|█▏        | 9/79 [00:00<00:03, 18.09it/s] 18%|█▊        | 14/79 [00:00<00:02, 24.54it/s] 24%|██▍       | 19/79 [00:00<00:02, 29.35it/s] 33%|███▎      | 26/79 [00:00<00:01, 38.60it/s] 42%|████▏     | 33/79 [00:01<00:01, 39.50it/s] 48%|████▊     | 38/79 [00:01<00:01, 40.98it/s] 57%|█████▋    | 45/79 [00:01<00:00, 47.84it/s] 65%|██████▍   | 51/79 [00:01<00:00, 41.84it/s] 71%|███████   | 56/79 [00:01<00:00, 42.80it/s] 81%|████████  | 64/79 [00:01<00:00, 51.01it/s] 89%|████████▊ | 70/79 [00:01<00:00, 52.34it/s] 96%|█████████▌| 76/79 [00:02<00:00, 44.32it/s]100%|██████████| 79/79 [00:02<00:00, 37.76it/s]
10000 images processed, 2.124911069869995 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:25,  3.08it/s] 13%|█▎        | 10/79 [00:00<00:02, 29.51it/s] 25%|██▌       | 20/79 [00:00<00:01, 49.57it/s] 38%|███▊      | 30/79 [00:00<00:00, 63.09it/s] 51%|█████     | 40/79 [00:00<00:00, 72.49it/s] 62%|██████▏   | 49/79 [00:00<00:00, 62.03it/s] 72%|███████▏  | 57/79 [00:01<00:00, 58.63it/s] 85%|████████▍ | 67/79 [00:01<00:00, 66.84it/s] 97%|█████████▋| 77/79 [00:01<00:00, 73.96it/s]100%|██████████| 79/79 [00:01<00:00, 59.82it/s]
10000 images processed, 1.3485593795776367 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:26,  2.64it/s]  9%|▊         | 6/70 [00:00<00:04, 14.98it/s] 16%|█▌        | 11/70 [00:00<00:02, 23.95it/s] 29%|██▊       | 20/70 [00:00<00:01, 41.22it/s] 43%|████▎     | 30/70 [00:00<00:00, 56.30it/s] 57%|█████▋    | 40/70 [00:00<00:00, 66.74it/s] 71%|███████▏  | 50/70 [00:01<00:00, 74.40it/s] 84%|████████▍ | 59/70 [00:01<00:00, 64.29it/s] 96%|█████████▌| 67/70 [00:01<00:00, 59.93it/s]100%|██████████| 70/70 [00:01<00:00, 49.73it/s]
8925 images processed, 1.4360926151275635 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:00<00:39,  1.12it/s]  4%|▍         | 2/45 [00:01<00:22,  1.94it/s] 20%|██        | 9/45 [00:01<00:03, 10.05it/s] 24%|██▍       | 11/45 [00:01<00:04,  7.85it/s] 38%|███▊      | 17/45 [00:01<00:01, 14.44it/s] 44%|████▍     | 20/45 [00:02<00:02, 10.45it/s] 58%|█████▊    | 26/45 [00:02<00:01, 10.42it/s] 76%|███████▌  | 34/45 [00:03<00:00, 11.17it/s] 93%|█████████▎| 42/45 [00:04<00:00, 11.66it/s]100%|██████████| 45/45 [00:04<00:00, 10.54it/s]
5640 images processed, 4.287493467330933 seconds used

21.257138967514038
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.53  99.36
places365     67.87  81.18
LSUN          17.60  96.07
iSUN          72.36  81.68
dtd           37.87  91.39
AVG           39.65  89.93
Retain-Acc: 0.7406
Forget-as-OOD (retain known vs forget novel):
  FPR: 79.50 AUROC: 86.90 AUIN: 98.36
9.977978706359863
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e5-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid
epochs=5 | cache=6 | flambda=0.2 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21610432
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<02:16,  2.85it/s]  2%|▏         | 8/391 [00:00<00:17, 21.30it/s]  4%|▍         | 17/391 [00:00<00:09, 40.55it/s]  7%|▋         | 27/391 [00:00<00:06, 56.55it/s]  9%|▉         | 37/391 [00:00<00:05, 67.63it/s] 12%|█▏        | 47/391 [00:00<00:04, 75.37it/s] 14%|█▍        | 56/391 [00:01<00:05, 65.65it/s] 16%|█▋        | 64/391 [00:01<00:05, 60.43it/s] 19%|█▉        | 74/391 [00:01<00:04, 68.95it/s] 21%|██▏       | 84/391 [00:01<00:04, 75.58it/s] 24%|██▍       | 94/391 [00:01<00:03, 80.94it/s] 27%|██▋       | 104/391 [00:01<00:03, 84.99it/s] 29%|██▉       | 113/391 [00:01<00:03, 81.30it/s] 31%|███       | 122/391 [00:01<00:03, 68.54it/s] 33%|███▎      | 130/391 [00:02<00:03, 67.65it/s] 36%|███▌      | 140/391 [00:02<00:03, 74.75it/s] 38%|███▊      | 150/391 [00:02<00:03, 80.27it/s] 41%|████      | 160/391 [00:02<00:02, 84.17it/s] 43%|████▎     | 170/391 [00:02<00:02, 86.99it/s] 46%|████▌     | 179/391 [00:02<00:02, 70.97it/s] 48%|████▊     | 187/391 [00:02<00:03, 65.82it/s] 50%|█████     | 197/391 [00:02<00:02, 73.14it/s] 53%|█████▎    | 207/391 [00:03<00:02, 78.88it/s] 55%|█████▌    | 217/391 [00:03<00:02, 82.94it/s] 58%|█████▊    | 227/391 [00:03<00:01, 86.04it/s] 60%|██████    | 236/391 [00:03<00:02, 76.82it/s] 63%|██████▎   | 245/391 [00:03<00:02, 65.92it/s] 65%|██████▍   | 254/391 [00:03<00:01, 70.51it/s] 68%|██████▊   | 264/391 [00:03<00:01, 76.87it/s] 70%|███████   | 274/391 [00:03<00:01, 81.80it/s] 73%|███████▎  | 284/391 [00:04<00:01, 85.26it/s] 75%|███████▍  | 293/391 [00:04<00:01, 81.83it/s] 77%|███████▋  | 302/391 [00:04<00:01, 68.81it/s] 79%|███████▉  | 310/391 [00:04<00:01, 67.27it/s] 82%|████████▏ | 320/391 [00:04<00:00, 73.65it/s] 84%|████████▍ | 330/391 [00:04<00:00, 78.97it/s] 87%|████████▋ | 340/391 [00:04<00:00, 82.92it/s] 90%|████████▉ | 350/391 [00:04<00:00, 85.04it/s] 92%|█████████▏| 359/391 [00:05<00:00, 69.85it/s] 94%|█████████▍| 367/391 [00:05<00:00, 65.89it/s] 96%|█████████▋| 377/391 [00:05<00:00, 72.44it/s] 99%|█████████▉| 387/391 [00:05<00:00, 78.55it/s]100%|██████████| 391/391 [00:05<00:00, 71.68it/s]
50000 images processed, 5.563770055770874 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:31,  2.49it/s]  8%|▊         | 6/79 [00:00<00:04, 14.79it/s] 15%|█▌        | 12/79 [00:00<00:02, 25.70it/s] 24%|██▍       | 19/79 [00:00<00:01, 36.59it/s] 37%|███▋      | 29/79 [00:00<00:00, 52.69it/s] 49%|████▉     | 39/79 [00:00<00:00, 64.23it/s] 62%|██████▏   | 49/79 [00:01<00:00, 72.40it/s] 72%|███████▏  | 57/79 [00:01<00:00, 71.80it/s] 82%|████████▏ | 65/79 [00:01<00:00, 63.42it/s] 91%|█████████ | 72/79 [00:01<00:00, 61.55it/s]100%|██████████| 79/79 [00:01<00:00, 51.43it/s]
10000 images processed, 1.5742404460906982 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:22,  2.46it/s]  4%|▍         | 8/204 [00:00<00:10, 19.10it/s]  6%|▋         | 13/204 [00:00<00:07, 26.19it/s]  9%|▉         | 18/204 [00:00<00:05, 32.17it/s] 13%|█▎        | 27/204 [00:00<00:03, 47.29it/s] 18%|█▊        | 37/204 [00:00<00:02, 60.24it/s] 23%|██▎       | 47/204 [00:01<00:02, 69.66it/s] 27%|██▋       | 55/204 [00:01<00:02, 63.74it/s] 30%|███       | 62/204 [00:01<00:02, 57.86it/s] 34%|███▍      | 70/204 [00:01<00:02, 62.98it/s] 39%|███▉      | 80/204 [00:01<00:01, 70.92it/s] 44%|████▍     | 90/204 [00:01<00:01, 76.69it/s] 49%|████▊     | 99/204 [00:01<00:01, 78.24it/s] 53%|█████▎    | 108/204 [00:02<00:01, 63.43it/s] 56%|█████▋    | 115/204 [00:02<00:01, 63.10it/s] 61%|██████▏   | 125/204 [00:02<00:01, 70.39it/s] 66%|██████▌   | 135/204 [00:02<00:00, 75.97it/s] 71%|███████   | 145/204 [00:02<00:00, 80.23it/s] 75%|███████▌  | 154/204 [00:02<00:00, 66.67it/s] 79%|███████▉  | 162/204 [00:02<00:00, 62.93it/s] 84%|████████▍ | 172/204 [00:02<00:00, 69.96it/s] 89%|████████▉ | 182/204 [00:02<00:00, 75.59it/s] 94%|█████████▍| 192/204 [00:03<00:00, 79.99it/s] 99%|█████████▊| 201/204 [00:03<00:00, 68.38it/s]100%|██████████| 204/204 [00:03<00:00, 60.97it/s]
26032 images processed, 3.386538505554199 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:44,  1.74it/s]  8%|▊         | 6/79 [00:00<00:06, 11.16it/s] 15%|█▌        | 12/79 [00:00<00:03, 21.78it/s] 23%|██▎       | 18/79 [00:00<00:02, 29.73it/s] 29%|██▉       | 23/79 [00:01<00:01, 30.19it/s] 35%|███▌      | 28/79 [00:01<00:01, 34.36it/s] 44%|████▍     | 35/79 [00:01<00:01, 34.77it/s] 51%|█████     | 40/79 [00:01<00:01, 37.33it/s] 58%|█████▊    | 46/79 [00:01<00:00, 42.65it/s] 65%|██████▍   | 51/79 [00:01<00:00, 37.26it/s] 71%|███████   | 56/79 [00:01<00:00, 39.95it/s] 77%|███████▋  | 61/79 [00:02<00:00, 37.60it/s] 84%|████████▎ | 66/79 [00:02<00:00, 39.13it/s] 90%|████████▉ | 71/79 [00:02<00:00, 40.26it/s] 96%|█████████▌| 76/79 [00:02<00:00, 38.65it/s]100%|██████████| 79/79 [00:02<00:00, 32.48it/s]
10000 images processed, 2.46691632270813 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:31,  2.51it/s] 13%|█▎        | 10/79 [00:00<00:02, 25.62it/s] 24%|██▍       | 19/79 [00:00<00:01, 41.26it/s] 33%|███▎      | 26/79 [00:00<00:01, 42.39it/s] 41%|████      | 32/79 [00:00<00:01, 45.28it/s] 53%|█████▎    | 42/79 [00:00<00:00, 58.33it/s] 66%|██████▌   | 52/79 [00:01<00:00, 68.06it/s] 78%|███████▊  | 62/79 [00:01<00:00, 74.85it/s] 91%|█████████ | 72/79 [00:01<00:00, 80.55it/s]100%|██████████| 79/79 [00:01<00:00, 54.22it/s]
10000 images processed, 1.4778492450714111 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:25,  2.73it/s]  9%|▊         | 6/70 [00:00<00:04, 15.55it/s] 23%|██▎       | 16/70 [00:00<00:01, 38.17it/s] 37%|███▋      | 26/70 [00:00<00:00, 54.49it/s] 51%|█████▏    | 36/70 [00:00<00:00, 66.03it/s] 66%|██████▌   | 46/70 [00:00<00:00, 74.25it/s] 79%|███████▊  | 55/70 [00:01<00:00, 68.12it/s] 90%|█████████ | 63/70 [00:01<00:00, 59.31it/s]100%|██████████| 70/70 [00:01<00:00, 53.04it/s]
8925 images processed, 1.3510487079620361 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:00<00:40,  1.09it/s]  4%|▍         | 2/45 [00:01<00:19,  2.25it/s] 16%|█▌        | 7/45 [00:01<00:03,  9.67it/s] 22%|██▏       | 10/45 [00:01<00:04,  8.06it/s] 31%|███       | 14/45 [00:01<00:03,  8.98it/s] 40%|████      | 18/45 [00:02<00:02, 12.35it/s] 49%|████▉     | 22/45 [00:02<00:02, 10.08it/s] 60%|██████    | 27/45 [00:02<00:01, 13.25it/s] 67%|██████▋   | 30/45 [00:03<00:01, 11.38it/s] 76%|███████▌  | 34/45 [00:03<00:00, 13.02it/s] 84%|████████▍ | 38/45 [00:03<00:00, 15.76it/s] 93%|█████████▎| 42/45 [00:04<00:00, 10.79it/s]100%|██████████| 45/45 [00:04<00:00, 10.65it/s]
5640 images processed, 4.251264333724976 seconds used

21.856426000595093
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.53  99.36
places365     67.87  81.18
LSUN          17.60  96.07
iSUN          72.36  81.68
dtd           37.87  91.39
AVG           39.65  89.93
Retain-Acc: 0.7406
Forget-as-OOD (retain known vs forget novel):
  FPR: 79.50 AUROC: 86.90 AUIN: 98.36
9.646969318389893
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e10-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid
epochs=10 | cache=6 | flambda=0.2 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e10-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e10-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e10-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21610432
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<02:58,  2.18it/s]  2%|▏         | 8/391 [00:00<00:21, 17.67it/s]  4%|▎         | 14/391 [00:00<00:13, 27.00it/s]  5%|▍         | 19/391 [00:00<00:11, 32.67it/s]  6%|▋         | 25/391 [00:00<00:09, 38.42it/s]  8%|▊         | 30/391 [00:01<00:08, 41.00it/s]  9%|▉         | 35/391 [00:01<00:08, 42.93it/s] 10%|█         | 40/391 [00:01<00:07, 44.25it/s] 12%|█▏        | 46/391 [00:01<00:07, 46.77it/s] 13%|█▎        | 51/391 [00:01<00:07, 47.06it/s] 14%|█▍        | 56/391 [00:01<00:07, 47.83it/s] 16%|█▌        | 62/391 [00:01<00:06, 48.80it/s] 17%|█▋        | 67/391 [00:01<00:06, 48.15it/s] 18%|█▊        | 72/391 [00:01<00:06, 48.38it/s] 20%|█▉        | 77/391 [00:01<00:06, 48.44it/s] 21%|██        | 83/391 [00:02<00:06, 49.60it/s] 23%|██▎       | 88/391 [00:02<00:06, 49.03it/s] 24%|██▍       | 93/391 [00:02<00:06, 48.66it/s] 25%|██▌       | 98/391 [00:02<00:06, 48.35it/s] 26%|██▋       | 103/391 [00:02<00:05, 48.05it/s] 28%|██▊       | 108/391 [00:02<00:05, 47.94it/s] 29%|██▉       | 113/391 [00:02<00:05, 47.87it/s] 30%|███       | 118/391 [00:02<00:05, 47.92it/s] 32%|███▏      | 124/391 [00:02<00:05, 49.31it/s] 33%|███▎      | 129/391 [00:03<00:05, 48.94it/s] 34%|███▍      | 134/391 [00:03<00:05, 48.64it/s] 36%|███▌      | 139/391 [00:03<00:05, 48.90it/s] 37%|███▋      | 145/391 [00:03<00:04, 49.57it/s] 38%|███▊      | 150/391 [00:03<00:04, 49.03it/s] 40%|███▉      | 156/391 [00:03<00:04, 50.57it/s] 41%|████▏     | 162/391 [00:03<00:04, 50.64it/s] 43%|████▎     | 168/391 [00:03<00:04, 49.66it/s] 44%|████▍     | 173/391 [00:03<00:04, 49.05it/s] 46%|████▌     | 179/391 [00:04<00:04, 50.12it/s] 47%|████▋     | 185/391 [00:04<00:04, 49.31it/s] 49%|████▊     | 190/391 [00:04<00:04, 48.92it/s] 50%|█████     | 196/391 [00:04<00:03, 49.98it/s] 51%|█████▏    | 201/391 [00:04<00:03, 49.42it/s] 53%|█████▎    | 206/391 [00:04<00:03, 48.96it/s] 54%|█████▍    | 211/391 [00:04<00:03, 48.65it/s] 55%|█████▌    | 216/391 [00:04<00:03, 48.42it/s] 57%|█████▋    | 223/391 [00:04<00:03, 54.59it/s] 60%|█████▉    | 233/391 [00:05<00:02, 65.97it/s] 62%|██████▏   | 243/391 [00:05<00:01, 75.07it/s] 64%|██████▍   | 252/391 [00:05<00:01, 79.15it/s] 67%|██████▋   | 261/391 [00:05<00:01, 82.23it/s] 69%|██████▉   | 270/391 [00:05<00:01, 84.15it/s] 72%|███████▏  | 280/391 [00:05<00:01, 87.43it/s] 74%|███████▍  | 290/391 [00:05<00:01, 89.37it/s] 77%|███████▋  | 300/391 [00:05<00:01, 89.92it/s] 79%|███████▉  | 310/391 [00:05<00:00, 91.36it/s] 82%|████████▏ | 320/391 [00:05<00:00, 92.35it/s] 84%|████████▍ | 330/391 [00:06<00:00, 93.05it/s] 87%|████████▋ | 340/391 [00:06<00:00, 92.04it/s] 90%|████████▉ | 350/391 [00:06<00:00, 72.33it/s] 92%|█████████▏| 358/391 [00:06<00:00, 65.47it/s] 94%|█████████▎| 366/391 [00:06<00:00, 59.51it/s] 95%|█████████▌| 373/391 [00:06<00:00, 57.03it/s] 97%|█████████▋| 379/391 [00:06<00:00, 54.91it/s] 98%|█████████▊| 385/391 [00:07<00:00, 53.71it/s]100%|██████████| 391/391 [00:07<00:00, 52.51it/s]100%|██████████| 391/391 [00:07<00:00, 54.30it/s]
50000 images processed, 7.292237758636475 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:29,  2.60it/s]  8%|▊         | 6/79 [00:00<00:04, 15.39it/s] 19%|█▉        | 15/79 [00:00<00:01, 35.20it/s] 30%|███       | 24/79 [00:00<00:01, 50.12it/s] 43%|████▎     | 34/79 [00:00<00:00, 62.72it/s] 54%|█████▍    | 43/79 [00:00<00:00, 69.54it/s] 67%|██████▋   | 53/79 [00:01<00:00, 76.10it/s] 80%|███████▉  | 63/79 [00:01<00:00, 80.24it/s] 91%|█████████ | 72/79 [00:01<00:00, 75.19it/s]100%|██████████| 79/79 [00:01<00:00, 55.70it/s]
10000 images processed, 1.4444222450256348 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:10,  2.86it/s]  5%|▍         | 10/204 [00:00<00:06, 28.03it/s] 10%|▉         | 20/204 [00:00<00:03, 47.87it/s] 15%|█▍        | 30/204 [00:00<00:02, 61.16it/s] 19%|█▉        | 39/204 [00:00<00:02, 68.41it/s] 24%|██▎       | 48/204 [00:00<00:02, 60.43it/s] 27%|██▋       | 56/204 [00:01<00:02, 56.20it/s] 31%|███       | 63/204 [00:01<00:02, 53.81it/s] 34%|███▍      | 69/204 [00:01<00:02, 52.33it/s] 37%|███▋      | 75/204 [00:01<00:02, 51.25it/s] 40%|███▉      | 81/204 [00:01<00:02, 50.45it/s] 43%|████▎     | 87/204 [00:01<00:02, 49.90it/s] 46%|████▌     | 93/204 [00:01<00:02, 49.63it/s] 49%|████▊     | 99/204 [00:02<00:02, 49.22it/s] 51%|█████     | 104/204 [00:02<00:02, 48.96it/s] 53%|█████▎    | 109/204 [00:02<00:01, 48.92it/s] 58%|█████▊    | 118/204 [00:02<00:01, 59.63it/s] 63%|██████▎   | 128/204 [00:02<00:01, 69.19it/s] 67%|██████▋   | 137/204 [00:02<00:00, 73.98it/s] 72%|███████▏  | 147/204 [00:02<00:00, 79.50it/s] 76%|███████▋  | 156/204 [00:02<00:00, 82.39it/s] 81%|████████▏ | 166/204 [00:02<00:00, 85.00it/s] 86%|████████▋ | 176/204 [00:02<00:00, 86.78it/s] 91%|█████████ | 186/204 [00:03<00:00, 89.04it/s] 96%|█████████▌| 196/204 [00:03<00:00, 90.48it/s]100%|██████████| 204/204 [00:03<00:00, 62.60it/s]
26032 images processed, 3.302496910095215 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:39,  1.96it/s] 11%|█▏        | 9/79 [00:00<00:03, 17.51it/s] 22%|██▏       | 17/79 [00:00<00:02, 27.87it/s] 28%|██▊       | 22/79 [00:00<00:01, 29.76it/s] 34%|███▍      | 27/79 [00:01<00:01, 31.12it/s] 43%|████▎     | 34/79 [00:01<00:01, 34.51it/s] 53%|█████▎    | 42/79 [00:01<00:01, 36.47it/s] 63%|██████▎   | 50/79 [00:01<00:00, 39.38it/s] 71%|███████   | 56/79 [00:01<00:00, 42.54it/s] 78%|███████▊  | 62/79 [00:01<00:00, 45.39it/s] 85%|████████▍ | 67/79 [00:01<00:00, 44.58it/s] 94%|█████████▎| 74/79 [00:02<00:00, 44.68it/s]100%|██████████| 79/79 [00:02<00:00, 36.03it/s]
10000 images processed, 2.2249279022216797 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:34,  2.24it/s] 14%|█▍        | 11/79 [00:00<00:02, 25.47it/s] 27%|██▋       | 21/79 [00:00<00:01, 43.36it/s] 39%|███▉      | 31/79 [00:00<00:00, 56.78it/s] 52%|█████▏    | 41/79 [00:00<00:00, 66.59it/s] 65%|██████▍   | 51/79 [00:00<00:00, 74.00it/s] 77%|███████▋  | 61/79 [00:01<00:00, 79.83it/s] 90%|████████▉ | 71/79 [00:01<00:00, 83.93it/s]100%|██████████| 79/79 [00:01<00:00, 61.67it/s]
10000 images processed, 1.3023715019226074 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:31,  2.17it/s] 14%|█▍        | 10/70 [00:00<00:02, 22.90it/s] 29%|██▊       | 20/70 [00:00<00:01, 41.38it/s] 41%|████▏     | 29/70 [00:00<00:00, 53.46it/s] 56%|█████▌    | 39/70 [00:00<00:00, 64.65it/s] 70%|███████   | 49/70 [00:00<00:00, 72.86it/s] 84%|████████▍ | 59/70 [00:01<00:00, 78.81it/s] 99%|█████████▊| 69/70 [00:01<00:00, 83.35it/s]100%|██████████| 70/70 [00:01<00:00, 57.49it/s]
8925 images processed, 1.2494711875915527 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:00<00:39,  1.11it/s] 11%|█         | 5/45 [00:01<00:06,  6.35it/s] 20%|██        | 9/45 [00:01<00:04,  8.47it/s] 24%|██▍       | 11/45 [00:01<00:03,  9.08it/s] 38%|███▊      | 17/45 [00:01<00:02, 11.84it/s] 42%|████▏     | 19/45 [00:02<00:02, 12.00it/s] 51%|█████     | 23/45 [00:02<00:01, 16.13it/s] 58%|█████▊    | 26/45 [00:02<00:01, 11.99it/s] 67%|██████▋   | 30/45 [00:02<00:00, 15.05it/s] 73%|███████▎  | 33/45 [00:03<00:00, 12.90it/s] 78%|███████▊  | 35/45 [00:03<00:00, 11.24it/s] 91%|█████████ | 41/45 [00:03<00:00, 16.36it/s] 98%|█████████▊| 44/45 [00:04<00:00, 10.13it/s]100%|██████████| 45/45 [00:04<00:00, 10.87it/s]
5640 images processed, 4.158612251281738 seconds used

22.718394994735718
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.53  99.36
places365     67.87  81.18
LSUN          17.60  96.07
iSUN          72.36  81.68
dtd           37.87  91.39
AVG           39.65  89.93
Retain-Acc: 0.7406
Forget-as-OOD (retain known vs forget novel):
  FPR: 79.50 AUROC: 86.90 AUIN: 98.36
9.90899133682251
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e20-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid
epochs=20 | cache=6 | flambda=0.2 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e20-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e20-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e20-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21610432
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<01:54,  3.39it/s]  3%|▎         | 11/391 [00:00<00:11, 34.25it/s]  5%|▌         | 21/391 [00:00<00:06, 53.53it/s]  8%|▊         | 31/391 [00:00<00:05, 66.19it/s] 10%|█         | 41/391 [00:00<00:04, 75.04it/s] 13%|█▎        | 51/391 [00:00<00:04, 80.65it/s] 16%|█▌        | 61/391 [00:00<00:03, 86.23it/s] 18%|█▊        | 72/391 [00:01<00:03, 91.12it/s] 21%|██        | 82/391 [00:01<00:03, 93.51it/s] 24%|██▍       | 93/391 [00:01<00:03, 96.42it/s] 27%|██▋       | 104/391 [00:01<00:02, 98.20it/s] 29%|██▉       | 115/391 [00:01<00:02, 99.29it/s] 32%|███▏      | 126/391 [00:01<00:02, 99.13it/s] 35%|███▍      | 136/391 [00:01<00:02, 97.07it/s] 37%|███▋      | 146/391 [00:01<00:02, 96.06it/s] 40%|███▉      | 156/391 [00:01<00:02, 94.12it/s] 42%|████▏     | 166/391 [00:02<00:02, 94.56it/s] 45%|████▌     | 176/391 [00:02<00:02, 94.02it/s] 48%|████▊     | 186/391 [00:02<00:02, 93.61it/s] 50%|█████     | 196/391 [00:02<00:02, 91.08it/s] 53%|█████▎    | 206/391 [00:02<00:02, 91.73it/s] 55%|█████▌    | 216/391 [00:02<00:01, 92.37it/s] 58%|█████▊    | 226/391 [00:02<00:01, 92.41it/s] 60%|██████    | 236/391 [00:02<00:01, 92.76it/s] 63%|██████▎   | 246/391 [00:02<00:01, 93.27it/s] 65%|██████▌   | 256/391 [00:02<00:01, 94.04it/s] 68%|██████▊   | 266/391 [00:03<00:01, 94.22it/s] 71%|███████   | 276/391 [00:03<00:01, 94.37it/s] 73%|███████▎  | 286/391 [00:03<00:01, 94.18it/s] 76%|███████▌  | 296/391 [00:03<00:01, 94.54it/s] 78%|███████▊  | 306/391 [00:03<00:00, 94.46it/s] 81%|████████  | 316/391 [00:03<00:00, 93.01it/s] 83%|████████▎ | 326/391 [00:03<00:00, 92.91it/s] 86%|████████▌ | 336/391 [00:03<00:00, 91.48it/s] 88%|████████▊ | 346/391 [00:03<00:00, 92.37it/s] 91%|█████████ | 356/391 [00:04<00:00, 93.00it/s] 94%|█████████▎| 366/391 [00:04<00:00, 93.06it/s] 96%|█████████▌| 376/391 [00:04<00:00, 93.04it/s] 99%|█████████▊| 386/391 [00:04<00:00, 94.14it/s]100%|██████████| 391/391 [00:04<00:00, 88.39it/s]
50000 images processed, 4.507104873657227 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:22,  3.43it/s] 14%|█▍        | 11/79 [00:00<00:01, 34.29it/s] 25%|██▌       | 20/79 [00:00<00:01, 51.53it/s] 38%|███▊      | 30/79 [00:00<00:00, 65.10it/s] 51%|█████     | 40/79 [00:00<00:00, 73.79it/s] 62%|██████▏   | 49/79 [00:00<00:00, 78.49it/s] 75%|███████▍  | 59/79 [00:00<00:00, 82.94it/s] 87%|████████▋ | 69/79 [00:01<00:00, 87.07it/s]100%|██████████| 79/79 [00:01<00:00, 88.45it/s]100%|██████████| 79/79 [00:01<00:00, 69.45it/s]
10000 images processed, 1.159792423248291 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:38,  2.05it/s]  5%|▍         | 10/204 [00:00<00:08, 21.76it/s] 10%|▉         | 20/204 [00:00<00:04, 39.92it/s] 15%|█▍        | 30/204 [00:00<00:03, 53.99it/s] 19%|█▉        | 39/204 [00:00<00:02, 63.11it/s] 24%|██▍       | 49/204 [00:01<00:02, 71.44it/s] 28%|██▊       | 58/204 [00:01<00:01, 76.34it/s] 33%|███▎      | 68/204 [00:01<00:01, 80.87it/s] 38%|███▊      | 77/204 [00:01<00:01, 82.71it/s] 43%|████▎     | 87/204 [00:01<00:01, 85.29it/s] 48%|████▊     | 97/204 [00:01<00:01, 86.96it/s] 52%|█████▏    | 107/204 [00:01<00:01, 88.45it/s] 57%|█████▋    | 117/204 [00:01<00:00, 89.42it/s] 62%|██████▏   | 127/204 [00:01<00:00, 89.39it/s] 67%|██████▋   | 137/204 [00:01<00:00, 89.82it/s] 72%|███████▏  | 147/204 [00:02<00:00, 89.35it/s] 76%|███████▋  | 156/204 [00:02<00:00, 89.03it/s] 81%|████████  | 165/204 [00:02<00:00, 87.64it/s] 85%|████████▌ | 174/204 [00:02<00:00, 88.08it/s] 90%|█████████ | 184/204 [00:02<00:00, 89.19it/s] 95%|█████████▌| 194/204 [00:02<00:00, 90.57it/s]100%|██████████| 204/204 [00:02<00:00, 91.51it/s]100%|██████████| 204/204 [00:02<00:00, 74.49it/s]
26032 images processed, 2.7825827598571777 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:33,  2.31it/s] 11%|█▏        | 9/79 [00:00<00:03, 19.01it/s] 22%|██▏       | 17/79 [00:00<00:02, 29.78it/s] 28%|██▊       | 22/79 [00:00<00:01, 33.31it/s] 34%|███▍      | 27/79 [00:01<00:01, 32.15it/s] 44%|████▍     | 35/79 [00:01<00:01, 35.51it/s] 54%|█████▍    | 43/79 [00:01<00:00, 37.98it/s] 65%|██████▍   | 51/79 [00:01<00:00, 39.53it/s] 75%|███████▍  | 59/79 [00:01<00:00, 40.58it/s] 85%|████████▍ | 67/79 [00:01<00:00, 43.32it/s] 95%|█████████▍| 75/79 [00:02<00:00, 45.33it/s]100%|██████████| 79/79 [00:02<00:00, 37.12it/s]
10000 images processed, 2.1631219387054443 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:26,  2.92it/s] 14%|█▍        | 11/79 [00:00<00:02, 30.89it/s] 27%|██▋       | 21/79 [00:00<00:01, 50.07it/s] 39%|███▉      | 31/79 [00:00<00:00, 63.21it/s] 52%|█████▏    | 41/79 [00:00<00:00, 72.32it/s] 65%|██████▍   | 51/79 [00:00<00:00, 78.67it/s] 77%|███████▋  | 61/79 [00:00<00:00, 83.16it/s] 90%|████████▉ | 71/79 [00:01<00:00, 86.39it/s]100%|██████████| 79/79 [00:01<00:00, 67.65it/s]
10000 images processed, 1.1874594688415527 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:26,  2.57it/s] 16%|█▌        | 11/70 [00:00<00:02, 28.21it/s] 30%|███       | 21/70 [00:00<00:01, 46.94it/s] 44%|████▍     | 31/70 [00:00<00:00, 59.43it/s] 59%|█████▊    | 41/70 [00:00<00:00, 69.18it/s] 73%|███████▎  | 51/70 [00:00<00:00, 76.26it/s] 87%|████████▋ | 61/70 [00:01<00:00, 81.51it/s]100%|██████████| 70/70 [00:01<00:00, 61.60it/s]
8925 images processed, 1.1673502922058105 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:00<00:40,  1.08it/s]  4%|▍         | 2/45 [00:01<00:21,  2.01it/s] 20%|██        | 9/45 [00:01<00:03,  9.66it/s] 24%|██▍       | 11/45 [00:01<00:04,  7.89it/s] 38%|███▊      | 17/45 [00:01<00:01, 14.33it/s] 44%|████▍     | 20/45 [00:02<00:02, 10.52it/s] 58%|█████▊    | 26/45 [00:02<00:01, 10.22it/s] 76%|███████▌  | 34/45 [00:03<00:01, 10.34it/s] 93%|█████████▎| 42/45 [00:04<00:00, 11.02it/s]100%|██████████| 45/45 [00:04<00:00, 10.17it/s]
5640 images processed, 4.446486473083496 seconds used

19.238972425460815
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.53  99.36
places365     67.87  81.18
LSUN          17.60  96.07
iSUN          72.36  81.68
dtd           37.87  91.39
AVG           39.65  89.93
Retain-Acc: 0.7406
Forget-as-OOD (retain known vs forget novel):
  FPR: 79.50 AUROC: 86.90 AUIN: 98.36
10.1271653175354
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e50-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid
epochs=50 | cache=6 | flambda=0.2 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e50-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e50-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e50-lr0.0001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21610432
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<02:29,  2.61it/s]  3%|▎         | 10/391 [00:00<00:14, 25.80it/s]  5%|▌         | 20/391 [00:00<00:08, 45.64it/s]  8%|▊         | 30/391 [00:00<00:06, 59.46it/s] 10%|█         | 40/391 [00:00<00:05, 69.65it/s] 13%|█▎        | 49/391 [00:00<00:05, 66.28it/s] 15%|█▍        | 57/391 [00:01<00:05, 60.28it/s] 17%|█▋        | 65/391 [00:01<00:05, 63.75it/s] 19%|█▉        | 75/391 [00:01<00:04, 71.62it/s] 22%|██▏       | 85/391 [00:01<00:03, 77.11it/s] 24%|██▍       | 95/391 [00:01<00:03, 81.84it/s] 27%|██▋       | 104/391 [00:01<00:03, 74.94it/s] 29%|██▊       | 112/391 [00:01<00:04, 65.93it/s] 30%|███       | 119/391 [00:01<00:04, 66.89it/s] 33%|███▎      | 129/391 [00:02<00:03, 74.15it/s] 35%|███▌      | 138/391 [00:02<00:03, 78.06it/s] 38%|███▊      | 148/391 [00:02<00:02, 82.36it/s] 40%|████      | 157/391 [00:02<00:03, 71.51it/s] 42%|████▏     | 165/391 [00:02<00:03, 63.63it/s] 45%|████▍     | 175/391 [00:02<00:03, 70.77it/s] 47%|████▋     | 185/391 [00:02<00:02, 76.61it/s] 50%|████▉     | 195/391 [00:02<00:02, 81.51it/s] 52%|█████▏    | 205/391 [00:03<00:02, 84.99it/s] 55%|█████▍    | 214/391 [00:03<00:02, 73.52it/s] 57%|█████▋    | 222/391 [00:03<00:02, 65.53it/s] 59%|█████▉    | 231/391 [00:03<00:02, 70.51it/s] 62%|██████▏   | 241/391 [00:03<00:01, 76.04it/s] 64%|██████▍   | 251/391 [00:03<00:01, 80.98it/s] 67%|██████▋   | 261/391 [00:03<00:01, 82.01it/s] 69%|██████▉   | 270/391 [00:03<00:01, 68.24it/s] 71%|███████   | 278/391 [00:04<00:01, 65.18it/s] 74%|███████▎  | 288/391 [00:04<00:01, 72.40it/s] 76%|███████▌  | 298/391 [00:04<00:01, 78.03it/s] 79%|███████▉  | 308/391 [00:04<00:01, 82.64it/s] 81%|████████  | 317/391 [00:04<00:00, 81.57it/s] 83%|████████▎ | 326/391 [00:04<00:00, 68.78it/s] 85%|████████▌ | 334/391 [00:04<00:00, 66.16it/s] 88%|████████▊ | 344/391 [00:04<00:00, 73.01it/s] 91%|█████████ | 354/391 [00:05<00:00, 78.04it/s] 93%|█████████▎| 364/391 [00:05<00:00, 81.89it/s] 95%|█████████▌| 373/391 [00:05<00:00, 74.58it/s] 97%|█████████▋| 381/391 [00:05<00:00, 65.58it/s] 99%|█████████▉| 389/391 [00:05<00:00, 67.42it/s]100%|██████████| 391/391 [00:05<00:00, 69.36it/s]
50000 images processed, 5.741699934005737 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:31,  2.51it/s]  8%|▊         | 6/79 [00:00<00:04, 14.84it/s] 14%|█▍        | 11/79 [00:00<00:02, 24.29it/s] 22%|██▏       | 17/79 [00:00<00:01, 33.84it/s] 34%|███▍      | 27/79 [00:00<00:01, 51.58it/s] 47%|████▋     | 37/79 [00:00<00:00, 63.94it/s] 59%|█████▉    | 47/79 [00:01<00:00, 72.36it/s] 70%|██████▉   | 55/79 [00:01<00:00, 74.04it/s] 80%|███████▉  | 63/79 [00:01<00:00, 63.59it/s] 89%|████████▊ | 70/79 [00:01<00:00, 60.96it/s]100%|██████████| 79/79 [00:01<00:00, 51.72it/s]
10000 images processed, 1.5477614402770996 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:02,  3.27it/s]  4%|▍         | 9/204 [00:00<00:07, 27.11it/s]  9%|▉         | 19/204 [00:00<00:03, 48.37it/s] 14%|█▍        | 29/204 [00:00<00:02, 62.51it/s] 19%|█▉        | 39/204 [00:00<00:02, 71.61it/s] 24%|██▎       | 48/204 [00:00<00:02, 64.37it/s] 27%|██▋       | 56/204 [00:01<00:02, 58.19it/s] 32%|███▏      | 66/204 [00:01<00:02, 67.04it/s] 37%|███▋      | 76/204 [00:01<00:01, 73.75it/s] 42%|████▏     | 86/204 [00:01<00:01, 78.58it/s] 47%|████▋     | 95/204 [00:01<00:01, 73.27it/s] 50%|█████     | 103/204 [00:01<00:01, 62.66it/s] 54%|█████▍    | 111/204 [00:01<00:01, 65.58it/s] 59%|█████▉    | 121/204 [00:01<00:01, 72.21it/s] 64%|██████▎   | 130/204 [00:02<00:00, 76.50it/s] 68%|██████▊   | 138/204 [00:02<00:01, 65.40it/s] 71%|███████   | 145/204 [00:02<00:00, 59.95it/s] 76%|███████▌  | 155/204 [00:02<00:00, 68.27it/s] 80%|████████  | 164/204 [00:02<00:00, 73.59it/s] 85%|████████▍ | 173/204 [00:02<00:00, 77.89it/s] 89%|████████▉ | 182/204 [00:02<00:00, 64.82it/s] 93%|█████████▎| 190/204 [00:02<00:00, 62.05it/s] 98%|█████████▊| 200/204 [00:03<00:00, 69.95it/s]100%|██████████| 204/204 [00:03<00:00, 64.84it/s]
26032 images processed, 3.194594621658325 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:41,  1.88it/s] 11%|█▏        | 9/79 [00:00<00:04, 16.45it/s] 18%|█▊        | 14/79 [00:00<00:02, 22.83it/s] 24%|██▍       | 19/79 [00:00<00:02, 28.44it/s] 34%|███▍      | 27/79 [00:01<00:01, 40.41it/s] 42%|████▏     | 33/79 [00:01<00:01, 40.18it/s] 48%|████▊     | 38/79 [00:01<00:00, 41.70it/s] 56%|█████▌    | 44/79 [00:01<00:00, 45.82it/s] 63%|██████▎   | 50/79 [00:01<00:00, 47.81it/s] 71%|███████   | 56/79 [00:01<00:00, 46.30it/s] 77%|███████▋  | 61/79 [00:01<00:00, 45.91it/s] 87%|████████▋ | 69/79 [00:01<00:00, 54.01it/s] 95%|█████████▍| 75/79 [00:02<00:00, 46.04it/s]100%|██████████| 79/79 [00:02<00:00, 37.67it/s]
10000 images processed, 2.1310172080993652 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:29,  2.62it/s]  8%|▊         | 6/79 [00:00<00:04, 14.89it/s] 14%|█▍        | 11/79 [00:00<00:02, 23.82it/s] 27%|██▋       | 21/79 [00:00<00:01, 43.62it/s] 39%|███▉      | 31/79 [00:00<00:00, 58.01it/s] 52%|█████▏    | 41/79 [00:00<00:00, 68.49it/s] 65%|██████▍   | 51/79 [00:01<00:00, 76.00it/s] 76%|███████▌  | 60/79 [00:01<00:00, 63.47it/s] 86%|████████▌ | 68/79 [00:01<00:00, 61.10it/s] 99%|█████████▊| 78/79 [00:01<00:00, 69.50it/s]100%|██████████| 79/79 [00:01<00:00, 53.38it/s]
10000 images processed, 1.4998459815979004 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:25,  2.76it/s]  9%|▊         | 6/70 [00:00<00:04, 15.25it/s] 17%|█▋        | 12/70 [00:00<00:02, 26.09it/s] 30%|███       | 21/70 [00:00<00:01, 43.15it/s] 44%|████▍     | 31/70 [00:00<00:00, 57.79it/s] 59%|█████▊    | 41/70 [00:00<00:00, 68.29it/s] 71%|███████▏  | 50/70 [00:01<00:00, 73.41it/s] 84%|████████▍ | 59/70 [00:01<00:00, 60.09it/s] 94%|█████████▍| 66/70 [00:01<00:00, 61.13it/s]100%|██████████| 70/70 [00:01<00:00, 50.53it/s]
8925 images processed, 1.4181087017059326 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:00<00:41,  1.05it/s]  4%|▍         | 2/45 [00:01<00:20,  2.12it/s] 16%|█▌        | 7/45 [00:01<00:04,  9.27it/s] 22%|██▏       | 10/45 [00:01<00:04,  7.81it/s] 31%|███       | 14/45 [00:01<00:02, 11.92it/s] 38%|███▊      | 17/45 [00:02<00:02, 12.22it/s] 44%|████▍     | 20/45 [00:02<00:02, 11.38it/s] 53%|█████▎    | 24/45 [00:02<00:01, 15.36it/s] 60%|██████    | 27/45 [00:02<00:01, 11.64it/s] 67%|██████▋   | 30/45 [00:02<00:01, 13.08it/s] 73%|███████▎  | 33/45 [00:03<00:01, 11.63it/s] 78%|███████▊  | 35/45 [00:03<00:00, 10.01it/s] 91%|█████████ | 41/45 [00:03<00:00, 14.31it/s] 96%|█████████▌| 43/45 [00:04<00:00,  9.12it/s]100%|██████████| 45/45 [00:04<00:00, 10.16it/s]
5640 images processed, 4.450646638870239 seconds used

21.710567235946655
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.53  99.36
places365     67.87  81.18
LSUN          17.60  96.07
iSUN          72.36  81.68
dtd           37.87  91.39
AVG           39.65  89.93
Retain-Acc: 0.7406
Forget-as-OOD (retain known vs forget novel):
  FPR: 79.50 AUROC: 86.90 AUIN: 98.36
9.500778913497925
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.1-lora_r8a32d0.05-temp0.08-fullgrid
epochs=5 | cache=6 | flambda=0.1 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.1-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.1-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.1-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21610432
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<01:48,  3.60it/s]  3%|▎         | 11/391 [00:00<00:10, 35.73it/s]  5%|▌         | 21/391 [00:00<00:06, 55.52it/s]  8%|▊         | 30/391 [00:00<00:05, 66.14it/s] 10%|█         | 40/391 [00:00<00:04, 75.38it/s] 13%|█▎        | 49/391 [00:00<00:04, 79.67it/s] 15%|█▌        | 59/391 [00:00<00:03, 83.77it/s] 18%|█▊        | 69/391 [00:01<00:03, 87.96it/s] 20%|██        | 79/391 [00:01<00:03, 86.56it/s] 23%|██▎       | 89/391 [00:01<00:03, 88.89it/s] 25%|██▌       | 99/391 [00:01<00:03, 90.53it/s] 28%|██▊       | 109/391 [00:01<00:03, 91.76it/s] 30%|███       | 119/391 [00:01<00:02, 92.41it/s] 33%|███▎      | 129/391 [00:01<00:02, 93.14it/s] 36%|███▌      | 139/391 [00:01<00:02, 92.89it/s] 38%|███▊      | 149/391 [00:01<00:02, 92.91it/s] 41%|████      | 159/391 [00:01<00:02, 94.17it/s] 43%|████▎     | 169/391 [00:02<00:02, 94.15it/s] 46%|████▌     | 179/391 [00:02<00:02, 93.72it/s] 48%|████▊     | 189/391 [00:02<00:02, 93.92it/s] 51%|█████     | 199/391 [00:02<00:02, 93.58it/s] 53%|█████▎    | 209/391 [00:02<00:01, 92.58it/s] 56%|█████▌    | 219/391 [00:02<00:01, 93.46it/s] 59%|█████▊    | 229/391 [00:02<00:01, 92.15it/s] 61%|██████    | 239/391 [00:02<00:01, 92.95it/s] 64%|██████▎   | 249/391 [00:02<00:01, 92.16it/s] 66%|██████▌   | 259/391 [00:03<00:01, 92.81it/s] 69%|██████▉   | 269/391 [00:03<00:01, 92.43it/s] 71%|███████▏  | 279/391 [00:03<00:01, 92.81it/s] 74%|███████▍  | 289/391 [00:03<00:01, 93.20it/s] 76%|███████▋  | 299/391 [00:03<00:00, 93.42it/s] 79%|███████▉  | 309/391 [00:03<00:00, 93.76it/s] 82%|████████▏ | 319/391 [00:03<00:00, 93.55it/s] 84%|████████▍ | 329/391 [00:03<00:00, 95.35it/s] 87%|████████▋ | 339/391 [00:03<00:00, 94.73it/s] 89%|████████▉ | 349/391 [00:04<00:00, 94.46it/s] 92%|█████████▏| 359/391 [00:04<00:00, 93.48it/s] 94%|█████████▍| 369/391 [00:04<00:00, 92.53it/s] 97%|█████████▋| 379/391 [00:04<00:00, 92.67it/s] 99%|█████████▉| 389/391 [00:04<00:00, 94.02it/s]100%|██████████| 391/391 [00:04<00:00, 87.62it/s]
50000 images processed, 4.532502889633179 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:17,  4.46it/s] 13%|█▎        | 10/79 [00:00<00:01, 36.65it/s] 25%|██▌       | 20/79 [00:00<00:01, 56.93it/s] 38%|███▊      | 30/79 [00:00<00:00, 69.04it/s] 51%|█████     | 40/79 [00:00<00:00, 76.65it/s] 62%|██████▏   | 49/79 [00:00<00:00, 80.47it/s] 75%|███████▍  | 59/79 [00:00<00:00, 84.61it/s] 87%|████████▋ | 69/79 [00:00<00:00, 87.57it/s]100%|██████████| 79/79 [00:01<00:00, 89.06it/s]100%|██████████| 79/79 [00:01<00:00, 73.06it/s]
10000 images processed, 1.1157631874084473 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:03,  3.21it/s]  5%|▌         | 11/204 [00:00<00:05, 32.64it/s] 10%|█         | 21/204 [00:00<00:03, 51.60it/s] 15%|█▌        | 31/204 [00:00<00:02, 65.28it/s] 20%|██        | 41/204 [00:00<00:02, 73.45it/s] 25%|██▍       | 50/204 [00:00<00:01, 77.73it/s] 29%|██▉       | 60/204 [00:00<00:01, 82.15it/s] 34%|███▍      | 69/204 [00:01<00:01, 83.65it/s] 39%|███▊      | 79/204 [00:01<00:01, 86.26it/s] 44%|████▎     | 89/204 [00:01<00:01, 88.20it/s] 49%|████▊     | 99/204 [00:01<00:01, 89.18it/s] 53%|█████▎    | 109/204 [00:01<00:01, 89.90it/s] 58%|█████▊    | 119/204 [00:01<00:00, 90.74it/s] 63%|██████▎   | 129/204 [00:01<00:00, 91.18it/s] 68%|██████▊   | 139/204 [00:01<00:00, 91.57it/s] 73%|███████▎  | 149/204 [00:01<00:00, 91.62it/s] 78%|███████▊  | 159/204 [00:02<00:00, 92.82it/s] 83%|████████▎ | 169/204 [00:02<00:00, 92.50it/s] 88%|████████▊ | 179/204 [00:02<00:00, 92.29it/s] 93%|█████████▎| 189/204 [00:02<00:00, 88.35it/s] 98%|█████████▊| 199/204 [00:02<00:00, 90.26it/s]100%|██████████| 204/204 [00:02<00:00, 80.59it/s]
26032 images processed, 2.5674636363983154 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:37,  2.08it/s] 11%|█▏        | 9/79 [00:00<00:04, 16.42it/s] 22%|██▏       | 17/79 [00:00<00:02, 24.61it/s] 32%|███▏      | 25/79 [00:01<00:01, 30.36it/s] 42%|████▏     | 33/79 [00:01<00:01, 34.05it/s] 52%|█████▏    | 41/79 [00:01<00:01, 36.52it/s] 62%|██████▏   | 49/79 [00:01<00:00, 38.20it/s] 72%|███████▏  | 57/79 [00:01<00:00, 38.97it/s] 82%|████████▏ | 65/79 [00:01<00:00, 42.00it/s] 92%|█████████▏| 73/79 [00:02<00:00, 44.13it/s]100%|██████████| 79/79 [00:02<00:00, 35.82it/s]
10000 images processed, 2.2512316703796387 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:25,  3.06it/s] 14%|█▍        | 11/79 [00:00<00:02, 31.91it/s] 27%|██▋       | 21/79 [00:00<00:01, 51.18it/s] 39%|███▉      | 31/79 [00:00<00:00, 63.81it/s] 52%|█████▏    | 41/79 [00:00<00:00, 73.53it/s] 65%|██████▍   | 51/79 [00:00<00:00, 79.71it/s] 77%|███████▋  | 61/79 [00:00<00:00, 84.01it/s] 90%|████████▉ | 71/79 [00:01<00:00, 87.31it/s]100%|██████████| 79/79 [00:01<00:00, 68.78it/s]
10000 images processed, 1.1747410297393799 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:25,  2.75it/s] 16%|█▌        | 11/70 [00:00<00:01, 29.60it/s] 30%|███       | 21/70 [00:00<00:01, 48.64it/s] 44%|████▍     | 31/70 [00:00<00:00, 62.25it/s] 59%|█████▊    | 41/70 [00:00<00:00, 72.13it/s] 73%|███████▎  | 51/70 [00:00<00:00, 78.57it/s] 87%|████████▋ | 61/70 [00:00<00:00, 83.38it/s]100%|██████████| 70/70 [00:01<00:00, 63.79it/s]
8925 images processed, 1.1275219917297363 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:00<00:40,  1.08it/s] 11%|█         | 5/45 [00:01<00:06,  6.24it/s] 20%|██        | 9/45 [00:01<00:04,  7.86it/s] 31%|███       | 14/45 [00:01<00:02, 11.45it/s] 38%|███▊      | 17/45 [00:02<00:02, 10.02it/s] 49%|████▉     | 22/45 [00:02<00:01, 13.46it/s] 56%|█████▌    | 25/45 [00:02<00:01, 11.30it/s] 67%|██████▋   | 30/45 [00:02<00:01, 13.96it/s] 73%|███████▎  | 33/45 [00:03<00:01,  9.67it/s] 84%|████████▍ | 38/45 [00:03<00:00, 13.70it/s] 91%|█████████ | 41/45 [00:03<00:00, 11.92it/s]100%|██████████| 45/45 [00:03<00:00, 11.26it/s]
5640 images processed, 4.014490604400635 seconds used

18.321983337402344
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.53  99.36
places365     67.87  81.18
LSUN          17.60  96.07
iSUN          72.36  81.68
dtd           37.87  91.39
AVG           39.65  89.93
Retain-Acc: 0.7406
Forget-as-OOD (retain known vs forget novel):
  FPR: 79.50 AUROC: 86.90 AUIN: 98.36
8.767963647842407
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e10-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.1-lora_r8a32d0.05-temp0.08-fullgrid
epochs=10 | cache=6 | flambda=0.1 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e10-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.1-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e10-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.1-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e10-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.1-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21610432
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<01:54,  3.41it/s]  3%|▎         | 11/391 [00:00<00:11, 34.11it/s]  5%|▌         | 21/391 [00:00<00:06, 53.61it/s]  8%|▊         | 31/391 [00:00<00:05, 66.51it/s] 10%|█         | 41/391 [00:00<00:04, 75.44it/s] 13%|█▎        | 50/391 [00:00<00:04, 72.34it/s] 15%|█▍        | 58/391 [00:01<00:05, 63.78it/s] 17%|█▋        | 66/391 [00:01<00:05, 64.48it/s] 19%|█▉        | 75/391 [00:01<00:04, 70.34it/s] 22%|██▏       | 85/391 [00:01<00:03, 76.98it/s] 24%|██▍       | 94/391 [00:01<00:03, 80.39it/s] 26%|██▋       | 103/391 [00:01<00:04, 68.59it/s] 28%|██▊       | 111/391 [00:01<00:04, 62.70it/s] 31%|███       | 121/391 [00:01<00:03, 70.61it/s] 34%|███▎      | 131/391 [00:01<00:03, 76.68it/s] 36%|███▌      | 141/391 [00:02<00:03, 81.48it/s] 38%|███▊      | 150/391 [00:02<00:03, 78.34it/s] 41%|████      | 159/391 [00:02<00:03, 67.00it/s] 43%|████▎     | 167/391 [00:02<00:03, 66.46it/s] 45%|████▌     | 177/391 [00:02<00:02, 73.40it/s] 48%|████▊     | 186/391 [00:02<00:02, 76.14it/s] 50%|████▉     | 195/391 [00:02<00:02, 76.94it/s] 52%|█████▏    | 203/391 [00:03<00:02, 66.09it/s] 54%|█████▎    | 210/391 [00:03<00:02, 62.91it/s] 56%|█████▌    | 219/391 [00:03<00:02, 69.07it/s] 59%|█████▊    | 229/391 [00:03<00:02, 75.97it/s] 61%|██████    | 239/391 [00:03<00:01, 80.45it/s] 63%|██████▎   | 248/391 [00:03<00:01, 74.32it/s] 65%|██████▌   | 256/391 [00:03<00:02, 65.20it/s] 67%|██████▋   | 263/391 [00:03<00:01, 66.31it/s] 70%|██████▉   | 272/391 [00:03<00:01, 71.26it/s] 72%|███████▏  | 282/391 [00:04<00:01, 76.65it/s] 74%|███████▍  | 290/391 [00:04<00:01, 75.03it/s] 76%|███████▌  | 298/391 [00:04<00:01, 65.62it/s] 78%|███████▊  | 305/391 [00:04<00:01, 63.14it/s] 81%|████████  | 315/391 [00:04<00:01, 71.11it/s] 83%|████████▎ | 325/391 [00:04<00:00, 77.41it/s] 86%|████████▌ | 335/391 [00:04<00:00, 82.27it/s] 88%|████████▊ | 344/391 [00:04<00:00, 81.09it/s] 90%|█████████ | 353/391 [00:05<00:00, 68.27it/s] 92%|█████████▏| 361/391 [00:05<00:00, 65.78it/s] 95%|█████████▍| 371/391 [00:05<00:00, 73.18it/s] 97%|█████████▋| 380/391 [00:05<00:00, 76.43it/s]100%|█████████▉| 390/391 [00:05<00:00, 81.98it/s]100%|██████████| 391/391 [00:05<00:00, 70.23it/s]
50000 images processed, 5.675110578536987 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:27,  2.88it/s]  8%|▊         | 6/79 [00:00<00:04, 16.45it/s] 15%|█▌        | 12/79 [00:00<00:02, 27.61it/s] 27%|██▋       | 21/79 [00:00<00:01, 44.27it/s] 39%|███▉      | 31/79 [00:00<00:00, 58.34it/s] 52%|█████▏    | 41/79 [00:00<00:00, 68.50it/s] 62%|██████▏   | 49/79 [00:01<00:00, 66.87it/s] 72%|███████▏  | 57/79 [00:01<00:00, 60.51it/s] 81%|████████  | 64/79 [00:01<00:00, 61.20it/s] 94%|█████████▎| 74/79 [00:01<00:00, 70.63it/s]100%|██████████| 79/79 [00:01<00:00, 54.43it/s]
10000 images processed, 1.470860481262207 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<00:51,  3.96it/s]  3%|▎         | 7/204 [00:00<00:08, 23.52it/s]  8%|▊         | 17/204 [00:00<00:03, 48.02it/s] 13%|█▎        | 27/204 [00:00<00:02, 62.79it/s] 18%|█▊        | 37/204 [00:00<00:02, 72.72it/s] 23%|██▎       | 46/204 [00:00<00:02, 74.01it/s] 26%|██▋       | 54/204 [00:00<00:02, 61.89it/s] 30%|██▉       | 61/204 [00:01<00:02, 60.72it/s] 35%|███▍      | 71/204 [00:01<00:01, 69.36it/s] 40%|███▉      | 81/204 [00:01<00:01, 76.04it/s] 45%|████▍     | 91/204 [00:01<00:01, 80.26it/s] 49%|████▉     | 100/204 [00:01<00:01, 65.12it/s] 53%|█████▎    | 108/204 [00:01<00:01, 63.48it/s] 58%|█████▊    | 118/204 [00:01<00:01, 70.66it/s] 63%|██████▎   | 128/204 [00:01<00:00, 76.53it/s] 68%|██████▊   | 138/204 [00:02<00:00, 81.18it/s] 72%|███████▏  | 147/204 [00:02<00:00, 77.43it/s] 76%|███████▌  | 155/204 [00:02<00:00, 64.96it/s] 79%|███████▉  | 162/204 [00:02<00:00, 65.81it/s] 84%|████████▍ | 172/204 [00:02<00:00, 73.03it/s] 89%|████████▉ | 182/204 [00:02<00:00, 78.58it/s] 94%|█████████▍| 192/204 [00:02<00:00, 83.03it/s] 99%|█████████▊| 201/204 [00:02<00:00, 79.29it/s]100%|██████████| 204/204 [00:02<00:00, 68.02it/s]
26032 images processed, 3.035344362258911 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:35,  2.18it/s] 11%|█▏        | 9/79 [00:00<00:03, 17.81it/s] 18%|█▊        | 14/79 [00:00<00:02, 24.54it/s] 24%|██▍       | 19/79 [00:00<00:01, 30.62it/s] 32%|███▏      | 25/79 [00:00<00:01, 34.70it/s] 38%|███▊      | 30/79 [00:01<00:01, 37.06it/s] 44%|████▍     | 35/79 [00:01<00:01, 38.91it/s] 52%|█████▏    | 41/79 [00:01<00:00, 40.38it/s] 58%|█████▊    | 46/79 [00:01<00:00, 41.19it/s] 65%|██████▍   | 51/79 [00:01<00:00, 42.43it/s] 72%|███████▏  | 57/79 [00:01<00:00, 44.14it/s] 82%|████████▏ | 65/79 [00:01<00:00, 45.12it/s] 89%|████████▊ | 70/79 [00:01<00:00, 45.55it/s] 99%|█████████▊| 78/79 [00:02<00:00, 53.48it/s]100%|██████████| 79/79 [00:02<00:00, 37.98it/s]
10000 images processed, 2.109776496887207 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:28,  2.74it/s]  8%|▊         | 6/79 [00:00<00:04, 15.54it/s] 16%|█▋        | 13/79 [00:00<00:02, 29.98it/s] 29%|██▉       | 23/79 [00:00<00:01, 48.69it/s] 42%|████▏     | 33/79 [00:00<00:00, 61.93it/s] 54%|█████▍    | 43/79 [00:00<00:00, 71.01it/s] 66%|██████▌   | 52/79 [00:01<00:00, 66.00it/s] 76%|███████▌  | 60/79 [00:01<00:00, 57.90it/s] 89%|████████▊ | 70/79 [00:01<00:00, 66.53it/s]100%|██████████| 79/79 [00:01<00:00, 54.96it/s]
10000 images processed, 1.4572253227233887 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:22,  3.04it/s] 16%|█▌        | 11/70 [00:00<00:01, 31.41it/s] 24%|██▍       | 17/70 [00:00<00:01, 36.74it/s] 33%|███▎      | 23/70 [00:00<00:01, 39.87it/s] 43%|████▎     | 30/70 [00:00<00:00, 47.92it/s] 57%|█████▋    | 40/70 [00:00<00:00, 61.16it/s] 71%|███████▏  | 50/70 [00:01<00:00, 70.59it/s] 86%|████████▌ | 60/70 [00:01<00:00, 75.76it/s] 99%|█████████▊| 69/70 [00:01<00:00, 62.33it/s]100%|██████████| 70/70 [00:01<00:00, 51.84it/s]
8925 images processed, 1.3807814121246338 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:00<00:39,  1.12it/s] 13%|█▎        | 6/45 [00:00<00:04,  7.82it/s] 20%|██        | 9/45 [00:01<00:04,  8.11it/s] 24%|██▍       | 11/45 [00:01<00:03,  9.10it/s] 31%|███       | 14/45 [00:01<00:02, 11.57it/s] 38%|███▊      | 17/45 [00:01<00:02, 11.44it/s] 44%|████▍     | 20/45 [00:02<00:01, 14.21it/s] 49%|████▉     | 22/45 [00:02<00:01, 12.96it/s] 56%|█████▌    | 25/45 [00:02<00:01, 13.11it/s] 60%|██████    | 27/45 [00:02<00:01, 13.37it/s] 67%|██████▋   | 30/45 [00:02<00:01, 13.20it/s] 71%|███████   | 32/45 [00:02<00:01, 12.95it/s] 76%|███████▌  | 34/45 [00:03<00:01, 10.76it/s] 87%|████████▋ | 39/45 [00:03<00:00, 13.16it/s] 93%|█████████▎| 42/45 [00:04<00:00,  9.08it/s]100%|██████████| 45/45 [00:04<00:00, 10.81it/s]
5640 images processed, 4.185608386993408 seconds used

20.98377561569214
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.53  99.36
places365     67.87  81.18
LSUN          17.60  96.07
iSUN          72.36  81.68
dtd           37.87  91.39
AVG           39.65  89.93
Retain-Acc: 0.7406
Forget-as-OOD (retain known vs forget novel):
  FPR: 79.50 AUROC: 86.90 AUIN: 98.36
8.724761962890625
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e20-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.1-lora_r8a32d0.05-temp0.08-fullgrid
epochs=20 | cache=6 | flambda=0.1 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e20-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.1-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e20-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.1-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e20-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.1-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21610432
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<02:00,  3.22it/s]  2%|▏         | 6/391 [00:00<00:21, 17.76it/s]  3%|▎         | 12/391 [00:00<00:13, 29.07it/s]  5%|▍         | 19/391 [00:00<00:09, 40.87it/s]  7%|▋         | 29/391 [00:00<00:06, 57.43it/s] 10%|▉         | 39/391 [00:00<00:05, 67.94it/s] 13%|█▎        | 49/391 [00:00<00:04, 76.18it/s] 15%|█▍        | 58/391 [00:01<00:05, 65.75it/s] 17%|█▋        | 66/391 [00:01<00:05, 60.77it/s] 19%|█▉        | 76/391 [00:01<00:04, 69.35it/s] 22%|██▏       | 86/391 [00:01<00:04, 76.05it/s] 25%|██▍       | 96/391 [00:01<00:03, 80.55it/s] 27%|██▋       | 105/391 [00:01<00:03, 75.69it/s] 29%|██▉       | 113/391 [00:01<00:04, 66.12it/s] 31%|███       | 120/391 [00:02<00:04, 65.75it/s] 33%|███▎      | 130/391 [00:02<00:03, 73.33it/s] 36%|███▌      | 140/391 [00:02<00:03, 79.10it/s] 38%|███▊      | 150/391 [00:02<00:02, 83.58it/s] 41%|████      | 159/391 [00:02<00:03, 75.76it/s] 43%|████▎     | 167/391 [00:02<00:03, 66.40it/s] 45%|████▍     | 174/391 [00:02<00:03, 67.10it/s] 47%|████▋     | 184/391 [00:02<00:02, 74.76it/s] 49%|████▉     | 193/391 [00:02<00:02, 77.08it/s] 51%|█████▏    | 201/391 [00:03<00:02, 72.66it/s] 53%|█████▎    | 209/391 [00:03<00:02, 64.28it/s] 55%|█████▌    | 216/391 [00:03<00:02, 64.02it/s] 58%|█████▊    | 226/391 [00:03<00:02, 71.44it/s] 60%|██████    | 235/391 [00:03<00:02, 75.68it/s] 62%|██████▏   | 243/391 [00:03<00:02, 73.95it/s] 64%|██████▍   | 251/391 [00:03<00:02, 64.92it/s] 66%|██████▌   | 258/391 [00:03<00:02, 62.96it/s] 69%|██████▊   | 268/391 [00:04<00:01, 71.02it/s] 71%|███████   | 278/391 [00:04<00:01, 76.55it/s] 73%|███████▎  | 287/391 [00:04<00:01, 78.78it/s] 76%|███████▌  | 296/391 [00:04<00:01, 66.12it/s] 78%|███████▊  | 304/391 [00:04<00:01, 64.00it/s] 80%|████████  | 314/391 [00:04<00:01, 71.66it/s] 83%|████████▎ | 323/391 [00:04<00:00, 75.99it/s] 85%|████████▌ | 333/391 [00:04<00:00, 81.12it/s] 87%|████████▋ | 342/391 [00:05<00:00, 69.27it/s] 90%|████████▉ | 350/391 [00:05<00:00, 62.36it/s] 92%|█████████▏| 360/391 [00:05<00:00, 69.72it/s] 95%|█████████▍| 370/391 [00:05<00:00, 75.40it/s] 97%|█████████▋| 379/391 [00:05<00:00, 79.04it/s] 99%|█████████▉| 389/391 [00:05<00:00, 81.91it/s]100%|██████████| 391/391 [00:05<00:00, 68.27it/s]
50000 images processed, 5.83462929725647 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:27,  2.79it/s]  8%|▊         | 6/79 [00:00<00:04, 15.86it/s] 14%|█▍        | 11/79 [00:00<00:02, 25.57it/s] 25%|██▌       | 20/79 [00:00<00:01, 42.98it/s] 34%|███▍      | 27/79 [00:00<00:01, 49.03it/s] 42%|████▏     | 33/79 [00:00<00:00, 48.91it/s] 49%|████▉     | 39/79 [00:01<00:00, 48.83it/s] 57%|█████▋    | 45/79 [00:01<00:00, 48.76it/s] 65%|██████▍   | 51/79 [00:01<00:00, 48.74it/s] 72%|███████▏  | 57/79 [00:01<00:00, 48.72it/s] 80%|███████▉  | 63/79 [00:01<00:00, 48.70it/s] 86%|████████▌ | 68/79 [00:01<00:00, 44.68it/s] 92%|█████████▏| 73/79 [00:01<00:00, 40.26it/s] 99%|█████████▊| 78/79 [00:01<00:00, 38.53it/s]100%|██████████| 79/79 [00:01<00:00, 39.79it/s]
10000 images processed, 2.019606828689575 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:16,  2.64it/s]  3%|▎         | 6/204 [00:00<00:12, 15.47it/s]  5%|▌         | 11/204 [00:00<00:07, 24.83it/s]  8%|▊         | 16/204 [00:00<00:05, 31.61it/s] 10%|█         | 21/204 [00:00<00:05, 36.31it/s] 13%|█▎        | 26/204 [00:00<00:04, 38.65it/s] 15%|█▌        | 31/204 [00:01<00:04, 41.42it/s] 18%|█▊        | 36/204 [00:01<00:03, 43.24it/s] 20%|██        | 41/204 [00:01<00:03, 43.92it/s] 23%|██▎       | 46/204 [00:01<00:04, 37.33it/s] 25%|██▌       | 51/204 [00:01<00:04, 34.08it/s] 27%|██▋       | 55/204 [00:01<00:04, 34.14it/s] 29%|██▉       | 60/204 [00:01<00:03, 37.22it/s] 32%|███▏      | 65/204 [00:01<00:03, 40.04it/s] 34%|███▍      | 70/204 [00:02<00:03, 42.21it/s] 37%|███▋      | 75/204 [00:02<00:02, 43.86it/s] 39%|███▉      | 80/204 [00:02<00:02, 45.07it/s] 42%|████▏     | 85/204 [00:02<00:02, 45.90it/s] 44%|████▍     | 90/204 [00:02<00:02, 46.47it/s] 47%|████▋     | 95/204 [00:02<00:02, 46.95it/s] 49%|████▉     | 100/204 [00:02<00:02, 46.98it/s] 51%|█████▏    | 105/204 [00:02<00:02, 43.36it/s] 54%|█████▍    | 110/204 [00:02<00:02, 37.21it/s] 56%|█████▌    | 114/204 [00:03<00:02, 34.57it/s] 58%|█████▊    | 118/204 [00:03<00:02, 34.49it/s] 60%|██████    | 123/204 [00:03<00:02, 37.74it/s] 63%|██████▎   | 128/204 [00:03<00:01, 40.25it/s] 65%|██████▌   | 133/204 [00:03<00:01, 42.45it/s] 68%|██████▊   | 138/204 [00:03<00:01, 44.06it/s] 70%|███████   | 143/204 [00:03<00:01, 45.19it/s] 73%|███████▎  | 148/204 [00:03<00:01, 46.02it/s] 75%|███████▌  | 153/204 [00:03<00:01, 46.64it/s] 77%|███████▋  | 158/204 [00:04<00:00, 47.14it/s] 80%|███████▉  | 163/204 [00:04<00:00, 47.40it/s] 82%|████████▏ | 168/204 [00:04<00:00, 43.41it/s] 85%|████████▍ | 173/204 [00:04<00:00, 37.24it/s] 87%|████████▋ | 177/204 [00:04<00:00, 34.60it/s] 89%|████████▊ | 181/204 [00:04<00:00, 35.13it/s] 91%|█████████ | 186/204 [00:04<00:00, 38.50it/s] 94%|█████████▎| 191/204 [00:04<00:00, 41.08it/s] 96%|█████████▌| 196/204 [00:05<00:00, 42.99it/s] 99%|█████████▊| 201/204 [00:05<00:00, 44.52it/s]100%|██████████| 204/204 [00:05<00:00, 39.30it/s]
26032 images processed, 5.238177299499512 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:43,  1.78it/s]  8%|▊         | 6/79 [00:00<00:06, 11.27it/s] 14%|█▍        | 11/79 [00:00<00:03, 19.36it/s] 20%|██        | 16/79 [00:00<00:02, 26.32it/s] 27%|██▋       | 21/79 [00:00<00:01, 31.93it/s] 33%|███▎      | 26/79 [00:01<00:01, 36.30it/s] 39%|███▉      | 31/79 [00:01<00:01, 39.56it/s] 46%|████▌     | 36/79 [00:01<00:01, 41.97it/s] 52%|█████▏    | 41/79 [00:01<00:00, 43.75it/s] 58%|█████▊    | 46/79 [00:01<00:00, 45.01it/s] 65%|██████▍   | 51/79 [00:01<00:00, 45.93it/s] 71%|███████   | 56/79 [00:01<00:00, 39.00it/s] 77%|███████▋  | 61/79 [00:01<00:00, 35.09it/s] 82%|████████▏ | 65/79 [00:02<00:00, 33.89it/s] 91%|█████████ | 72/79 [00:02<00:00, 42.34it/s]100%|██████████| 79/79 [00:02<00:00, 34.95it/s]
10000 images processed, 2.294950485229492 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:30,  2.59it/s]  8%|▊         | 6/79 [00:00<00:04, 15.29it/s] 18%|█▊        | 14/79 [00:00<00:01, 32.93it/s] 25%|██▌       | 20/79 [00:00<00:01, 37.97it/s] 33%|███▎      | 26/79 [00:00<00:01, 41.25it/s] 39%|███▉      | 31/79 [00:00<00:01, 43.19it/s] 46%|████▌     | 36/79 [00:01<00:00, 44.64it/s] 52%|█████▏    | 41/79 [00:01<00:00, 45.67it/s] 58%|█████▊    | 46/79 [00:01<00:00, 46.72it/s] 65%|██████▍   | 51/79 [00:01<00:00, 47.19it/s] 71%|███████   | 56/79 [00:01<00:00, 45.47it/s] 77%|███████▋  | 61/79 [00:01<00:00, 39.19it/s] 84%|████████▎ | 66/79 [00:01<00:00, 36.05it/s] 89%|████████▊ | 70/79 [00:01<00:00, 36.86it/s] 95%|█████████▍| 75/79 [00:02<00:00, 39.80it/s]100%|██████████| 79/79 [00:02<00:00, 37.95it/s]
10000 images processed, 2.1026668548583984 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:26,  2.63it/s]  7%|▋         | 5/70 [00:00<00:05, 11.89it/s] 14%|█▍        | 10/70 [00:00<00:02, 21.05it/s] 21%|██▏       | 15/70 [00:00<00:01, 28.47it/s] 29%|██▊       | 20/70 [00:00<00:01, 34.03it/s] 36%|███▌      | 25/70 [00:00<00:01, 38.12it/s] 43%|████▎     | 30/70 [00:01<00:00, 41.07it/s] 50%|█████     | 35/70 [00:01<00:00, 43.20it/s] 57%|█████▋    | 40/70 [00:01<00:00, 44.68it/s] 64%|██████▍   | 45/70 [00:01<00:00, 45.74it/s] 71%|███████▏  | 50/70 [00:01<00:00, 46.48it/s] 79%|███████▊  | 55/70 [00:01<00:00, 47.00it/s] 86%|████████▌ | 60/70 [00:01<00:00, 43.48it/s] 93%|█████████▎| 65/70 [00:01<00:00, 38.10it/s]100%|██████████| 70/70 [00:02<00:00, 35.76it/s]100%|██████████| 70/70 [00:02<00:00, 34.61it/s]
8925 images processed, 2.0529446601867676 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:01<00:44,  1.01s/it]  9%|▉         | 4/45 [00:01<00:08,  4.56it/s] 20%|██        | 9/45 [00:01<00:04,  7.75it/s] 24%|██▍       | 11/45 [00:01<00:03,  8.93it/s] 31%|███       | 14/45 [00:01<00:02, 11.28it/s] 38%|███▊      | 17/45 [00:02<00:02,  9.46it/s] 49%|████▉     | 22/45 [00:02<00:01, 12.88it/s] 56%|█████▌    | 25/45 [00:02<00:01, 10.35it/s] 67%|██████▋   | 30/45 [00:03<00:01, 13.50it/s] 73%|███████▎  | 33/45 [00:03<00:01,  9.29it/s] 84%|████████▍ | 38/45 [00:03<00:00, 13.22it/s] 91%|█████████ | 41/45 [00:04<00:00, 11.24it/s]100%|██████████| 45/45 [00:04<00:00, 10.52it/s]
5640 images processed, 4.295828104019165 seconds used

25.588895082473755
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.53  99.36
places365     67.87  81.18
LSUN          17.60  96.07
iSUN          72.36  81.68
dtd           37.87  91.39
AVG           39.65  89.93
Retain-Acc: 0.7406
Forget-as-OOD (retain known vs forget novel):
  FPR: 79.50 AUROC: 86.90 AUIN: 98.36
9.113417625427246
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e50-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.1-lora_r8a32d0.05-temp0.08-fullgrid
epochs=50 | cache=6 | flambda=0.1 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e50-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.1-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e50-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.1-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e50-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.1-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21610432
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<01:39,  3.94it/s]  3%|▎         | 11/391 [00:00<00:10, 36.65it/s]  4%|▍         | 17/391 [00:00<00:09, 41.01it/s]  6%|▌         | 23/391 [00:00<00:08, 44.23it/s]  8%|▊         | 31/391 [00:00<00:06, 53.11it/s] 10%|█         | 41/391 [00:00<00:05, 65.84it/s] 13%|█▎        | 51/391 [00:00<00:04, 74.85it/s] 16%|█▌        | 61/391 [00:01<00:04, 81.04it/s] 18%|█▊        | 71/391 [00:01<00:03, 85.15it/s] 20%|██        | 80/391 [00:01<00:04, 74.62it/s] 23%|██▎       | 88/391 [00:01<00:04, 65.60it/s] 25%|██▍       | 97/391 [00:01<00:04, 69.83it/s] 27%|██▋       | 107/391 [00:01<00:03, 76.57it/s] 30%|██▉       | 117/391 [00:01<00:03, 81.35it/s] 32%|███▏      | 127/391 [00:01<00:03, 85.20it/s] 35%|███▌      | 137/391 [00:01<00:02, 88.19it/s] 37%|███▋      | 146/391 [00:02<00:03, 73.60it/s] 39%|███▉      | 154/391 [00:02<00:03, 65.64it/s] 42%|████▏     | 164/391 [00:02<00:03, 72.96it/s] 45%|████▍     | 174/391 [00:02<00:02, 77.74it/s] 47%|████▋     | 184/391 [00:02<00:02, 82.62it/s] 50%|████▉     | 194/391 [00:02<00:02, 86.27it/s] 52%|█████▏    | 203/391 [00:02<00:02, 75.97it/s] 54%|█████▍    | 211/391 [00:03<00:02, 66.68it/s] 56%|█████▋    | 220/391 [00:03<00:02, 70.53it/s] 59%|█████▉    | 230/391 [00:03<00:02, 76.90it/s] 61%|██████▏   | 240/391 [00:03<00:01, 81.86it/s] 64%|██████▍   | 250/391 [00:03<00:01, 85.54it/s] 66%|██████▌   | 259/391 [00:03<00:01, 86.32it/s] 69%|██████▊   | 268/391 [00:03<00:01, 70.21it/s] 71%|███████   | 276/391 [00:03<00:01, 66.50it/s] 73%|███████▎  | 286/391 [00:04<00:01, 73.44it/s] 76%|███████▌  | 296/391 [00:04<00:01, 78.36it/s] 78%|███████▊  | 306/391 [00:04<00:01, 82.51it/s] 81%|████████  | 316/391 [00:04<00:00, 83.98it/s] 83%|████████▎ | 325/391 [00:04<00:00, 69.32it/s] 85%|████████▌ | 333/391 [00:04<00:00, 66.27it/s] 88%|████████▊ | 343/391 [00:04<00:00, 73.33it/s] 90%|█████████ | 353/391 [00:04<00:00, 78.98it/s] 93%|█████████▎| 363/391 [00:04<00:00, 83.35it/s] 95%|█████████▌| 373/391 [00:05<00:00, 86.51it/s] 98%|█████████▊| 382/391 [00:05<00:00, 73.71it/s]100%|█████████▉| 390/391 [00:05<00:00, 65.38it/s]100%|██████████| 391/391 [00:05<00:00, 71.90it/s]
50000 images processed, 5.550371170043945 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:24,  3.20it/s] 10%|█         | 8/79 [00:00<00:02, 24.01it/s] 23%|██▎       | 18/79 [00:00<00:01, 46.36it/s] 35%|███▌      | 28/79 [00:00<00:00, 61.12it/s] 48%|████▊     | 38/79 [00:00<00:00, 71.25it/s] 59%|█████▉    | 47/79 [00:00<00:00, 67.46it/s] 70%|██████▉   | 55/79 [00:01<00:00, 60.93it/s] 78%|███████▊  | 62/79 [00:01<00:00, 63.02it/s] 91%|█████████ | 72/79 [00:01<00:00, 71.72it/s]100%|██████████| 79/79 [00:01<00:00, 59.45it/s]
10000 images processed, 1.372246265411377 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:12,  2.82it/s]  3%|▎         | 6/204 [00:00<00:12, 15.88it/s]  6%|▌         | 12/204 [00:00<00:06, 28.03it/s] 10%|█         | 21/204 [00:00<00:04, 45.33it/s] 15%|█▌        | 31/204 [00:00<00:02, 59.36it/s] 20%|██        | 41/204 [00:00<00:02, 68.72it/s] 24%|██▍       | 49/204 [00:01<00:02, 57.64it/s] 27%|██▋       | 56/204 [00:01<00:02, 57.02it/s] 32%|███▏      | 65/204 [00:01<00:02, 65.18it/s] 37%|███▋      | 75/204 [00:01<00:01, 72.40it/s] 41%|████      | 84/204 [00:01<00:01, 77.08it/s] 46%|████▌     | 93/204 [00:01<00:01, 67.75it/s] 50%|████▉     | 101/204 [00:01<00:01, 60.55it/s] 54%|█████▍    | 110/204 [00:01<00:01, 67.16it/s] 58%|█████▊    | 119/204 [00:02<00:01, 72.83it/s] 63%|██████▎   | 129/204 [00:02<00:00, 78.27it/s] 68%|██████▊   | 138/204 [00:02<00:00, 70.71it/s] 72%|███████▏  | 146/204 [00:02<00:00, 61.17it/s] 76%|███████▌  | 155/204 [00:02<00:00, 67.35it/s] 81%|████████  | 165/204 [00:02<00:00, 73.63it/s] 86%|████████▌ | 175/204 [00:02<00:00, 78.38it/s] 90%|█████████ | 184/204 [00:02<00:00, 75.05it/s] 94%|█████████▍| 192/204 [00:03<00:00, 63.68it/s] 98%|█████████▊| 199/204 [00:03<00:00, 64.73it/s]100%|██████████| 204/204 [00:03<00:00, 61.98it/s]
26032 images processed, 3.3358278274536133 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:40,  1.91it/s] 11%|█▏        | 9/79 [00:00<00:04, 15.35it/s] 18%|█▊        | 14/79 [00:00<00:02, 21.91it/s] 24%|██▍       | 19/79 [00:00<00:02, 27.75it/s] 32%|███▏      | 25/79 [00:01<00:01, 29.16it/s] 41%|████      | 32/79 [00:01<00:01, 37.71it/s] 47%|████▋     | 37/79 [00:01<00:01, 33.09it/s] 52%|█████▏    | 41/79 [00:01<00:01, 33.71it/s] 62%|██████▏   | 49/79 [00:01<00:00, 35.19it/s] 68%|██████▊   | 54/79 [00:01<00:00, 37.53it/s] 75%|███████▍  | 59/79 [00:01<00:00, 39.38it/s] 82%|████████▏ | 65/79 [00:02<00:00, 36.34it/s] 89%|████████▊ | 70/79 [00:02<00:00, 39.12it/s]100%|██████████| 79/79 [00:02<00:00, 33.53it/s]
10000 images processed, 2.3906099796295166 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:21,  3.55it/s] 14%|█▍        | 11/79 [00:00<00:01, 35.12it/s] 27%|██▋       | 21/79 [00:00<00:01, 54.66it/s] 39%|███▉      | 31/79 [00:00<00:00, 67.25it/s] 52%|█████▏    | 41/79 [00:00<00:00, 75.72it/s] 63%|██████▎   | 50/79 [00:00<00:00, 68.77it/s] 73%|███████▎  | 58/79 [00:01<00:00, 59.47it/s] 86%|████████▌ | 68/79 [00:01<00:00, 67.77it/s] 99%|█████████▊| 78/79 [00:01<00:00, 74.88it/s]100%|██████████| 79/79 [00:01<00:00, 62.78it/s]
10000 images processed, 1.2789223194122314 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:20,  3.36it/s] 16%|█▌        | 11/70 [00:00<00:01, 33.95it/s] 30%|███       | 21/70 [00:00<00:00, 53.46it/s] 44%|████▍     | 31/70 [00:00<00:00, 66.23it/s] 59%|█████▊    | 41/70 [00:00<00:00, 74.84it/s] 71%|███████▏  | 50/70 [00:00<00:00, 62.41it/s] 83%|████████▎ | 58/70 [00:01<00:00, 60.37it/s] 97%|█████████▋| 68/70 [00:01<00:00, 69.11it/s]100%|██████████| 70/70 [00:01<00:00, 58.85it/s]
8925 images processed, 1.225248098373413 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:00<00:40,  1.09it/s]  4%|▍         | 2/45 [00:01<00:19,  2.18it/s] 16%|█▌        | 7/45 [00:01<00:04,  9.47it/s] 22%|██▏       | 10/45 [00:01<00:04,  7.87it/s] 31%|███       | 14/45 [00:01<00:02, 11.33it/s] 38%|███▊      | 17/45 [00:01<00:02, 12.43it/s] 42%|████▏     | 19/45 [00:02<00:02, 12.52it/s] 49%|████▉     | 22/45 [00:02<00:02, 11.17it/s] 58%|█████▊    | 26/45 [00:02<00:01, 15.11it/s] 67%|██████▋   | 30/45 [00:03<00:01, 11.90it/s] 73%|███████▎  | 33/45 [00:03<00:00, 13.68it/s] 78%|███████▊  | 35/45 [00:03<00:00, 14.11it/s] 84%|████████▍ | 38/45 [00:03<00:00, 15.93it/s] 89%|████████▉ | 40/45 [00:03<00:00, 12.76it/s] 93%|█████████▎| 42/45 [00:04<00:00,  9.74it/s]100%|██████████| 45/45 [00:04<00:00, 10.99it/s]
5640 images processed, 4.11452054977417 seconds used

21.10879373550415
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.53  99.36
places365     67.87  81.18
LSUN          17.60  96.07
iSUN          72.36  81.68
dtd           37.87  91.39
AVG           39.65  89.93
Retain-Acc: 0.7406
Forget-as-OOD (retain known vs forget novel):
  FPR: 79.50 AUROC: 86.90 AUIN: 98.36
8.792822360992432
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e5-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.1-lora_r8a32d0.05-temp0.08-fullgrid
epochs=5 | cache=6 | flambda=0.1 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.1-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.1-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.1-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21610432
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<02:06,  3.08it/s]  3%|▎         | 11/391 [00:00<00:11, 32.15it/s]  5%|▌         | 21/391 [00:00<00:07, 51.65it/s]  8%|▊         | 31/391 [00:00<00:05, 64.92it/s] 10%|█         | 40/391 [00:00<00:05, 63.82it/s] 12%|█▏        | 48/391 [00:00<00:05, 58.55it/s] 14%|█▍        | 56/391 [00:01<00:05, 62.16it/s] 17%|█▋        | 66/391 [00:01<00:04, 70.86it/s] 19%|█▉        | 76/391 [00:01<00:04, 77.21it/s] 22%|██▏       | 86/391 [00:01<00:03, 81.95it/s] 25%|██▍       | 96/391 [00:01<00:03, 85.68it/s] 27%|██▋       | 105/391 [00:01<00:04, 69.84it/s] 29%|██▉       | 113/391 [00:01<00:04, 65.12it/s] 31%|███▏      | 123/391 [00:01<00:03, 71.88it/s] 34%|███▍      | 133/391 [00:02<00:03, 77.49it/s] 37%|███▋      | 143/391 [00:02<00:03, 82.08it/s] 39%|███▉      | 152/391 [00:02<00:03, 71.67it/s] 41%|████      | 160/391 [00:02<00:03, 64.13it/s] 43%|████▎     | 169/391 [00:02<00:03, 70.16it/s] 46%|████▌     | 179/391 [00:02<00:02, 75.69it/s] 48%|████▊     | 189/391 [00:02<00:02, 80.82it/s] 51%|█████     | 199/391 [00:02<00:02, 84.84it/s] 53%|█████▎    | 208/391 [00:03<00:02, 77.21it/s] 55%|█████▌    | 217/391 [00:03<00:02, 65.21it/s] 58%|█████▊    | 226/391 [00:03<00:02, 70.22it/s] 60%|██████    | 236/391 [00:03<00:02, 75.82it/s] 63%|██████▎   | 246/391 [00:03<00:01, 80.89it/s] 65%|██████▌   | 255/391 [00:03<00:01, 80.95it/s] 68%|██████▊   | 264/391 [00:03<00:01, 67.65it/s] 70%|██████▉   | 272/391 [00:03<00:01, 65.48it/s] 72%|███████▏  | 282/391 [00:04<00:01, 72.87it/s] 75%|███████▍  | 292/391 [00:04<00:01, 78.24it/s] 77%|███████▋  | 302/391 [00:04<00:01, 83.03it/s] 80%|███████▉  | 312/391 [00:04<00:00, 82.42it/s] 82%|████████▏ | 321/391 [00:04<00:01, 68.68it/s] 84%|████████▍ | 329/391 [00:04<00:00, 66.06it/s] 87%|████████▋ | 339/391 [00:04<00:00, 72.62it/s] 89%|████████▉ | 348/391 [00:04<00:00, 76.82it/s] 92%|█████████▏| 358/391 [00:05<00:00, 81.66it/s] 94%|█████████▍| 367/391 [00:05<00:00, 68.40it/s] 96%|█████████▌| 375/391 [00:05<00:00, 63.68it/s] 98%|█████████▊| 385/391 [00:05<00:00, 71.79it/s]100%|██████████| 391/391 [00:05<00:00, 70.50it/s]
50000 images processed, 5.64704704284668 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:21,  3.55it/s]  8%|▊         | 6/79 [00:00<00:03, 19.16it/s] 19%|█▉        | 15/79 [00:00<00:01, 42.11it/s] 32%|███▏      | 25/79 [00:00<00:00, 59.24it/s] 43%|████▎     | 34/79 [00:00<00:00, 68.37it/s] 54%|█████▍    | 43/79 [00:00<00:00, 73.42it/s] 66%|██████▌   | 52/79 [00:00<00:00, 62.18it/s] 75%|███████▍  | 59/79 [00:01<00:00, 60.31it/s] 87%|████████▋ | 69/79 [00:01<00:00, 68.75it/s]100%|██████████| 79/79 [00:01<00:00, 75.13it/s]100%|██████████| 79/79 [00:01<00:00, 59.48it/s]
10000 images processed, 1.3649547100067139 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:18,  2.59it/s]  3%|▎         | 6/204 [00:00<00:13, 15.00it/s]  6%|▋         | 13/204 [00:00<00:06, 29.29it/s] 11%|█         | 22/204 [00:00<00:03, 46.03it/s] 16%|█▌        | 32/204 [00:00<00:02, 59.75it/s] 21%|██        | 42/204 [00:00<00:02, 69.41it/s] 25%|██▍       | 50/204 [00:01<00:02, 64.27it/s] 28%|██▊       | 58/204 [00:01<00:02, 56.70it/s] 33%|███▎      | 67/204 [00:01<00:02, 64.62it/s] 37%|███▋      | 76/204 [00:01<00:01, 70.14it/s] 42%|████▏     | 85/204 [00:01<00:01, 75.25it/s] 46%|████▌     | 93/204 [00:01<00:01, 70.16it/s] 50%|████▉     | 101/204 [00:01<00:01, 60.14it/s] 53%|█████▎    | 109/204 [00:01<00:01, 64.69it/s] 58%|█████▊    | 119/204 [00:02<00:01, 72.01it/s] 63%|██████▎   | 129/204 [00:02<00:00, 77.70it/s] 68%|██████▊   | 139/204 [00:02<00:00, 81.75it/s] 73%|███████▎  | 148/204 [00:02<00:00, 65.93it/s] 76%|███████▋  | 156/204 [00:02<00:00, 63.95it/s] 81%|████████▏ | 166/204 [00:02<00:00, 71.21it/s] 86%|████████▋ | 176/204 [00:02<00:00, 76.77it/s] 91%|█████████ | 185/204 [00:02<00:00, 80.16it/s] 95%|█████████▌| 194/204 [00:03<00:00, 68.72it/s] 99%|█████████▉| 202/204 [00:03<00:00, 62.55it/s]100%|██████████| 204/204 [00:03<00:00, 61.79it/s]
26032 images processed, 3.3477704524993896 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:38,  2.00it/s]  8%|▊         | 6/79 [00:00<00:05, 12.25it/s] 14%|█▍        | 11/79 [00:00<00:03, 21.07it/s] 23%|██▎       | 18/79 [00:00<00:01, 31.42it/s] 32%|███▏      | 25/79 [00:00<00:01, 36.74it/s] 38%|███▊      | 30/79 [00:01<00:01, 35.88it/s] 44%|████▍     | 35/79 [00:01<00:01, 38.51it/s] 52%|█████▏    | 41/79 [00:01<00:00, 42.75it/s] 58%|█████▊    | 46/79 [00:01<00:00, 39.49it/s] 65%|██████▍   | 51/79 [00:01<00:00, 38.39it/s] 71%|███████   | 56/79 [00:01<00:00, 39.77it/s] 77%|███████▋  | 61/79 [00:01<00:00, 39.39it/s] 85%|████████▍ | 67/79 [00:02<00:00, 40.15it/s] 91%|█████████ | 72/79 [00:02<00:00, 40.99it/s] 99%|█████████▊| 78/79 [00:02<00:00, 44.81it/s]100%|██████████| 79/79 [00:02<00:00, 34.98it/s]
10000 images processed, 2.300272226333618 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:23,  3.35it/s] 13%|█▎        | 10/79 [00:00<00:02, 31.24it/s] 25%|██▌       | 20/79 [00:00<00:01, 51.63it/s] 37%|███▋      | 29/79 [00:00<00:00, 63.09it/s] 49%|████▉     | 39/79 [00:00<00:00, 71.76it/s] 61%|██████    | 48/79 [00:00<00:00, 75.84it/s] 73%|███████▎  | 58/79 [00:00<00:00, 81.22it/s] 86%|████████▌ | 68/79 [00:01<00:00, 85.21it/s] 99%|█████████▊| 78/79 [00:01<00:00, 87.93it/s]100%|██████████| 79/79 [00:01<00:00, 68.75it/s]
10000 images processed, 1.1758086681365967 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:23,  2.96it/s] 16%|█▌        | 11/70 [00:00<00:01, 31.04it/s] 29%|██▊       | 20/70 [00:00<00:01, 48.03it/s] 43%|████▎     | 30/70 [00:00<00:00, 62.07it/s] 57%|█████▋    | 40/70 [00:00<00:00, 70.60it/s] 71%|███████▏  | 50/70 [00:00<00:00, 77.32it/s] 86%|████████▌ | 60/70 [00:00<00:00, 82.43it/s]100%|██████████| 70/70 [00:01<00:00, 85.89it/s]100%|██████████| 70/70 [00:01<00:00, 64.38it/s]
8925 images processed, 1.1152386665344238 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:00<00:36,  1.21it/s]  4%|▍         | 2/45 [00:01<00:20,  2.06it/s] 20%|██        | 9/45 [00:01<00:03, 10.71it/s] 24%|██▍       | 11/45 [00:01<00:04,  8.06it/s] 38%|███▊      | 17/45 [00:01<00:02, 13.85it/s] 44%|████▍     | 20/45 [00:02<00:02, 11.82it/s] 51%|█████     | 23/45 [00:02<00:01, 14.17it/s] 58%|█████▊    | 26/45 [00:02<00:01, 10.65it/s] 67%|██████▋   | 30/45 [00:02<00:01, 13.49it/s] 73%|███████▎  | 33/45 [00:03<00:00, 13.06it/s] 78%|███████▊  | 35/45 [00:03<00:00, 10.17it/s] 91%|█████████ | 41/45 [00:03<00:00, 15.17it/s] 96%|█████████▌| 43/45 [00:04<00:00,  9.06it/s]100%|██████████| 45/45 [00:04<00:00, 10.39it/s]
5640 images processed, 4.352807283401489 seconds used

21.09886360168457
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.53  99.36
places365     67.87  81.18
LSUN          17.60  96.07
iSUN          72.36  81.68
dtd           37.87  91.39
AVG           39.65  89.93
Retain-Acc: 0.7406
Forget-as-OOD (retain known vs forget novel):
  FPR: 79.50 AUROC: 86.90 AUIN: 98.36
9.633524179458618
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e10-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.1-lora_r8a32d0.05-temp0.08-fullgrid
epochs=10 | cache=6 | flambda=0.1 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e10-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.1-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e10-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.1-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e10-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.1-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21610432
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<01:52,  3.47it/s]  2%|▏         | 7/391 [00:00<00:18, 20.86it/s]  4%|▎         | 14/391 [00:00<00:10, 34.92it/s]  6%|▌         | 24/391 [00:00<00:06, 53.37it/s]  9%|▊         | 34/391 [00:00<00:05, 65.57it/s] 11%|█▏        | 44/391 [00:00<00:04, 74.52it/s] 14%|█▎        | 53/391 [00:00<00:04, 76.17it/s] 16%|█▌        | 62/391 [00:01<00:05, 64.94it/s] 18%|█▊        | 70/391 [00:01<00:05, 63.39it/s] 20%|██        | 80/391 [00:01<00:04, 71.50it/s] 23%|██▎       | 90/391 [00:01<00:03, 77.35it/s] 26%|██▌       | 100/391 [00:01<00:03, 82.29it/s] 28%|██▊       | 109/391 [00:01<00:03, 82.52it/s] 30%|███       | 118/391 [00:01<00:04, 68.21it/s] 32%|███▏      | 126/391 [00:02<00:04, 65.49it/s] 35%|███▍      | 136/391 [00:02<00:03, 73.13it/s] 37%|███▋      | 146/391 [00:02<00:03, 78.82it/s] 40%|███▉      | 155/391 [00:02<00:02, 80.90it/s] 42%|████▏     | 164/391 [00:02<00:03, 73.56it/s] 44%|████▍     | 172/391 [00:02<00:03, 65.15it/s] 46%|████▌     | 180/391 [00:02<00:03, 66.63it/s] 49%|████▊     | 190/391 [00:02<00:02, 73.40it/s] 51%|█████     | 200/391 [00:02<00:02, 79.01it/s] 54%|█████▎    | 210/391 [00:03<00:02, 83.10it/s] 56%|█████▌    | 219/391 [00:03<00:02, 70.10it/s] 58%|█████▊    | 227/391 [00:03<00:02, 64.16it/s] 61%|██████    | 237/391 [00:03<00:02, 71.17it/s] 63%|██████▎   | 246/391 [00:03<00:01, 75.69it/s] 65%|██████▌   | 256/391 [00:03<00:01, 80.32it/s] 68%|██████▊   | 265/391 [00:03<00:01, 77.46it/s] 70%|██████▉   | 273/391 [00:04<00:01, 66.71it/s] 72%|███████▏  | 281/391 [00:04<00:01, 65.90it/s] 74%|███████▍  | 291/391 [00:04<00:01, 73.02it/s] 77%|███████▋  | 301/391 [00:04<00:01, 78.91it/s] 80%|███████▉  | 311/391 [00:04<00:00, 83.18it/s] 82%|████████▏ | 321/391 [00:04<00:00, 86.67it/s] 84%|████████▍ | 330/391 [00:04<00:00, 73.16it/s] 86%|████████▋ | 338/391 [00:04<00:00, 65.00it/s] 89%|████████▉ | 348/391 [00:04<00:00, 72.22it/s] 92%|█████████▏| 358/391 [00:05<00:00, 77.92it/s] 94%|█████████▍| 368/391 [00:05<00:00, 81.61it/s] 97%|█████████▋| 378/391 [00:05<00:00, 85.01it/s] 99%|█████████▉| 387/391 [00:05<00:00, 70.11it/s]100%|██████████| 391/391 [00:05<00:00, 70.05it/s]
50000 images processed, 5.652166843414307 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:19,  4.06it/s]  8%|▊         | 6/79 [00:00<00:03, 20.65it/s] 15%|█▌        | 12/79 [00:00<00:02, 31.97it/s] 24%|██▍       | 19/79 [00:00<00:01, 42.61it/s] 37%|███▋      | 29/79 [00:00<00:00, 59.02it/s] 49%|████▉     | 39/79 [00:00<00:00, 70.05it/s] 62%|██████▏   | 49/79 [00:00<00:00, 77.32it/s] 73%|███████▎  | 58/79 [00:01<00:00, 79.97it/s] 85%|████████▍ | 67/79 [00:01<00:00, 66.11it/s] 95%|█████████▍| 75/79 [00:01<00:00, 63.89it/s]100%|██████████| 79/79 [00:01<00:00, 57.57it/s]
10000 images processed, 1.4037816524505615 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<00:59,  3.40it/s]  5%|▍         | 10/204 [00:00<00:06, 30.98it/s] 10%|▉         | 20/204 [00:00<00:03, 51.30it/s] 15%|█▍        | 30/204 [00:00<00:02, 64.49it/s] 19%|█▉        | 39/204 [00:00<00:02, 70.82it/s] 24%|██▎       | 48/204 [00:00<00:02, 59.03it/s] 27%|██▋       | 55/204 [00:01<00:02, 59.55it/s] 32%|███▏      | 65/204 [00:01<00:02, 68.48it/s] 37%|███▋      | 75/204 [00:01<00:01, 75.29it/s] 42%|████▏     | 85/204 [00:01<00:01, 80.45it/s] 46%|████▌     | 94/204 [00:01<00:01, 74.43it/s] 50%|█████     | 102/204 [00:01<00:01, 63.22it/s] 54%|█████▍    | 110/204 [00:01<00:01, 67.00it/s] 59%|█████▉    | 120/204 [00:01<00:01, 73.91it/s] 64%|██████▎   | 130/204 [00:01<00:00, 79.05it/s] 69%|██████▊   | 140/204 [00:02<00:00, 82.65it/s] 73%|███████▎  | 149/204 [00:02<00:00, 66.49it/s] 77%|███████▋  | 157/204 [00:02<00:00, 64.38it/s] 82%|████████▏ | 167/204 [00:02<00:00, 71.23it/s] 87%|████████▋ | 177/204 [00:02<00:00, 76.84it/s] 92%|█████████▏| 187/204 [00:02<00:00, 81.06it/s] 96%|█████████▌| 196/204 [00:02<00:00, 73.28it/s]100%|██████████| 204/204 [00:03<00:00, 64.16it/s]100%|██████████| 204/204 [00:03<00:00, 66.09it/s]
26032 images processed, 3.1252787113189697 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:32,  2.43it/s] 11%|█▏        | 9/79 [00:00<00:03, 18.25it/s] 16%|█▋        | 13/79 [00:00<00:02, 22.88it/s] 22%|██▏       | 17/79 [00:00<00:02, 27.05it/s] 32%|███▏      | 25/79 [00:01<00:01, 31.79it/s] 37%|███▋      | 29/79 [00:01<00:01, 33.42it/s] 43%|████▎     | 34/79 [00:01<00:01, 34.90it/s] 52%|█████▏    | 41/79 [00:01<00:01, 36.44it/s] 58%|█████▊    | 46/79 [00:01<00:00, 39.13it/s] 65%|██████▍   | 51/79 [00:01<00:00, 36.14it/s] 71%|███████   | 56/79 [00:01<00:00, 38.61it/s] 78%|███████▊  | 62/79 [00:01<00:00, 42.75it/s] 85%|████████▍ | 67/79 [00:02<00:00, 36.35it/s] 91%|█████████ | 72/79 [00:02<00:00, 38.56it/s]100%|██████████| 79/79 [00:02<00:00, 34.31it/s]
10000 images processed, 2.3430144786834717 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:31,  2.47it/s]  8%|▊         | 6/79 [00:00<00:05, 14.59it/s] 20%|██        | 16/79 [00:00<00:01, 36.42it/s] 33%|███▎      | 26/79 [00:00<00:01, 52.53it/s] 46%|████▌     | 36/79 [00:00<00:00, 64.15it/s] 56%|█████▌    | 44/79 [00:00<00:00, 64.96it/s] 66%|██████▌   | 52/79 [00:01<00:00, 57.00it/s] 75%|███████▍  | 59/79 [00:01<00:00, 59.67it/s] 87%|████████▋ | 69/79 [00:01<00:00, 68.74it/s]100%|██████████| 79/79 [00:01<00:00, 76.95it/s]100%|██████████| 79/79 [00:01<00:00, 54.58it/s]
10000 images processed, 1.4892282485961914 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:29,  2.34it/s]  9%|▊         | 6/70 [00:00<00:04, 14.11it/s] 23%|██▎       | 16/70 [00:00<00:01, 35.88it/s] 37%|███▋      | 26/70 [00:00<00:00, 52.13it/s] 51%|█████▏    | 36/70 [00:00<00:00, 63.95it/s] 64%|██████▍   | 45/70 [00:00<00:00, 69.85it/s] 77%|███████▋  | 54/70 [00:01<00:00, 58.95it/s] 87%|████████▋ | 61/70 [00:01<00:00, 59.50it/s]100%|██████████| 70/70 [00:01<00:00, 50.99it/s]
8925 images processed, 1.4052469730377197 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:00<00:41,  1.06it/s]  4%|▍         | 2/45 [00:01<00:20,  2.13it/s] 16%|█▌        | 7/45 [00:01<00:04,  9.24it/s] 22%|██▏       | 10/45 [00:01<00:04,  8.01it/s] 38%|███▊      | 17/45 [00:01<00:02, 13.01it/s] 42%|████▏     | 19/45 [00:02<00:02, 11.73it/s] 51%|█████     | 23/45 [00:02<00:01, 15.47it/s] 58%|█████▊    | 26/45 [00:02<00:01, 11.51it/s] 69%|██████▉   | 31/45 [00:02<00:00, 15.68it/s] 76%|███████▌  | 34/45 [00:03<00:01, 10.18it/s] 91%|█████████ | 41/45 [00:03<00:00, 13.89it/s] 96%|█████████▌| 43/45 [00:04<00:00, 10.15it/s]100%|██████████| 45/45 [00:04<00:00, 10.59it/s]
5640 images processed, 4.269761562347412 seconds used

21.215641975402832
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.53  99.36
places365     67.87  81.18
LSUN          17.60  96.07
iSUN          72.36  81.68
dtd           37.87  91.39
AVG           39.65  89.93
Retain-Acc: 0.7406
Forget-as-OOD (retain known vs forget novel):
  FPR: 79.50 AUROC: 86.90 AUIN: 98.36
9.636338233947754
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e20-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.1-lora_r8a32d0.05-temp0.08-fullgrid
epochs=20 | cache=6 | flambda=0.1 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e20-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.1-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e20-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.1-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e20-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.1-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21610432
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<02:01,  3.20it/s]  3%|▎         | 11/391 [00:00<00:11, 32.87it/s]  5%|▌         | 21/391 [00:00<00:07, 52.42it/s]  7%|▋         | 29/391 [00:00<00:06, 56.88it/s]  9%|▉         | 37/391 [00:00<00:06, 54.10it/s] 11%|█▏        | 44/391 [00:00<00:06, 56.39it/s] 14%|█▍        | 54/391 [00:01<00:05, 66.66it/s] 16%|█▋        | 64/391 [00:01<00:04, 74.58it/s] 19%|█▉        | 74/391 [00:01<00:03, 80.37it/s] 21%|██▏       | 84/391 [00:01<00:03, 84.55it/s] 24%|██▍       | 93/391 [00:01<00:04, 71.13it/s] 26%|██▌       | 101/391 [00:01<00:04, 64.05it/s] 28%|██▊       | 111/391 [00:01<00:03, 71.63it/s] 31%|███       | 121/391 [00:01<00:03, 77.70it/s] 34%|███▎      | 131/391 [00:01<00:03, 82.33it/s] 36%|███▌      | 141/391 [00:02<00:02, 85.75it/s] 38%|███▊      | 150/391 [00:02<00:03, 73.94it/s] 40%|████      | 158/391 [00:02<00:03, 64.92it/s] 43%|████▎     | 168/391 [00:02<00:03, 71.77it/s] 46%|████▌     | 178/391 [00:02<00:02, 77.74it/s] 48%|████▊     | 188/391 [00:02<00:02, 82.23it/s] 51%|█████     | 198/391 [00:02<00:02, 85.75it/s] 53%|█████▎    | 207/391 [00:02<00:02, 81.91it/s] 55%|█████▌    | 216/391 [00:03<00:02, 68.97it/s] 57%|█████▋    | 224/391 [00:03<00:02, 67.85it/s] 60%|█████▉    | 234/391 [00:03<00:02, 74.83it/s] 62%|██████▏   | 244/391 [00:03<00:01, 80.02it/s] 65%|██████▍   | 254/391 [00:03<00:01, 83.95it/s] 68%|██████▊   | 264/391 [00:03<00:01, 87.00it/s] 70%|██████▉   | 273/391 [00:03<00:01, 72.91it/s] 72%|███████▏  | 281/391 [00:04<00:01, 65.17it/s] 74%|███████▍  | 291/391 [00:04<00:01, 72.54it/s] 77%|███████▋  | 301/391 [00:04<00:01, 78.26it/s] 80%|███████▉  | 311/391 [00:04<00:00, 82.70it/s] 82%|████████▏ | 321/391 [00:04<00:00, 85.91it/s] 84%|████████▍ | 330/391 [00:04<00:00, 79.79it/s] 87%|████████▋ | 339/391 [00:04<00:00, 67.91it/s] 89%|████████▊ | 347/391 [00:04<00:00, 68.70it/s] 91%|█████████▏| 357/391 [00:04<00:00, 75.34it/s] 94%|█████████▍| 367/391 [00:05<00:00, 80.67it/s] 96%|█████████▋| 377/391 [00:05<00:00, 84.21it/s] 99%|█████████▉| 387/391 [00:05<00:00, 86.66it/s]100%|██████████| 391/391 [00:05<00:00, 72.48it/s]
50000 images processed, 5.503333806991577 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:29,  2.68it/s]  9%|▉         | 7/79 [00:00<00:04, 17.62it/s] 20%|██        | 16/79 [00:00<00:01, 36.41it/s] 33%|███▎      | 26/79 [00:00<00:01, 52.89it/s] 46%|████▌     | 36/79 [00:00<00:00, 64.68it/s] 58%|█████▊    | 46/79 [00:00<00:00, 72.84it/s] 70%|██████▉   | 55/79 [00:01<00:00, 64.15it/s] 80%|███████▉  | 63/79 [00:01<00:00, 59.51it/s] 92%|█████████▏| 73/79 [00:01<00:00, 67.89it/s]100%|██████████| 79/79 [00:01<00:00, 55.13it/s]
10000 images processed, 1.4695425033569336 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:12,  2.80it/s]  3%|▎         | 6/204 [00:00<00:12, 15.60it/s]  5%|▌         | 11/204 [00:00<00:07, 24.64it/s] 10%|▉         | 20/204 [00:00<00:04, 41.82it/s] 15%|█▍        | 30/204 [00:00<00:03, 56.73it/s] 20%|█▉        | 40/204 [00:00<00:02, 67.14it/s] 24%|██▍       | 49/204 [00:01<00:02, 72.23it/s] 28%|██▊       | 57/204 [00:01<00:02, 60.56it/s] 31%|███▏      | 64/204 [00:01<00:02, 59.37it/s] 36%|███▋      | 74/204 [00:01<00:01, 68.08it/s] 41%|████      | 84/204 [00:01<00:01, 74.64it/s] 46%|████▌     | 94/204 [00:01<00:01, 79.64it/s] 50%|█████     | 103/204 [00:01<00:01, 69.97it/s] 54%|█████▍    | 111/204 [00:01<00:01, 61.71it/s] 59%|█████▉    | 121/204 [00:02<00:01, 69.32it/s] 64%|██████▍   | 131/204 [00:02<00:00, 75.37it/s] 69%|██████▉   | 141/204 [00:02<00:00, 80.06it/s] 74%|███████▎  | 150/204 [00:02<00:00, 78.86it/s] 78%|███████▊  | 159/204 [00:02<00:00, 64.65it/s] 82%|████████▏ | 167/204 [00:02<00:00, 65.93it/s] 87%|████████▋ | 177/204 [00:02<00:00, 72.64it/s] 92%|█████████▏| 187/204 [00:02<00:00, 77.78it/s] 97%|█████████▋| 197/204 [00:03<00:00, 82.40it/s]100%|██████████| 204/204 [00:03<00:00, 63.74it/s]
26032 images processed, 3.2462079524993896 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:38,  2.04it/s]  8%|▊         | 6/79 [00:00<00:05, 12.65it/s] 18%|█▊        | 14/79 [00:00<00:02, 28.83it/s] 25%|██▌       | 20/79 [00:00<00:01, 30.02it/s] 32%|███▏      | 25/79 [00:00<00:01, 34.00it/s] 42%|████▏     | 33/79 [00:01<00:01, 39.80it/s] 51%|█████     | 40/79 [00:01<00:00, 44.64it/s] 58%|█████▊    | 46/79 [00:01<00:00, 42.64it/s] 68%|██████▊   | 54/79 [00:01<00:00, 51.08it/s] 76%|███████▌  | 60/79 [00:01<00:00, 49.78it/s] 84%|████████▎ | 66/79 [00:01<00:00, 47.74it/s] 91%|█████████ | 72/79 [00:01<00:00, 47.22it/s]100%|██████████| 79/79 [00:01<00:00, 39.60it/s]
10000 images processed, 2.032064437866211 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:27,  2.82it/s]  8%|▊         | 6/79 [00:00<00:04, 15.67it/s] 14%|█▍        | 11/79 [00:00<00:02, 24.69it/s] 25%|██▌       | 20/79 [00:00<00:01, 42.08it/s] 38%|███▊      | 30/79 [00:00<00:00, 57.33it/s] 51%|█████     | 40/79 [00:00<00:00, 67.83it/s] 63%|██████▎   | 50/79 [00:01<00:00, 75.59it/s] 76%|███████▌  | 60/79 [00:01<00:00, 79.03it/s] 87%|████████▋ | 69/79 [00:01<00:00, 64.15it/s] 97%|█████████▋| 77/79 [00:01<00:00, 64.07it/s]100%|██████████| 79/79 [00:01<00:00, 53.96it/s]
10000 images processed, 1.4839885234832764 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:24,  2.86it/s] 16%|█▌        | 11/70 [00:00<00:01, 30.31it/s] 30%|███       | 21/70 [00:00<00:00, 49.48it/s] 41%|████▏     | 29/70 [00:00<00:00, 54.63it/s] 51%|█████▏    | 36/70 [00:00<00:00, 51.19it/s] 61%|██████▏   | 43/70 [00:00<00:00, 53.83it/s] 76%|███████▌  | 53/70 [00:01<00:00, 64.15it/s] 90%|█████████ | 63/70 [00:01<00:00, 72.39it/s]100%|██████████| 70/70 [00:01<00:00, 55.79it/s]
8925 images processed, 1.290480613708496 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:00<00:40,  1.10it/s]  4%|▍         | 2/45 [00:01<00:19,  2.24it/s] 16%|█▌        | 7/45 [00:01<00:03,  9.60it/s] 22%|██▏       | 10/45 [00:01<00:03,  8.89it/s] 31%|███       | 14/45 [00:01<00:02, 11.67it/s] 38%|███▊      | 17/45 [00:01<00:02, 13.88it/s] 42%|████▏     | 19/45 [00:02<00:01, 13.43it/s] 47%|████▋     | 21/45 [00:02<00:01, 14.34it/s] 51%|█████     | 23/45 [00:02<00:01, 14.18it/s] 58%|█████▊    | 26/45 [00:02<00:01, 12.80it/s] 67%|██████▋   | 30/45 [00:02<00:01, 12.22it/s] 76%|███████▌  | 34/45 [00:03<00:00, 11.89it/s] 89%|████████▉ | 40/45 [00:03<00:00, 15.59it/s] 93%|█████████▎| 42/45 [00:03<00:00, 11.29it/s]100%|██████████| 45/45 [00:03<00:00, 11.38it/s]
5640 images processed, 3.975938558578491 seconds used

20.79214835166931
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.53  99.36
places365     67.87  81.18
LSUN          17.60  96.07
iSUN          72.36  81.68
dtd           37.87  91.39
AVG           39.65  89.93
Retain-Acc: 0.7406
Forget-as-OOD (retain known vs forget novel):
  FPR: 79.50 AUROC: 86.90 AUIN: 98.36
9.155866146087646
========== RE-EVAL ==========
id=CIFAR-100 | backbone=resnet34 | method=top5-palm-cache6-ema0.999-b128-e50-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.1-lora_r8a32d0.05-temp0.08-fullgrid
epochs=50 | cache=6 | flambda=0.1 | oods=[SVHN places365 LSUN iSUN dtd]
adapter=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e50-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.1-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter | ckpt=checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e50-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.1-lora_r8a32d0.05-temp0.08-fullgrid-planB_adapter
resnet34-top5-palm-cache6-ema0.999-b128-e50-lr0.0005-wd1e-4-ltboth-bfmbalanced-fl0.1-lora_r8a32d0.05-temp0.08-fullgrid: Number of model parameters: 21610432
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<01:52,  3.47it/s]  3%|▎         | 11/391 [00:00<00:11, 34.02it/s]  4%|▍         | 17/391 [00:00<00:09, 38.58it/s]  6%|▌         | 23/391 [00:00<00:08, 42.48it/s]  8%|▊         | 31/391 [00:00<00:06, 51.50it/s] 10%|█         | 41/391 [00:00<00:05, 63.93it/s] 13%|█▎        | 51/391 [00:00<00:04, 72.92it/s] 16%|█▌        | 61/391 [00:01<00:04, 79.24it/s] 18%|█▊        | 70/391 [00:01<00:04, 69.29it/s] 20%|█▉        | 78/391 [00:01<00:05, 62.36it/s] 22%|██▏       | 87/391 [00:01<00:04, 68.99it/s] 25%|██▍       | 97/391 [00:01<00:03, 75.71it/s] 27%|██▋       | 107/391 [00:01<00:03, 80.42it/s] 30%|██▉       | 117/391 [00:01<00:03, 84.22it/s] 32%|███▏      | 126/391 [00:02<00:03, 69.45it/s] 34%|███▍      | 134/391 [00:02<00:03, 64.79it/s] 37%|███▋      | 144/391 [00:02<00:03, 72.12it/s] 39%|███▉      | 154/391 [00:02<00:03, 77.35it/s] 42%|████▏     | 164/391 [00:02<00:02, 81.96it/s] 44%|████▍     | 173/391 [00:02<00:02, 80.73it/s] 47%|████▋     | 182/391 [00:02<00:03, 68.33it/s] 49%|████▊     | 190/391 [00:02<00:03, 66.14it/s] 51%|█████     | 200/391 [00:03<00:02, 73.23it/s] 54%|█████▎    | 210/391 [00:03<00:02, 78.87it/s] 56%|█████▋    | 220/391 [00:03<00:02, 83.01it/s] 59%|█████▊    | 229/391 [00:03<00:02, 78.03it/s] 61%|██████    | 238/391 [00:03<00:02, 66.94it/s] 63%|██████▎   | 246/391 [00:03<00:02, 67.92it/s] 65%|██████▌   | 256/391 [00:03<00:01, 74.67it/s] 68%|██████▊   | 266/391 [00:03<00:01, 80.01it/s] 71%|███████   | 276/391 [00:03<00:01, 83.69it/s] 73%|███████▎  | 285/391 [00:04<00:01, 77.94it/s] 75%|███████▌  | 294/391 [00:04<00:01, 66.83it/s] 77%|███████▋  | 302/391 [00:04<00:01, 68.30it/s] 80%|███████▉  | 312/391 [00:04<00:01, 74.96it/s] 82%|████████▏ | 322/391 [00:04<00:00, 79.49it/s] 85%|████████▍ | 332/391 [00:04<00:00, 83.55it/s] 87%|████████▋ | 341/391 [00:04<00:00, 70.35it/s] 89%|████████▉ | 349/391 [00:05<00:00, 64.04it/s] 92%|█████████▏| 359/391 [00:05<00:00, 71.46it/s] 94%|█████████▍| 369/391 [00:05<00:00, 77.46it/s] 97%|█████████▋| 379/391 [00:05<00:00, 81.92it/s] 99%|█████████▉| 389/391 [00:05<00:00, 86.04it/s]100%|██████████| 391/391 [00:05<00:00, 70.99it/s]
50000 images processed, 5.612419605255127 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:19,  4.01it/s] 13%|█▎        | 10/79 [00:00<00:02, 34.10it/s] 25%|██▌       | 20/79 [00:00<00:01, 54.87it/s] 38%|███▊      | 30/79 [00:00<00:00, 67.80it/s] 49%|████▉     | 39/79 [00:00<00:00, 71.42it/s] 59%|█████▉    | 47/79 [00:00<00:00, 61.81it/s] 68%|██████▊   | 54/79 [00:00<00:00, 60.13it/s] 81%|████████  | 64/79 [00:01<00:00, 69.55it/s] 94%|█████████▎| 74/79 [00:01<00:00, 77.02it/s]100%|██████████| 79/79 [00:01<00:00, 63.66it/s]
10000 images processed, 1.2613794803619385 seconds used

Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:17,  2.62it/s]  3%|▎         | 6/204 [00:00<00:13, 15.08it/s]  7%|▋         | 15/204 [00:00<00:05, 34.83it/s] 12%|█▏        | 25/204 [00:00<00:03, 51.67it/s] 17%|█▋        | 35/204 [00:00<00:02, 63.39it/s] 21%|██        | 43/204 [00:00<00:02, 62.32it/s] 25%|██▌       | 51/204 [00:01<00:02, 55.59it/s] 29%|██▉       | 59/204 [00:01<00:02, 61.31it/s] 34%|███▍      | 69/204 [00:01<00:01, 69.35it/s] 39%|███▊      | 79/204 [00:01<00:01, 75.85it/s] 43%|████▎     | 88/204 [00:01<00:01, 70.27it/s] 47%|████▋     | 96/204 [00:01<00:01, 60.09it/s] 51%|█████     | 104/204 [00:01<00:01, 64.55it/s] 56%|█████▌    | 114/204 [00:01<00:01, 72.17it/s] 61%|██████    | 124/204 [00:02<00:01, 77.88it/s] 66%|██████▌   | 134/204 [00:02<00:00, 82.27it/s] 70%|███████   | 143/204 [00:02<00:00, 69.49it/s] 74%|███████▍  | 151/204 [00:02<00:00, 63.20it/s] 79%|███████▉  | 161/204 [00:02<00:00, 70.36it/s] 84%|████████▍ | 171/204 [00:02<00:00, 76.34it/s] 89%|████████▊ | 181/204 [00:02<00:00, 80.02it/s] 93%|█████████▎| 190/204 [00:03<00:00, 74.88it/s] 97%|█████████▋| 198/204 [00:03<00:00, 63.53it/s]100%|██████████| 204/204 [00:03<00:00, 62.35it/s]
26032 images processed, 3.324877977371216 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:41,  1.89it/s]  8%|▊         | 6/79 [00:00<00:06, 11.86it/s] 16%|█▋        | 13/79 [00:00<00:02, 24.91it/s] 23%|██▎       | 18/79 [00:00<00:02, 26.66it/s] 29%|██▉       | 23/79 [00:01<00:01, 31.32it/s] 38%|███▊      | 30/79 [00:01<00:01, 40.14it/s] 44%|████▍     | 35/79 [00:01<00:01, 36.43it/s] 51%|█████     | 40/79 [00:01<00:00, 39.03it/s] 57%|█████▋    | 45/79 [00:01<00:00, 41.63it/s] 66%|██████▌   | 52/79 [00:01<00:00, 47.89it/s] 73%|███████▎  | 58/79 [00:01<00:00, 39.43it/s] 82%|████████▏ | 65/79 [00:01<00:00, 40.59it/s] 89%|████████▊ | 70/79 [00:02<00:00, 41.27it/s] 95%|█████████▍| 75/79 [00:02<00:00, 42.40it/s]100%|██████████| 79/79 [00:02<00:00, 34.84it/s]
10000 images processed, 2.303845167160034 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:24,  3.16it/s] 14%|█▍        | 11/79 [00:00<00:02, 32.36it/s] 22%|██▏       | 17/79 [00:00<00:01, 38.29it/s] 29%|██▉       | 23/79 [00:00<00:01, 40.48it/s] 38%|███▊      | 30/79 [00:00<00:01, 48.21it/s] 51%|█████     | 40/79 [00:00<00:00, 61.64it/s] 62%|██████▏   | 49/79 [00:00<00:00, 68.59it/s] 75%|███████▍  | 59/79 [00:01<00:00, 75.81it/s] 86%|████████▌ | 68/79 [00:01<00:00, 69.58it/s] 96%|█████████▌| 76/79 [00:01<00:00, 60.18it/s]100%|██████████| 79/79 [00:01<00:00, 54.07it/s]
10000 images processed, 1.4880383014678955 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:22,  3.10it/s]  9%|▊         | 6/70 [00:00<00:03, 16.95it/s] 20%|██        | 14/70 [00:00<00:01, 35.67it/s] 34%|███▍      | 24/70 [00:00<00:00, 53.41it/s] 49%|████▊     | 34/70 [00:00<00:00, 65.81it/s] 63%|██████▎   | 44/70 [00:00<00:00, 73.62it/s] 76%|███████▌  | 53/70 [00:01<00:00, 61.83it/s] 87%|████████▋ | 61/70 [00:01<00:00, 60.04it/s]100%|██████████| 70/70 [00:01<00:00, 54.18it/s]
8925 images processed, 1.322810173034668 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:00<00:34,  1.26it/s]  4%|▍         | 2/45 [00:01<00:19,  2.20it/s] 16%|█▌        | 7/45 [00:01<00:03,  9.52it/s] 22%|██▏       | 10/45 [00:01<00:04,  8.09it/s] 31%|███       | 14/45 [00:01<00:02, 11.56it/s] 40%|████      | 18/45 [00:02<00:02, 11.32it/s] 49%|████▉     | 22/45 [00:02<00:01, 12.95it/s] 58%|█████▊    | 26/45 [00:02<00:01, 12.56it/s] 67%|██████▋   | 30/45 [00:02<00:01, 13.44it/s] 76%|███████▌  | 34/45 [00:03<00:00, 11.73it/s] 93%|█████████▎| 42/45 [00:04<00:00, 11.04it/s]100%|██████████| 45/45 [00:04<00:00, 10.84it/s]
5640 images processed, 4.178625583648682 seconds used

21.26061773300171
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.53  99.36
places365     67.87  81.18
LSUN          17.60  96.07
iSUN          72.36  81.68
dtd           37.87  91.39
AVG           39.65  89.93
Retain-Acc: 0.7406
Forget-as-OOD (retain known vs forget novel):
  FPR: 79.50 AUROC: 86.90 AUIN: 98.36
9.614149570465088
