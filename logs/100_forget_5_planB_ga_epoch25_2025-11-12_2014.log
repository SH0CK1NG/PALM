nohup: ignoring input
/home/shaokun/anaconda3/envs/CILPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/CILPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
/home/shaokun/PALM/main.py:61: FutureWarning: `torch.cuda.amp.GradScaler(args...)` is deprecated. Please use `torch.amp.GradScaler('cuda', args...)` instead.
  scaler = torch.cuda.amp.GradScaler()
Namespace(in_dataset='CIFAR-100', out_datasets=['inat', 'sun50', 'places50', 'dtd'], backbone='resnet34', method='top5-palm-cache6-ema0.999', seed=1, gpu='0', epochs=25, batch_size=128, lr=0.001, weight_decay=0.0001, print_every=50, fine_tune=False, temp=0.08, cosine=True, warm=False, lr_decay_epochs='700,800,900', lr_decay_rate=0.1, layers=100, depth=40, width=4, growth=12, droprate=0.0, save_path='checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-baseline-ga-b128-e25-lr0.001-wd1e-4-fl1-CIFAR-100forget5.pt', load_path='checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt', reduce=0.5, score='mahalanobis', threshold=1.0, k=5, momentum=0.9, proto_m=0.999, cache_size=6, nviews=2, lambda_pcon=0.0, epsilon=0.05, palm_enable=True, palm_mle_mode='all', palm_retain_only=False, pcon_inc=None, incremental=False, use_lora=False, lora_impl='native', lora_r=8, lora_alpha=32, lora_dropout=0.05, lora_target='head', adapter_save_path=None, adapter_load_path=None, lora_stack=False, lora_orth_enable=False, lora_orth_lambda=0.1, lora_orth_ref_paths=None, forget_classes='0,8,11,40,51', forget_list_path=None, forget_classes_inc=None, forget_classes_seen=None, retain_exclude_csv=None, forget_csv=None, forget_lambda=1.0, forget_margin=100.0, forget_strategy='ga', centers_path=None, precision_path=None, batch_forget_mode='balanced', forget_proto_enable=False, forget_attr_w=1.0, forget_proto_rep_w=1.0, forget_avgproto_enable=False, forget_avgproto_w=1.0, umap_enable=False, umap_by='domain', umap_max_points=20000, umap_neighbors=15, umap_min_dist=0.05, umap_metric='cosine', umap_save_path=None, umap_rf_only=False, keep_cache=False, argument=True)
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
resnet34-top5-palm-cache6-ema0.999: Number of model parameters: 21605312
[debug] trainable_count = 112
[debug] trainable: encoder.conv1.weight
[debug] trainable: encoder.bn1.weight
[debug] trainable: encoder.bn1.bias
[debug] trainable: encoder.layer1.0.conv1.weight
[debug] trainable: encoder.layer1.0.bn1.weight
[debug] trainable: encoder.layer1.0.bn1.bias
[debug] trainable: encoder.layer1.0.conv2.weight
[debug] trainable: encoder.layer1.0.bn2.weight
[debug] trainable: encoder.layer1.0.bn2.bias
[debug] trainable: encoder.layer1.1.conv1.weight
[debug] trainable: encoder.layer1.1.bn1.weight
[debug] trainable: encoder.layer1.1.bn1.bias
[debug] trainable: encoder.layer1.1.conv2.weight
[debug] trainable: encoder.layer1.1.bn2.weight
[debug] trainable: encoder.layer1.1.bn2.bias
[debug] trainable: encoder.layer1.2.conv1.weight
[debug] trainable: encoder.layer1.2.bn1.weight
[debug] trainable: encoder.layer1.2.bn1.bias
[debug] trainable: encoder.layer1.2.conv2.weight
[debug] trainable: encoder.layer1.2.bn2.weight
[debug] trainable: encoder.layer1.2.bn2.bias
[debug] trainable: encoder.layer2.0.conv1.weight
[debug] trainable: encoder.layer2.0.bn1.weight
[debug] trainable: encoder.layer2.0.bn1.bias
[debug] trainable: encoder.layer2.0.conv2.weight
[debug] trainable: encoder.layer2.0.bn2.weight
[debug] trainable: encoder.layer2.0.bn2.bias
[debug] trainable: encoder.layer2.0.shortcut.0.weight
[debug] trainable: encoder.layer2.0.shortcut.1.weight
[debug] trainable: encoder.layer2.0.shortcut.1.bias
[debug] trainable: encoder.layer2.1.conv1.weight
[debug] trainable: encoder.layer2.1.bn1.weight
[debug] trainable: encoder.layer2.1.bn1.bias
[debug] trainable: encoder.layer2.1.conv2.weight
[debug] trainable: encoder.layer2.1.bn2.weight
[debug] trainable: encoder.layer2.1.bn2.bias
[debug] trainable: encoder.layer2.2.conv1.weight
[debug] trainable: encoder.layer2.2.bn1.weight
[debug] trainable: encoder.layer2.2.bn1.bias
[debug] trainable: encoder.layer2.2.conv2.weight
[debug] trainable: encoder.layer2.2.bn2.weight
[debug] trainable: encoder.layer2.2.bn2.bias
[debug] trainable: encoder.layer2.3.conv1.weight
[debug] trainable: encoder.layer2.3.bn1.weight
[debug] trainable: encoder.layer2.3.bn1.bias
[debug] trainable: encoder.layer2.3.conv2.weight
[debug] trainable: encoder.layer2.3.bn2.weight
[debug] trainable: encoder.layer2.3.bn2.bias
[debug] trainable: encoder.layer3.0.conv1.weight
[debug] trainable: encoder.layer3.0.bn1.weight
[debug][warn] non-LoRA trainables detected: ['encoder.conv1.weight', 'encoder.bn1.weight', 'encoder.bn1.bias', 'encoder.layer1.0.conv1.weight', 'encoder.layer1.0.bn1.weight', 'encoder.layer1.0.bn1.bias', 'encoder.layer1.0.conv2.weight', 'encoder.layer1.0.bn2.weight', 'encoder.layer1.0.bn2.bias', 'encoder.layer1.1.conv1.weight']
[trainable] param_count=21605312 tensors=112
  0%|          | 0/25 [00:00<?, ?it/s]/home/shaokun/PALM/trainer.py:550: FutureWarning: `torch.cuda.amp.autocast(args...)` is deprecated. Please use `torch.amp.autocast('cuda', args...)` instead.
  with torch.cuda.amp.autocast(enabled=bool(scaler is not None)):
/home/shaokun/PALM/trainer.py:638: UserWarning: Converting a tensor with requires_grad=True to a scalar may lead to unexpected behavior.
Consider using tensor.detach() first. (Triggered internally at /pytorch/torch/csrc/autograd/generated/python_variable_methods.cpp:835.)
  print(f"[loss-{args.forget_strategy}] ep {epoch} it {it} total={loss.item():.4f} ce_r={float(loss_retain):.4f} ce_f={float(loss_forget):.4f}")
  4%|▍         | 1/25 [00:29<11:47, 29.47s/it]  8%|▊         | 2/25 [00:44<08:06, 21.13s/it] 12%|█▏        | 3/25 [00:59<06:42, 18.31s/it] 16%|█▌        | 4/25 [01:14<05:57, 17.05s/it] 20%|██        | 5/25 [01:30<05:29, 16.48s/it] 24%|██▍       | 6/25 [01:46<05:11, 16.38s/it] 28%|██▊       | 7/25 [02:03<04:55, 16.42s/it] 32%|███▏      | 8/25 [02:19<04:39, 16.43s/it] 36%|███▌      | 9/25 [02:35<04:20, 16.27s/it] 40%|████      | 10/25 [02:51<04:02, 16.15s/it] 44%|████▍     | 11/25 [03:06<03:41, 15.82s/it] 48%|████▊     | 12/25 [03:22<03:25, 15.84s/it] 52%|█████▏    | 13/25 [03:37<03:08, 15.70s/it] 56%|█████▌    | 14/25 [03:53<02:53, 15.78s/it] 60%|██████    | 15/25 [04:09<02:37, 15.72s/it] 64%|██████▍   | 16/25 [04:24<02:19, 15.55s/it] 68%|██████▊   | 17/25 [04:39<02:03, 15.48s/it][loss-ga] ep 0 it 0 total=-0.0751 ce_r=0.0867 ce_f=0.1618
[loss-ga] ep 0 it 50 total=-0.0979 ce_r=0.1110 ce_f=0.2089
[loss-ga] ep 0 it 100 total=-0.3153 ce_r=0.3266 ce_f=0.6419
[loss-ga] ep 0 it 150 total=-0.5261 ce_r=0.5541 ce_f=1.0802
[loss-ga] ep 0 it 200 total=-1.9986 ce_r=2.0638 ce_f=4.0624
[loss-ga] ep 0 it 250 total=-4.0147 ce_r=4.0607 ce_f=8.0754
[loss-ga] ep 0 it 300 total=-5.6034 ce_r=5.7671 ce_f=11.3706
[loss-ga] ep 0 it 350 total=-6.2700 ce_r=6.4735 ce_f=12.7434
[loss-ga] ep 1 it 10 total=-6.5947 ce_r=6.8893 ce_f=13.4840
[loss-ga] ep 1 it 60 total=-6.9870 ce_r=7.2792 ce_f=14.2662
[loss-ga] ep 1 it 110 total=-6.9441 ce_r=7.0177 ce_f=13.9618
[loss-ga] ep 1 it 160 total=-7.4573 ce_r=7.5307 ce_f=14.9881
[loss-ga] ep 1 it 210 total=-7.5635 ce_r=7.6008 ce_f=15.1643
[loss-ga] ep 1 it 260 total=-7.4523 ce_r=7.6496 ce_f=15.1019
[loss-ga] ep 1 it 310 total=-7.6675 ce_r=7.8070 ce_f=15.4745
[loss-ga] ep 1 it 360 total=-7.9572 ce_r=8.1158 ce_f=16.0730
[loss-ga] ep 2 it 20 total=-7.7139 ce_r=7.8890 ce_f=15.6029
[loss-ga] ep 2 it 70 total=-7.6112 ce_r=7.9762 ce_f=15.5874
[loss-ga] ep 2 it 120 total=-7.9937 ce_r=8.0132 ce_f=16.0068
[loss-ga] ep 2 it 170 total=-8.2864 ce_r=8.4180 ce_f=16.7044
[loss-ga] ep 2 it 220 total=-8.0703 ce_r=8.1495 ce_f=16.2198
[loss-ga] ep 2 it 270 total=-7.9878 ce_r=8.2560 ce_f=16.2438
[loss-ga] ep 2 it 320 total=-7.9929 ce_r=8.2817 ce_f=16.2746
[loss-ga] ep 2 it 370 total=-8.0736 ce_r=8.2242 ce_f=16.2978
[loss-ga] ep 3 it 30 total=-8.1232 ce_r=8.1607 ce_f=16.2839
[loss-ga] ep 3 it 80 total=-7.9772 ce_r=8.1417 ce_f=16.1189
[loss-ga] ep 3 it 130 total=-7.9415 ce_r=8.0851 ce_f=16.0266
[loss-ga] ep 3 it 180 total=-7.9872 ce_r=8.1535 ce_f=16.1407
[loss-ga] ep 3 it 230 total=-8.1608 ce_r=8.3618 ce_f=16.5227
[loss-ga] ep 3 it 280 total=-8.2005 ce_r=8.2575 ce_f=16.4580
[loss-ga] ep 3 it 330 total=-8.1072 ce_r=8.1609 ce_f=16.2682
[loss-ga] ep 3 it 380 total=-8.0844 ce_r=8.2057 ce_f=16.2901
[loss-ga] ep 4 it 40 total=-8.1648 ce_r=8.3179 ce_f=16.4827
[loss-ga] ep 4 it 90 total=-8.2223 ce_r=8.3700 ce_f=16.5924
[loss-ga] ep 4 it 140 total=-8.0728 ce_r=8.3478 ce_f=16.4206
[loss-ga] ep 4 it 190 total=-8.3480 ce_r=8.4409 ce_f=16.7889
[loss-ga] ep 4 it 240 total=-8.2194 ce_r=8.3677 ce_f=16.5871
[loss-ga] ep 4 it 290 total=-8.2904 ce_r=8.4719 ce_f=16.7623
[loss-ga] ep 4 it 340 total=-8.2265 ce_r=8.2574 ce_f=16.4840
[loss-ga] ep 5 it 0 total=-8.2583 ce_r=8.3463 ce_f=16.6046
[loss-ga] ep 5 it 50 total=-8.2004 ce_r=8.3985 ce_f=16.5989
[loss-ga] ep 5 it 100 total=-8.2218 ce_r=8.3992 ce_f=16.6210
[loss-ga] ep 5 it 150 total=-7.9204 ce_r=8.3012 ce_f=16.2215
[loss-ga] ep 5 it 200 total=-7.9466 ce_r=8.2195 ce_f=16.1661
[loss-ga] ep 5 it 250 total=-7.8292 ce_r=8.1117 ce_f=15.9409
[loss-ga] ep 5 it 300 total=-8.3383 ce_r=8.5186 ce_f=16.8569
[loss-ga] ep 5 it 350 total=-8.2239 ce_r=8.3444 ce_f=16.5683
[loss-ga] ep 6 it 10 total=-8.3409 ce_r=8.4774 ce_f=16.8182
[loss-ga] ep 6 it 60 total=-8.3214 ce_r=8.3958 ce_f=16.7172
[loss-ga] ep 6 it 110 total=-8.2851 ce_r=8.4053 ce_f=16.6904
[loss-ga] ep 6 it 160 total=-8.2339 ce_r=8.2898 ce_f=16.5237
[loss-ga] ep 6 it 210 total=-8.2170 ce_r=8.2997 ce_f=16.5167
[loss-ga] ep 6 it 260 total=-8.2934 ce_r=8.3602 ce_f=16.6535
[loss-ga] ep 6 it 310 total=-8.4419 ce_r=8.4963 ce_f=16.9382
[loss-ga] ep 6 it 360 total=-8.4527 ce_r=8.4675 ce_f=16.9202
[loss-ga] ep 7 it 20 total=-8.2676 ce_r=8.2870 ce_f=16.5546
[loss-ga] ep 7 it 70 total=-8.2055 ce_r=8.3114 ce_f=16.5169
[loss-ga] ep 7 it 120 total=-8.2926 ce_r=8.3830 ce_f=16.6755
[loss-ga] ep 7 it 170 total=-8.0712 ce_r=8.3072 ce_f=16.3784
[loss-ga] ep 7 it 220 total=-8.3566 ce_r=8.3641 ce_f=16.7207
[loss-ga] ep 7 it 270 total=-8.3174 ce_r=8.3344 ce_f=16.6518
[loss-ga] ep 7 it 320 total=-8.2022 ce_r=8.4824 ce_f=16.6845
[loss-ga] ep 7 it 370 total=-8.3664 ce_r=8.4324 ce_f=16.7988
[loss-ga] ep 8 it 30 total=-8.3119 ce_r=8.3936 ce_f=16.7054
[loss-ga] ep 8 it 80 total=-8.2044 ce_r=8.3753 ce_f=16.5797
[loss-ga] ep 8 it 130 total=-8.2548 ce_r=8.2739 ce_f=16.5288
[loss-ga] ep 8 it 180 total=-8.4121 ce_r=8.5223 ce_f=16.9344
[loss-ga] ep 8 it 230 total=-8.4213 ce_r=8.4681 ce_f=16.8894
[loss-ga] ep 8 it 280 total=-8.4150 ce_r=8.4256 ce_f=16.8407
[loss-ga] ep 8 it 330 total=-8.4466 ce_r=8.5657 ce_f=17.0123
[loss-ga] ep 8 it 380 total=-8.2643 ce_r=8.3674 ce_f=16.6316
[loss-ga] ep 9 it 40 total=-8.3283 ce_r=8.4798 ce_f=16.8081
[loss-ga] ep 9 it 90 total=-8.1620 ce_r=8.3316 ce_f=16.4937
[loss-ga] ep 9 it 140 total=-8.3634 ce_r=8.4062 ce_f=16.7696
[loss-ga] ep 9 it 190 total=-8.5435 ce_r=8.5634 ce_f=17.1069
[loss-ga] ep 9 it 240 total=-8.3288 ce_r=8.4504 ce_f=16.7793
[loss-ga] ep 9 it 290 total=-8.3437 ce_r=8.3856 ce_f=16.7293
[loss-ga] ep 9 it 340 total=-8.1056 ce_r=8.2365 ce_f=16.3421
[loss-ga] ep 10 it 0 total=-8.5329 ce_r=8.5685 ce_f=17.1014
[loss-ga] ep 10 it 50 total=-8.2749 ce_r=8.3935 ce_f=16.6684
[loss-ga] ep 10 it 100 total=-8.2974 ce_r=8.3579 ce_f=16.6553
[loss-ga] ep 10 it 150 total=-8.2597 ce_r=8.2741 ce_f=16.5337
[loss-ga] ep 10 it 200 total=-8.4191 ce_r=8.4690 ce_f=16.8881
[loss-ga] ep 10 it 250 total=-8.4550 ce_r=8.4873 ce_f=16.9423
[loss-ga] ep 10 it 300 total=-8.2696 ce_r=8.3747 ce_f=16.6444
[loss-ga] ep 10 it 350 total=-8.5332 ce_r=8.5530 ce_f=17.0862
[loss-ga] ep 11 it 10 total=-8.2812 ce_r=8.3499 ce_f=16.6311
[loss-ga] ep 11 it 60 total=-8.3035 ce_r=8.3148 ce_f=16.6183
[loss-ga] ep 11 it 110 total=-8.3545 ce_r=8.4746 ce_f=16.8291
[loss-ga] ep 11 it 160 total=-8.4753 ce_r=8.4983 ce_f=16.9736
[loss-ga] ep 11 it 210 total=-8.3379 ce_r=8.3897 ce_f=16.7275
[loss-ga] ep 11 it 260 total=-8.3875 ce_r=8.4942 ce_f=16.8816
[loss-ga] ep 11 it 310 total=-8.2363 ce_r=8.2818 ce_f=16.5181
[loss-ga] ep 11 it 360 total=-8.3917 ce_r=8.4792 ce_f=16.8708
[loss-ga] ep 12 it 20 total=-8.3726 ce_r=8.4326 ce_f=16.8052
[loss-ga] ep 12 it 70 total=-8.2897 ce_r=8.3679 ce_f=16.6575
[loss-ga] ep 12 it 120 total=-8.4191 ce_r=8.5212 ce_f=16.9403
[loss-ga] ep 12 it 170 total=-8.4632 ce_r=8.5165 ce_f=16.9797
[loss-ga] ep 12 it 220 total=-8.1381 ce_r=8.3227 ce_f=16.4608
[loss-ga] ep 12 it 270 total=-8.3315 ce_r=8.3562 ce_f=16.6878
[loss-ga] ep 12 it 320 total=-8.4788 ce_r=8.6267 ce_f=17.1055
[loss-ga] ep 12 it 370 total=-8.2579 ce_r=8.3689 ce_f=16.6268
[loss-ga] ep 13 it 30 total=-8.3855 ce_r=8.5157 ce_f=16.9012
[loss-ga] ep 13 it 80 total=-8.3352 ce_r=8.4009 ce_f=16.7361
[loss-ga] ep 13 it 130 total=-8.4197 ce_r=8.4728 ce_f=16.8925
[loss-ga] ep 13 it 180 total=-8.4927 ce_r=8.5159 ce_f=17.0086
[loss-ga] ep 13 it 230 total=-8.3912 ce_r=8.4200 ce_f=16.8112
[loss-ga] ep 13 it 280 total=-8.4168 ce_r=8.5097 ce_f=16.9264
[loss-ga] ep 13 it 330 total=-8.1306 ce_r=8.2737 ce_f=16.4043
[loss-ga] ep 13 it 380 total=-8.0363 ce_r=8.1763 ce_f=16.2126
[loss-ga] ep 14 it 40 total=-8.3531 ce_r=8.4061 ce_f=16.7591
[loss-ga] ep 14 it 90 total=-8.2453 ce_r=8.3628 ce_f=16.6081
[loss-ga] ep 14 it 140 total=-8.4021 ce_r=8.4422 ce_f=16.8443
[loss-ga] ep 14 it 190 total=-8.3969 ce_r=8.4279 ce_f=16.8248
[loss-ga] ep 14 it 240 total=-8.2458 ce_r=8.3140 ce_f=16.5598
[loss-ga] ep 14 it 290 total=-8.3011 ce_r=8.3685 ce_f=16.6696
[loss-ga] ep 14 it 340 total=-8.5757 ce_r=8.7166 ce_f=17.2923
[loss-ga] ep 15 it 0 total=-8.2607 ce_r=8.3714 ce_f=16.6322
[loss-ga] ep 15 it 50 total=-8.4975 ce_r=8.5149 ce_f=17.0124
[loss-ga] ep 15 it 100 total=-8.2574 ce_r=8.2819 ce_f=16.5394
[loss-ga] ep 15 it 150 total=-8.4097 ce_r=8.4849 ce_f=16.8946
[loss-ga] ep 15 it 200 total=-8.3917 ce_r=8.4369 ce_f=16.8286
[loss-ga] ep 15 it 250 total=-8.4688 ce_r=8.6105 ce_f=17.0793
[loss-ga] ep 15 it 300 total=-8.4631 ce_r=8.5549 ce_f=17.0180
[loss-ga] ep 15 it 350 total=-8.3123 ce_r=8.3391 ce_f=16.6514
[loss-ga] ep 16 it 10 total=-8.5197 ce_r=8.5631 ce_f=17.0828
[loss-ga] ep 16 it 60 total=-8.1812 ce_r=8.4210 ce_f=16.6022
[loss-ga] ep 16 it 110 total=-8.3314 ce_r=8.4722 ce_f=16.8036
[loss-ga] ep 16 it 160 total=-8.2396 ce_r=8.3029 ce_f=16.5425
[loss-ga] ep 16 it 210 total=-8.4385 ce_r=8.5550 ce_f=16.9935
[loss-ga] ep 16 it 260 total=-8.4828 ce_r=8.5210 ce_f=17.0038
[loss-ga] ep 16 it 310 total=-8.4936 ce_r=8.5453 ce_f=17.0389
[loss-ga] ep 16 it 360 total=-8.1852 ce_r=8.2255 ce_f=16.4106
[loss-ga] ep 17 it 20 total=-8.2521 ce_r=8.4048 ce_f=16.6568
 72%|███████▏  | 18/25 [04:54<01:47, 15.35s/it] 76%|███████▌  | 19/25 [05:10<01:33, 15.54s/it] 80%|████████  | 20/25 [05:27<01:20, 16.03s/it] 84%|████████▍ | 21/25 [05:44<01:04, 16.08s/it] 88%|████████▊ | 22/25 [05:59<00:47, 15.84s/it] 92%|█████████▏| 23/25 [06:15<00:31, 15.81s/it] 96%|█████████▌| 24/25 [06:31<00:16, 16.11s/it]100%|██████████| 25/25 [06:47<00:00, 16.02s/it]100%|██████████| 25/25 [06:47<00:00, 16.31s/it]
[loss-ga] ep 17 it 70 total=-8.2618 ce_r=8.3082 ce_f=16.5700
[loss-ga] ep 17 it 120 total=-8.2108 ce_r=8.3106 ce_f=16.5214
[loss-ga] ep 17 it 170 total=-8.1394 ce_r=8.3214 ce_f=16.4609
[loss-ga] ep 17 it 220 total=-8.2411 ce_r=8.3372 ce_f=16.5782
[loss-ga] ep 17 it 270 total=-8.2955 ce_r=8.3616 ce_f=16.6571
[loss-ga] ep 17 it 320 total=-8.4738 ce_r=8.5389 ce_f=17.0127
[loss-ga] ep 17 it 370 total=-8.4737 ce_r=8.5003 ce_f=16.9740
[loss-ga] ep 18 it 30 total=-8.3652 ce_r=8.4468 ce_f=16.8120
[loss-ga] ep 18 it 80 total=-8.3077 ce_r=8.3252 ce_f=16.6328
[loss-ga] ep 18 it 130 total=-8.3597 ce_r=8.3728 ce_f=16.7325
[loss-ga] ep 18 it 180 total=-8.4378 ce_r=8.4504 ce_f=16.8882
[loss-ga] ep 18 it 230 total=-8.3764 ce_r=8.4102 ce_f=16.7866
[loss-ga] ep 18 it 280 total=-8.3455 ce_r=8.4752 ce_f=16.8208
[loss-ga] ep 18 it 330 total=-8.3455 ce_r=8.4953 ce_f=16.8408
[loss-ga] ep 18 it 380 total=-8.3073 ce_r=8.4016 ce_f=16.7089
[loss-ga] ep 19 it 40 total=-8.5023 ce_r=8.5220 ce_f=17.0243
[loss-ga] ep 19 it 90 total=-8.2781 ce_r=8.3017 ce_f=16.5798
[loss-ga] ep 19 it 140 total=-8.3442 ce_r=8.3684 ce_f=16.7127
[loss-ga] ep 19 it 190 total=-8.2194 ce_r=8.4472 ce_f=16.6666
[loss-ga] ep 19 it 240 total=-8.2556 ce_r=8.4015 ce_f=16.6571
[loss-ga] ep 19 it 290 total=-8.5381 ce_r=8.5685 ce_f=17.1065
[loss-ga] ep 19 it 340 total=-8.2741 ce_r=8.3760 ce_f=16.6501
[loss-ga] ep 20 it 0 total=-8.4220 ce_r=8.4475 ce_f=16.8695
[loss-ga] ep 20 it 50 total=-8.3898 ce_r=8.4635 ce_f=16.8533
[loss-ga] ep 20 it 100 total=-8.3920 ce_r=8.4705 ce_f=16.8625
[loss-ga] ep 20 it 150 total=-8.3672 ce_r=8.3958 ce_f=16.7630
[loss-ga] ep 20 it 200 total=-8.4085 ce_r=8.4435 ce_f=16.8520
[loss-ga] ep 20 it 250 total=-8.4040 ce_r=8.4215 ce_f=16.8254
[loss-ga] ep 20 it 300 total=-8.1796 ce_r=8.2909 ce_f=16.4705
[loss-ga] ep 20 it 350 total=-8.4335 ce_r=8.5480 ce_f=16.9815
[loss-ga] ep 21 it 10 total=-8.4539 ce_r=8.4781 ce_f=16.9321
[loss-ga] ep 21 it 60 total=-8.5279 ce_r=8.5473 ce_f=17.0752
[loss-ga] ep 21 it 110 total=-8.3991 ce_r=8.4326 ce_f=16.8317
[loss-ga] ep 21 it 160 total=-8.3512 ce_r=8.3969 ce_f=16.7481
[loss-ga] ep 21 it 210 total=-8.5888 ce_r=8.6194 ce_f=17.2082
[loss-ga] ep 21 it 260 total=-8.3554 ce_r=8.4921 ce_f=16.8475
[loss-ga] ep 21 it 310 total=-8.1425 ce_r=8.2963 ce_f=16.4389
[loss-ga] ep 21 it 360 total=-8.4319 ce_r=8.5579 ce_f=16.9898
[loss-ga] ep 22 it 20 total=-8.5232 ce_r=8.5808 ce_f=17.1040
[loss-ga] ep 22 it 70 total=-8.2644 ce_r=8.2805 ce_f=16.5449
[loss-ga] ep 22 it 120 total=-8.2720 ce_r=8.3069 ce_f=16.5789
[loss-ga] ep 22 it 170 total=-8.4442 ce_r=8.4635 ce_f=16.9076
[loss-ga] ep 22 it 220 total=-8.2408 ce_r=8.5409 ce_f=16.7817
[loss-ga] ep 22 it 270 total=-8.4338 ce_r=8.5453 ce_f=16.9790
[loss-ga] ep 22 it 320 total=-8.0845 ce_r=8.1157 ce_f=16.2002
[loss-ga] ep 22 it 370 total=-8.2794 ce_r=8.4146 ce_f=16.6941
[loss-ga] ep 23 it 30 total=-8.3782 ce_r=8.4425 ce_f=16.8206
[loss-ga] ep 23 it 80 total=-8.3913 ce_r=8.4436 ce_f=16.8350
[loss-ga] ep 23 it 130 total=-8.4278 ce_r=8.4580 ce_f=16.8857
[loss-ga] ep 23 it 180 total=-8.4432 ce_r=8.4782 ce_f=16.9214
[loss-ga] ep 23 it 230 total=-8.3415 ce_r=8.4528 ce_f=16.7943
[loss-ga] ep 23 it 280 total=-8.1191 ce_r=8.2048 ce_f=16.3239
[loss-ga] ep 23 it 330 total=-8.4263 ce_r=8.4804 ce_f=16.9067
[loss-ga] ep 23 it 380 total=-8.3534 ce_r=8.4386 ce_f=16.7921
[loss-ga] ep 24 it 40 total=-8.3499 ce_r=8.3842 ce_f=16.7341
[loss-ga] ep 24 it 90 total=-8.5636 ce_r=8.6036 ce_f=17.1671
[loss-ga] ep 24 it 140 total=-8.3675 ce_r=8.3882 ce_f=16.7556
[loss-ga] ep 24 it 190 total=-8.3987 ce_r=8.4400 ce_f=16.8387
[loss-ga] ep 24 it 240 total=-8.4838 ce_r=8.4984 ce_f=16.9822
[loss-ga] ep 24 it 290 total=-8.5540 ce_r=8.5666 ce_f=17.1206
[loss-ga] ep 24 it 340 total=-8.4056 ce_r=8.4306 ce_f=16.8363
/home/shaokun/anaconda3/envs/CILPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/CILPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-baseline-ga-b128-e25-lr0.001-wd1e-4-fl1-CIFAR-100forget5.pt
resnet34-top5-palm-cache6-ema0.999-baseline-ga-b128-e25-lr0.001-wd1e-4-fl1-CIFAR-100forget5: Number of model parameters: 21605312
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<03:20,  1.94it/s]  3%|▎         | 11/391 [00:00<00:16, 23.12it/s]  5%|▌         | 21/391 [00:00<00:08, 41.24it/s]  8%|▊         | 31/391 [00:00<00:06, 55.76it/s] 11%|█         | 42/391 [00:00<00:05, 68.36it/s] 14%|█▎        | 53/391 [00:01<00:04, 77.58it/s] 16%|█▋        | 64/391 [00:01<00:03, 84.13it/s] 19%|█▉        | 75/391 [00:01<00:03, 88.95it/s] 22%|██▏       | 86/391 [00:01<00:03, 92.33it/s] 25%|██▍       | 97/391 [00:01<00:03, 94.83it/s] 27%|██▋       | 107/391 [00:01<00:02, 95.68it/s] 30%|███       | 118/391 [00:01<00:02, 97.36it/s] 33%|███▎      | 129/391 [00:01<00:02, 98.32it/s] 36%|███▌      | 139/391 [00:01<00:02, 96.79it/s] 38%|███▊      | 150/391 [00:02<00:02, 97.87it/s] 41%|████      | 161/391 [00:02<00:02, 98.86it/s] 44%|████▍     | 172/391 [00:02<00:02, 99.45it/s] 47%|████▋     | 183/391 [00:02<00:02, 99.78it/s] 50%|████▉     | 194/391 [00:02<00:01, 99.98it/s] 52%|█████▏    | 205/391 [00:02<00:01, 99.84it/s] 55%|█████▌    | 216/391 [00:02<00:01, 99.95it/s] 58%|█████▊    | 227/391 [00:02<00:01, 100.10it/s] 61%|██████    | 238/391 [00:02<00:01, 100.35it/s] 64%|██████▎   | 249/391 [00:03<00:01, 98.42it/s]  66%|██████▋   | 260/391 [00:03<00:01, 99.10it/s] 69%|██████▉   | 270/391 [00:03<00:01, 98.56it/s] 72%|███████▏  | 281/391 [00:03<00:01, 99.15it/s] 75%|███████▍  | 292/391 [00:03<00:00, 99.45it/s] 77%|███████▋  | 303/391 [00:03<00:00, 99.78it/s] 80%|████████  | 313/391 [00:03<00:00, 98.90it/s] 83%|████████▎ | 323/391 [00:03<00:00, 99.13it/s] 85%|████████▌ | 334/391 [00:03<00:00, 99.67it/s] 88%|████████▊ | 345/391 [00:03<00:00, 100.12it/s] 91%|█████████ | 356/391 [00:04<00:00, 100.02it/s] 94%|█████████▍| 367/391 [00:04<00:00, 100.09it/s] 97%|█████████▋| 378/391 [00:04<00:00, 100.64it/s] 99%|█████████▉| 389/391 [00:04<00:00, 101.13it/s]100%|██████████| 391/391 [00:04<00:00, 88.26it/s] 
50000 images processed, 4.517690181732178 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:41,  1.88it/s] 13%|█▎        | 10/79 [00:00<00:03, 20.30it/s] 24%|██▍       | 19/79 [00:00<00:01, 35.73it/s] 37%|███▋      | 29/79 [00:00<00:00, 50.73it/s] 49%|████▉     | 39/79 [00:00<00:00, 62.43it/s] 62%|██████▏   | 49/79 [00:01<00:00, 71.67it/s] 75%|███████▍  | 59/79 [00:01<00:00, 78.74it/s] 87%|████████▋ | 69/79 [00:01<00:00, 84.23it/s]100%|██████████| 79/79 [00:01<00:00, 84.16it/s]100%|██████████| 79/79 [00:01<00:00, 57.09it/s]
10000 images processed, 1.4069702625274658 seconds used

Saved forget OOD features to cache/resnet34-top5-palm-cache6-ema0.999-baseline-ga-b128-e25-lr0.001-wd1e-4-fl1-CIFAR-100forget5/CIFAR-100/forget
Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:55,  1.75it/s]  5%|▌         | 11/204 [00:00<00:09, 21.36it/s] 10%|█         | 21/204 [00:00<00:04, 38.49it/s] 15%|█▌        | 31/204 [00:00<00:03, 52.88it/s] 20%|█▉        | 40/204 [00:00<00:02, 60.11it/s] 25%|██▍       | 50/204 [00:01<00:02, 70.37it/s] 29%|██▉       | 60/204 [00:01<00:01, 77.83it/s] 34%|███▍      | 70/204 [00:01<00:01, 81.48it/s] 39%|███▉      | 80/204 [00:01<00:01, 85.35it/s] 44%|████▍     | 90/204 [00:01<00:01, 87.94it/s] 49%|████▉     | 100/204 [00:01<00:01, 89.86it/s] 54%|█████▍    | 110/204 [00:01<00:01, 92.43it/s] 59%|█████▉    | 120/204 [00:01<00:00, 93.03it/s] 64%|██████▎   | 130/204 [00:01<00:00, 94.25it/s] 69%|██████▊   | 140/204 [00:02<00:00, 95.38it/s] 74%|███████▎  | 150/204 [00:02<00:00, 96.33it/s] 78%|███████▊  | 160/204 [00:02<00:00, 97.38it/s] 83%|████████▎ | 170/204 [00:02<00:00, 97.01it/s] 88%|████████▊ | 180/204 [00:02<00:00, 97.65it/s] 94%|█████████▎| 191/204 [00:02<00:00, 98.78it/s] 99%|█████████▉| 202/204 [00:02<00:00, 99.41it/s]100%|██████████| 204/204 [00:02<00:00, 76.08it/s]
26032 images processed, 2.718705892562866 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:52,  1.48it/s] 14%|█▍        | 11/79 [00:00<00:03, 18.38it/s] 27%|██▋       | 21/79 [00:00<00:01, 34.29it/s] 39%|███▉      | 31/79 [00:00<00:00, 48.47it/s] 52%|█████▏    | 41/79 [00:01<00:00, 60.63it/s] 65%|██████▍   | 51/79 [00:01<00:00, 70.40it/s] 77%|███████▋  | 61/79 [00:01<00:00, 78.12it/s] 91%|█████████ | 72/79 [00:01<00:00, 84.76it/s]100%|██████████| 79/79 [00:01<00:00, 53.99it/s]
10000 images processed, 1.4930260181427002 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:41,  1.89it/s] 13%|█▎        | 10/79 [00:00<00:03, 20.32it/s] 25%|██▌       | 20/79 [00:00<00:01, 38.57it/s] 38%|███▊      | 30/79 [00:00<00:00, 52.85it/s] 51%|█████     | 40/79 [00:00<00:00, 64.60it/s] 63%|██████▎   | 50/79 [00:01<00:00, 73.94it/s] 77%|███████▋  | 61/79 [00:01<00:00, 81.79it/s] 91%|█████████ | 72/79 [00:01<00:00, 87.54it/s]100%|██████████| 79/79 [00:01<00:00, 59.52it/s]
10000 images processed, 1.3454363346099854 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:36,  1.90it/s] 14%|█▍        | 10/70 [00:00<00:02, 20.30it/s] 29%|██▊       | 20/70 [00:00<00:01, 37.89it/s] 43%|████▎     | 30/70 [00:00<00:00, 52.48it/s] 57%|█████▋    | 40/70 [00:00<00:00, 63.63it/s] 73%|███████▎  | 51/70 [00:01<00:00, 74.21it/s] 89%|████████▊ | 62/70 [00:01<00:00, 81.86it/s]100%|██████████| 70/70 [00:01<00:00, 55.69it/s]
8925 images processed, 1.2884666919708252 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:01<00:44,  1.02s/it]  4%|▍         | 2/45 [00:01<00:21,  1.98it/s] 27%|██▋       | 12/45 [00:01<00:02, 15.93it/s] 38%|███▊      | 17/45 [00:01<00:01, 18.13it/s] 47%|████▋     | 21/45 [00:01<00:01, 20.40it/s] 62%|██████▏   | 28/45 [00:01<00:00, 29.33it/s] 73%|███████▎  | 33/45 [00:02<00:00, 21.02it/s] 82%|████████▏ | 37/45 [00:02<00:00, 23.68it/s]100%|██████████| 45/45 [00:02<00:00, 19.52it/s]
5640 images processed, 2.330930471420288 seconds used

16.670145750045776
/home/shaokun/anaconda3/envs/CILPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/CILPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
/home/shaokun/anaconda3/envs/CILPALM/lib/python3.10/site-packages/umap/umap_.py:1952: UserWarning: n_jobs value 1 overridden to 1 by setting random_state. Use no seed for parallelism.
  warn(
/home/shaokun/anaconda3/envs/CILPALM/lib/python3.10/site-packages/umap/umap_.py:1952: UserWarning: n_jobs value 1 overridden to 1 by setting random_state. Use no seed for parallelism.
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           7.02  98.38  95.90
places365     72.26  78.22  75.69
LSUN          30.52  93.47  93.65
iSUN          73.33  80.91  84.10
dtd           44.10  89.33  93.18
AVG           45.45  88.06  88.50
Retain-Acc: 0.7279
Forget-as-OOD (retain known vs forget novel):
  FPR: 71.80 AUROC: 74.65 AUIN: 98.18
7.591947317123413
[umap] saved to figs/umap_CIFAR-100_resnet34_top5-palm-cache6-ema0.999-baseline-ga-b128-e25-lr0.001-wd1e-4-fl1-CIFAR-100forget5_domain.png
[umap] saved to figs/umap_CIFAR-100_resnet34_top5-palm-cache6-ema0.999-baseline-ga-b128-e25-lr0.001-wd1e-4-fl1-CIFAR-100forget5_rf.png
