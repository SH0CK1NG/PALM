nohup: ignoring input
==== Stage 1: forget_inc={0,8,11,40,51}; forget_seen={}; all={0,8,11,40,51,66,67,88,94,57} ====
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
/home/shaokun/PALM/main.py:54: FutureWarning: `torch.cuda.amp.GradScaler(args...)` is deprecated. Please use `torch.amp.GradScaler('cuda', args...)` instead.
  scaler = torch.cuda.amp.GradScaler()
Namespace(in_dataset='CIFAR-100', out_datasets=['inat', 'sun50', 'places50', 'dtd'], backbone='resnet34', method='top5-palm-cache6-ema0.999', seed=1, gpu='0', epochs=5, batch_size=128, lr=0.001, weight_decay=0.0001, print_every=50, fine_tune=False, temp=0.08, cosine=True, warm=False, lr_decay_epochs='700,800,900', lr_decay_rate=0.1, layers=100, depth=40, width=4, growth=12, droprate=0.0, save_path='CIFAR-10-ResNet18.pt', load_path='checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt', reduce=0.5, score='mahalanobis', threshold=1.0, k=5, momentum=0.9, proto_m=0.999, cache_size=6, nviews=2, lambda_pcon=1.0, epsilon=0.05, incremental=False, use_lora=True, lora_impl='peft', lora_r=8, lora_alpha=32, lora_dropout=0.05, lora_target='both', adapter_save_path='checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stack/stage1', adapter_load_path=None, adapter_load_paths=None, lora_new_adapter_name=None, lora_stack=False, lora_orth_enable=False, lora_orth_lambda=0.1, lora_orth_ref_paths=None, forget_classes='0,8,11,40,51,66,67,88,94,57', forget_list_path=None, forget_classes_inc='0,8,11,40,51', forget_classes_seen=None, retain_exclude_csv=None, forget_csv=None, forget_lambda=0.2, forget_margin=100.0, forget_strategy='proto', centers_path=None, precision_path=None, batch_forget_mode='balanced', forget_proto_enable=False, forget_attr_w=1.0, forget_proto_rep_w=1.0, forget_avgproto_enable=False, forget_avgproto_w=1.0, umap_enable=False, umap_by='domain', umap_max_points=20000, umap_neighbors=15, umap_min_dist=0.05, umap_metric='cosine', umap_save_path=None, umap_rf_only=False, keep_cache=False, argument=True)
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
resnet34-top5-palm-cache6-ema0.999: Number of model parameters: 21843904
[debug] trainable_count = 16
[debug] trainable: base_model.model.encoder.layer4.0.conv1.lora_A.default.weight
[debug] trainable: base_model.model.encoder.layer4.0.conv1.lora_B.default.weight
[debug] trainable: base_model.model.encoder.layer4.0.conv2.lora_A.default.weight
[debug] trainable: base_model.model.encoder.layer4.0.conv2.lora_B.default.weight
[debug] trainable: base_model.model.encoder.layer4.0.shortcut.0.lora_A.default.weight
[debug] trainable: base_model.model.encoder.layer4.0.shortcut.0.lora_B.default.weight
[debug] trainable: base_model.model.encoder.layer4.1.conv1.lora_A.default.weight
[debug] trainable: base_model.model.encoder.layer4.1.conv1.lora_B.default.weight
[debug] trainable: base_model.model.encoder.layer4.1.conv2.lora_A.default.weight
[debug] trainable: base_model.model.encoder.layer4.1.conv2.lora_B.default.weight
[debug] trainable: base_model.model.encoder.layer4.2.conv1.lora_A.default.weight
[debug] trainable: base_model.model.encoder.layer4.2.conv1.lora_B.default.weight
[debug] trainable: base_model.model.encoder.layer4.2.conv2.lora_A.default.weight
[debug] trainable: base_model.model.encoder.layer4.2.conv2.lora_B.default.weight
[debug] trainable: base_model.model.head.2.lora_A.default.weight
[debug] trainable: base_model.model.head.2.lora_B.default.weight
[debug][warn] non-LoRA trainables detected: ['base_model.model.encoder.layer4.0.conv1.lora_A.default.weight', 'base_model.model.encoder.layer4.0.conv1.lora_B.default.weight', 'base_model.model.encoder.layer4.0.conv2.lora_A.default.weight', 'base_model.model.encoder.layer4.0.conv2.lora_B.default.weight', 'base_model.model.encoder.layer4.0.shortcut.0.lora_A.default.weight', 'base_model.model.encoder.layer4.0.shortcut.0.lora_B.default.weight', 'base_model.model.encoder.layer4.1.conv1.lora_A.default.weight', 'base_model.model.encoder.layer4.1.conv1.lora_B.default.weight', 'base_model.model.encoder.layer4.1.conv2.lora_A.default.weight', 'base_model.model.encoder.layer4.1.conv2.lora_B.default.weight']
  0%|          | 0/5 [00:00<?, ?it/s]/home/shaokun/PALM/trainer.py:139: FutureWarning: `torch.cuda.amp.autocast(args...)` is deprecated. Please use `torch.amp.autocast('cuda', args...)` instead.
  with torch.cuda.amp.autocast():
 20%|██        | 1/5 [01:47<07:08, 107.04s/it] 40%|████      | 2/5 [02:11<02:55, 58.58s/it]  60%|██████    | 3/5 [02:33<01:24, 42.01s/it] 80%|████████  | 4/5 [02:58<00:35, 35.01s/it]100%|██████████| 5/5 [03:18<00:00, 29.73s/it]100%|██████████| 5/5 [03:18<00:00, 39.72s/it]
[loss] ep 0 it 0 total=8.3811 mle=1.5980 pcon=5.2951 forget=1.4880 orth=0.0000 favg=0.0000 nr=28 nf=28 protos=570 fproto_sim=NA
[loss] ep 0 it 50 total=8.7595 mle=1.9972 pcon=5.2911 forget=1.4712 orth=0.0000 favg=0.0000 nr=30 nf=30 protos=570 fproto_sim=NA
[loss] ep 0 it 100 total=8.8934 mle=2.1485 pcon=5.2870 forget=1.4579 orth=0.0000 favg=0.0000 nr=30 nf=30 protos=570 fproto_sim=NA
[loss] ep 0 it 150 total=9.2583 mle=2.5105 pcon=5.2832 forget=1.4646 orth=0.0000 favg=0.0000 nr=32 nf=32 protos=570 fproto_sim=NA
[loss] ep 0 it 200 total=9.2762 mle=2.5474 pcon=5.2791 forget=1.4498 orth=0.0000 favg=0.0000 nr=30 nf=30 protos=570 fproto_sim=NA
[loss] ep 0 it 250 total=8.6594 mle=1.9176 pcon=5.2752 forget=1.4665 orth=0.0000 favg=0.0000 nr=34 nf=34 protos=570 fproto_sim=NA
[loss] ep 0 it 300 total=8.5038 mle=1.7862 pcon=5.2713 forget=1.4463 orth=0.0000 favg=0.0000 nr=30 nf=30 protos=570 fproto_sim=NA
[loss] ep 0 it 350 total=9.0427 mle=2.3259 pcon=5.2675 forget=1.4493 orth=0.0000 favg=0.0000 nr=34 nf=34 protos=570 fproto_sim=NA
[peft] adapter saved to checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stack/stage1
[loss] ep 1 it 10 total=8.3754 mle=1.6421 pcon=5.2637 forget=1.4696 orth=0.0000 favg=0.0000 nr=41 nf=41 protos=570 fproto_sim=NA
[loss] ep 1 it 60 total=8.3646 mle=1.6556 pcon=5.2599 forget=1.4491 orth=0.0000 favg=0.0000 nr=26 nf=26 protos=570 fproto_sim=NA
[loss] ep 1 it 110 total=8.3744 mle=1.6662 pcon=5.2563 forget=1.4519 orth=0.0000 favg=0.0000 nr=30 nf=30 protos=570 fproto_sim=NA
[loss] ep 1 it 160 total=8.5364 mle=1.7870 pcon=5.2527 forget=1.4967 orth=0.0000 favg=0.0000 nr=32 nf=32 protos=570 fproto_sim=NA
[loss] ep 1 it 210 total=8.2692 mle=1.5534 pcon=5.2490 forget=1.4668 orth=0.0000 favg=0.0000 nr=32 nf=32 protos=570 fproto_sim=NA
[loss] ep 1 it 260 total=8.7188 mle=2.0005 pcon=5.2453 forget=1.4730 orth=0.0000 favg=0.0000 nr=30 nf=30 protos=570 fproto_sim=NA
[loss] ep 1 it 310 total=8.9542 mle=2.2417 pcon=5.2419 forget=1.4705 orth=0.0000 favg=0.0000 nr=36 nf=36 protos=570 fproto_sim=NA
[loss] ep 1 it 360 total=8.5467 mle=1.8657 pcon=5.2383 forget=1.4427 orth=0.0000 favg=0.0000 nr=33 nf=33 protos=570 fproto_sim=NA
[peft] adapter saved to checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stack/stage1
[loss] ep 2 it 20 total=8.0545 mle=1.3651 pcon=5.2348 forget=1.4546 orth=0.0000 favg=0.0000 nr=38 nf=38 protos=570 fproto_sim=NA
[loss] ep 2 it 70 total=8.4467 mle=1.8039 pcon=5.2316 forget=1.4112 orth=0.0000 favg=0.0000 nr=32 nf=32 protos=570 fproto_sim=NA
[loss] ep 2 it 120 total=8.3462 mle=1.6641 pcon=5.2282 forget=1.4539 orth=0.0000 favg=0.0000 nr=40 nf=40 protos=570 fproto_sim=NA
[loss] ep 2 it 170 total=8.7063 mle=2.0457 pcon=5.2248 forget=1.4357 orth=0.0000 favg=0.0000 nr=24 nf=24 protos=570 fproto_sim=NA
[loss] ep 2 it 220 total=9.0455 mle=2.3965 pcon=5.2216 forget=1.4274 orth=0.0000 favg=0.0000 nr=27 nf=27 protos=570 fproto_sim=NA
[loss] ep 2 it 270 total=8.4757 mle=1.8103 pcon=5.2184 forget=1.4470 orth=0.0000 favg=0.0000 nr=35 nf=35 protos=570 fproto_sim=NA
[loss] ep 2 it 320 total=8.2588 mle=1.5983 pcon=5.2153 forget=1.4452 orth=0.0000 favg=0.0000 nr=33 nf=33 protos=570 fproto_sim=NA
[loss] ep 2 it 370 total=8.6864 mle=2.0371 pcon=5.2123 forget=1.4370 orth=0.0000 favg=0.0000 nr=29 nf=29 protos=570 fproto_sim=NA
[peft] adapter saved to checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stack/stage1
[loss] ep 3 it 30 total=8.2844 mle=1.6319 pcon=5.2091 forget=1.4434 orth=0.0000 favg=0.0000 nr=28 nf=28 protos=570 fproto_sim=NA
[loss] ep 3 it 80 total=8.7030 mle=1.9745 pcon=5.2058 forget=1.5227 orth=0.0000 favg=0.0000 nr=34 nf=34 protos=570 fproto_sim=NA
[loss] ep 3 it 130 total=8.5236 mle=1.9429 pcon=5.2030 forget=1.3777 orth=0.0000 favg=0.0000 nr=30 nf=30 protos=570 fproto_sim=NA
[loss] ep 3 it 180 total=8.7428 mle=2.1014 pcon=5.1997 forget=1.4416 orth=0.0000 favg=0.0000 nr=41 nf=41 protos=570 fproto_sim=NA
[loss] ep 3 it 230 total=8.4349 mle=1.8277 pcon=5.1967 forget=1.4104 orth=0.0000 favg=0.0000 nr=32 nf=32 protos=570 fproto_sim=NA
[loss] ep 3 it 280 total=8.4477 mle=1.8482 pcon=5.1939 forget=1.4056 orth=0.0000 favg=0.0000 nr=33 nf=33 protos=570 fproto_sim=NA
[loss] ep 3 it 330 total=8.7782 mle=2.1115 pcon=5.1911 forget=1.4756 orth=0.0000 favg=0.0000 nr=25 nf=25 protos=570 fproto_sim=NA
[loss] ep 3 it 380 total=8.3117 mle=1.6334 pcon=5.1881 forget=1.4902 orth=0.0000 favg=0.0000 nr=29 nf=29 protos=570 fproto_sim=NA
[peft] adapter saved to checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stack/stage1
[loss] ep 4 it 40 total=8.5256 mle=1.8572 pcon=5.1854 forget=1.4830 orth=0.0000 favg=0.0000 nr=34 nf=34 protos=570 fproto_sim=NA
[loss] ep 4 it 90 total=8.2827 mle=1.7163 pcon=5.1825 forget=1.3839 orth=0.0000 favg=0.0000 nr=41 nf=41 protos=570 fproto_sim=NA
[loss] ep 4 it 140 total=8.9957 mle=2.3384 pcon=5.1797 forget=1.4776 orth=0.0000 favg=0.0000 nr=33 nf=33 protos=570 fproto_sim=NA
[loss] ep 4 it 190 total=8.5001 mle=1.8535 pcon=5.1767 forget=1.4698 orth=0.0000 favg=0.0000 nr=25 nf=25 protos=570 fproto_sim=NA
[loss] ep 4 it 240 total=8.5113 mle=1.8303 pcon=5.1738 forget=1.5072 orth=0.0000 favg=0.0000 nr=28 nf=28 protos=570 fproto_sim=NA
[loss] ep 4 it 290 total=8.3032 mle=1.7324 pcon=5.1710 forget=1.3998 orth=0.0000 favg=0.0000 nr=29 nf=29 protos=570 fproto_sim=NA
[loss] ep 4 it 340 total=8.6434 mle=2.0392 pcon=5.1682 forget=1.4360 orth=0.0000 favg=0.0000 nr=29 nf=29 protos=570 fproto_sim=NA
[peft] adapter saved to checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stack/stage1
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stage1-inc1: Number of model parameters: 21843904
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<04:23,  1.48it/s]  2%|▏         | 6/391 [00:00<00:39,  9.74it/s]  3%|▎         | 12/391 [00:00<00:19, 19.04it/s]  5%|▌         | 20/391 [00:01<00:11, 31.68it/s]  7%|▋         | 29/391 [00:01<00:08, 44.58it/s] 10%|▉         | 38/391 [00:01<00:06, 54.79it/s] 12%|█▏        | 46/391 [00:01<00:06, 55.11it/s] 14%|█▎        | 53/391 [00:01<00:06, 54.23it/s] 15%|█▌        | 60/391 [00:01<00:06, 54.74it/s] 18%|█▊        | 69/391 [00:01<00:05, 62.96it/s] 20%|█▉        | 78/391 [00:01<00:04, 69.62it/s] 22%|██▏       | 87/391 [00:01<00:04, 74.66it/s] 25%|██▍       | 96/391 [00:02<00:03, 78.56it/s] 27%|██▋       | 105/391 [00:02<00:04, 64.09it/s] 29%|██▉       | 113/391 [00:02<00:04, 60.70it/s] 31%|███       | 122/391 [00:02<00:03, 67.36it/s] 34%|███▎      | 131/391 [00:02<00:03, 72.80it/s] 36%|███▌      | 140/391 [00:02<00:03, 75.49it/s] 38%|███▊      | 148/391 [00:02<00:03, 72.89it/s] 40%|███▉      | 156/391 [00:02<00:03, 63.85it/s] 42%|████▏     | 163/391 [00:03<00:03, 61.20it/s] 44%|████▍     | 172/391 [00:03<00:03, 67.89it/s] 46%|████▋     | 181/391 [00:03<00:02, 72.26it/s] 49%|████▊     | 190/391 [00:03<00:02, 76.01it/s] 51%|█████     | 198/391 [00:03<00:02, 66.05it/s] 52%|█████▏    | 205/391 [00:03<00:03, 61.84it/s] 54%|█████▍    | 212/391 [00:03<00:02, 63.05it/s] 57%|█████▋    | 221/391 [00:03<00:02, 69.66it/s] 59%|█████▉    | 230/391 [00:04<00:02, 73.18it/s] 61%|██████    | 239/391 [00:04<00:02, 73.41it/s] 63%|██████▎   | 247/391 [00:04<00:02, 62.80it/s] 65%|██████▍   | 254/391 [00:04<00:02, 60.29it/s] 67%|██████▋   | 263/391 [00:04<00:01, 67.18it/s] 70%|██████▉   | 272/391 [00:04<00:01, 72.43it/s] 72%|███████▏  | 281/391 [00:04<00:01, 76.04it/s] 74%|███████▍  | 289/391 [00:04<00:01, 71.89it/s] 76%|███████▌  | 297/391 [00:05<00:01, 63.55it/s] 78%|███████▊  | 304/391 [00:05<00:01, 60.92it/s] 80%|████████  | 313/391 [00:05<00:01, 67.78it/s] 82%|████████▏ | 321/391 [00:05<00:00, 70.52it/s] 84%|████████▍ | 330/391 [00:05<00:00, 75.21it/s] 86%|████████▋ | 338/391 [00:05<00:00, 63.33it/s] 88%|████████▊ | 345/391 [00:05<00:00, 60.14it/s] 90%|█████████ | 353/391 [00:05<00:00, 64.40it/s] 93%|█████████▎| 362/391 [00:06<00:00, 69.63it/s] 95%|█████████▍| 371/391 [00:06<00:00, 74.66it/s] 97%|█████████▋| 380/391 [00:06<00:00, 78.45it/s] 99%|█████████▉| 389/391 [00:06<00:00, 71.31it/s]100%|██████████| 391/391 [00:06<00:00, 60.90it/s]
50000 images processed, 6.5829548835754395 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:51,  1.51it/s] 10%|█         | 8/79 [00:00<00:05, 13.37it/s] 16%|█▋        | 13/79 [00:00<00:03, 20.35it/s] 24%|██▍       | 19/79 [00:00<00:02, 28.27it/s] 32%|███▏      | 25/79 [00:01<00:01, 35.11it/s] 43%|████▎     | 34/79 [00:01<00:00, 47.79it/s] 54%|█████▍    | 43/79 [00:01<00:00, 57.52it/s] 66%|██████▌   | 52/79 [00:01<00:00, 65.68it/s] 76%|███████▌  | 60/79 [00:01<00:00, 58.44it/s] 85%|████████▍ | 67/79 [00:01<00:00, 57.39it/s] 94%|█████████▎| 74/79 [00:01<00:00, 60.11it/s]100%|██████████| 79/79 [00:01<00:00, 41.93it/s]
10000 images processed, 1.9079740047454834 seconds used

Saved forget OOD features to cache/resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stage1-inc1/CIFAR-100/forget
Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<02:11,  1.55it/s]  3%|▎         | 6/204 [00:00<00:19,  9.98it/s]  6%|▌         | 12/204 [00:00<00:10, 19.11it/s] 10%|▉         | 20/204 [00:00<00:05, 31.77it/s] 14%|█▍        | 29/204 [00:01<00:03, 44.79it/s] 18%|█▊        | 37/204 [00:01<00:03, 53.43it/s] 22%|██▏       | 44/204 [00:01<00:03, 50.89it/s] 25%|██▌       | 51/204 [00:01<00:03, 50.56it/s] 28%|██▊       | 58/204 [00:01<00:02, 54.15it/s] 33%|███▎      | 67/204 [00:01<00:02, 61.70it/s] 37%|███▋      | 76/204 [00:01<00:01, 68.24it/s] 42%|████▏     | 85/204 [00:01<00:01, 70.55it/s] 46%|████▌     | 93/204 [00:02<00:01, 60.10it/s] 49%|████▉     | 100/204 [00:02<00:01, 60.95it/s] 53%|█████▎    | 109/204 [00:02<00:01, 67.05it/s] 58%|█████▊    | 118/204 [00:02<00:01, 72.25it/s] 62%|██████▏   | 127/204 [00:02<00:01, 74.32it/s] 66%|██████▌   | 135/204 [00:02<00:01, 66.84it/s] 71%|███████   | 145/204 [00:02<00:00, 73.98it/s] 76%|███████▌  | 155/204 [00:02<00:00, 79.27it/s] 81%|████████  | 165/204 [00:03<00:00, 82.56it/s] 86%|████████▌ | 175/204 [00:03<00:00, 85.55it/s] 91%|█████████ | 185/204 [00:03<00:00, 88.74it/s] 96%|█████████▌| 195/204 [00:03<00:00, 90.73it/s]100%|██████████| 204/204 [00:03<00:00, 59.37it/s]
26032 images processed, 3.4915988445281982 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:57,  1.34it/s] 13%|█▎        | 10/79 [00:00<00:04, 15.59it/s] 24%|██▍       | 19/79 [00:00<00:02, 28.99it/s] 35%|███▌      | 28/79 [00:01<00:01, 40.95it/s] 46%|████▌     | 36/79 [00:01<00:00, 46.97it/s] 54%|█████▍    | 43/79 [00:01<00:00, 46.94it/s] 63%|██████▎   | 50/79 [00:01<00:00, 48.85it/s] 75%|███████▍  | 59/79 [00:01<00:00, 58.04it/s] 86%|████████▌ | 68/79 [00:01<00:00, 65.95it/s] 97%|█████████▋| 77/79 [00:01<00:00, 72.05it/s]100%|██████████| 79/79 [00:01<00:00, 44.15it/s]
10000 images processed, 1.8226702213287354 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:43,  1.80it/s] 13%|█▎        | 10/79 [00:00<00:03, 19.67it/s] 24%|██▍       | 19/79 [00:00<00:01, 35.02it/s] 35%|███▌      | 28/79 [00:00<00:01, 47.89it/s] 47%|████▋     | 37/79 [00:00<00:00, 58.09it/s] 57%|█████▋    | 45/79 [00:01<00:00, 58.36it/s] 67%|██████▋   | 53/79 [00:01<00:00, 54.22it/s] 76%|███████▌  | 60/79 [00:01<00:00, 56.73it/s] 87%|████████▋ | 69/79 [00:01<00:00, 64.73it/s] 99%|█████████▊| 78/79 [00:01<00:00, 71.05it/s]100%|██████████| 79/79 [00:01<00:00, 49.57it/s]
10000 images processed, 1.6145095825195312 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:48,  1.43it/s]  9%|▊         | 6/70 [00:00<00:06,  9.51it/s] 21%|██▏       | 15/70 [00:00<00:02, 24.50it/s] 34%|███▍      | 24/70 [00:01<00:01, 38.11it/s] 47%|████▋     | 33/70 [00:01<00:00, 49.64it/s] 59%|█████▊    | 41/70 [00:01<00:00, 56.95it/s] 70%|███████   | 49/70 [00:01<00:00, 51.32it/s] 80%|████████  | 56/70 [00:01<00:00, 52.23it/s] 93%|█████████▎| 65/70 [00:01<00:00, 60.92it/s]100%|██████████| 70/70 [00:01<00:00, 41.01it/s]
8925 images processed, 1.7443478107452393 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:01<00:48,  1.11s/it]  4%|▍         | 2/45 [00:01<00:23,  1.81it/s] 27%|██▋       | 12/45 [00:01<00:02, 14.68it/s] 38%|███▊      | 17/45 [00:01<00:02, 13.01it/s] 47%|████▋     | 21/45 [00:01<00:01, 15.21it/s] 58%|█████▊    | 26/45 [00:02<00:00, 20.14it/s] 73%|███████▎  | 33/45 [00:02<00:00, 15.09it/s] 82%|████████▏ | 37/45 [00:02<00:00, 17.76it/s] 93%|█████████▎| 42/45 [00:02<00:00, 22.01it/s]100%|██████████| 45/45 [00:02<00:00, 15.13it/s]
5640 images processed, 2.9939169883728027 seconds used

21.88249158859253
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/umap/umap_.py:1952: UserWarning: n_jobs value 1 overridden to 1 by setting random_state. Use no seed for parallelism.
  warn(
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/umap/umap_.py:1952: UserWarning: n_jobs value 1 overridden to 1 by setting random_state. Use no seed for parallelism.
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.55  99.36
places365     68.45  80.52
LSUN          22.01  94.99
iSUN          72.53  81.45
dtd           38.40  91.28
AVG           40.79  89.52
Retain-Acc: 0.7485
Forget-as-OOD (retain known vs forget novel):
  FPR: 55.20 AUROC: 88.46 AUIN: 99.25
9.672688722610474
[umap] saved to figs/umap_CIFAR-100_resnet34_top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stage1-inc1_domain.png
[umap] saved to figs/umap_CIFAR-100_resnet34_top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stage1-inc1_rf.png
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stage1-seen: Number of model parameters: 21843904
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<03:00,  2.16it/s]  2%|▏         | 6/391 [00:00<00:30, 12.58it/s]  3%|▎         | 12/391 [00:00<00:15, 23.73it/s]  5%|▍         | 19/391 [00:00<00:10, 35.36it/s]  7%|▋         | 28/391 [00:00<00:07, 49.68it/s]  9%|▉         | 37/391 [00:01<00:05, 60.29it/s] 12%|█▏        | 46/391 [00:01<00:05, 66.99it/s] 14%|█▍        | 55/391 [00:01<00:04, 73.02it/s] 16%|█▌        | 63/391 [00:01<00:05, 62.39it/s] 18%|█▊        | 70/391 [00:01<00:05, 58.52it/s] 20%|█▉        | 78/391 [00:01<00:05, 62.28it/s] 22%|██▏       | 87/391 [00:01<00:04, 68.16it/s] 25%|██▍       | 96/391 [00:01<00:04, 73.38it/s] 27%|██▋       | 104/391 [00:01<00:03, 74.62it/s] 29%|██▊       | 112/391 [00:02<00:04, 63.07it/s] 30%|███       | 119/391 [00:02<00:04, 60.30it/s] 32%|███▏      | 127/391 [00:02<00:04, 64.59it/s] 35%|███▍      | 136/391 [00:02<00:03, 71.02it/s] 37%|███▋      | 145/391 [00:02<00:03, 74.01it/s] 39%|███▉      | 153/391 [00:02<00:03, 71.67it/s] 41%|████      | 161/391 [00:02<00:03, 62.32it/s] 43%|████▎     | 168/391 [00:02<00:03, 60.07it/s] 45%|████▌     | 177/391 [00:03<00:03, 66.10it/s] 48%|████▊     | 186/391 [00:03<00:02, 71.85it/s] 50%|████▉     | 195/391 [00:03<00:02, 75.43it/s] 52%|█████▏    | 203/391 [00:03<00:02, 69.74it/s] 54%|█████▍    | 211/391 [00:03<00:02, 62.91it/s] 56%|█████▌    | 218/391 [00:03<00:02, 61.96it/s] 58%|█████▊    | 227/391 [00:03<00:02, 67.90it/s] 60%|██████    | 236/391 [00:03<00:02, 73.29it/s] 63%|██████▎   | 245/391 [00:04<00:01, 76.34it/s] 65%|██████▍   | 253/391 [00:04<00:02, 63.86it/s] 66%|██████▋   | 260/391 [00:04<00:02, 60.90it/s] 68%|██████▊   | 267/391 [00:04<00:01, 62.48it/s] 71%|███████   | 276/391 [00:04<00:01, 69.43it/s] 73%|███████▎  | 285/391 [00:04<00:01, 74.61it/s] 75%|███████▌  | 294/391 [00:04<00:01, 78.66it/s] 77%|███████▋  | 303/391 [00:04<00:01, 76.38it/s] 80%|███████▉  | 311/391 [00:05<00:01, 64.74it/s] 81%|████████▏ | 318/391 [00:05<00:01, 61.19it/s] 84%|████████▎ | 327/391 [00:05<00:00, 68.05it/s] 86%|████████▌ | 336/391 [00:05<00:00, 72.59it/s] 88%|████████▊ | 345/391 [00:05<00:00, 76.78it/s] 90%|█████████ | 353/391 [00:05<00:00, 75.76it/s] 92%|█████████▏| 361/391 [00:05<00:00, 63.45it/s] 94%|█████████▍| 368/391 [00:05<00:00, 61.55it/s] 96%|█████████▋| 377/391 [00:05<00:00, 67.12it/s] 99%|█████████▉| 387/391 [00:06<00:00, 73.68it/s]100%|██████████| 391/391 [00:06<00:00, 63.48it/s]
50000 images processed, 6.272065877914429 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:42,  1.86it/s] 11%|█▏        | 9/79 [00:00<00:03, 18.05it/s] 23%|██▎       | 18/79 [00:00<00:01, 34.03it/s] 34%|███▍      | 27/79 [00:00<00:01, 47.08it/s] 44%|████▍     | 35/79 [00:01<00:00, 48.18it/s] 53%|█████▎    | 42/79 [00:01<00:00, 49.85it/s] 62%|██████▏   | 49/79 [00:01<00:00, 53.30it/s] 73%|███████▎  | 58/79 [00:01<00:00, 62.42it/s] 85%|████████▍ | 67/79 [00:01<00:00, 69.06it/s] 96%|█████████▌| 76/79 [00:01<00:00, 74.58it/s]100%|██████████| 79/79 [00:01<00:00, 49.34it/s]
10000 images processed, 1.6212694644927979 seconds used

Saved forget OOD features to cache/resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stage1-seen/CIFAR-100/forget
Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<02:01,  1.66it/s]  3%|▎         | 6/204 [00:00<00:18, 10.56it/s]  5%|▌         | 11/204 [00:00<00:10, 18.65it/s]  8%|▊         | 17/204 [00:00<00:06, 27.15it/s] 13%|█▎        | 26/204 [00:01<00:04, 41.12it/s] 17%|█▋        | 35/204 [00:01<00:03, 52.62it/s] 22%|██▏       | 44/204 [00:01<00:02, 61.85it/s] 25%|██▌       | 52/204 [00:01<00:02, 56.10it/s] 29%|██▉       | 59/204 [00:01<00:02, 56.89it/s] 32%|███▏      | 66/204 [00:01<00:02, 56.85it/s] 37%|███▋      | 75/204 [00:01<00:02, 64.26it/s] 41%|████      | 84/204 [00:01<00:01, 69.76it/s] 46%|████▌     | 93/204 [00:01<00:01, 74.02it/s] 50%|████▉     | 101/204 [00:02<00:01, 63.21it/s] 53%|█████▎    | 108/204 [00:02<00:01, 57.82it/s] 57%|█████▋    | 117/204 [00:02<00:01, 63.84it/s] 62%|██████▏   | 126/204 [00:02<00:01, 68.95it/s] 66%|██████▌   | 135/204 [00:02<00:00, 73.31it/s] 71%|███████   | 144/204 [00:02<00:00, 76.31it/s] 75%|███████▍  | 152/204 [00:02<00:00, 62.21it/s] 78%|███████▊  | 159/204 [00:03<00:00, 59.45it/s] 82%|████████▏ | 168/204 [00:03<00:00, 66.26it/s] 87%|████████▋ | 177/204 [00:03<00:00, 71.23it/s] 91%|█████████ | 186/204 [00:03<00:00, 75.99it/s] 96%|█████████▌| 195/204 [00:03<00:00, 79.60it/s]100%|██████████| 204/204 [00:03<00:00, 68.67it/s]100%|██████████| 204/204 [00:03<00:00, 55.90it/s]
26032 images processed, 3.697798013687134 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:56,  1.39it/s]  8%|▊         | 6/79 [00:00<00:07,  9.33it/s] 16%|█▋        | 13/79 [00:00<00:03, 20.15it/s] 23%|██▎       | 18/79 [00:01<00:02, 25.32it/s] 30%|███       | 24/79 [00:01<00:01, 31.77it/s] 42%|████▏     | 33/79 [00:01<00:01, 44.19it/s] 52%|█████▏    | 41/79 [00:01<00:00, 50.92it/s] 61%|██████    | 48/79 [00:01<00:00, 53.23it/s] 70%|██████▉   | 55/79 [00:01<00:00, 51.57it/s] 77%|███████▋  | 61/79 [00:01<00:00, 51.44it/s] 89%|████████▊ | 70/79 [00:01<00:00, 61.02it/s]100%|██████████| 79/79 [00:01<00:00, 39.79it/s]
10000 images processed, 2.0477964878082275 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:44,  1.76it/s]  8%|▊         | 6/79 [00:00<00:06, 10.95it/s] 14%|█▍        | 11/79 [00:00<00:03, 19.27it/s] 22%|██▏       | 17/79 [00:00<00:02, 27.76it/s] 33%|███▎      | 26/79 [00:01<00:01, 42.36it/s] 44%|████▍     | 35/79 [00:01<00:00, 53.88it/s] 56%|█████▌    | 44/79 [00:01<00:00, 63.06it/s] 67%|██████▋   | 53/79 [00:01<00:00, 70.23it/s] 77%|███████▋  | 61/79 [00:01<00:00, 68.70it/s] 87%|████████▋ | 69/79 [00:01<00:00, 60.03it/s] 96%|█████████▌| 76/79 [00:01<00:00, 59.55it/s]100%|██████████| 79/79 [00:01<00:00, 44.79it/s]
10000 images processed, 1.7817552089691162 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:42,  1.64it/s]  9%|▊         | 6/70 [00:00<00:06, 10.43it/s] 16%|█▌        | 11/70 [00:00<00:03, 18.49it/s] 26%|██▌       | 18/70 [00:00<00:01, 29.86it/s] 39%|███▊      | 27/70 [00:01<00:00, 44.13it/s] 51%|█████▏    | 36/70 [00:01<00:00, 55.48it/s] 64%|██████▍   | 45/70 [00:01<00:00, 64.39it/s] 77%|███████▋  | 54/70 [00:01<00:00, 71.12it/s] 90%|█████████ | 63/70 [00:01<00:00, 65.37it/s]100%|██████████| 70/70 [00:01<00:00, 42.37it/s]
8925 images processed, 1.6834156513214111 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:01<00:49,  1.12s/it]  4%|▍         | 2/45 [00:01<00:23,  1.85it/s] 20%|██        | 9/45 [00:01<00:03, 10.94it/s] 31%|███       | 14/45 [00:01<00:01, 17.05it/s] 40%|████      | 18/45 [00:01<00:01, 15.59it/s] 51%|█████     | 23/45 [00:01<00:01, 20.40it/s] 62%|██████▏   | 28/45 [00:02<00:00, 24.94it/s] 73%|███████▎  | 33/45 [00:02<00:00, 18.56it/s] 93%|█████████▎| 42/45 [00:02<00:00, 28.83it/s]100%|██████████| 45/45 [00:02<00:00, 17.38it/s]
5640 images processed, 2.607436418533325 seconds used

21.35913586616516
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/umap/umap_.py:1952: UserWarning: n_jobs value 1 overridden to 1 by setting random_state. Use no seed for parallelism.
  warn(
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/umap/umap_.py:1952: UserWarning: n_jobs value 1 overridden to 1 by setting random_state. Use no seed for parallelism.
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.55  99.36
places365     68.45  80.52
LSUN          22.01  94.99
iSUN          72.53  81.45
dtd           38.40  91.28
AVG           40.79  89.52
Retain-Acc: 0.7485
Forget-as-OOD (retain known vs forget novel):
  FPR: 55.20 AUROC: 88.46 AUIN: 99.25
10.203808069229126
[umap] saved to figs/umap_CIFAR-100_resnet34_top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stage1-seen_domain.png
[umap] saved to figs/umap_CIFAR-100_resnet34_top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stage1-seen_rf.png
==== Stage 2: forget_inc={66,67,88,94,57}; forget_seen={0,8,11,40,51}; all={0,8,11,40,51,66,67,88,94,57} ====
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
/home/shaokun/PALM/main.py:54: FutureWarning: `torch.cuda.amp.GradScaler(args...)` is deprecated. Please use `torch.amp.GradScaler('cuda', args...)` instead.
  scaler = torch.cuda.amp.GradScaler()
Namespace(in_dataset='CIFAR-100', out_datasets=['inat', 'sun50', 'places50', 'dtd'], backbone='resnet34', method='top5-palm-cache6-ema0.999', seed=1, gpu='0', epochs=5, batch_size=128, lr=0.001, weight_decay=0.0001, print_every=50, fine_tune=False, temp=0.08, cosine=True, warm=False, lr_decay_epochs='700,800,900', lr_decay_rate=0.1, layers=100, depth=40, width=4, growth=12, droprate=0.0, save_path='CIFAR-10-ResNet18.pt', load_path='checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt', reduce=0.5, score='mahalanobis', threshold=1.0, k=5, momentum=0.9, proto_m=0.999, cache_size=6, nviews=2, lambda_pcon=1.0, epsilon=0.05, incremental=False, use_lora=True, lora_impl='peft', lora_r=8, lora_alpha=32, lora_dropout=0.05, lora_target='both', adapter_save_path='checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stack/stage2', adapter_load_path='checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stack/stage1', adapter_load_paths=None, lora_new_adapter_name=None, lora_stack=False, lora_orth_enable=True, lora_orth_lambda=0.1, lora_orth_ref_paths='checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stack/stage1', forget_classes='0,8,11,40,51,66,67,88,94,57', forget_list_path=None, forget_classes_inc='66,67,88,94,57', forget_classes_seen='0,8,11,40,51', retain_exclude_csv=None, forget_csv=None, forget_lambda=0.2, forget_margin=100.0, forget_strategy='proto', centers_path=None, precision_path=None, batch_forget_mode='balanced', forget_proto_enable=False, forget_attr_w=1.0, forget_proto_rep_w=1.0, forget_avgproto_enable=False, forget_avgproto_w=1.0, umap_enable=False, umap_by='domain', umap_max_points=20000, umap_neighbors=15, umap_min_dist=0.05, umap_metric='cosine', umap_save_path=None, umap_rf_only=False, keep_cache=False, argument=True)
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stack/stage1
[peft] active adapters set to: default
resnet34-top5-palm-cache6-ema0.999: Number of model parameters: 21843904
[debug] trainable_count = 16
[debug] trainable: base_model.model.encoder.layer4.0.conv1.lora_A.default.weight
[debug] trainable: base_model.model.encoder.layer4.0.conv1.lora_B.default.weight
[debug] trainable: base_model.model.encoder.layer4.0.conv2.lora_A.default.weight
[debug] trainable: base_model.model.encoder.layer4.0.conv2.lora_B.default.weight
[debug] trainable: base_model.model.encoder.layer4.0.shortcut.0.lora_A.default.weight
[debug] trainable: base_model.model.encoder.layer4.0.shortcut.0.lora_B.default.weight
[debug] trainable: base_model.model.encoder.layer4.1.conv1.lora_A.default.weight
[debug] trainable: base_model.model.encoder.layer4.1.conv1.lora_B.default.weight
[debug] trainable: base_model.model.encoder.layer4.1.conv2.lora_A.default.weight
[debug] trainable: base_model.model.encoder.layer4.1.conv2.lora_B.default.weight
[debug] trainable: base_model.model.encoder.layer4.2.conv1.lora_A.default.weight
[debug] trainable: base_model.model.encoder.layer4.2.conv1.lora_B.default.weight
[debug] trainable: base_model.model.encoder.layer4.2.conv2.lora_A.default.weight
[debug] trainable: base_model.model.encoder.layer4.2.conv2.lora_B.default.weight
[debug] trainable: base_model.model.head.2.lora_A.default.weight
[debug] trainable: base_model.model.head.2.lora_B.default.weight
[debug][warn] non-LoRA trainables detected: ['base_model.model.encoder.layer4.0.conv1.lora_A.default.weight', 'base_model.model.encoder.layer4.0.conv1.lora_B.default.weight', 'base_model.model.encoder.layer4.0.conv2.lora_A.default.weight', 'base_model.model.encoder.layer4.0.conv2.lora_B.default.weight', 'base_model.model.encoder.layer4.0.shortcut.0.lora_A.default.weight', 'base_model.model.encoder.layer4.0.shortcut.0.lora_B.default.weight', 'base_model.model.encoder.layer4.1.conv1.lora_A.default.weight', 'base_model.model.encoder.layer4.1.conv1.lora_B.default.weight', 'base_model.model.encoder.layer4.1.conv2.lora_A.default.weight', 'base_model.model.encoder.layer4.1.conv2.lora_B.default.weight']
  0%|          | 0/5 [00:00<?, ?it/s]/home/shaokun/PALM/trainer.py:139: FutureWarning: `torch.cuda.amp.autocast(args...)` is deprecated. Please use `torch.amp.autocast('cuda', args...)` instead.
  with torch.cuda.amp.autocast():
/home/shaokun/PALM/trainer.py:227: FutureWarning: `torch.cuda.amp.autocast(args...)` is deprecated. Please use `torch.amp.autocast('cuda', args...)` instead.
  with torch.cuda.amp.autocast(enabled=False):
 20%|██        | 1/5 [01:47<07:08, 107.14s/it] 40%|████      | 2/5 [02:15<03:02, 60.69s/it]  60%|██████    | 3/5 [02:39<01:28, 44.08s/it] 80%|████████  | 4/5 [03:06<00:37, 37.25s/it]100%|██████████| 5/5 [03:30<00:00, 32.50s/it]100%|██████████| 5/5 [03:30<00:00, 42.10s/it]
[loss] ep 0 it 0 total=8.6608 mle=1.8458 pcon=5.2951 forget=1.4193 orth=0.1006 favg=0.0000 nr=36 nf=36 protos=540 fproto_sim=NA
[loss] ep 0 it 50 total=8.6443 mle=1.8131 pcon=5.2897 forget=1.4409 orth=0.1006 favg=0.0000 nr=34 nf=34 protos=540 fproto_sim=NA
[loss] ep 0 it 100 total=8.8337 mle=2.0127 pcon=5.2847 forget=1.4357 orth=0.1006 favg=0.0000 nr=34 nf=34 protos=540 fproto_sim=NA
[loss] ep 0 it 150 total=8.9146 mle=2.0390 pcon=5.2796 forget=1.4954 orth=0.1006 favg=0.0000 nr=32 nf=32 protos=540 fproto_sim=NA
[loss] ep 0 it 200 total=8.9924 mle=2.1170 pcon=5.2744 forget=1.5005 orth=0.1006 favg=0.0000 nr=34 nf=34 protos=540 fproto_sim=NA
[loss] ep 0 it 250 total=8.6674 mle=1.8994 pcon=5.2693 forget=1.3981 orth=0.1006 favg=0.0000 nr=30 nf=30 protos=540 fproto_sim=NA
[loss] ep 0 it 300 total=8.9432 mle=2.1197 pcon=5.2645 forget=1.4584 orth=0.1006 favg=0.0000 nr=34 nf=34 protos=540 fproto_sim=NA
[loss] ep 0 it 350 total=8.8724 mle=2.0891 pcon=5.2598 forget=1.4229 orth=0.1006 favg=0.0000 nr=30 nf=30 protos=540 fproto_sim=NA
[peft] adapter saved to checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stack/stage2
[loss] ep 1 it 10 total=8.8722 mle=2.0282 pcon=5.2551 forget=1.4883 orth=0.1006 favg=0.0000 nr=23 nf=23 protos=540 fproto_sim=NA
[loss] ep 1 it 60 total=8.7881 mle=2.0471 pcon=5.2503 forget=1.3902 orth=0.1006 favg=0.0000 nr=38 nf=38 protos=540 fproto_sim=NA
[loss] ep 1 it 110 total=8.6636 mle=1.8953 pcon=5.2457 forget=1.4221 orth=0.1006 favg=0.0000 nr=34 nf=34 protos=540 fproto_sim=NA
[loss] ep 1 it 160 total=8.6080 mle=1.8590 pcon=5.2412 forget=1.4072 orth=0.1006 favg=0.0000 nr=32 nf=32 protos=540 fproto_sim=NA
[loss] ep 1 it 210 total=8.7794 mle=2.0580 pcon=5.2368 forget=1.3841 orth=0.1006 favg=0.0000 nr=32 nf=32 protos=540 fproto_sim=NA
[loss] ep 1 it 260 total=8.4940 mle=1.7821 pcon=5.2322 forget=1.3791 orth=0.1006 favg=0.0000 nr=34 nf=34 protos=540 fproto_sim=NA
[loss] ep 1 it 310 total=8.6976 mle=1.9331 pcon=5.2276 forget=1.4364 orth=0.1006 favg=0.0000 nr=28 nf=28 protos=540 fproto_sim=NA
[loss] ep 1 it 360 total=8.9519 mle=2.1587 pcon=5.2231 forget=1.4695 orth=0.1006 favg=0.0000 nr=31 nf=31 protos=540 fproto_sim=NA
[peft] adapter saved to checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stack/stage2
[loss] ep 2 it 20 total=8.7787 mle=1.9889 pcon=5.2188 forget=1.4705 orth=0.1006 favg=0.0000 nr=26 nf=26 protos=540 fproto_sim=NA
[loss] ep 2 it 70 total=8.4419 mle=1.7076 pcon=5.2144 forget=1.4194 orth=0.1005 favg=0.0000 nr=32 nf=32 protos=540 fproto_sim=NA
[loss] ep 2 it 120 total=8.8593 mle=2.1078 pcon=5.2103 forget=1.4407 orth=0.1005 favg=0.0000 nr=24 nf=24 protos=540 fproto_sim=NA
[loss] ep 2 it 170 total=8.4515 mle=1.7358 pcon=5.2064 forget=1.4088 orth=0.1005 favg=0.0000 nr=40 nf=40 protos=540 fproto_sim=NA
[loss] ep 2 it 220 total=8.6947 mle=1.9649 pcon=5.2022 forget=1.4270 orth=0.1005 favg=0.0000 nr=37 nf=37 protos=540 fproto_sim=NA
[loss] ep 2 it 270 total=8.7687 mle=2.0288 pcon=5.1982 forget=1.4412 orth=0.1005 favg=0.0000 nr=29 nf=29 protos=540 fproto_sim=NA
[loss] ep 2 it 320 total=8.4100 mle=1.6924 pcon=5.1942 forget=1.4229 orth=0.1005 favg=0.0000 nr=31 nf=31 protos=540 fproto_sim=NA
[loss] ep 2 it 370 total=8.7167 mle=2.0151 pcon=5.1905 forget=1.4105 orth=0.1005 favg=0.0000 nr=35 nf=35 protos=540 fproto_sim=NA
[peft] adapter saved to checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stack/stage2
[loss] ep 3 it 30 total=8.7432 mle=2.0441 pcon=5.1868 forget=1.4118 orth=0.1005 favg=0.0000 nr=36 nf=36 protos=540 fproto_sim=NA
[loss] ep 3 it 80 total=8.8358 mle=2.1615 pcon=5.1831 forget=1.3907 orth=0.1005 favg=0.0000 nr=30 nf=30 protos=540 fproto_sim=NA
[loss] ep 3 it 130 total=8.3766 mle=1.6690 pcon=5.1794 forget=1.4277 orth=0.1005 favg=0.0000 nr=34 nf=34 protos=540 fproto_sim=NA
[loss] ep 3 it 180 total=8.6972 mle=1.9565 pcon=5.1756 forget=1.4646 orth=0.1005 favg=0.0000 nr=23 nf=23 protos=540 fproto_sim=NA
[loss] ep 3 it 230 total=8.5740 mle=1.8815 pcon=5.1721 forget=1.4198 orth=0.1005 favg=0.0000 nr=32 nf=32 protos=540 fproto_sim=NA
[loss] ep 3 it 280 total=8.7411 mle=2.0560 pcon=5.1685 forget=1.4160 orth=0.1005 favg=0.0000 nr=31 nf=31 protos=540 fproto_sim=NA
[loss] ep 3 it 330 total=8.6820 mle=2.0231 pcon=5.1647 forget=1.3937 orth=0.1005 favg=0.0000 nr=39 nf=39 protos=540 fproto_sim=NA
[loss] ep 3 it 380 total=8.4094 mle=1.7632 pcon=5.1611 forget=1.3847 orth=0.1005 favg=0.0000 nr=35 nf=35 protos=540 fproto_sim=NA
[peft] adapter saved to checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stack/stage2
[loss] ep 4 it 40 total=8.7396 mle=2.0576 pcon=5.1574 forget=1.4241 orth=0.1005 favg=0.0000 nr=30 nf=30 protos=540 fproto_sim=NA
[loss] ep 4 it 90 total=8.5906 mle=1.9397 pcon=5.1540 forget=1.3964 orth=0.1005 favg=0.0000 nr=23 nf=23 protos=540 fproto_sim=NA
[loss] ep 4 it 140 total=8.5656 mle=1.8889 pcon=5.1506 forget=1.4256 orth=0.1005 favg=0.0000 nr=31 nf=31 protos=540 fproto_sim=NA
[loss] ep 4 it 190 total=8.3344 mle=1.6776 pcon=5.1471 forget=1.4093 orth=0.1005 favg=0.0000 nr=39 nf=39 protos=540 fproto_sim=NA
[loss] ep 4 it 240 total=8.8930 mle=2.2240 pcon=5.1437 forget=1.4248 orth=0.1005 favg=0.0000 nr=36 nf=36 protos=540 fproto_sim=NA
[loss] ep 4 it 290 total=8.3615 mle=1.7388 pcon=5.1405 forget=1.3818 orth=0.1005 favg=0.0000 nr=35 nf=35 protos=540 fproto_sim=NA
[loss] ep 4 it 340 total=8.7819 mle=2.0957 pcon=5.1372 forget=1.4486 orth=0.1005 favg=0.0000 nr=35 nf=35 protos=540 fproto_sim=NA
[peft] adapter saved to checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stack/stage2
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stage2-inc1: Number of model parameters: 21843904
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<03:14,  2.01it/s]  2%|▏         | 6/391 [00:00<00:30, 12.42it/s]  3%|▎         | 13/391 [00:00<00:15, 25.11it/s]  5%|▍         | 19/391 [00:00<00:11, 33.47it/s]  7%|▋         | 28/391 [00:00<00:07, 47.73it/s]  9%|▉         | 37/391 [00:01<00:06, 58.92it/s] 12%|█▏        | 46/391 [00:01<00:05, 67.21it/s] 14%|█▍        | 55/391 [00:01<00:04, 73.25it/s] 16%|█▋        | 64/391 [00:01<00:04, 68.38it/s] 18%|█▊        | 72/391 [00:01<00:05, 62.61it/s] 20%|██        | 79/391 [00:01<00:05, 61.38it/s] 23%|██▎       | 88/391 [00:01<00:04, 68.50it/s] 25%|██▍       | 97/391 [00:01<00:04, 73.29it/s] 27%|██▋       | 106/391 [00:01<00:03, 77.52it/s] 29%|██▉       | 115/391 [00:02<00:03, 75.23it/s] 31%|███▏      | 123/391 [00:02<00:04, 63.55it/s] 33%|███▎      | 130/391 [00:02<00:04, 61.37it/s] 36%|███▌      | 139/391 [00:02<00:03, 68.05it/s] 38%|███▊      | 148/391 [00:02<00:03, 72.78it/s] 40%|████      | 157/391 [00:02<00:03, 77.27it/s] 42%|████▏     | 166/391 [00:02<00:02, 79.53it/s] 45%|████▍     | 175/391 [00:02<00:03, 67.32it/s] 47%|████▋     | 183/391 [00:03<00:03, 61.58it/s] 49%|████▉     | 192/391 [00:03<00:02, 66.67it/s] 51%|█████▏    | 201/391 [00:03<00:02, 72.23it/s] 54%|█████▎    | 210/391 [00:03<00:02, 75.45it/s] 56%|█████▌    | 219/391 [00:03<00:02, 79.29it/s] 58%|█████▊    | 228/391 [00:03<00:02, 68.58it/s] 60%|██████    | 236/391 [00:03<00:02, 62.79it/s] 62%|██████▏   | 244/391 [00:03<00:02, 66.05it/s] 65%|██████▍   | 253/391 [00:04<00:01, 71.72it/s] 67%|██████▋   | 262/391 [00:04<00:01, 76.33it/s] 69%|██████▉   | 271/391 [00:04<00:01, 79.95it/s] 72%|███████▏  | 280/391 [00:04<00:01, 82.06it/s] 74%|███████▍  | 289/391 [00:04<00:01, 66.79it/s] 76%|███████▌  | 297/391 [00:04<00:01, 62.32it/s] 78%|███████▊  | 306/391 [00:04<00:01, 68.44it/s] 81%|████████  | 315/391 [00:04<00:01, 73.61it/s] 83%|████████▎ | 324/391 [00:05<00:00, 76.45it/s] 85%|████████▌ | 333/391 [00:05<00:00, 75.93it/s] 87%|████████▋ | 341/391 [00:05<00:00, 64.23it/s] 89%|████████▉ | 348/391 [00:05<00:00, 61.56it/s] 91%|█████████▏| 357/391 [00:05<00:00, 67.37it/s] 94%|█████████▎| 366/391 [00:05<00:00, 72.73it/s] 96%|█████████▌| 376/391 [00:05<00:00, 77.87it/s] 99%|█████████▊| 386/391 [00:05<00:00, 81.52it/s]100%|██████████| 391/391 [00:06<00:00, 65.03it/s]
50000 images processed, 6.120087385177612 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:43,  1.81it/s] 13%|█▎        | 10/79 [00:00<00:03, 19.75it/s] 22%|██▏       | 17/79 [00:00<00:02, 29.65it/s] 29%|██▉       | 23/79 [00:00<00:01, 34.41it/s] 37%|███▋      | 29/79 [00:01<00:01, 39.62it/s] 47%|████▋     | 37/79 [00:01<00:00, 49.50it/s] 58%|█████▊    | 46/79 [00:01<00:00, 58.61it/s] 70%|██████▉   | 55/79 [00:01<00:00, 66.82it/s] 81%|████████  | 64/79 [00:01<00:00, 73.08it/s] 91%|█████████ | 72/79 [00:01<00:00, 72.42it/s]100%|██████████| 79/79 [00:02<00:00, 28.03it/s]
10000 images processed, 2.8411333560943604 seconds used

Saved forget OOD features to cache/resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stage2-inc1/CIFAR-100/forget
Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:54,  1.78it/s]  5%|▍         | 10/204 [00:00<00:10, 19.21it/s] 10%|▉         | 20/204 [00:00<00:05, 36.56it/s] 15%|█▍        | 30/204 [00:00<00:03, 50.97it/s] 20%|█▉        | 40/204 [00:00<00:02, 62.50it/s] 25%|██▍       | 50/204 [00:01<00:02, 70.75it/s] 29%|██▉       | 60/204 [00:01<00:01, 76.80it/s] 34%|███▍      | 70/204 [00:01<00:01, 81.84it/s] 39%|███▉      | 80/204 [00:01<00:01, 85.68it/s] 44%|████▍     | 90/204 [00:01<00:01, 88.41it/s] 49%|████▉     | 100/204 [00:01<00:01, 90.03it/s] 54%|█████▍    | 110/204 [00:01<00:01, 91.17it/s] 59%|█████▉    | 120/204 [00:01<00:01, 79.37it/s] 63%|██████▎   | 129/204 [00:02<00:00, 81.44it/s] 68%|██████▊   | 138/204 [00:02<00:00, 82.28it/s] 72%|███████▏  | 147/204 [00:02<00:00, 83.54it/s] 76%|███████▋  | 156/204 [00:02<00:00, 84.46it/s] 81%|████████  | 165/204 [00:02<00:00, 84.33it/s] 85%|████████▌ | 174/204 [00:02<00:00, 65.82it/s] 89%|████████▉ | 182/204 [00:02<00:00, 63.41it/s] 94%|█████████▎| 191/204 [00:02<00:00, 69.69it/s] 98%|█████████▊| 200/204 [00:02<00:00, 74.43it/s]100%|██████████| 204/204 [00:03<00:00, 67.50it/s]
26032 images processed, 3.0854873657226562 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<01:04,  1.20it/s]  8%|▊         | 6/79 [00:00<00:09,  8.08it/s] 15%|█▌        | 12/79 [00:01<00:04, 16.31it/s] 24%|██▍       | 19/79 [00:01<00:02, 26.34it/s] 35%|███▌      | 28/79 [00:01<00:01, 39.48it/s] 47%|████▋     | 37/79 [00:01<00:00, 50.66it/s] 58%|█████▊    | 46/79 [00:01<00:00, 59.18it/s] 68%|██████▊   | 54/79 [00:01<00:00, 64.48it/s] 78%|███████▊  | 62/79 [00:01<00:00, 55.39it/s] 87%|████████▋ | 69/79 [00:01<00:00, 55.20it/s] 99%|█████████▊| 78/79 [00:02<00:00, 63.36it/s]100%|██████████| 79/79 [00:02<00:00, 39.20it/s]
10000 images processed, 2.049496650695801 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:52,  1.48it/s] 10%|█         | 8/79 [00:00<00:05, 13.34it/s] 22%|██▏       | 17/79 [00:00<00:02, 28.15it/s] 32%|███▏      | 25/79 [00:01<00:01, 32.52it/s] 39%|███▉      | 31/79 [00:01<00:01, 36.48it/s] 49%|████▉     | 39/79 [00:01<00:00, 45.05it/s] 61%|██████    | 48/79 [00:01<00:00, 55.13it/s] 72%|███████▏  | 57/79 [00:01<00:00, 63.67it/s] 84%|████████▎ | 66/79 [00:01<00:00, 70.41it/s] 95%|█████████▍| 75/79 [00:01<00:00, 75.58it/s]100%|██████████| 79/79 [00:01<00:00, 44.61it/s]
10000 images processed, 1.7896809577941895 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:44,  1.56it/s]  9%|▊         | 6/70 [00:00<00:06, 10.29it/s] 21%|██▏       | 15/70 [00:00<00:02, 26.49it/s] 34%|███▍      | 24/70 [00:00<00:01, 40.08it/s] 47%|████▋     | 33/70 [00:01<00:00, 50.98it/s] 59%|█████▊    | 41/70 [00:01<00:00, 51.85it/s] 69%|██████▊   | 48/70 [00:01<00:00, 50.65it/s] 79%|███████▊  | 55/70 [00:01<00:00, 54.07it/s] 91%|█████████▏| 64/70 [00:01<00:00, 62.85it/s]100%|██████████| 70/70 [00:01<00:00, 42.53it/s]
8925 images processed, 1.6794281005859375 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:01<00:45,  1.02s/it]  4%|▍         | 2/45 [00:01<00:22,  1.89it/s] 20%|██        | 9/45 [00:01<00:03, 11.16it/s] 36%|███▌      | 16/45 [00:01<00:01, 20.51it/s] 47%|████▋     | 21/45 [00:01<00:01, 18.61it/s] 56%|█████▌    | 25/45 [00:02<00:01, 17.03it/s] 73%|███████▎  | 33/45 [00:02<00:00, 18.35it/s] 84%|████████▍ | 38/45 [00:02<00:00, 22.01it/s] 96%|█████████▌| 43/45 [00:02<00:00, 26.22it/s]100%|██████████| 45/45 [00:02<00:00, 16.89it/s]
5640 images processed, 2.6886801719665527 seconds used

21.94633150100708
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/umap/umap_.py:1952: UserWarning: n_jobs value 1 overridden to 1 by setting random_state. Use no seed for parallelism.
  warn(
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/umap/umap_.py:1952: UserWarning: n_jobs value 1 overridden to 1 by setting random_state. Use no seed for parallelism.
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.74  99.29
places365     74.73  79.11
LSUN          20.51  95.38
iSUN          78.34  79.48
dtd           43.60  90.14
AVG           43.98  88.68
Retain-Acc: 0.7087
Forget-as-OOD (retain known vs forget novel):
  FPR: 77.80 AUROC: 84.40 AUIN: 99.01
9.717841148376465
[umap] saved to figs/umap_CIFAR-100_resnet34_top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stage2-inc1_domain.png
[umap] saved to figs/umap_CIFAR-100_resnet34_top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stage2-inc1_rf.png
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stage2-inc2: Number of model parameters: 21843904
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<04:23,  1.48it/s]  3%|▎         | 10/391 [00:00<00:22, 16.82it/s]  5%|▍         | 19/391 [00:00<00:12, 30.85it/s]  7%|▋         | 28/391 [00:00<00:08, 43.47it/s]  9%|▉         | 36/391 [00:01<00:07, 48.56it/s] 11%|█         | 43/391 [00:01<00:07, 48.47it/s] 13%|█▎        | 50/391 [00:01<00:06, 51.36it/s] 15%|█▌        | 59/391 [00:01<00:05, 59.20it/s] 17%|█▋        | 68/391 [00:01<00:04, 66.06it/s] 20%|█▉        | 77/391 [00:01<00:04, 72.17it/s] 22%|██▏       | 85/391 [00:01<00:04, 72.11it/s] 24%|██▍       | 93/391 [00:01<00:04, 61.68it/s] 26%|██▌       | 100/391 [00:02<00:04, 59.03it/s] 28%|██▊       | 109/391 [00:02<00:04, 65.39it/s] 30%|███       | 118/391 [00:02<00:03, 71.45it/s] 32%|███▏      | 127/391 [00:02<00:03, 75.92it/s] 35%|███▍      | 135/391 [00:02<00:03, 75.84it/s] 37%|███▋      | 143/391 [00:02<00:03, 64.19it/s] 38%|███▊      | 150/391 [00:02<00:03, 61.01it/s] 40%|████      | 158/391 [00:02<00:03, 64.03it/s] 43%|████▎     | 167/391 [00:03<00:03, 70.39it/s] 45%|████▌     | 176/391 [00:03<00:02, 74.46it/s] 47%|████▋     | 185/391 [00:03<00:02, 77.07it/s] 49%|████▉     | 193/391 [00:03<00:02, 76.27it/s] 51%|█████▏    | 201/391 [00:03<00:02, 64.30it/s] 53%|█████▎    | 208/391 [00:03<00:03, 60.91it/s] 55%|█████▌    | 217/391 [00:03<00:02, 67.57it/s] 58%|█████▊    | 226/391 [00:03<00:02, 73.02it/s] 60%|██████    | 235/391 [00:03<00:02, 76.99it/s] 62%|██████▏   | 244/391 [00:04<00:01, 79.24it/s] 65%|██████▍   | 253/391 [00:04<00:02, 67.69it/s] 67%|██████▋   | 261/391 [00:04<00:02, 63.33it/s] 69%|██████▊   | 268/391 [00:04<00:01, 64.14it/s] 71%|███████   | 277/391 [00:04<00:01, 70.49it/s] 73%|███████▎  | 286/391 [00:04<00:01, 75.27it/s] 75%|███████▌  | 295/391 [00:04<00:01, 77.94it/s] 77%|███████▋  | 303/391 [00:04<00:01, 72.48it/s] 80%|███████▉  | 311/391 [00:05<00:01, 65.29it/s] 81%|████████▏ | 318/391 [00:05<00:01, 61.94it/s] 84%|████████▎ | 327/391 [00:05<00:00, 68.16it/s] 86%|████████▌ | 336/391 [00:05<00:00, 73.63it/s] 88%|████████▊ | 345/391 [00:05<00:00, 76.34it/s] 90%|█████████ | 353/391 [00:05<00:00, 65.91it/s] 92%|█████████▏| 360/391 [00:05<00:00, 61.89it/s] 94%|█████████▍| 367/391 [00:05<00:00, 61.91it/s] 96%|█████████▋| 377/391 [00:06<00:00, 69.72it/s] 99%|█████████▉| 387/391 [00:06<00:00, 75.66it/s]100%|██████████| 391/391 [00:06<00:00, 62.65it/s]
50000 images processed, 6.3318047523498535 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:45,  1.73it/s] 11%|█▏        | 9/79 [00:00<00:04, 17.23it/s] 22%|██▏       | 17/79 [00:00<00:01, 31.03it/s] 30%|███       | 24/79 [00:00<00:01, 37.16it/s] 38%|███▊      | 30/79 [00:01<00:01, 40.58it/s] 46%|████▌     | 36/79 [00:01<00:00, 43.59it/s] 57%|█████▋    | 45/79 [00:01<00:00, 54.57it/s] 68%|██████▊   | 54/79 [00:01<00:00, 63.63it/s] 80%|███████▉  | 63/79 [00:01<00:00, 70.64it/s] 91%|█████████ | 72/79 [00:01<00:00, 75.93it/s]100%|██████████| 79/79 [00:01<00:00, 47.38it/s]
10000 images processed, 1.686779499053955 seconds used

Saved forget OOD features to cache/resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stage2-inc2/CIFAR-100/forget
Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<02:02,  1.65it/s]  3%|▎         | 6/204 [00:00<00:18, 10.52it/s]  5%|▌         | 11/204 [00:00<00:10, 18.52it/s] 10%|▉         | 20/204 [00:00<00:05, 34.34it/s] 14%|█▎        | 28/204 [00:01<00:03, 45.40it/s] 18%|█▊        | 37/204 [00:01<00:02, 55.84it/s] 22%|██▏       | 45/204 [00:01<00:02, 53.44it/s] 25%|██▌       | 52/204 [00:01<00:02, 50.91it/s] 29%|██▉       | 60/204 [00:01<00:02, 57.02it/s] 34%|███▍      | 69/204 [00:01<00:02, 63.95it/s] 38%|███▊      | 78/204 [00:01<00:01, 70.02it/s] 43%|████▎     | 87/204 [00:01<00:01, 73.46it/s] 47%|████▋     | 95/204 [00:02<00:01, 60.47it/s] 50%|█████     | 102/204 [00:02<00:01, 58.75it/s] 54%|█████▍    | 111/204 [00:02<00:01, 65.34it/s] 59%|█████▉    | 120/204 [00:02<00:01, 70.79it/s] 63%|██████▎   | 129/204 [00:02<00:01, 74.57it/s] 67%|██████▋   | 137/204 [00:02<00:01, 66.83it/s] 71%|███████   | 145/204 [00:02<00:00, 61.47it/s] 75%|███████▍  | 152/204 [00:02<00:00, 61.67it/s] 79%|███████▉  | 161/204 [00:03<00:00, 68.46it/s] 83%|████████▎ | 170/204 [00:03<00:00, 73.48it/s] 88%|████████▊ | 179/204 [00:03<00:00, 77.62it/s] 92%|█████████▏| 188/204 [00:03<00:00, 80.93it/s] 97%|█████████▋| 197/204 [00:03<00:00, 64.77it/s]100%|██████████| 204/204 [00:03<00:00, 55.37it/s]
26032 images processed, 3.725965976715088 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<01:05,  1.20it/s]  8%|▊         | 6/79 [00:00<00:09,  8.09it/s] 16%|█▋        | 13/79 [00:01<00:03, 18.16it/s] 24%|██▍       | 19/79 [00:01<00:02, 26.12it/s] 35%|███▌      | 28/79 [00:01<00:01, 39.54it/s] 47%|████▋     | 37/79 [00:01<00:00, 51.02it/s] 58%|█████▊    | 46/79 [00:01<00:00, 59.75it/s] 68%|██████▊   | 54/79 [00:01<00:00, 61.72it/s] 78%|███████▊  | 62/79 [00:01<00:00, 57.01it/s] 87%|████████▋ | 69/79 [00:01<00:00, 56.30it/s] 99%|█████████▊| 78/79 [00:01<00:00, 64.35it/s]100%|██████████| 79/79 [00:01<00:00, 39.56it/s]
10000 images processed, 2.0288190841674805 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:55,  1.40it/s] 11%|█▏        | 9/79 [00:00<00:04, 14.32it/s] 23%|██▎       | 18/79 [00:00<00:02, 28.61it/s] 34%|███▍      | 27/79 [00:01<00:01, 40.50it/s] 44%|████▍     | 35/79 [00:01<00:01, 41.14it/s] 53%|█████▎    | 42/79 [00:01<00:00, 44.63it/s] 65%|██████▍   | 51/79 [00:01<00:00, 54.56it/s] 76%|███████▌  | 60/79 [00:01<00:00, 62.79it/s] 87%|████████▋ | 69/79 [00:01<00:00, 69.73it/s] 99%|█████████▊| 78/79 [00:01<00:00, 74.73it/s]100%|██████████| 79/79 [00:01<00:00, 44.75it/s]
10000 images processed, 1.789618968963623 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:46,  1.49it/s]  9%|▊         | 6/70 [00:00<00:06,  9.93it/s] 17%|█▋        | 12/70 [00:00<00:02, 19.86it/s] 30%|███       | 21/70 [00:00<00:01, 35.19it/s] 43%|████▎     | 30/70 [00:01<00:00, 47.96it/s] 56%|█████▌    | 39/70 [00:01<00:00, 58.20it/s] 69%|██████▊   | 48/70 [00:01<00:00, 66.36it/s] 81%|████████▏ | 57/70 [00:01<00:00, 57.96it/s] 91%|█████████▏| 64/70 [00:01<00:00, 57.69it/s]100%|██████████| 70/70 [00:01<00:00, 41.45it/s]
8925 images processed, 1.7217047214508057 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:01<00:46,  1.05s/it]  4%|▍         | 2/45 [00:01<00:21,  2.01it/s] 16%|█▌        | 7/45 [00:01<00:04,  8.74it/s] 31%|███       | 14/45 [00:01<00:01, 18.84it/s] 40%|████      | 18/45 [00:01<00:01, 16.19it/s] 51%|█████     | 23/45 [00:01<00:01, 17.04it/s] 69%|██████▉   | 31/45 [00:02<00:00, 26.52it/s] 80%|████████  | 36/45 [00:02<00:00, 19.59it/s] 93%|█████████▎| 42/45 [00:02<00:00, 24.66it/s]100%|██████████| 45/45 [00:02<00:00, 16.91it/s]
5640 images processed, 2.6821179389953613 seconds used

21.60444736480713
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/umap/umap_.py:1952: UserWarning: n_jobs value 1 overridden to 1 by setting random_state. Use no seed for parallelism.
  warn(
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/umap/umap_.py:1952: UserWarning: n_jobs value 1 overridden to 1 by setting random_state. Use no seed for parallelism.
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.64  99.31
places365     73.15  79.36
LSUN          19.62  95.60
iSUN          77.04  79.75
dtd           42.39  90.36
AVG           42.97  88.88
Retain-Acc: 0.7087
Forget-as-OOD (retain known vs forget novel):
  FPR: 69.20 AUROC: 87.58 AUIN: 99.28
11.274295091629028
[umap] saved to figs/umap_CIFAR-100_resnet34_top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stage2-inc2_domain.png
[umap] saved to figs/umap_CIFAR-100_resnet34_top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stage2-inc2_rf.png
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stage2-seen: Number of model parameters: 21843904
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<04:27,  1.46it/s]  3%|▎         | 11/391 [00:00<00:20, 18.25it/s]  5%|▌         | 20/391 [00:00<00:11, 32.29it/s]  8%|▊         | 30/391 [00:01<00:07, 46.23it/s] 10%|▉         | 39/391 [00:01<00:06, 56.12it/s] 12%|█▏        | 48/391 [00:01<00:05, 63.10it/s] 15%|█▍        | 57/391 [00:01<00:04, 69.49it/s] 17%|█▋        | 66/391 [00:01<00:04, 74.16it/s] 19%|█▉        | 75/391 [00:01<00:04, 77.83it/s] 21%|██▏       | 84/391 [00:01<00:03, 80.76it/s] 24%|██▍       | 93/391 [00:01<00:03, 82.23it/s] 26%|██▌       | 102/391 [00:01<00:03, 73.96it/s] 28%|██▊       | 111/391 [00:01<00:03, 76.95it/s] 31%|███       | 121/391 [00:02<00:03, 80.86it/s] 33%|███▎      | 130/391 [00:02<00:03, 83.04it/s] 36%|███▌      | 139/391 [00:02<00:02, 84.97it/s] 38%|███▊      | 148/391 [00:02<00:02, 84.29it/s] 40%|████      | 157/391 [00:02<00:03, 68.30it/s] 42%|████▏     | 165/391 [00:02<00:03, 62.30it/s] 45%|████▍     | 174/391 [00:02<00:03, 68.53it/s] 47%|████▋     | 182/391 [00:02<00:02, 71.31it/s] 49%|████▉     | 191/391 [00:03<00:02, 75.27it/s] 51%|█████     | 200/391 [00:03<00:02, 77.29it/s] 53%|█████▎    | 208/391 [00:03<00:02, 74.50it/s] 55%|█████▌    | 216/391 [00:03<00:02, 64.01it/s] 57%|█████▋    | 223/391 [00:03<00:02, 61.04it/s] 59%|█████▉    | 232/391 [00:03<00:02, 66.50it/s] 62%|██████▏   | 241/391 [00:03<00:02, 72.12it/s] 64%|██████▍   | 250/391 [00:03<00:01, 76.76it/s] 66%|██████▌   | 259/391 [00:04<00:01, 80.28it/s] 69%|██████▊   | 268/391 [00:04<00:01, 80.79it/s] 71%|███████   | 277/391 [00:04<00:01, 65.91it/s] 73%|███████▎  | 285/391 [00:04<00:01, 62.22it/s] 75%|███████▌  | 294/391 [00:04<00:01, 67.30it/s] 77%|███████▋  | 303/391 [00:04<00:01, 72.53it/s] 80%|███████▉  | 312/391 [00:04<00:01, 76.89it/s] 82%|████████▏ | 321/391 [00:04<00:00, 79.94it/s] 84%|████████▍ | 330/391 [00:05<00:00, 74.31it/s] 86%|████████▋ | 338/391 [00:05<00:00, 64.26it/s] 88%|████████▊ | 345/391 [00:05<00:00, 61.38it/s] 91%|█████████ | 354/391 [00:05<00:00, 67.92it/s] 93%|█████████▎| 363/391 [00:05<00:00, 72.71it/s] 95%|█████████▌| 373/391 [00:05<00:00, 77.84it/s] 98%|█████████▊| 383/391 [00:05<00:00, 81.56it/s]100%|██████████| 391/391 [00:05<00:00, 66.76it/s]
50000 images processed, 5.952764987945557 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:43,  1.81it/s] 13%|█▎        | 10/79 [00:00<00:03, 19.62it/s] 24%|██▍       | 19/79 [00:00<00:01, 34.83it/s] 35%|███▌      | 28/79 [00:00<00:01, 47.69it/s] 47%|████▋     | 37/79 [00:00<00:00, 57.82it/s] 57%|█████▋    | 45/79 [00:01<00:00, 53.08it/s] 66%|██████▌   | 52/79 [00:01<00:00, 52.41it/s] 76%|███████▌  | 60/79 [00:01<00:00, 57.75it/s] 87%|████████▋ | 69/79 [00:01<00:00, 64.32it/s] 99%|█████████▊| 78/79 [00:01<00:00, 69.45it/s]100%|██████████| 79/79 [00:01<00:00, 48.43it/s]
10000 images processed, 1.6588068008422852 seconds used

Saved forget OOD features to cache/resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stage2-seen/CIFAR-100/forget
Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:56,  1.74it/s]  4%|▍         | 8/204 [00:00<00:13, 15.00it/s]  8%|▊         | 17/204 [00:00<00:06, 31.10it/s] 13%|█▎        | 26/204 [00:00<00:04, 44.23it/s] 17%|█▋        | 35/204 [00:01<00:03, 54.88it/s] 21%|██        | 43/204 [00:01<00:02, 55.49it/s] 25%|██▍       | 50/204 [00:01<00:02, 51.90it/s] 28%|██▊       | 57/204 [00:01<00:02, 54.02it/s] 32%|███▏      | 66/204 [00:01<00:02, 62.16it/s] 37%|███▋      | 75/204 [00:01<00:01, 68.59it/s] 41%|████      | 84/204 [00:01<00:01, 73.60it/s] 45%|████▌     | 92/204 [00:01<00:01, 62.42it/s] 49%|████▊     | 99/204 [00:02<00:01, 58.75it/s] 52%|█████▏    | 107/204 [00:02<00:01, 62.63it/s] 57%|█████▋    | 116/204 [00:02<00:01, 68.85it/s] 61%|██████▏   | 125/204 [00:02<00:01, 73.87it/s] 66%|██████▌   | 134/204 [00:02<00:00, 77.30it/s] 70%|██████▉   | 142/204 [00:02<00:00, 64.01it/s] 73%|███████▎  | 149/204 [00:02<00:00, 58.47it/s] 77%|███████▋  | 158/204 [00:02<00:00, 65.04it/s] 82%|████████▏ | 167/204 [00:03<00:00, 69.51it/s] 86%|████████▋ | 176/204 [00:03<00:00, 73.87it/s] 90%|█████████ | 184/204 [00:03<00:00, 71.75it/s] 94%|█████████▍| 192/204 [00:03<00:00, 63.20it/s] 98%|█████████▊| 199/204 [00:03<00:00, 60.36it/s]100%|██████████| 204/204 [00:03<00:00, 56.81it/s]
26032 images processed, 3.630561113357544 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<01:03,  1.22it/s]  8%|▊         | 6/79 [00:00<00:08,  8.23it/s] 15%|█▌        | 12/79 [00:01<00:04, 16.38it/s] 24%|██▍       | 19/79 [00:01<00:02, 26.06it/s] 35%|███▌      | 28/79 [00:01<00:01, 39.25it/s] 47%|████▋     | 37/79 [00:01<00:00, 49.71it/s] 58%|█████▊    | 46/79 [00:01<00:00, 56.90it/s] 68%|██████▊   | 54/79 [00:01<00:00, 51.49it/s] 77%|███████▋  | 61/79 [00:01<00:00, 51.43it/s] 89%|████████▊ | 70/79 [00:01<00:00, 58.96it/s]100%|██████████| 79/79 [00:02<00:00, 66.36it/s]100%|██████████| 79/79 [00:02<00:00, 38.73it/s]
10000 images processed, 2.0703489780426025 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:50,  1.55it/s]  8%|▊         | 6/79 [00:00<00:07, 10.05it/s] 19%|█▉        | 15/79 [00:00<00:02, 25.87it/s] 30%|███       | 24/79 [00:00<00:01, 39.76it/s] 42%|████▏     | 33/79 [00:01<00:00, 51.45it/s] 53%|█████▎    | 42/79 [00:01<00:00, 60.39it/s] 63%|██████▎   | 50/79 [00:01<00:00, 53.17it/s] 72%|███████▏  | 57/79 [00:01<00:00, 52.06it/s] 84%|████████▎ | 66/79 [00:01<00:00, 60.01it/s] 94%|█████████▎| 74/79 [00:01<00:00, 64.90it/s]100%|██████████| 79/79 [00:01<00:00, 44.67it/s]
10000 images processed, 1.7934613227844238 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:44,  1.55it/s]  7%|▋         | 5/70 [00:00<00:07,  8.41it/s] 16%|█▌        | 11/70 [00:00<00:03, 18.13it/s] 29%|██▊       | 20/70 [00:00<00:01, 33.36it/s] 41%|████▏     | 29/70 [00:01<00:00, 46.28it/s] 54%|█████▍    | 38/70 [00:01<00:00, 56.13it/s] 67%|██████▋   | 47/70 [00:01<00:00, 64.67it/s] 79%|███████▊  | 55/70 [00:01<00:00, 58.11it/s] 89%|████████▊ | 62/70 [00:01<00:00, 54.82it/s]100%|██████████| 70/70 [00:01<00:00, 60.27it/s]100%|██████████| 70/70 [00:01<00:00, 40.90it/s]
8925 images processed, 1.7439720630645752 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:01<00:55,  1.27s/it] 16%|█▌        | 7/45 [00:01<00:05,  6.70it/s] 29%|██▉       | 13/45 [00:01<00:02, 13.05it/s] 40%|████      | 18/45 [00:01<00:02, 13.10it/s] 47%|████▋     | 21/45 [00:02<00:01, 12.95it/s] 58%|█████▊    | 26/45 [00:02<00:01, 17.54it/s] 71%|███████   | 32/45 [00:02<00:00, 24.09it/s] 80%|████████  | 36/45 [00:02<00:00, 21.12it/s] 96%|█████████▌| 43/45 [00:02<00:00, 28.58it/s]100%|██████████| 45/45 [00:02<00:00, 16.44it/s]
5640 images processed, 2.7554397583007812 seconds used

21.249378204345703
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/umap/umap_.py:1952: UserWarning: n_jobs value 1 overridden to 1 by setting random_state. Use no seed for parallelism.
  warn(
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/umap/umap_.py:1952: UserWarning: n_jobs value 1 overridden to 1 by setting random_state. Use no seed for parallelism.
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.57  99.36
places365     68.08  81.18
LSUN          17.82  96.07
iSUN          72.36  81.80
dtd           38.48  91.38
AVG           39.86  89.96
Retain-Acc: 0.7481
Forget-as-OOD (retain known vs forget novel):
  FPR: 54.60 AUROC: 89.30 AUIN: 98.64
39.33668255805969
[umap] saved to figs/umap_CIFAR-100_resnet34_top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stage2-seen_domain.png
[umap] saved to figs/umap_CIFAR-100_resnet34_top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stage2-seen_rf.png
runner-incremental-stack.sh: line 143: syntax error near unexpected token `done'
