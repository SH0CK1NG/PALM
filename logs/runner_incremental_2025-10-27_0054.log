nohup: ignoring input
==== Stage 1: forget_inc={0,8,11,40,51}; forget_seen={}; all={0,8,11,40,51,66,67,88,94,57} ====
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e50-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stack/stage1
[peft] active adapters set to: default
resnet34-top5-palm-cache6-ema0.999-b128-e50-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stage1-inc1: Number of model parameters: 21843904
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<03:28,  1.87it/s]  2%|▏         | 9/391 [00:00<00:21, 18.17it/s]  4%|▍         | 17/391 [00:00<00:11, 32.32it/s]  7%|▋         | 26/391 [00:00<00:07, 46.54it/s]  9%|▉         | 35/391 [00:00<00:06, 56.46it/s] 11%|█▏        | 44/391 [00:01<00:05, 64.88it/s] 14%|█▎        | 53/391 [00:01<00:04, 71.07it/s] 16%|█▌        | 62/391 [00:01<00:04, 75.54it/s] 18%|█▊        | 72/391 [00:01<00:03, 80.54it/s] 21%|██        | 81/391 [00:01<00:03, 82.92it/s] 23%|██▎       | 91/391 [00:01<00:03, 84.46it/s] 26%|██▌       | 101/391 [00:01<00:03, 86.63it/s] 28%|██▊       | 110/391 [00:01<00:03, 86.83it/s] 31%|███       | 120/391 [00:01<00:03, 88.75it/s] 33%|███▎      | 130/391 [00:02<00:02, 89.87it/s] 36%|███▌      | 140/391 [00:02<00:02, 91.65it/s] 38%|███▊      | 150/391 [00:02<00:02, 92.91it/s] 41%|████      | 160/391 [00:02<00:02, 92.62it/s] 43%|████▎     | 170/391 [00:02<00:02, 93.24it/s] 46%|████▌     | 180/391 [00:02<00:02, 92.03it/s] 49%|████▊     | 190/391 [00:02<00:02, 91.66it/s] 51%|█████     | 200/391 [00:02<00:02, 93.03it/s] 54%|█████▎    | 210/391 [00:02<00:01, 93.84it/s] 56%|█████▋    | 220/391 [00:02<00:01, 87.22it/s] 59%|█████▉    | 230/391 [00:03<00:01, 88.60it/s] 61%|██████    | 239/391 [00:03<00:01, 87.92it/s] 64%|██████▎   | 249/391 [00:03<00:01, 87.72it/s] 66%|██████▌   | 259/391 [00:03<00:01, 88.60it/s] 69%|██████▉   | 269/391 [00:03<00:01, 89.65it/s] 71%|███████▏  | 279/391 [00:03<00:01, 90.70it/s] 74%|███████▍  | 289/391 [00:03<00:01, 91.89it/s] 76%|███████▋  | 299/391 [00:03<00:01, 90.39it/s] 79%|███████▉  | 309/391 [00:03<00:00, 89.23it/s] 82%|████████▏ | 319/391 [00:04<00:00, 89.07it/s] 84%|████████▍ | 329/391 [00:04<00:00, 90.25it/s] 87%|████████▋ | 339/391 [00:04<00:00, 90.28it/s] 89%|████████▉ | 349/391 [00:04<00:00, 89.87it/s] 92%|█████████▏| 359/391 [00:04<00:00, 90.81it/s] 94%|█████████▍| 369/391 [00:04<00:00, 91.77it/s] 97%|█████████▋| 379/391 [00:04<00:00, 93.34it/s] 99%|█████████▉| 389/391 [00:04<00:00, 94.33it/s]100%|██████████| 391/391 [00:04<00:00, 80.05it/s]
50000 images processed, 5.018982887268066 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:54,  1.42it/s] 13%|█▎        | 10/79 [00:00<00:04, 16.26it/s] 24%|██▍       | 19/79 [00:00<00:01, 30.20it/s] 35%|███▌      | 28/79 [00:01<00:01, 42.80it/s] 47%|████▋     | 37/79 [00:01<00:00, 53.34it/s] 58%|█████▊    | 46/79 [00:01<00:00, 61.06it/s] 71%|███████   | 56/79 [00:01<00:00, 69.34it/s] 84%|████████▎ | 66/79 [00:01<00:00, 75.93it/s] 96%|█████████▌| 76/79 [00:01<00:00, 80.72it/s]100%|██████████| 79/79 [00:02<00:00, 36.66it/s]
10000 images processed, 2.1861491203308105 seconds used

Saved forget OOD features to cache/resnet34-top5-palm-cache6-ema0.999-b128-e50-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stage1-inc1/CIFAR-100/forget
Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<02:07,  1.59it/s]  3%|▎         | 6/204 [00:00<00:18, 10.51it/s]  7%|▋         | 15/204 [00:00<00:07, 26.96it/s] 12%|█▏        | 24/204 [00:00<00:04, 41.27it/s] 17%|█▋        | 34/204 [00:01<00:03, 54.60it/s] 21%|██        | 43/204 [00:01<00:02, 62.46it/s] 26%|██▌       | 53/204 [00:01<00:02, 71.45it/s] 30%|███       | 62/204 [00:01<00:01, 76.05it/s] 35%|███▌      | 72/204 [00:01<00:01, 81.53it/s] 40%|████      | 82/204 [00:01<00:01, 84.19it/s] 45%|████▌     | 92/204 [00:01<00:01, 86.93it/s] 50%|█████     | 102/204 [00:01<00:01, 89.20it/s] 55%|█████▍    | 112/204 [00:01<00:01, 90.62it/s] 60%|█████▉    | 122/204 [00:01<00:00, 92.01it/s] 65%|██████▍   | 132/204 [00:02<00:00, 92.69it/s] 70%|██████▉   | 142/204 [00:02<00:00, 90.26it/s] 75%|███████▍  | 152/204 [00:02<00:00, 91.21it/s] 79%|███████▉  | 162/204 [00:02<00:00, 91.20it/s] 84%|████████▍ | 172/204 [00:02<00:00, 91.09it/s] 89%|████████▉ | 182/204 [00:02<00:00, 91.78it/s] 94%|█████████▍| 192/204 [00:02<00:00, 93.04it/s] 99%|█████████▉| 202/204 [00:02<00:00, 93.96it/s]100%|██████████| 204/204 [00:02<00:00, 70.58it/s]
26032 images processed, 2.937377452850342 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<01:06,  1.17it/s] 10%|█         | 8/79 [00:00<00:06, 10.99it/s] 20%|██        | 16/79 [00:01<00:02, 22.48it/s] 32%|███▏      | 25/79 [00:01<00:01, 35.28it/s] 43%|████▎     | 34/79 [00:01<00:00, 46.35it/s] 54%|█████▍    | 43/79 [00:01<00:00, 55.24it/s] 67%|██████▋   | 53/79 [00:01<00:00, 64.23it/s] 78%|███████▊  | 62/79 [00:01<00:00, 69.71it/s] 90%|████████▉ | 71/79 [00:01<00:00, 73.32it/s]100%|██████████| 79/79 [00:01<00:00, 44.21it/s]
10000 images processed, 1.8197846412658691 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:51,  1.52it/s] 14%|█▍        | 11/79 [00:00<00:03, 18.73it/s] 24%|██▍       | 19/79 [00:00<00:01, 30.69it/s] 34%|███▍      | 27/79 [00:00<00:01, 41.46it/s] 46%|████▌     | 36/79 [00:01<00:00, 51.69it/s] 58%|█████▊    | 46/79 [00:01<00:00, 62.31it/s] 71%|███████   | 56/79 [00:01<00:00, 70.95it/s] 84%|████████▎ | 66/79 [00:01<00:00, 77.95it/s] 96%|█████████▌| 76/79 [00:01<00:00, 83.08it/s]100%|██████████| 79/79 [00:01<00:00, 51.54it/s]
10000 images processed, 1.5538372993469238 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:41,  1.64it/s] 10%|█         | 7/70 [00:00<00:04, 12.61it/s] 23%|██▎       | 16/70 [00:00<00:01, 28.59it/s] 37%|███▋      | 26/70 [00:00<00:01, 43.67it/s] 50%|█████     | 35/70 [00:01<00:00, 54.81it/s] 64%|██████▍   | 45/70 [00:01<00:00, 64.75it/s] 79%|███████▊  | 55/70 [00:01<00:00, 73.23it/s] 93%|█████████▎| 65/70 [00:01<00:00, 79.70it/s]100%|██████████| 70/70 [00:01<00:00, 49.50it/s]
8925 images processed, 1.4464986324310303 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:01<00:48,  1.11s/it]  4%|▍         | 2/45 [00:01<00:24,  1.73it/s] 24%|██▍       | 11/45 [00:01<00:02, 12.95it/s] 38%|███▊      | 17/45 [00:01<00:01, 15.78it/s] 47%|████▋     | 21/45 [00:01<00:01, 17.39it/s] 62%|██████▏   | 28/45 [00:01<00:00, 25.33it/s] 73%|███████▎  | 33/45 [00:02<00:00, 19.12it/s] 82%|████████▏ | 37/45 [00:02<00:00, 20.52it/s]100%|██████████| 45/45 [00:02<00:00, 29.31it/s]100%|██████████| 45/45 [00:02<00:00, 16.92it/s]
5640 images processed, 2.689603328704834 seconds used

19.721655130386353
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/umap/umap_.py:1952: UserWarning: n_jobs value 1 overridden to 1 by setting random_state. Use no seed for parallelism.
  warn(
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/umap/umap_.py:1952: UserWarning: n_jobs value 1 overridden to 1 by setting random_state. Use no seed for parallelism.
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           5.46  98.78
places365     72.67  79.75
LSUN          27.04  94.18
iSUN          76.19  79.51
dtd           47.16  89.36
AVG           45.70  88.32
Retain-Acc: 0.7385
Forget-as-OOD (retain known vs forget novel):
  FPR: 38.00 AUROC: 88.86 AUIN: 99.23
30.825518131256104
[umap] saved to figs/umap_CIFAR-100_resnet34_top5-palm-cache6-ema0.999-b128-e50-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stage1-inc1_domain.png
[umap] saved to figs/umap_CIFAR-100_resnet34_top5-palm-cache6-ema0.999-b128-e50-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stage1-inc1_rf.png
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e50-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stack/stage1
[peft] active adapters set to: default
resnet34-top5-palm-cache6-ema0.999-b128-e50-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stage1-seen: Number of model parameters: 21843904
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<03:43,  1.74it/s]  3%|▎         | 10/391 [00:00<00:19, 19.14it/s]  5%|▌         | 20/391 [00:00<00:10, 36.61it/s]  7%|▋         | 29/391 [00:00<00:07, 48.76it/s] 10%|▉         | 38/391 [00:00<00:06, 57.80it/s] 12%|█▏        | 48/391 [00:01<00:05, 66.49it/s] 15%|█▍        | 58/391 [00:01<00:04, 73.91it/s] 17%|█▋        | 68/391 [00:01<00:04, 79.89it/s] 20%|█▉        | 77/391 [00:01<00:03, 82.46it/s] 22%|██▏       | 87/391 [00:01<00:03, 86.26it/s] 25%|██▍       | 97/391 [00:01<00:03, 87.98it/s] 27%|██▋       | 107/391 [00:01<00:03, 89.73it/s] 30%|██▉       | 117/391 [00:01<00:03, 88.95it/s] 32%|███▏      | 127/391 [00:01<00:02, 90.72it/s] 35%|███▌      | 137/391 [00:02<00:02, 90.02it/s] 38%|███▊      | 147/391 [00:02<00:02, 91.70it/s] 40%|████      | 157/391 [00:02<00:02, 91.44it/s] 43%|████▎     | 167/391 [00:02<00:02, 90.17it/s] 45%|████▌     | 177/391 [00:02<00:02, 88.97it/s] 48%|████▊     | 186/391 [00:02<00:02, 88.80it/s] 50%|████▉     | 195/391 [00:02<00:02, 88.62it/s] 52%|█████▏    | 204/391 [00:02<00:02, 86.19it/s] 54%|█████▍    | 213/391 [00:02<00:02, 86.95it/s] 57%|█████▋    | 222/391 [00:03<00:01, 87.07it/s] 59%|█████▉    | 231/391 [00:03<00:01, 87.13it/s] 62%|██████▏   | 241/391 [00:03<00:01, 88.50it/s] 64%|██████▍   | 251/391 [00:03<00:01, 89.19it/s] 67%|██████▋   | 261/391 [00:03<00:01, 90.11it/s] 69%|██████▉   | 271/391 [00:03<00:01, 88.81it/s] 72%|███████▏  | 281/391 [00:03<00:01, 90.75it/s] 74%|███████▍  | 291/391 [00:03<00:01, 92.20it/s] 77%|███████▋  | 301/391 [00:03<00:00, 90.24it/s] 80%|███████▉  | 311/391 [00:04<00:00, 88.85it/s] 82%|████████▏ | 320/391 [00:04<00:00, 88.82it/s] 84%|████████▍ | 330/391 [00:04<00:00, 90.84it/s] 87%|████████▋ | 340/391 [00:04<00:00, 92.37it/s] 90%|████████▉ | 350/391 [00:04<00:00, 90.75it/s] 92%|█████████▏| 360/391 [00:04<00:00, 91.65it/s] 95%|█████████▍| 370/391 [00:04<00:00, 93.35it/s] 97%|█████████▋| 380/391 [00:04<00:00, 94.60it/s]100%|█████████▉| 390/391 [00:04<00:00, 95.37it/s]100%|██████████| 391/391 [00:04<00:00, 79.91it/s]
50000 images processed, 5.016876697540283 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:52,  1.49it/s] 10%|█         | 8/79 [00:00<00:05, 13.47it/s] 22%|██▏       | 17/79 [00:00<00:02, 28.68it/s] 33%|███▎      | 26/79 [00:00<00:01, 42.19it/s] 43%|████▎     | 34/79 [00:01<00:00, 49.99it/s] 54%|█████▍    | 43/79 [00:01<00:00, 59.74it/s] 66%|██████▌   | 52/79 [00:01<00:00, 67.65it/s] 78%|███████▊  | 62/79 [00:01<00:00, 75.01it/s] 91%|█████████ | 72/79 [00:01<00:00, 80.34it/s]100%|██████████| 79/79 [00:01<00:00, 49.74it/s]
10000 images processed, 1.6197025775909424 seconds used

Saved forget OOD features to cache/resnet34-top5-palm-cache6-ema0.999-b128-e50-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stage1-seen/CIFAR-100/forget
Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<02:04,  1.63it/s]  4%|▍         | 9/204 [00:00<00:11, 16.37it/s]  9%|▉         | 19/204 [00:00<00:05, 33.54it/s] 14%|█▎        | 28/204 [00:00<00:03, 46.19it/s] 18%|█▊        | 37/204 [00:01<00:02, 55.70it/s] 23%|██▎       | 47/204 [00:01<00:02, 65.04it/s] 27%|██▋       | 56/204 [00:01<00:02, 70.82it/s] 32%|███▏      | 66/204 [00:01<00:01, 77.06it/s] 37%|███▋      | 75/204 [00:01<00:01, 80.09it/s] 42%|████▏     | 85/204 [00:01<00:01, 84.47it/s] 46%|████▌     | 94/204 [00:01<00:01, 85.23it/s] 51%|█████     | 104/204 [00:01<00:01, 88.10it/s] 56%|█████▌    | 114/204 [00:01<00:01, 89.06it/s] 61%|██████    | 124/204 [00:01<00:00, 90.81it/s] 66%|██████▌   | 134/204 [00:02<00:00, 92.07it/s] 71%|███████   | 144/204 [00:02<00:00, 90.87it/s] 75%|███████▌  | 154/204 [00:02<00:00, 92.02it/s] 80%|████████  | 164/204 [00:02<00:00, 87.50it/s] 85%|████████▌ | 174/204 [00:02<00:00, 89.05it/s] 90%|█████████ | 184/204 [00:02<00:00, 91.13it/s] 95%|█████████▌| 194/204 [00:02<00:00, 92.67it/s]100%|██████████| 204/204 [00:02<00:00, 91.59it/s]100%|██████████| 204/204 [00:02<00:00, 71.11it/s]
26032 images processed, 2.9171478748321533 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:59,  1.30it/s]  8%|▊         | 6/79 [00:00<00:08,  8.91it/s] 19%|█▉        | 15/79 [00:00<00:02, 23.66it/s] 32%|███▏      | 25/79 [00:01<00:01, 38.66it/s] 43%|████▎     | 34/79 [00:01<00:00, 49.86it/s] 56%|█████▌    | 44/79 [00:01<00:00, 60.71it/s] 67%|██████▋   | 53/79 [00:01<00:00, 67.64it/s] 78%|███████▊  | 62/79 [00:01<00:00, 72.68it/s] 91%|█████████ | 72/79 [00:01<00:00, 78.99it/s]100%|██████████| 79/79 [00:01<00:00, 47.29it/s]
10000 images processed, 1.7044293880462646 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:48,  1.62it/s] 10%|█         | 8/79 [00:00<00:04, 14.36it/s] 22%|██▏       | 17/79 [00:00<00:02, 30.10it/s] 34%|███▍      | 27/79 [00:00<00:01, 45.29it/s] 46%|████▌     | 36/79 [00:01<00:00, 55.25it/s] 58%|█████▊    | 46/79 [00:01<00:00, 65.12it/s] 70%|██████▉   | 55/79 [00:01<00:00, 71.35it/s] 82%|████████▏ | 65/79 [00:01<00:00, 78.33it/s] 95%|█████████▍| 75/79 [00:01<00:00, 83.46it/s]100%|██████████| 79/79 [00:01<00:00, 52.73it/s]
10000 images processed, 1.5219273567199707 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:48,  1.43it/s]  7%|▋         | 5/70 [00:00<00:08,  7.97it/s] 21%|██▏       | 15/70 [00:00<00:02, 25.40it/s] 34%|███▍      | 24/70 [00:01<00:01, 38.74it/s] 49%|████▊     | 34/70 [00:01<00:00, 52.00it/s] 63%|██████▎   | 44/70 [00:01<00:00, 63.06it/s] 77%|███████▋  | 54/70 [00:01<00:00, 71.81it/s] 91%|█████████▏| 64/70 [00:01<00:00, 78.49it/s]100%|██████████| 70/70 [00:01<00:00, 46.49it/s]
8925 images processed, 1.5427231788635254 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:01<00:52,  1.18s/it]  7%|▋         | 3/45 [00:01<00:14,  2.86it/s] 29%|██▉       | 13/45 [00:01<00:02, 15.57it/s] 40%|████      | 18/45 [00:01<00:01, 14.62it/s] 49%|████▉     | 22/45 [00:01<00:01, 15.91it/s] 69%|██████▉   | 31/45 [00:02<00:00, 26.60it/s] 80%|████████  | 36/45 [00:02<00:00, 19.47it/s]100%|██████████| 45/45 [00:02<00:00, 28.94it/s]100%|██████████| 45/45 [00:02<00:00, 17.20it/s]
5640 images processed, 2.645216464996338 seconds used

18.81061625480652
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/umap/umap_.py:1952: UserWarning: n_jobs value 1 overridden to 1 by setting random_state. Use no seed for parallelism.
  warn(
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/umap/umap_.py:1952: UserWarning: n_jobs value 1 overridden to 1 by setting random_state. Use no seed for parallelism.
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           5.46  98.78
places365     72.67  79.75
LSUN          27.04  94.18
iSUN          76.19  79.51
dtd           47.16  89.36
AVG           45.70  88.32
Retain-Acc: 0.7385
Forget-as-OOD (retain known vs forget novel):
  FPR: 38.00 AUROC: 88.86 AUIN: 99.23
31.950523614883423
[umap] saved to figs/umap_CIFAR-100_resnet34_top5-palm-cache6-ema0.999-b128-e50-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stage1-seen_domain.png
[umap] saved to figs/umap_CIFAR-100_resnet34_top5-palm-cache6-ema0.999-b128-e50-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stage1-seen_rf.png
==== Stage 2: forget_inc={66,67,88,94,57}; forget_seen={0,8,11,40,51}; all={0,8,11,40,51,66,67,88,94,57} ====
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e50-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stack/stage2
[peft] active adapters set to: default
resnet34-top5-palm-cache6-ema0.999-b128-e50-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stage2-inc1: Number of model parameters: 21843904
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<03:50,  1.70it/s]  2%|▏         | 9/391 [00:00<00:22, 16.75it/s]  5%|▍         | 18/391 [00:00<00:11, 32.54it/s]  7%|▋         | 26/391 [00:00<00:08, 43.28it/s]  9%|▉         | 35/391 [00:01<00:06, 54.93it/s] 11%|█▏        | 44/391 [00:01<00:05, 63.67it/s] 14%|█▎        | 53/391 [00:01<00:04, 70.51it/s] 16%|█▌        | 62/391 [00:01<00:04, 74.64it/s] 18%|█▊        | 72/391 [00:01<00:03, 80.53it/s] 21%|██        | 81/391 [00:01<00:03, 80.34it/s] 23%|██▎       | 90/391 [00:01<00:03, 82.28it/s] 25%|██▌       | 99/391 [00:01<00:03, 82.47it/s] 28%|██▊       | 109/391 [00:01<00:03, 86.24it/s] 30%|███       | 119/391 [00:01<00:03, 87.79it/s] 33%|███▎      | 129/391 [00:02<00:02, 89.13it/s] 36%|███▌      | 139/391 [00:02<00:02, 90.57it/s] 38%|███▊      | 149/391 [00:02<00:02, 87.08it/s] 40%|████      | 158/391 [00:02<00:02, 87.14it/s] 43%|████▎     | 167/391 [00:02<00:02, 87.37it/s] 45%|████▌     | 176/391 [00:02<00:02, 87.87it/s] 48%|████▊     | 186/391 [00:02<00:02, 88.14it/s] 50%|████▉     | 195/391 [00:02<00:02, 86.46it/s] 52%|█████▏    | 204/391 [00:02<00:02, 87.45it/s] 54%|█████▍    | 213/391 [00:03<00:02, 86.91it/s] 57%|█████▋    | 223/391 [00:03<00:01, 88.33it/s] 59%|█████▉    | 232/391 [00:03<00:01, 86.81it/s] 62%|██████▏   | 241/391 [00:03<00:01, 87.56it/s] 64%|██████▍   | 251/391 [00:03<00:01, 89.09it/s] 66%|██████▋   | 260/391 [00:03<00:01, 88.80it/s] 69%|██████▉   | 270/391 [00:03<00:01, 89.39it/s] 72%|███████▏  | 280/391 [00:03<00:01, 89.56it/s] 74%|███████▍  | 289/391 [00:03<00:01, 88.03it/s] 76%|███████▋  | 299/391 [00:03<00:01, 89.69it/s] 79%|███████▉  | 308/391 [00:04<00:00, 87.56it/s] 81%|████████  | 317/391 [00:04<00:00, 86.15it/s] 83%|████████▎ | 326/391 [00:04<00:00, 87.10it/s] 86%|████████▌ | 336/391 [00:04<00:00, 88.14it/s] 88%|████████▊ | 346/391 [00:04<00:00, 89.67it/s] 91%|█████████ | 356/391 [00:04<00:00, 90.17it/s] 94%|█████████▎| 366/391 [00:04<00:00, 91.29it/s] 96%|█████████▌| 376/391 [00:04<00:00, 91.98it/s] 99%|█████████▊| 386/391 [00:04<00:00, 93.58it/s]100%|██████████| 391/391 [00:05<00:00, 77.94it/s]
50000 images processed, 5.135338068008423 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:55,  1.42it/s] 10%|█         | 8/79 [00:00<00:05, 12.76it/s] 20%|██        | 16/79 [00:00<00:02, 25.50it/s] 32%|███▏      | 25/79 [00:01<00:01, 38.93it/s] 42%|████▏     | 33/79 [00:01<00:00, 48.16it/s] 53%|█████▎    | 42/79 [00:01<00:00, 58.53it/s] 66%|██████▌   | 52/79 [00:01<00:00, 67.61it/s] 78%|███████▊  | 62/79 [00:01<00:00, 74.74it/s] 91%|█████████ | 72/79 [00:01<00:00, 80.10it/s]100%|██████████| 79/79 [00:01<00:00, 48.35it/s]
10000 images processed, 1.661616325378418 seconds used

Saved forget OOD features to cache/resnet34-top5-palm-cache6-ema0.999-b128-e50-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stage2-inc1/CIFAR-100/forget
Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<02:15,  1.50it/s]  4%|▍         | 9/204 [00:00<00:12, 15.27it/s]  9%|▉         | 18/204 [00:00<00:06, 30.01it/s] 14%|█▎        | 28/204 [00:00<00:03, 44.69it/s] 18%|█▊        | 37/204 [00:01<00:03, 55.26it/s] 23%|██▎       | 46/204 [00:01<00:02, 63.74it/s] 27%|██▋       | 55/204 [00:01<00:02, 70.38it/s] 31%|███▏      | 64/204 [00:01<00:01, 74.51it/s] 36%|███▋      | 74/204 [00:01<00:01, 80.16it/s] 41%|████      | 83/204 [00:01<00:01, 80.02it/s] 45%|████▌     | 92/204 [00:01<00:01, 82.66it/s] 50%|████▉     | 101/204 [00:01<00:01, 84.27it/s] 54%|█████▍    | 111/204 [00:01<00:01, 87.31it/s] 59%|█████▉    | 120/204 [00:02<00:00, 88.02it/s] 63%|██████▎   | 129/204 [00:02<00:00, 86.30it/s] 68%|██████▊   | 139/204 [00:02<00:00, 88.93it/s] 73%|███████▎  | 148/204 [00:02<00:00, 89.20it/s] 77%|███████▋  | 158/204 [00:02<00:00, 89.53it/s] 82%|████████▏ | 168/204 [00:02<00:00, 90.07it/s] 87%|████████▋ | 178/204 [00:02<00:00, 91.68it/s] 92%|█████████▏| 188/204 [00:02<00:00, 93.08it/s] 97%|█████████▋| 198/204 [00:02<00:00, 94.00it/s]100%|██████████| 204/204 [00:02<00:00, 69.46it/s]
26032 images processed, 2.9857940673828125 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<01:10,  1.11it/s]  9%|▉         | 7/79 [00:01<00:07,  9.16it/s] 20%|██        | 16/79 [00:01<00:02, 22.11it/s] 32%|███▏      | 25/79 [00:01<00:01, 34.30it/s] 42%|████▏     | 33/79 [00:01<00:01, 43.46it/s] 52%|█████▏    | 41/79 [00:01<00:00, 51.22it/s] 63%|██████▎   | 50/79 [00:01<00:00, 59.65it/s] 76%|███████▌  | 60/79 [00:01<00:00, 69.23it/s] 89%|████████▊ | 70/79 [00:01<00:00, 76.70it/s]100%|██████████| 79/79 [00:01<00:00, 43.26it/s]
10000 images processed, 1.863468885421753 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:49,  1.57it/s] 11%|█▏        | 9/79 [00:00<00:04, 15.92it/s] 23%|██▎       | 18/79 [00:00<00:01, 31.13it/s] 34%|███▍      | 27/79 [00:00<00:01, 43.45it/s] 44%|████▍     | 35/79 [00:01<00:00, 52.20it/s] 56%|█████▌    | 44/79 [00:01<00:00, 60.15it/s] 67%|██████▋   | 53/79 [00:01<00:00, 67.08it/s] 80%|███████▉  | 63/79 [00:01<00:00, 75.23it/s] 92%|█████████▏| 73/79 [00:01<00:00, 81.22it/s]100%|██████████| 79/79 [00:01<00:00, 51.60it/s]
10000 images processed, 1.553943395614624 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:46,  1.50it/s] 13%|█▎        | 9/70 [00:00<00:03, 15.29it/s] 26%|██▌       | 18/70 [00:00<00:01, 30.07it/s] 40%|████      | 28/70 [00:00<00:00, 44.65it/s] 54%|█████▍    | 38/70 [00:01<00:00, 57.02it/s] 69%|██████▊   | 48/70 [00:01<00:00, 67.14it/s] 83%|████████▎ | 58/70 [00:01<00:00, 75.05it/s] 97%|█████████▋| 68/70 [00:01<00:00, 80.95it/s]100%|██████████| 70/70 [00:01<00:00, 49.07it/s]
8925 images processed, 1.4605731964111328 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:01<00:52,  1.19s/it]  4%|▍         | 2/45 [00:01<00:24,  1.74it/s] 27%|██▋       | 12/45 [00:01<00:02, 14.14it/s] 38%|███▊      | 17/45 [00:01<00:01, 14.70it/s] 47%|████▋     | 21/45 [00:01<00:01, 15.85it/s] 62%|██████▏   | 28/45 [00:02<00:00, 23.59it/s] 73%|███████▎  | 33/45 [00:02<00:00, 18.12it/s] 82%|████████▏ | 37/45 [00:02<00:00, 19.53it/s]100%|██████████| 45/45 [00:02<00:00, 16.33it/s]
5640 images processed, 2.7776246070861816 seconds used

19.29660177230835
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/umap/umap_.py:1952: UserWarning: n_jobs value 1 overridden to 1 by setting random_state. Use no seed for parallelism.
  warn(
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/umap/umap_.py:1952: UserWarning: n_jobs value 1 overridden to 1 by setting random_state. Use no seed for parallelism.
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           7.04  98.45
places365     75.68  77.74
LSUN          44.42  87.13
iSUN          79.78  77.44
dtd           49.38  88.38
AVG           51.26  85.83
Retain-Acc: 0.7281
Forget-as-OOD (retain known vs forget novel):
  FPR: 42.00 AUROC: 89.11 AUIN: 99.26
34.21764373779297
[umap] saved to figs/umap_CIFAR-100_resnet34_top5-palm-cache6-ema0.999-b128-e50-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stage2-inc1_domain.png
[umap] saved to figs/umap_CIFAR-100_resnet34_top5-palm-cache6-ema0.999-b128-e50-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stage2-inc1_rf.png
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e50-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stack/stage2
[peft] active adapters set to: default
resnet34-top5-palm-cache6-ema0.999-b128-e50-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stage2-inc2: Number of model parameters: 21843904
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<03:42,  1.76it/s]  2%|▏         | 9/391 [00:00<00:22, 17.31it/s]  4%|▍         | 17/391 [00:00<00:12, 30.68it/s]  6%|▌         | 24/391 [00:00<00:09, 39.70it/s]  8%|▊         | 31/391 [00:01<00:08, 41.33it/s] 10%|▉         | 39/391 [00:01<00:07, 49.61it/s] 12%|█▏        | 46/391 [00:01<00:06, 53.07it/s] 14%|█▍        | 54/391 [00:01<00:05, 57.93it/s] 16%|█▌        | 63/391 [00:01<00:04, 66.21it/s] 18%|█▊        | 72/391 [00:01<00:04, 70.76it/s] 21%|██        | 81/391 [00:01<00:04, 74.11it/s] 23%|██▎       | 89/391 [00:01<00:04, 62.45it/s] 25%|██▌       | 98/391 [00:01<00:04, 68.18it/s] 27%|██▋       | 106/391 [00:02<00:04, 64.65it/s] 29%|██▉       | 115/391 [00:02<00:03, 70.72it/s] 32%|███▏      | 124/391 [00:02<00:03, 73.97it/s] 34%|███▍      | 132/391 [00:02<00:03, 68.26it/s] 36%|███▌      | 140/391 [00:02<00:04, 62.58it/s] 38%|███▊      | 147/391 [00:02<00:03, 64.32it/s] 39%|███▉      | 154/391 [00:02<00:03, 63.51it/s] 41%|████▏     | 162/391 [00:02<00:03, 67.76it/s] 44%|████▎     | 171/391 [00:03<00:03, 71.59it/s] 46%|████▌     | 179/391 [00:03<00:03, 60.76it/s] 48%|████▊     | 187/391 [00:03<00:03, 65.09it/s] 50%|████▉     | 194/391 [00:03<00:03, 62.05it/s] 52%|█████▏    | 202/391 [00:03<00:02, 65.80it/s] 54%|█████▍    | 211/391 [00:03<00:02, 70.17it/s] 56%|█████▌    | 219/391 [00:03<00:02, 59.49it/s] 58%|█████▊    | 227/391 [00:03<00:02, 64.11it/s] 60%|██████    | 235/391 [00:04<00:02, 65.22it/s] 62%|██████▏   | 243/391 [00:04<00:02, 67.18it/s] 64%|██████▍   | 252/391 [00:04<00:01, 72.12it/s] 66%|██████▋   | 260/391 [00:04<00:01, 74.21it/s] 69%|██████▊   | 268/391 [00:04<00:01, 62.03it/s] 71%|███████   | 276/391 [00:04<00:01, 65.11it/s] 73%|███████▎  | 284/391 [00:04<00:01, 66.78it/s] 74%|███████▍  | 291/391 [00:04<00:01, 66.70it/s] 77%|███████▋  | 300/391 [00:05<00:01, 72.77it/s] 79%|███████▉  | 309/391 [00:05<00:01, 77.21it/s] 81%|████████▏ | 318/391 [00:05<00:00, 80.32it/s] 84%|████████▎ | 327/391 [00:05<00:00, 71.48it/s] 86%|████████▌ | 335/391 [00:05<00:00, 66.82it/s] 88%|████████▊ | 344/391 [00:05<00:00, 72.14it/s] 90%|█████████ | 352/391 [00:05<00:00, 64.17it/s] 92%|█████████▏| 361/391 [00:05<00:00, 69.90it/s] 95%|█████████▍| 370/391 [00:05<00:00, 71.56it/s] 97%|█████████▋| 378/391 [00:06<00:00, 62.05it/s] 99%|█████████▉| 388/391 [00:06<00:00, 70.18it/s]100%|██████████| 391/391 [00:06<00:00, 61.98it/s]
50000 images processed, 6.427409648895264 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:44,  1.74it/s]  8%|▊         | 6/79 [00:00<00:06, 11.19it/s] 19%|█▉        | 15/79 [00:00<00:02, 27.93it/s] 30%|███       | 24/79 [00:00<00:01, 41.04it/s] 39%|███▉      | 31/79 [00:01<00:01, 42.86it/s] 47%|████▋     | 37/79 [00:01<00:00, 45.81it/s] 57%|█████▋    | 45/79 [00:01<00:00, 52.40it/s] 66%|██████▌   | 52/79 [00:01<00:00, 54.04it/s] 77%|███████▋  | 61/79 [00:01<00:00, 62.78it/s] 89%|████████▊ | 70/79 [00:01<00:00, 69.47it/s]100%|██████████| 79/79 [00:01<00:00, 72.58it/s]100%|██████████| 79/79 [00:01<00:00, 45.91it/s]
10000 images processed, 1.748889684677124 seconds used

Saved forget OOD features to cache/resnet34-top5-palm-cache6-ema0.999-b128-e50-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stage2-inc2/CIFAR-100/forget
Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<02:17,  1.48it/s]  3%|▎         | 7/204 [00:00<00:17, 11.52it/s]  8%|▊         | 16/204 [00:00<00:07, 26.29it/s] 12%|█▏        | 25/204 [00:01<00:04, 39.75it/s] 16%|█▌        | 32/204 [00:01<00:03, 43.07it/s] 19%|█▉        | 39/204 [00:01<00:03, 45.90it/s] 24%|██▎       | 48/204 [00:01<00:02, 53.54it/s] 27%|██▋       | 55/204 [00:01<00:02, 56.36it/s] 31%|███▏      | 64/204 [00:01<00:02, 63.86it/s] 36%|███▌      | 73/204 [00:01<00:01, 69.28it/s] 40%|███▉      | 81/204 [00:01<00:02, 60.07it/s] 43%|████▎     | 88/204 [00:01<00:01, 61.40it/s] 47%|████▋     | 96/204 [00:02<00:01, 65.67it/s] 50%|█████     | 103/204 [00:02<00:01, 61.26it/s] 55%|█████▍    | 112/204 [00:02<00:01, 66.41it/s] 58%|█████▊    | 119/204 [00:02<00:01, 64.17it/s] 62%|██████▏   | 126/204 [00:02<00:01, 58.17it/s] 66%|██████▌   | 135/204 [00:02<00:01, 64.56it/s] 70%|██████▉   | 142/204 [00:02<00:00, 64.70it/s] 73%|███████▎  | 149/204 [00:02<00:00, 65.28it/s] 77%|███████▋  | 158/204 [00:03<00:00, 70.61it/s] 82%|████████▏ | 167/204 [00:03<00:00, 75.18it/s] 86%|████████▌ | 175/204 [00:03<00:00, 70.35it/s] 90%|████████▉ | 183/204 [00:03<00:00, 62.47it/s] 95%|█████████▍| 193/204 [00:03<00:00, 71.04it/s] 99%|█████████▊| 201/204 [00:03<00:00, 66.59it/s]100%|██████████| 204/204 [00:03<00:00, 54.74it/s]
26032 images processed, 3.772669792175293 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<01:06,  1.18it/s]  6%|▋         | 5/79 [00:00<00:10,  6.77it/s] 16%|█▋        | 13/79 [00:01<00:03, 19.23it/s] 28%|██▊       | 22/79 [00:01<00:01, 32.71it/s] 37%|███▋      | 29/79 [00:01<00:01, 36.05it/s] 44%|████▍     | 35/79 [00:01<00:01, 40.88it/s] 56%|█████▌    | 44/79 [00:01<00:00, 51.05it/s] 65%|██████▍   | 51/79 [00:01<00:00, 52.71it/s] 76%|███████▌  | 60/79 [00:01<00:00, 60.83it/s] 87%|████████▋ | 69/79 [00:01<00:00, 68.15it/s] 99%|█████████▊| 78/79 [00:01<00:00, 73.74it/s]100%|██████████| 79/79 [00:01<00:00, 40.14it/s]
10000 images processed, 2.004929542541504 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:55,  1.42it/s]  5%|▌         | 4/79 [00:00<00:12,  5.89it/s] 13%|█▎        | 10/79 [00:00<00:04, 15.66it/s] 23%|██▎       | 18/79 [00:01<00:02, 28.62it/s] 32%|███▏      | 25/79 [00:01<00:01, 37.45it/s] 39%|███▉      | 31/79 [00:01<00:01, 39.03it/s] 47%|████▋     | 37/79 [00:01<00:00, 43.95it/s] 58%|█████▊    | 46/79 [00:01<00:00, 54.94it/s] 67%|██████▋   | 53/79 [00:01<00:00, 54.67it/s] 78%|███████▊  | 62/79 [00:01<00:00, 63.55it/s] 90%|████████▉ | 71/79 [00:01<00:00, 70.34it/s]100%|██████████| 79/79 [00:01<00:00, 41.08it/s]
10000 images processed, 1.9477860927581787 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:46,  1.47it/s]  6%|▌         | 4/70 [00:00<00:10,  6.18it/s] 16%|█▌        | 11/70 [00:00<00:03, 18.18it/s] 23%|██▎       | 16/70 [00:01<00:02, 24.58it/s] 33%|███▎      | 23/70 [00:01<00:01, 34.23it/s] 46%|████▌     | 32/70 [00:01<00:00, 45.94it/s] 54%|█████▍    | 38/70 [00:01<00:00, 44.62it/s] 66%|██████▌   | 46/70 [00:01<00:00, 52.18it/s] 79%|███████▊  | 55/70 [00:01<00:00, 61.36it/s] 89%|████████▊ | 62/70 [00:01<00:00, 60.40it/s]100%|██████████| 70/70 [00:01<00:00, 38.54it/s]
8925 images processed, 1.851431131362915 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:01<00:53,  1.22s/it]  4%|▍         | 2/45 [00:01<00:26,  1.60it/s] 20%|██        | 9/45 [00:01<00:03,  9.54it/s] 38%|███▊      | 17/45 [00:01<00:01, 16.62it/s] 47%|████▋     | 21/45 [00:01<00:01, 17.05it/s] 53%|█████▎    | 24/45 [00:02<00:01, 19.00it/s] 69%|██████▉   | 31/45 [00:02<00:00, 27.94it/s] 80%|████████  | 36/45 [00:02<00:00, 18.11it/s] 96%|█████████▌| 43/45 [00:02<00:00, 25.06it/s]100%|██████████| 45/45 [00:02<00:00, 15.97it/s]
5640 images processed, 2.841059446334839 seconds used

22.444753646850586
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/umap/umap_.py:1952: UserWarning: n_jobs value 1 overridden to 1 by setting random_state. Use no seed for parallelism.
  warn(
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/umap/umap_.py:1952: UserWarning: n_jobs value 1 overridden to 1 by setting random_state. Use no seed for parallelism.
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           5.60  98.76
places365     72.78  80.09
LSUN          21.66  95.81
iSUN          77.75  78.95
dtd           45.57  89.68
AVG           44.67  88.66
Retain-Acc: 0.7292
Forget-as-OOD (retain known vs forget novel):
  FPR: 46.00 AUROC: 91.97 AUIN: 99.52
35.96299743652344
[umap] saved to figs/umap_CIFAR-100_resnet34_top5-palm-cache6-ema0.999-b128-e50-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stage2-inc2_domain.png
[umap] saved to figs/umap_CIFAR-100_resnet34_top5-palm-cache6-ema0.999-b128-e50-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stage2-inc2_rf.png
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e50-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stack/stage2
[peft] active adapters set to: default
resnet34-top5-palm-cache6-ema0.999-b128-e50-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stage2-seen: Number of model parameters: 21843904
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<04:58,  1.31it/s]  2%|▏         | 6/391 [00:00<00:43,  8.93it/s]  4%|▍         | 15/391 [00:00<00:16, 23.31it/s]  6%|▌         | 24/391 [00:01<00:10, 36.68it/s]  8%|▊         | 33/391 [00:01<00:07, 47.41it/s] 10%|█         | 41/391 [00:01<00:06, 51.28it/s] 12%|█▏        | 48/391 [00:01<00:06, 50.19it/s] 15%|█▍        | 58/391 [00:01<00:05, 60.43it/s] 17%|█▋        | 66/391 [00:01<00:05, 59.45it/s] 19%|█▉        | 75/391 [00:01<00:04, 65.17it/s] 21%|██▏       | 84/391 [00:01<00:04, 69.86it/s] 24%|██▎       | 92/391 [00:02<00:04, 67.31it/s] 26%|██▌       | 100/391 [00:02<00:04, 60.51it/s] 28%|██▊       | 109/391 [00:02<00:04, 66.32it/s] 30%|██▉       | 116/391 [00:02<00:04, 64.42it/s] 31%|███▏      | 123/391 [00:02<00:04, 65.66it/s] 34%|███▍      | 132/391 [00:02<00:03, 69.51it/s] 36%|███▌      | 140/391 [00:02<00:03, 71.58it/s] 38%|███▊      | 148/391 [00:02<00:04, 60.09it/s] 40%|███▉      | 156/391 [00:03<00:03, 63.78it/s] 42%|████▏     | 163/391 [00:03<00:03, 61.68it/s] 44%|████▍     | 172/391 [00:03<00:03, 67.38it/s] 46%|████▋     | 181/391 [00:03<00:02, 72.31it/s] 48%|████▊     | 189/391 [00:03<00:02, 68.53it/s] 50%|█████     | 197/391 [00:03<00:03, 60.41it/s] 53%|█████▎    | 206/391 [00:03<00:02, 67.06it/s] 55%|█████▍    | 214/391 [00:03<00:02, 62.98it/s] 57%|█████▋    | 222/391 [00:04<00:02, 65.97it/s] 59%|█████▉    | 230/391 [00:04<00:02, 68.21it/s] 61%|██████    | 238/391 [00:04<00:02, 61.63it/s] 63%|██████▎   | 245/391 [00:04<00:02, 61.16it/s] 65%|██████▍   | 254/391 [00:04<00:02, 64.88it/s] 67%|██████▋   | 261/391 [00:04<00:02, 63.83it/s] 69%|██████▉   | 269/391 [00:04<00:01, 67.45it/s] 71%|███████   | 278/391 [00:04<00:01, 71.24it/s] 73%|███████▎  | 286/391 [00:05<00:01, 59.31it/s] 75%|███████▌  | 294/391 [00:05<00:01, 63.59it/s] 77%|███████▋  | 301/391 [00:05<00:01, 60.44it/s] 79%|███████▉  | 310/391 [00:05<00:01, 66.00it/s] 81%|████████▏ | 318/391 [00:05<00:01, 68.62it/s] 83%|████████▎ | 326/391 [00:05<00:01, 60.40it/s] 85%|████████▌ | 333/391 [00:05<00:00, 60.35it/s] 87%|████████▋ | 342/391 [00:05<00:00, 67.27it/s] 90%|████████▉ | 350/391 [00:06<00:00, 63.41it/s] 92%|█████████▏| 359/391 [00:06<00:00, 69.15it/s] 94%|█████████▍| 368/391 [00:06<00:00, 74.59it/s] 97%|█████████▋| 378/391 [00:06<00:00, 79.27it/s] 99%|█████████▉| 388/391 [00:06<00:00, 80.67it/s]100%|██████████| 391/391 [00:06<00:00, 59.42it/s]
50000 images processed, 6.704103708267212 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:46,  1.69it/s]  9%|▉         | 7/79 [00:00<00:05, 12.79it/s] 16%|█▋        | 13/79 [00:00<00:02, 22.11it/s] 27%|██▋       | 21/79 [00:00<00:01, 34.82it/s] 37%|███▋      | 29/79 [00:01<00:01, 45.51it/s] 48%|████▊     | 38/79 [00:01<00:00, 55.86it/s] 58%|█████▊    | 46/79 [00:01<00:00, 53.60it/s] 67%|██████▋   | 53/79 [00:01<00:00, 55.07it/s] 76%|███████▌  | 60/79 [00:01<00:00, 56.34it/s] 86%|████████▌ | 68/79 [00:01<00:00, 61.94it/s] 97%|█████████▋| 77/79 [00:01<00:00, 68.73it/s]100%|██████████| 79/79 [00:01<00:00, 44.63it/s]
10000 images processed, 1.807880163192749 seconds used

Saved forget OOD features to cache/resnet34-top5-palm-cache6-ema0.999-b128-e50-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stage2-seen/CIFAR-100/forget
Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<02:24,  1.40it/s]  3%|▎         | 7/204 [00:00<00:17, 11.04it/s]  8%|▊         | 16/204 [00:00<00:07, 25.43it/s] 11%|█▏        | 23/204 [00:01<00:05, 34.55it/s] 14%|█▍        | 29/204 [00:01<00:04, 36.29it/s] 19%|█▊        | 38/204 [00:01<00:03, 47.79it/s] 22%|██▏       | 45/204 [00:01<00:03, 49.57it/s] 26%|██▌       | 53/204 [00:01<00:02, 56.73it/s] 30%|██▉       | 61/204 [00:01<00:02, 62.49it/s] 34%|███▍      | 69/204 [00:01<00:02, 57.07it/s] 37%|███▋      | 76/204 [00:01<00:02, 57.86it/s] 42%|████▏     | 86/204 [00:02<00:01, 67.42it/s] 46%|████▌     | 94/204 [00:02<00:01, 66.04it/s] 50%|█████     | 102/204 [00:02<00:01, 67.28it/s] 54%|█████▍    | 111/204 [00:02<00:01, 71.81it/s] 59%|█████▉    | 120/204 [00:02<00:01, 75.40it/s] 63%|██████▎   | 128/204 [00:02<00:01, 62.01it/s] 67%|██████▋   | 136/204 [00:02<00:01, 64.06it/s] 70%|███████   | 143/204 [00:02<00:01, 60.63it/s] 74%|███████▍  | 151/204 [00:03<00:00, 64.89it/s] 77%|███████▋  | 158/204 [00:03<00:00, 64.95it/s] 81%|████████  | 165/204 [00:03<00:00, 56.40it/s] 85%|████████▌ | 174/204 [00:03<00:00, 63.55it/s] 89%|████████▉ | 182/204 [00:03<00:00, 64.80it/s] 93%|█████████▎| 190/204 [00:03<00:00, 67.13it/s] 98%|█████████▊| 199/204 [00:03<00:00, 72.66it/s]100%|██████████| 204/204 [00:03<00:00, 53.89it/s]
26032 images processed, 3.8455331325531006 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<01:10,  1.11it/s] 14%|█▍        | 11/79 [00:01<00:04, 14.53it/s] 23%|██▎       | 18/79 [00:01<00:02, 23.38it/s] 34%|███▍      | 27/79 [00:01<00:01, 35.78it/s] 47%|████▋     | 37/79 [00:01<00:00, 48.48it/s] 58%|█████▊    | 46/79 [00:01<00:00, 57.47it/s] 71%|███████   | 56/79 [00:01<00:00, 66.47it/s] 82%|████████▏ | 65/79 [00:01<00:00, 72.32it/s] 94%|█████████▎| 74/79 [00:01<00:00, 52.82it/s]100%|██████████| 79/79 [00:01<00:00, 40.52it/s]
10000 images processed, 1.9870274066925049 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:48,  1.59it/s]  5%|▌         | 4/79 [00:00<00:11,  6.76it/s] 16%|█▋        | 13/79 [00:00<00:02, 23.63it/s] 24%|██▍       | 19/79 [00:00<00:01, 31.25it/s] 34%|███▍      | 27/79 [00:01<00:01, 42.79it/s] 44%|████▍     | 35/79 [00:01<00:00, 52.23it/s] 56%|█████▌    | 44/79 [00:01<00:00, 60.60it/s] 67%|██████▋   | 53/79 [00:01<00:00, 68.08it/s] 77%|███████▋  | 61/79 [00:01<00:00, 62.76it/s] 86%|████████▌ | 68/79 [00:01<00:00, 61.00it/s] 99%|█████████▊| 78/79 [00:01<00:00, 70.40it/s]100%|██████████| 79/79 [00:01<00:00, 45.23it/s]
10000 images processed, 1.7695012092590332 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:48,  1.43it/s] 13%|█▎        | 9/70 [00:00<00:04, 14.60it/s] 26%|██▌       | 18/70 [00:00<00:01, 28.69it/s] 37%|███▋      | 26/70 [00:01<00:01, 39.14it/s] 47%|████▋     | 33/70 [00:01<00:00, 40.01it/s] 59%|█████▊    | 41/70 [00:01<00:00, 48.54it/s] 69%|██████▊   | 48/70 [00:01<00:00, 52.74it/s] 79%|███████▊  | 55/70 [00:01<00:00, 56.96it/s] 91%|█████████▏| 64/70 [00:01<00:00, 65.24it/s]100%|██████████| 70/70 [00:01<00:00, 41.74it/s]
8925 images processed, 1.7124335765838623 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:01<00:51,  1.18s/it]  4%|▍         | 2/45 [00:01<00:25,  1.66it/s] 20%|██        | 9/45 [00:01<00:03,  9.74it/s] 38%|███▊      | 17/45 [00:01<00:02, 13.92it/s] 51%|█████     | 23/45 [00:02<00:01, 18.51it/s] 73%|███████▎  | 33/45 [00:02<00:00, 17.76it/s] 91%|█████████ | 41/45 [00:02<00:00, 24.23it/s]100%|██████████| 45/45 [00:02<00:00, 15.83it/s]
5640 images processed, 2.8673014640808105 seconds used

22.555474281311035
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/umap/umap_.py:1952: UserWarning: n_jobs value 1 overridden to 1 by setting random_state. Use no seed for parallelism.
  warn(
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/umap/umap_.py:1952: UserWarning: n_jobs value 1 overridden to 1 by setting random_state. Use no seed for parallelism.
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           5.70  98.74
places365     73.23  79.90
LSUN          22.63  95.67
iSUN          78.23  78.54
dtd           46.37  89.52
AVG           45.23  88.47
Retain-Acc: 0.7328
Forget-as-OOD (retain known vs forget novel):
  FPR: 43.40 AUROC: 90.85 AUIN: 98.79
33.906975984573364
[umap] saved to figs/umap_CIFAR-100_resnet34_top5-palm-cache6-ema0.999-b128-e50-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stage2-seen_domain.png
[umap] saved to figs/umap_CIFAR-100_resnet34_top5-palm-cache6-ema0.999-b128-e50-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stage2-seen_rf.png
