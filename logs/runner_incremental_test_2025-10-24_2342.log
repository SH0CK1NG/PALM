nohup: ignoring input
==== Stage 1: forget_inc={0,8,11,40,51}; forget_seen={}; all={0,8,11,40,51,66,67,88,94,57} ====
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
/home/shaokun/PALM/main.py:54: FutureWarning: `torch.cuda.amp.GradScaler(args...)` is deprecated. Please use `torch.amp.GradScaler('cuda', args...)` instead.
  scaler = torch.cuda.amp.GradScaler()
Namespace(in_dataset='CIFAR-100', out_datasets=['inat', 'sun50', 'places50', 'dtd'], backbone='resnet34', method='top5-palm-cache6-ema0.999', seed=1, gpu='0', epochs=5, batch_size=128, lr=0.001, weight_decay=0.0001, print_every=50, fine_tune=False, temp=0.08, cosine=True, warm=False, lr_decay_epochs='700,800,900', lr_decay_rate=0.1, layers=100, depth=40, width=4, growth=12, droprate=0.0, save_path='CIFAR-10-ResNet18.pt', load_path='checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt', reduce=0.5, score='mahalanobis', threshold=1.0, k=5, momentum=0.9, proto_m=0.999, cache_size=6, nviews=2, lambda_pcon=1.0, epsilon=0.05, incremental=False, use_lora=True, lora_impl='peft', lora_r=8, lora_alpha=32, lora_dropout=0.05, lora_target='both', adapter_save_path='checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stack/stage1', adapter_load_path=None, adapter_load_paths=None, lora_new_adapter_name=None, lora_stack=False, lora_orth_enable=False, lora_orth_lambda=0.1, lora_orth_ref_paths=None, forget_classes='0,8,11,40,51,66,67,88,94,57', forget_list_path=None, forget_classes_inc='0,8,11,40,51', forget_classes_seen=None, retain_exclude_csv=None, forget_csv=None, forget_lambda=0.2, forget_margin=100.0, forget_strategy='proto', centers_path=None, precision_path=None, batch_forget_mode='balanced', forget_proto_enable=False, forget_attr_w=1.0, forget_proto_rep_w=1.0, forget_avgproto_enable=False, forget_avgproto_w=1.0, umap_enable=False, umap_by='domain', umap_max_points=20000, umap_neighbors=15, umap_min_dist=0.05, umap_metric='cosine', umap_save_path=None, umap_rf_only=False, keep_cache=False, argument=True)
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
resnet34-top5-palm-cache6-ema0.999: Number of model parameters: 21843904
[debug] trainable_count = 16
[debug] trainable: base_model.model.encoder.layer4.0.conv1.lora_A.default.weight
[debug] trainable: base_model.model.encoder.layer4.0.conv1.lora_B.default.weight
[debug] trainable: base_model.model.encoder.layer4.0.conv2.lora_A.default.weight
[debug] trainable: base_model.model.encoder.layer4.0.conv2.lora_B.default.weight
[debug] trainable: base_model.model.encoder.layer4.0.shortcut.0.lora_A.default.weight
[debug] trainable: base_model.model.encoder.layer4.0.shortcut.0.lora_B.default.weight
[debug] trainable: base_model.model.encoder.layer4.1.conv1.lora_A.default.weight
[debug] trainable: base_model.model.encoder.layer4.1.conv1.lora_B.default.weight
[debug] trainable: base_model.model.encoder.layer4.1.conv2.lora_A.default.weight
[debug] trainable: base_model.model.encoder.layer4.1.conv2.lora_B.default.weight
[debug] trainable: base_model.model.encoder.layer4.2.conv1.lora_A.default.weight
[debug] trainable: base_model.model.encoder.layer4.2.conv1.lora_B.default.weight
[debug] trainable: base_model.model.encoder.layer4.2.conv2.lora_A.default.weight
[debug] trainable: base_model.model.encoder.layer4.2.conv2.lora_B.default.weight
[debug] trainable: base_model.model.head.2.lora_A.default.weight
[debug] trainable: base_model.model.head.2.lora_B.default.weight
[debug][warn] non-LoRA trainables detected: ['base_model.model.encoder.layer4.0.conv1.lora_A.default.weight', 'base_model.model.encoder.layer4.0.conv1.lora_B.default.weight', 'base_model.model.encoder.layer4.0.conv2.lora_A.default.weight', 'base_model.model.encoder.layer4.0.conv2.lora_B.default.weight', 'base_model.model.encoder.layer4.0.shortcut.0.lora_A.default.weight', 'base_model.model.encoder.layer4.0.shortcut.0.lora_B.default.weight', 'base_model.model.encoder.layer4.1.conv1.lora_A.default.weight', 'base_model.model.encoder.layer4.1.conv1.lora_B.default.weight', 'base_model.model.encoder.layer4.1.conv2.lora_A.default.weight', 'base_model.model.encoder.layer4.1.conv2.lora_B.default.weight']
  0%|          | 0/5 [00:00<?, ?it/s]/home/shaokun/PALM/trainer.py:139: FutureWarning: `torch.cuda.amp.autocast(args...)` is deprecated. Please use `torch.amp.autocast('cuda', args...)` instead.
  with torch.cuda.amp.autocast():
 20%|██        | 1/5 [02:11<08:47, 131.80s/it] 40%|████      | 2/5 [02:49<03:48, 76.29s/it]  60%|██████    | 3/5 [03:23<01:54, 57.17s/it] 80%|████████  | 4/5 [04:01<00:49, 49.51s/it]100%|██████████| 5/5 [04:36<00:00, 44.27s/it]100%|██████████| 5/5 [04:36<00:00, 55.28s/it]
[loss] ep 0 it 0 total=8.4104 mle=1.6273 pcon=5.2951 forget=1.4880 favg=0.0000 nr=28 nf=28 protos=570 fproto_sim=NA
[loss] ep 0 it 50 total=8.7564 mle=1.9943 pcon=5.2910 forget=1.4712 favg=0.0000 nr=30 nf=30 protos=570 fproto_sim=NA
[loss] ep 0 it 100 total=8.8798 mle=2.1352 pcon=5.2868 forget=1.4578 favg=0.0000 nr=30 nf=30 protos=570 fproto_sim=NA
[loss] ep 0 it 150 total=9.2353 mle=2.4879 pcon=5.2829 forget=1.4645 favg=0.0000 nr=32 nf=32 protos=570 fproto_sim=NA
[loss] ep 0 it 200 total=9.2724 mle=2.5441 pcon=5.2787 forget=1.4496 favg=0.0000 nr=30 nf=30 protos=570 fproto_sim=NA
[loss] ep 0 it 250 total=8.6732 mle=1.9322 pcon=5.2748 forget=1.4663 favg=0.0000 nr=34 nf=34 protos=570 fproto_sim=NA
[loss] ep 0 it 300 total=8.4972 mle=1.7804 pcon=5.2707 forget=1.4461 favg=0.0000 nr=30 nf=30 protos=570 fproto_sim=NA
[loss] ep 0 it 350 total=9.0521 mle=2.3362 pcon=5.2668 forget=1.4491 favg=0.0000 nr=34 nf=34 protos=570 fproto_sim=NA
[peft] adapter saved to checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stack/stage1
[loss] ep 1 it 10 total=8.3919 mle=1.6597 pcon=5.2628 forget=1.4693 favg=0.0000 nr=41 nf=41 protos=570 fproto_sim=NA
[loss] ep 1 it 60 total=8.3571 mle=1.6493 pcon=5.2590 forget=1.4488 favg=0.0000 nr=26 nf=26 protos=570 fproto_sim=NA
[loss] ep 1 it 110 total=8.4052 mle=1.6983 pcon=5.2552 forget=1.4517 favg=0.0000 nr=30 nf=30 protos=570 fproto_sim=NA
[loss] ep 1 it 160 total=8.5317 mle=1.7839 pcon=5.2515 forget=1.4963 favg=0.0000 nr=32 nf=32 protos=570 fproto_sim=NA
[loss] ep 1 it 210 total=8.2694 mle=1.5553 pcon=5.2477 forget=1.4664 favg=0.0000 nr=32 nf=32 protos=570 fproto_sim=NA
[loss] ep 1 it 260 total=8.7201 mle=2.0037 pcon=5.2439 forget=1.4725 favg=0.0000 nr=30 nf=30 protos=570 fproto_sim=NA
[loss] ep 1 it 310 total=8.9391 mle=2.2288 pcon=5.2404 forget=1.4699 favg=0.0000 nr=36 nf=36 protos=570 fproto_sim=NA
[loss] ep 1 it 360 total=8.5477 mle=1.8688 pcon=5.2367 forget=1.4422 favg=0.0000 nr=33 nf=33 protos=570 fproto_sim=NA
[peft] adapter saved to checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stack/stage1
[loss] ep 2 it 20 total=8.0423 mle=1.3551 pcon=5.2331 forget=1.4541 favg=0.0000 nr=38 nf=38 protos=570 fproto_sim=NA
[loss] ep 2 it 70 total=8.4405 mle=1.8000 pcon=5.2298 forget=1.4108 favg=0.0000 nr=32 nf=32 protos=570 fproto_sim=NA
[loss] ep 2 it 120 total=8.3367 mle=1.6570 pcon=5.2262 forget=1.4535 favg=0.0000 nr=40 nf=40 protos=570 fproto_sim=NA
[loss] ep 2 it 170 total=8.7015 mle=2.0434 pcon=5.2228 forget=1.4353 favg=0.0000 nr=24 nf=24 protos=570 fproto_sim=NA
[loss] ep 2 it 220 total=9.0549 mle=2.4084 pcon=5.2195 forget=1.4270 favg=0.0000 nr=27 nf=27 protos=570 fproto_sim=NA
[loss] ep 2 it 270 total=8.4799 mle=1.8171 pcon=5.2162 forget=1.4465 favg=0.0000 nr=35 nf=35 protos=570 fproto_sim=NA
[loss] ep 2 it 320 total=8.2500 mle=1.5927 pcon=5.2130 forget=1.4443 favg=0.0000 nr=33 nf=33 protos=570 fproto_sim=NA
[loss] ep 2 it 370 total=8.6809 mle=2.0344 pcon=5.2098 forget=1.4367 favg=0.0000 nr=29 nf=29 protos=570 fproto_sim=NA
[peft] adapter saved to checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stack/stage1
[loss] ep 3 it 30 total=8.2820 mle=1.6327 pcon=5.2065 forget=1.4428 favg=0.0000 nr=28 nf=28 protos=570 fproto_sim=NA
[loss] ep 3 it 80 total=8.7729 mle=2.0475 pcon=5.2032 forget=1.5222 favg=0.0000 nr=34 nf=34 protos=570 fproto_sim=NA
[loss] ep 3 it 130 total=8.5102 mle=1.9324 pcon=5.2003 forget=1.3775 favg=0.0000 nr=30 nf=30 protos=570 fproto_sim=NA
[loss] ep 3 it 180 total=8.7392 mle=2.1012 pcon=5.1969 forget=1.4410 favg=0.0000 nr=41 nf=41 protos=570 fproto_sim=NA
[loss] ep 3 it 230 total=8.4280 mle=1.8243 pcon=5.1937 forget=1.4099 favg=0.0000 nr=32 nf=32 protos=570 fproto_sim=NA
[loss] ep 3 it 280 total=8.4481 mle=1.8524 pcon=5.1909 forget=1.4049 favg=0.0000 nr=33 nf=33 protos=570 fproto_sim=NA
[loss] ep 3 it 330 total=8.7581 mle=2.0956 pcon=5.1880 forget=1.4746 favg=0.0000 nr=25 nf=25 protos=570 fproto_sim=NA
[loss] ep 3 it 380 total=8.3019 mle=1.6275 pcon=5.1850 forget=1.4895 favg=0.0000 nr=29 nf=29 protos=570 fproto_sim=NA
[peft] adapter saved to checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stack/stage1
[loss] ep 4 it 40 total=8.5239 mle=1.8599 pcon=5.1821 forget=1.4819 favg=0.0000 nr=34 nf=34 protos=570 fproto_sim=NA
[loss] ep 4 it 90 total=8.2764 mle=1.7143 pcon=5.1790 forget=1.3830 favg=0.0000 nr=41 nf=41 protos=570 fproto_sim=NA
[loss] ep 4 it 140 total=9.0108 mle=2.3582 pcon=5.1762 forget=1.4763 favg=0.0000 nr=33 nf=33 protos=570 fproto_sim=NA
[loss] ep 4 it 190 total=8.4974 mle=1.8555 pcon=5.1731 forget=1.4688 favg=0.0000 nr=25 nf=25 protos=570 fproto_sim=NA
[loss] ep 4 it 240 total=8.4978 mle=1.8213 pcon=5.1701 forget=1.5064 favg=0.0000 nr=28 nf=28 protos=570 fproto_sim=NA
[loss] ep 4 it 290 total=8.2815 mle=1.7154 pcon=5.1672 forget=1.3989 favg=0.0000 nr=29 nf=29 protos=570 fproto_sim=NA
[loss] ep 4 it 340 total=8.6386 mle=2.0389 pcon=5.1643 forget=1.4354 favg=0.0000 nr=29 nf=29 protos=570 fproto_sim=NA
[peft] adapter saved to checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stack/stage1
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stage1-inc1: Number of model parameters: 21843904
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<02:39,  2.45it/s]  2%|▏         | 6/391 [00:00<00:26, 14.30it/s]  3%|▎         | 11/391 [00:00<00:16, 23.20it/s]  4%|▍         | 16/391 [00:00<00:12, 29.46it/s]  5%|▌         | 21/391 [00:00<00:10, 33.89it/s]  7%|▋         | 26/391 [00:00<00:09, 36.64it/s]  8%|▊         | 31/391 [00:01<00:09, 39.15it/s]  9%|▉         | 36/391 [00:01<00:08, 40.71it/s] 10%|█         | 41/391 [00:01<00:08, 42.03it/s] 12%|█▏        | 47/391 [00:01<00:07, 44.61it/s] 13%|█▎        | 52/391 [00:01<00:07, 45.04it/s] 15%|█▍        | 57/391 [00:01<00:07, 45.38it/s] 16%|█▌        | 62/391 [00:01<00:07, 44.76it/s] 17%|█▋        | 67/391 [00:01<00:07, 45.16it/s] 18%|█▊        | 72/391 [00:01<00:07, 45.45it/s] 20%|█▉        | 77/391 [00:02<00:07, 44.65it/s] 21%|██        | 82/391 [00:02<00:07, 43.56it/s] 22%|██▏       | 87/391 [00:02<00:06, 43.82it/s] 24%|██▎       | 92/391 [00:02<00:06, 44.25it/s] 25%|██▍       | 97/391 [00:02<00:06, 43.55it/s] 26%|██▌       | 102/391 [00:02<00:06, 44.75it/s] 27%|██▋       | 107/391 [00:02<00:06, 44.18it/s] 29%|██▊       | 112/391 [00:02<00:06, 44.76it/s] 30%|██▉       | 117/391 [00:02<00:06, 45.18it/s] 31%|███       | 122/391 [00:03<00:05, 45.51it/s] 32%|███▏      | 127/391 [00:03<00:05, 45.71it/s] 34%|███▍      | 132/391 [00:03<00:05, 45.85it/s] 35%|███▌      | 137/391 [00:03<00:05, 45.96it/s] 37%|███▋      | 143/391 [00:03<00:05, 47.32it/s] 38%|███▊      | 148/391 [00:03<00:05, 47.02it/s] 39%|███▉      | 153/391 [00:03<00:05, 46.54it/s] 40%|████      | 158/391 [00:03<00:05, 45.62it/s] 42%|████▏     | 163/391 [00:03<00:05, 44.39it/s] 43%|████▎     | 168/391 [00:04<00:05, 43.90it/s] 44%|████▍     | 173/391 [00:04<00:04, 43.79it/s] 46%|████▌     | 179/391 [00:04<00:04, 46.31it/s] 47%|████▋     | 184/391 [00:04<00:04, 46.03it/s] 48%|████▊     | 189/391 [00:04<00:04, 45.04it/s] 50%|████▉     | 194/391 [00:04<00:04, 44.87it/s] 51%|█████     | 199/391 [00:04<00:04, 45.25it/s] 52%|█████▏    | 204/391 [00:04<00:04, 45.51it/s] 53%|█████▎    | 209/391 [00:05<00:04, 45.14it/s] 55%|█████▍    | 214/391 [00:05<00:03, 45.44it/s] 56%|█████▌    | 219/391 [00:05<00:03, 45.65it/s] 57%|█████▋    | 224/391 [00:05<00:03, 45.33it/s] 59%|█████▊    | 229/391 [00:05<00:03, 45.53it/s] 60%|█████▉    | 234/391 [00:05<00:03, 44.40it/s] 61%|██████    | 239/391 [00:05<00:03, 45.92it/s] 62%|██████▏   | 244/391 [00:05<00:03, 45.97it/s] 64%|██████▎   | 249/391 [00:05<00:03, 44.98it/s] 65%|██████▍   | 254/391 [00:06<00:03, 44.80it/s] 66%|██████▌   | 259/391 [00:06<00:02, 44.31it/s] 68%|██████▊   | 264/391 [00:06<00:02, 42.66it/s] 69%|██████▉   | 269/391 [00:06<00:02, 42.46it/s] 70%|███████   | 274/391 [00:06<00:02, 42.56it/s] 71%|███████▏  | 279/391 [00:06<00:02, 43.10it/s] 73%|███████▎  | 284/391 [00:06<00:02, 42.38it/s] 74%|███████▍  | 289/391 [00:06<00:02, 43.38it/s] 75%|███████▌  | 294/391 [00:06<00:02, 44.21it/s] 76%|███████▋  | 299/391 [00:07<00:02, 43.60it/s] 78%|███████▊  | 304/391 [00:07<00:02, 43.15it/s] 79%|███████▉  | 309/391 [00:07<00:01, 44.79it/s] 80%|████████  | 314/391 [00:07<00:01, 45.10it/s] 82%|████████▏ | 319/391 [00:07<00:01, 45.19it/s] 83%|████████▎ | 324/391 [00:07<00:01, 45.46it/s] 84%|████████▍ | 329/391 [00:07<00:01, 45.70it/s] 85%|████████▌ | 334/391 [00:07<00:01, 45.85it/s] 87%|████████▋ | 339/391 [00:07<00:01, 44.69it/s] 88%|████████▊ | 344/391 [00:08<00:01, 45.14it/s] 89%|████████▉ | 349/391 [00:08<00:00, 44.19it/s] 91%|█████████ | 354/391 [00:08<00:00, 43.04it/s] 92%|█████████▏| 359/391 [00:08<00:00, 42.27it/s] 93%|█████████▎| 364/391 [00:08<00:00, 43.35it/s] 95%|█████████▍| 370/391 [00:08<00:00, 45.47it/s] 96%|█████████▌| 375/391 [00:08<00:00, 45.67it/s] 97%|█████████▋| 380/391 [00:08<00:00, 45.85it/s] 98%|█████████▊| 385/391 [00:08<00:00, 45.97it/s]100%|█████████▉| 390/391 [00:09<00:00, 46.06it/s]100%|██████████| 391/391 [00:09<00:00, 43.01it/s]
50000 images processed, 9.233488321304321 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:42,  1.82it/s]  8%|▊         | 6/79 [00:00<00:06, 11.44it/s] 14%|█▍        | 11/79 [00:00<00:03, 19.68it/s] 19%|█▉        | 15/79 [00:00<00:02, 24.31it/s] 25%|██▌       | 20/79 [00:00<00:01, 29.94it/s] 32%|███▏      | 25/79 [00:01<00:01, 34.20it/s] 38%|███▊      | 30/79 [00:01<00:01, 36.70it/s] 44%|████▍     | 35/79 [00:01<00:01, 39.89it/s] 51%|█████     | 40/79 [00:01<00:00, 40.70it/s] 57%|█████▋    | 45/79 [00:01<00:00, 41.81it/s] 63%|██████▎   | 50/79 [00:01<00:00, 42.13it/s] 70%|██████▉   | 55/79 [00:01<00:00, 43.38it/s] 76%|███████▌  | 60/79 [00:01<00:00, 44.20it/s] 82%|████████▏ | 65/79 [00:01<00:00, 44.79it/s] 89%|████████▊ | 70/79 [00:02<00:00, 45.22it/s] 96%|█████████▌| 76/79 [00:02<00:00, 47.03it/s]100%|██████████| 79/79 [00:02<00:00, 34.66it/s]
10000 images processed, 2.306601047515869 seconds used

Saved forget OOD features to cache/resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stage1-inc1/CIFAR-100/forget
Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<02:00,  1.69it/s]  3%|▎         | 6/204 [00:00<00:18, 10.63it/s]  5%|▌         | 11/204 [00:00<00:10, 18.12it/s]  8%|▊         | 16/204 [00:00<00:07, 24.21it/s] 11%|█         | 22/204 [00:01<00:05, 31.16it/s] 13%|█▎        | 27/204 [00:01<00:05, 34.12it/s] 16%|█▌        | 32/204 [00:01<00:04, 35.24it/s] 18%|█▊        | 37/204 [00:01<00:04, 36.88it/s] 21%|██        | 42/204 [00:01<00:04, 37.17it/s] 23%|██▎       | 47/204 [00:01<00:04, 38.37it/s] 25%|██▌       | 52/204 [00:01<00:03, 38.43it/s] 27%|██▋       | 56/204 [00:01<00:03, 38.81it/s] 29%|██▉       | 60/204 [00:02<00:03, 38.92it/s] 31%|███▏      | 64/204 [00:02<00:03, 38.79it/s] 33%|███▎      | 68/204 [00:02<00:03, 39.09it/s] 35%|███▌      | 72/204 [00:02<00:03, 38.07it/s] 38%|███▊      | 77/204 [00:02<00:03, 39.23it/s] 40%|████      | 82/204 [00:02<00:03, 40.02it/s] 43%|████▎     | 87/204 [00:02<00:02, 40.12it/s] 45%|████▌     | 92/204 [00:02<00:02, 39.96it/s] 48%|████▊     | 97/204 [00:02<00:02, 40.49it/s] 50%|█████     | 102/204 [00:03<00:02, 40.87it/s] 52%|█████▏    | 107/204 [00:03<00:02, 41.15it/s] 55%|█████▍    | 112/204 [00:03<00:02, 42.58it/s] 57%|█████▋    | 117/204 [00:03<00:02, 41.59it/s] 60%|█████▉    | 122/204 [00:03<00:01, 41.42it/s] 62%|██████▏   | 127/204 [00:03<00:01, 40.76it/s] 65%|██████▍   | 132/204 [00:03<00:01, 40.62it/s] 67%|██████▋   | 137/204 [00:03<00:01, 40.57it/s] 70%|██████▉   | 142/204 [00:04<00:01, 41.46it/s] 72%|███████▏  | 147/204 [00:04<00:01, 41.76it/s] 75%|███████▍  | 152/204 [00:04<00:01, 39.97it/s] 77%|███████▋  | 157/204 [00:04<00:01, 39.83it/s] 79%|███████▉  | 161/204 [00:04<00:01, 39.43it/s] 81%|████████▏ | 166/204 [00:04<00:00, 39.73it/s] 84%|████████▍ | 171/204 [00:04<00:00, 39.49it/s] 86%|████████▋ | 176/204 [00:04<00:00, 39.94it/s] 89%|████████▊ | 181/204 [00:05<00:00, 40.61it/s] 91%|█████████ | 186/204 [00:05<00:00, 40.96it/s] 94%|█████████▎| 191/204 [00:05<00:00, 41.21it/s] 96%|█████████▌| 196/204 [00:05<00:00, 41.34it/s] 99%|█████████▊| 201/204 [00:05<00:00, 41.51it/s]100%|██████████| 204/204 [00:05<00:00, 36.64it/s]
26032 images processed, 5.62126350402832 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<01:08,  1.14it/s]  8%|▊         | 6/79 [00:01<00:09,  7.70it/s] 13%|█▎        | 10/79 [00:01<00:05, 12.89it/s] 18%|█▊        | 14/79 [00:01<00:03, 17.82it/s] 23%|██▎       | 18/79 [00:01<00:02, 22.47it/s] 29%|██▉       | 23/79 [00:01<00:02, 27.31it/s] 34%|███▍      | 27/79 [00:01<00:01, 29.57it/s] 39%|███▉      | 31/79 [00:01<00:01, 31.83it/s] 46%|████▌     | 36/79 [00:01<00:01, 34.87it/s] 51%|█████     | 40/79 [00:01<00:01, 35.98it/s] 56%|█████▌    | 44/79 [00:01<00:00, 36.65it/s] 62%|██████▏   | 49/79 [00:02<00:00, 38.06it/s] 68%|██████▊   | 54/79 [00:02<00:00, 39.23it/s] 75%|███████▍  | 59/79 [00:02<00:00, 39.98it/s] 81%|████████  | 64/79 [00:02<00:00, 40.52it/s] 87%|████████▋ | 69/79 [00:02<00:00, 40.91it/s] 94%|█████████▎| 74/79 [00:02<00:00, 41.16it/s]100%|██████████| 79/79 [00:02<00:00, 43.29it/s]100%|██████████| 79/79 [00:02<00:00, 28.25it/s]
10000 images processed, 2.8349876403808594 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:47,  1.63it/s]  6%|▋         | 5/79 [00:00<00:08,  8.80it/s] 13%|█▎        | 10/79 [00:00<00:04, 16.79it/s] 18%|█▊        | 14/79 [00:00<00:02, 21.98it/s] 24%|██▍       | 19/79 [00:01<00:02, 27.28it/s] 29%|██▉       | 23/79 [00:01<00:01, 30.27it/s] 34%|███▍      | 27/79 [00:01<00:01, 32.61it/s] 41%|████      | 32/79 [00:01<00:01, 35.23it/s] 47%|████▋     | 37/79 [00:01<00:01, 37.21it/s] 53%|█████▎    | 42/79 [00:01<00:00, 38.60it/s] 61%|██████    | 48/79 [00:01<00:00, 42.08it/s] 67%|██████▋   | 53/79 [00:01<00:00, 41.78it/s] 73%|███████▎  | 58/79 [00:01<00:00, 41.77it/s] 80%|███████▉  | 63/79 [00:02<00:00, 41.78it/s] 86%|████████▌ | 68/79 [00:02<00:00, 41.78it/s] 92%|█████████▏| 73/79 [00:02<00:00, 42.09it/s] 99%|█████████▊| 78/79 [00:02<00:00, 42.00it/s]100%|██████████| 79/79 [00:02<00:00, 31.99it/s]
10000 images processed, 2.4913511276245117 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:42,  1.60it/s]  7%|▋         | 5/70 [00:00<00:07,  8.68it/s] 14%|█▍        | 10/70 [00:00<00:03, 16.81it/s] 21%|██▏       | 15/70 [00:00<00:02, 24.08it/s] 29%|██▊       | 20/70 [00:01<00:01, 28.95it/s] 36%|███▌      | 25/70 [00:01<00:01, 32.42it/s] 43%|████▎     | 30/70 [00:01<00:01, 34.94it/s] 50%|█████     | 35/70 [00:01<00:00, 36.95it/s] 57%|█████▋    | 40/70 [00:01<00:00, 38.49it/s] 64%|██████▍   | 45/70 [00:01<00:00, 39.44it/s] 71%|███████▏  | 50/70 [00:01<00:00, 40.13it/s] 79%|███████▊  | 55/70 [00:01<00:00, 40.60it/s] 86%|████████▌ | 60/70 [00:02<00:00, 40.95it/s] 93%|█████████▎| 65/70 [00:02<00:00, 43.05it/s]100%|██████████| 70/70 [00:02<00:00, 42.84it/s]100%|██████████| 70/70 [00:02<00:00, 31.15it/s]
8925 images processed, 2.279001235961914 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:01<00:56,  1.28s/it] 11%|█         | 5/45 [00:01<00:08,  4.71it/s] 22%|██▏       | 10/45 [00:01<00:03, 10.05it/s] 33%|███▎      | 15/45 [00:01<00:01, 15.48it/s] 42%|████▏     | 19/45 [00:01<00:01, 14.15it/s] 51%|█████     | 23/45 [00:02<00:01, 17.47it/s] 62%|██████▏   | 28/45 [00:02<00:00, 22.28it/s] 73%|███████▎  | 33/45 [00:02<00:00, 17.53it/s] 84%|████████▍ | 38/45 [00:02<00:00, 21.69it/s] 96%|█████████▌| 43/45 [00:02<00:00, 25.66it/s]100%|██████████| 45/45 [00:02<00:00, 15.62it/s]
5640 images processed, 2.9015913009643555 seconds used

29.549842357635498
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/umap/umap_.py:1952: UserWarning: n_jobs value 1 overridden to 1 by setting random_state. Use no seed for parallelism.
  warn(
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/umap/umap_.py:1952: UserWarning: n_jobs value 1 overridden to 1 by setting random_state. Use no seed for parallelism.
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.55  99.36
places365     68.45  80.52
LSUN          22.01  94.99
iSUN          72.53  81.45
dtd           38.40  91.28
AVG           40.79  89.52
Retain-Acc: 0.7485
Forget-as-OOD (retain known vs forget novel):
  FPR: 55.20 AUROC: 88.46 AUIN: 99.25
17.798415899276733
[umap] saved to figs/umap_CIFAR-100_resnet34_top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stage1-inc1_domain.png
[umap] saved to figs/umap_CIFAR-100_resnet34_top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stage1-inc1_rf.png
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stage1-seen: Number of model parameters: 21843904
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<02:46,  2.34it/s]  2%|▏         | 6/391 [00:00<00:27, 13.90it/s]  3%|▎         | 11/391 [00:00<00:16, 22.74it/s]  4%|▍         | 16/391 [00:00<00:12, 29.06it/s]  5%|▌         | 21/391 [00:00<00:10, 33.94it/s]  7%|▋         | 26/391 [00:00<00:09, 37.07it/s]  8%|▊         | 31/391 [00:01<00:09, 39.69it/s]  9%|▉         | 36/391 [00:01<00:08, 41.59it/s] 10%|█         | 41/391 [00:01<00:08, 42.94it/s] 12%|█▏        | 47/391 [00:01<00:07, 45.67it/s] 13%|█▎        | 52/391 [00:01<00:07, 45.83it/s] 15%|█▍        | 57/391 [00:01<00:07, 45.92it/s] 16%|█▌        | 62/391 [00:01<00:07, 46.08it/s] 17%|█▋        | 67/391 [00:01<00:07, 46.14it/s] 18%|█▊        | 72/391 [00:01<00:06, 46.19it/s] 20%|█▉        | 77/391 [00:02<00:06, 46.20it/s] 21%|██        | 83/391 [00:02<00:06, 48.02it/s] 23%|██▎       | 88/391 [00:02<00:06, 47.18it/s] 24%|██▍       | 93/391 [00:02<00:06, 46.93it/s] 25%|██▌       | 98/391 [00:02<00:06, 46.69it/s] 26%|██▋       | 103/391 [00:02<00:06, 47.60it/s] 28%|██▊       | 108/391 [00:02<00:05, 47.33it/s] 29%|██▉       | 113/391 [00:02<00:05, 46.95it/s] 30%|███       | 118/391 [00:02<00:05, 46.45it/s] 31%|███▏      | 123/391 [00:03<00:05, 46.09it/s] 33%|███▎      | 128/391 [00:03<00:05, 46.14it/s] 34%|███▍      | 133/391 [00:03<00:05, 46.12it/s] 35%|███▌      | 138/391 [00:03<00:05, 46.35it/s] 37%|███▋      | 143/391 [00:03<00:05, 45.75it/s] 38%|███▊      | 148/391 [00:03<00:05, 45.87it/s] 39%|███▉      | 153/391 [00:03<00:05, 45.18it/s] 40%|████      | 158/391 [00:03<00:05, 45.47it/s] 42%|████▏     | 163/391 [00:03<00:05, 45.40it/s] 43%|████▎     | 169/391 [00:04<00:04, 47.18it/s] 45%|████▍     | 174/391 [00:04<00:04, 46.59it/s] 46%|████▌     | 179/391 [00:04<00:04, 46.51it/s] 47%|████▋     | 184/391 [00:04<00:04, 46.39it/s] 48%|████▊     | 189/391 [00:04<00:04, 46.31it/s] 50%|████▉     | 194/391 [00:04<00:04, 46.27it/s] 51%|█████     | 199/391 [00:04<00:04, 46.23it/s] 52%|█████▏    | 204/391 [00:04<00:04, 45.97it/s] 53%|█████▎    | 209/391 [00:04<00:03, 45.75it/s] 55%|█████▍    | 214/391 [00:05<00:03, 45.89it/s] 56%|█████▌    | 219/391 [00:05<00:03, 45.67it/s] 57%|█████▋    | 224/391 [00:05<00:03, 45.81it/s] 59%|█████▉    | 230/391 [00:05<00:03, 47.38it/s] 60%|██████    | 235/391 [00:05<00:03, 45.71it/s] 61%|██████▏   | 240/391 [00:05<00:03, 45.84it/s] 63%|██████▎   | 245/391 [00:05<00:03, 45.92it/s] 64%|██████▍   | 250/391 [00:05<00:03, 45.81it/s] 65%|██████▌   | 255/391 [00:05<00:03, 44.58it/s] 66%|██████▋   | 260/391 [00:06<00:02, 45.05it/s] 68%|██████▊   | 266/391 [00:06<00:02, 46.95it/s] 69%|██████▉   | 271/391 [00:06<00:02, 46.76it/s] 71%|███████   | 276/391 [00:06<00:02, 46.58it/s] 72%|███████▏  | 281/391 [00:06<00:02, 46.41it/s] 73%|███████▎  | 286/391 [00:06<00:02, 46.63it/s] 74%|███████▍  | 291/391 [00:06<00:02, 46.48it/s] 76%|███████▌  | 296/391 [00:06<00:02, 45.04it/s] 77%|███████▋  | 301/391 [00:06<00:01, 45.38it/s] 79%|███████▊  | 307/391 [00:07<00:01, 46.78it/s] 80%|███████▉  | 312/391 [00:07<00:01, 46.60it/s] 81%|████████  | 317/391 [00:07<00:01, 46.44it/s] 82%|████████▏ | 322/391 [00:07<00:01, 46.39it/s] 84%|████████▎ | 327/391 [00:07<00:01, 45.25it/s] 85%|████████▍ | 332/391 [00:07<00:01, 45.26it/s] 86%|████████▌ | 337/391 [00:07<00:01, 45.74it/s] 87%|████████▋ | 342/391 [00:07<00:01, 45.61it/s] 89%|████████▊ | 347/391 [00:07<00:00, 45.51it/s] 90%|█████████ | 352/391 [00:08<00:00, 45.72it/s] 91%|█████████▏| 357/391 [00:08<00:00, 45.78it/s] 93%|█████████▎| 362/391 [00:08<00:00, 45.66it/s] 94%|█████████▍| 368/391 [00:08<00:00, 47.80it/s] 95%|█████████▌| 373/391 [00:08<00:00, 47.33it/s] 97%|█████████▋| 378/391 [00:08<00:00, 47.02it/s] 98%|█████████▊| 383/391 [00:08<00:00, 46.79it/s] 99%|█████████▉| 388/391 [00:08<00:00, 46.60it/s]100%|██████████| 391/391 [00:08<00:00, 44.15it/s]
50000 images processed, 8.962888479232788 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:44,  1.74it/s]  5%|▌         | 4/79 [00:00<00:10,  7.22it/s] 11%|█▏        | 9/79 [00:00<00:04, 16.26it/s] 18%|█▊        | 14/79 [00:00<00:02, 23.12it/s] 24%|██▍       | 19/79 [00:01<00:02, 29.03it/s] 30%|███       | 24/79 [00:01<00:01, 33.66it/s] 37%|███▋      | 29/79 [00:01<00:01, 36.76it/s] 43%|████▎     | 34/79 [00:01<00:01, 39.44it/s] 49%|████▉     | 39/79 [00:01<00:00, 41.33it/s] 56%|█████▌    | 44/79 [00:01<00:00, 42.77it/s] 62%|██████▏   | 49/79 [00:01<00:00, 43.78it/s] 68%|██████▊   | 54/79 [00:01<00:00, 44.52it/s] 75%|███████▍  | 59/79 [00:01<00:00, 45.01it/s] 81%|████████  | 64/79 [00:01<00:00, 45.43it/s] 87%|████████▋ | 69/79 [00:02<00:00, 45.67it/s] 94%|█████████▎| 74/79 [00:02<00:00, 45.81it/s]100%|██████████| 79/79 [00:02<00:00, 46.14it/s]100%|██████████| 79/79 [00:02<00:00, 34.02it/s]
10000 images processed, 2.3409321308135986 seconds used

Saved forget OOD features to cache/resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stage1-seen/CIFAR-100/forget
Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:49,  1.86it/s]  3%|▎         | 6/204 [00:00<00:17, 11.40it/s]  5%|▌         | 11/204 [00:00<00:10, 19.16it/s]  7%|▋         | 15/204 [00:00<00:07, 23.78it/s] 10%|▉         | 20/204 [00:01<00:06, 28.86it/s] 12%|█▏        | 25/204 [00:01<00:05, 32.57it/s] 14%|█▍        | 29/204 [00:01<00:05, 34.45it/s] 17%|█▋        | 34/204 [00:01<00:04, 36.67it/s] 19%|█▉        | 39/204 [00:01<00:04, 39.54it/s] 22%|██▏       | 44/204 [00:01<00:03, 40.26it/s] 24%|██▍       | 49/204 [00:01<00:03, 40.06it/s] 26%|██▋       | 54/204 [00:01<00:03, 40.57it/s] 29%|██▉       | 59/204 [00:01<00:03, 40.91it/s] 31%|███▏      | 64/204 [00:02<00:03, 40.78it/s] 34%|███▍      | 69/204 [00:02<00:03, 40.66it/s] 36%|███▋      | 74/204 [00:02<00:03, 40.75it/s] 39%|███▊      | 79/204 [00:02<00:03, 40.81it/s] 41%|████      | 84/204 [00:02<00:02, 40.88it/s] 44%|████▎     | 89/204 [00:02<00:02, 42.82it/s] 46%|████▌     | 94/204 [00:02<00:02, 42.49it/s] 49%|████▊     | 99/204 [00:02<00:02, 42.28it/s] 51%|█████     | 104/204 [00:03<00:02, 41.70it/s] 53%|█████▎    | 109/204 [00:03<00:02, 41.72it/s] 56%|█████▌    | 114/204 [00:03<00:02, 41.87it/s] 58%|█████▊    | 119/204 [00:03<00:02, 41.87it/s] 61%|██████    | 124/204 [00:03<00:01, 41.85it/s] 63%|██████▎   | 129/204 [00:03<00:01, 41.86it/s] 66%|██████▌   | 134/204 [00:03<00:01, 41.85it/s] 68%|██████▊   | 139/204 [00:03<00:01, 42.10it/s] 71%|███████   | 144/204 [00:03<00:01, 42.15it/s] 73%|███████▎  | 149/204 [00:04<00:01, 40.60it/s] 75%|███████▌  | 154/204 [00:04<00:01, 40.06it/s] 78%|███████▊  | 159/204 [00:04<00:01, 41.82it/s] 80%|████████  | 164/204 [00:04<00:00, 41.56it/s] 83%|████████▎ | 169/204 [00:04<00:00, 41.63it/s] 85%|████████▌ | 174/204 [00:04<00:00, 41.01it/s] 88%|████████▊ | 179/204 [00:04<00:00, 41.24it/s] 90%|█████████ | 184/204 [00:04<00:00, 41.50it/s] 93%|█████████▎| 189/204 [00:05<00:00, 41.58it/s] 95%|█████████▌| 194/204 [00:05<00:00, 41.63it/s] 98%|█████████▊| 199/204 [00:05<00:00, 41.66it/s]100%|██████████| 204/204 [00:05<00:00, 42.53it/s]100%|██████████| 204/204 [00:05<00:00, 37.67it/s]
26032 images processed, 5.456426382064819 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:49,  1.59it/s]  8%|▊         | 6/79 [00:00<00:07, 10.17it/s] 14%|█▍        | 11/79 [00:00<00:03, 17.55it/s] 20%|██        | 16/79 [00:00<00:02, 23.60it/s] 27%|██▋       | 21/79 [00:01<00:02, 28.38it/s] 33%|███▎      | 26/79 [00:01<00:01, 32.05it/s] 39%|███▉      | 31/79 [00:01<00:01, 34.70it/s] 46%|████▌     | 36/79 [00:01<00:01, 36.55it/s] 52%|█████▏    | 41/79 [00:01<00:00, 38.07it/s] 58%|█████▊    | 46/79 [00:01<00:00, 39.87it/s] 65%|██████▍   | 51/79 [00:01<00:00, 40.78it/s] 71%|███████   | 56/79 [00:01<00:00, 41.10it/s] 77%|███████▋  | 61/79 [00:02<00:00, 41.32it/s] 84%|████████▎ | 66/79 [00:02<00:00, 41.49it/s] 90%|████████▉ | 71/79 [00:02<00:00, 41.59it/s] 96%|█████████▌| 76/79 [00:02<00:00, 41.78it/s]100%|██████████| 79/79 [00:02<00:00, 31.99it/s]
10000 images processed, 2.506031036376953 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:50,  1.53it/s]  6%|▋         | 5/79 [00:00<00:08,  8.41it/s] 13%|█▎        | 10/79 [00:00<00:04, 16.45it/s] 19%|█▉        | 15/79 [00:00<00:02, 22.85it/s] 25%|██▌       | 20/79 [00:01<00:02, 27.74it/s] 32%|███▏      | 25/79 [00:01<00:01, 31.43it/s] 38%|███▊      | 30/79 [00:01<00:01, 34.31it/s] 44%|████▍     | 35/79 [00:01<00:01, 36.52it/s] 51%|█████     | 40/79 [00:01<00:01, 38.06it/s] 57%|█████▋    | 45/79 [00:01<00:00, 39.12it/s] 63%|██████▎   | 50/79 [00:01<00:00, 39.91it/s] 70%|██████▉   | 55/79 [00:01<00:00, 40.46it/s] 76%|███████▌  | 60/79 [00:02<00:00, 42.46it/s] 82%|████████▏ | 65/79 [00:02<00:00, 42.65it/s] 89%|████████▊ | 70/79 [00:02<00:00, 42.38it/s] 95%|█████████▍| 75/79 [00:02<00:00, 42.20it/s]100%|██████████| 79/79 [00:02<00:00, 31.81it/s]
10000 images processed, 2.5071840286254883 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:38,  1.80it/s]  6%|▌         | 4/70 [00:00<00:08,  7.41it/s] 13%|█▎        | 9/70 [00:00<00:03, 16.17it/s] 20%|██        | 14/70 [00:00<00:02, 23.00it/s] 27%|██▋       | 19/70 [00:01<00:01, 28.24it/s] 34%|███▍      | 24/70 [00:01<00:01, 32.05it/s] 41%|████▏     | 29/70 [00:01<00:01, 34.67it/s] 49%|████▊     | 34/70 [00:01<00:00, 36.75it/s] 56%|█████▌    | 39/70 [00:01<00:00, 38.05it/s] 64%|██████▍   | 45/70 [00:01<00:00, 41.24it/s] 71%|███████▏  | 50/70 [00:01<00:00, 41.35it/s] 79%|███████▊  | 55/70 [00:01<00:00, 41.20it/s] 86%|████████▌ | 60/70 [00:01<00:00, 41.61it/s] 93%|█████████▎| 65/70 [00:02<00:00, 41.65it/s]100%|██████████| 70/70 [00:02<00:00, 41.87it/s]100%|██████████| 70/70 [00:02<00:00, 31.41it/s]
8925 images processed, 2.2653145790100098 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:01<00:53,  1.23s/it] 11%|█         | 5/45 [00:01<00:08,  4.85it/s] 18%|█▊        | 8/45 [00:01<00:04,  7.81it/s] 29%|██▉       | 13/45 [00:01<00:02, 13.69it/s] 38%|███▊      | 17/45 [00:01<00:01, 14.22it/s] 49%|████▉     | 22/45 [00:01<00:01, 19.28it/s] 56%|█████▌    | 25/45 [00:02<00:01, 19.64it/s] 67%|██████▋   | 30/45 [00:02<00:00, 24.57it/s] 76%|███████▌  | 34/45 [00:02<00:00, 18.20it/s] 87%|████████▋ | 39/45 [00:02<00:00, 22.77it/s] 98%|█████████▊| 44/45 [00:02<00:00, 26.85it/s]100%|██████████| 45/45 [00:02<00:00, 15.82it/s]
5640 images processed, 2.8750267028808594 seconds used

28.530700206756592
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/umap/umap_.py:1952: UserWarning: n_jobs value 1 overridden to 1 by setting random_state. Use no seed for parallelism.
  warn(
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/umap/umap_.py:1952: UserWarning: n_jobs value 1 overridden to 1 by setting random_state. Use no seed for parallelism.
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.55  99.36
places365     68.45  80.52
LSUN          22.01  94.99
iSUN          72.53  81.45
dtd           38.40  91.28
AVG           40.79  89.52
Retain-Acc: 0.7485
Forget-as-OOD (retain known vs forget novel):
  FPR: 55.20 AUROC: 88.46 AUIN: 99.25
15.177860736846924
[umap] saved to figs/umap_CIFAR-100_resnet34_top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stage1-seen_domain.png
[umap] saved to figs/umap_CIFAR-100_resnet34_top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stage1-seen_rf.png
==== Stage 2: forget_inc={66,67,88,94,57}; forget_seen={0,8,11,40,51}; all={0,8,11,40,51,66,67,88,94,57} ====
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
/home/shaokun/PALM/main.py:54: FutureWarning: `torch.cuda.amp.GradScaler(args...)` is deprecated. Please use `torch.amp.GradScaler('cuda', args...)` instead.
  scaler = torch.cuda.amp.GradScaler()
Namespace(in_dataset='CIFAR-100', out_datasets=['inat', 'sun50', 'places50', 'dtd'], backbone='resnet34', method='top5-palm-cache6-ema0.999', seed=1, gpu='0', epochs=5, batch_size=128, lr=0.001, weight_decay=0.0001, print_every=50, fine_tune=False, temp=0.08, cosine=True, warm=False, lr_decay_epochs='700,800,900', lr_decay_rate=0.1, layers=100, depth=40, width=4, growth=12, droprate=0.0, save_path='CIFAR-10-ResNet18.pt', load_path='checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt', reduce=0.5, score='mahalanobis', threshold=1.0, k=5, momentum=0.9, proto_m=0.999, cache_size=6, nviews=2, lambda_pcon=1.0, epsilon=0.05, incremental=False, use_lora=True, lora_impl='peft', lora_r=8, lora_alpha=32, lora_dropout=0.05, lora_target='both', adapter_save_path='checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stack/stage2', adapter_load_path='checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stack/stage1', adapter_load_paths=None, lora_new_adapter_name=None, lora_stack=False, lora_orth_enable=False, lora_orth_lambda=0.1, lora_orth_ref_paths=None, forget_classes='0,8,11,40,51,66,67,88,94,57', forget_list_path=None, forget_classes_inc='66,67,88,94,57', forget_classes_seen='0,8,11,40,51', retain_exclude_csv=None, forget_csv=None, forget_lambda=0.2, forget_margin=100.0, forget_strategy='proto', centers_path=None, precision_path=None, batch_forget_mode='balanced', forget_proto_enable=False, forget_attr_w=1.0, forget_proto_rep_w=1.0, forget_avgproto_enable=False, forget_avgproto_w=1.0, umap_enable=False, umap_by='domain', umap_max_points=20000, umap_neighbors=15, umap_min_dist=0.05, umap_metric='cosine', umap_save_path=None, umap_rf_only=False, keep_cache=False, argument=True)
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
[peft] adapter loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stack/stage1
[peft] active adapters set to: default
resnet34-top5-palm-cache6-ema0.999: Number of model parameters: 21843904
[debug] trainable_count = 16
[debug] trainable: base_model.model.encoder.layer4.0.conv1.lora_A.default.weight
[debug] trainable: base_model.model.encoder.layer4.0.conv1.lora_B.default.weight
[debug] trainable: base_model.model.encoder.layer4.0.conv2.lora_A.default.weight
[debug] trainable: base_model.model.encoder.layer4.0.conv2.lora_B.default.weight
[debug] trainable: base_model.model.encoder.layer4.0.shortcut.0.lora_A.default.weight
[debug] trainable: base_model.model.encoder.layer4.0.shortcut.0.lora_B.default.weight
[debug] trainable: base_model.model.encoder.layer4.1.conv1.lora_A.default.weight
[debug] trainable: base_model.model.encoder.layer4.1.conv1.lora_B.default.weight
[debug] trainable: base_model.model.encoder.layer4.1.conv2.lora_A.default.weight
[debug] trainable: base_model.model.encoder.layer4.1.conv2.lora_B.default.weight
[debug] trainable: base_model.model.encoder.layer4.2.conv1.lora_A.default.weight
[debug] trainable: base_model.model.encoder.layer4.2.conv1.lora_B.default.weight
[debug] trainable: base_model.model.encoder.layer4.2.conv2.lora_A.default.weight
[debug] trainable: base_model.model.encoder.layer4.2.conv2.lora_B.default.weight
[debug] trainable: base_model.model.head.2.lora_A.default.weight
[debug] trainable: base_model.model.head.2.lora_B.default.weight
[debug][warn] non-LoRA trainables detected: ['base_model.model.encoder.layer4.0.conv1.lora_A.default.weight', 'base_model.model.encoder.layer4.0.conv1.lora_B.default.weight', 'base_model.model.encoder.layer4.0.conv2.lora_A.default.weight', 'base_model.model.encoder.layer4.0.conv2.lora_B.default.weight', 'base_model.model.encoder.layer4.0.shortcut.0.lora_A.default.weight', 'base_model.model.encoder.layer4.0.shortcut.0.lora_B.default.weight', 'base_model.model.encoder.layer4.1.conv1.lora_A.default.weight', 'base_model.model.encoder.layer4.1.conv1.lora_B.default.weight', 'base_model.model.encoder.layer4.1.conv2.lora_A.default.weight', 'base_model.model.encoder.layer4.1.conv2.lora_B.default.weight']
  0%|          | 0/5 [00:00<?, ?it/s]/home/shaokun/PALM/trainer.py:139: FutureWarning: `torch.cuda.amp.autocast(args...)` is deprecated. Please use `torch.amp.autocast('cuda', args...)` instead.
  with torch.cuda.amp.autocast():
 20%|██        | 1/5 [02:18<09:13, 138.25s/it] 40%|████      | 2/5 [02:56<03:58, 79.61s/it]  60%|██████    | 3/5 [03:32<01:59, 59.60s/it] 80%|████████  | 4/5 [04:11<00:51, 51.41s/it]100%|██████████| 5/5 [04:47<00:00, 45.86s/it]100%|██████████| 5/5 [04:47<00:00, 57.49s/it]
[loss] ep 0 it 0 total=8.5689 mle=1.8546 pcon=5.2951 forget=1.4192 favg=0.0000 nr=36 nf=36 protos=540 fproto_sim=NA
[loss] ep 0 it 50 total=8.5196 mle=1.7892 pcon=5.2896 forget=1.4408 favg=0.0000 nr=34 nf=34 protos=540 fproto_sim=NA
[loss] ep 0 it 100 total=8.7295 mle=2.0094 pcon=5.2844 forget=1.4357 favg=0.0000 nr=34 nf=34 protos=540 fproto_sim=NA
[loss] ep 0 it 150 total=8.8011 mle=2.0264 pcon=5.2793 forget=1.4954 favg=0.0000 nr=32 nf=32 protos=540 fproto_sim=NA
[loss] ep 0 it 200 total=8.8595 mle=2.0852 pcon=5.2739 forget=1.5004 favg=0.0000 nr=34 nf=34 protos=540 fproto_sim=NA
[loss] ep 0 it 250 total=8.5580 mle=1.8913 pcon=5.2687 forget=1.3980 favg=0.0000 nr=30 nf=30 protos=540 fproto_sim=NA
[loss] ep 0 it 300 total=8.8357 mle=2.1138 pcon=5.2638 forget=1.4582 favg=0.0000 nr=34 nf=34 protos=540 fproto_sim=NA
[loss] ep 0 it 350 total=8.7720 mle=2.0904 pcon=5.2590 forget=1.4227 favg=0.0000 nr=30 nf=30 protos=540 fproto_sim=NA
[peft] adapter saved to checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stack/stage2
[loss] ep 1 it 10 total=8.7496 mle=2.0075 pcon=5.2542 forget=1.4879 favg=0.0000 nr=23 nf=23 protos=540 fproto_sim=NA
[loss] ep 1 it 60 total=8.6660 mle=2.0269 pcon=5.2492 forget=1.3899 favg=0.0000 nr=38 nf=38 protos=540 fproto_sim=NA
[loss] ep 1 it 110 total=8.5530 mle=1.8869 pcon=5.2444 forget=1.4217 favg=0.0000 nr=34 nf=34 protos=540 fproto_sim=NA
[loss] ep 1 it 160 total=8.4633 mle=1.8167 pcon=5.2399 forget=1.4067 favg=0.0000 nr=32 nf=32 protos=540 fproto_sim=NA
[loss] ep 1 it 210 total=8.6865 mle=2.0674 pcon=5.2354 forget=1.3837 favg=0.0000 nr=32 nf=32 protos=540 fproto_sim=NA
[loss] ep 1 it 260 total=8.3655 mle=1.7562 pcon=5.2306 forget=1.3787 favg=0.0000 nr=34 nf=34 protos=540 fproto_sim=NA
[loss] ep 1 it 310 total=8.5931 mle=1.9315 pcon=5.2259 forget=1.4357 favg=0.0000 nr=28 nf=28 protos=540 fproto_sim=NA
[loss] ep 1 it 360 total=8.8932 mle=2.2033 pcon=5.2213 forget=1.4686 favg=0.0000 nr=31 nf=31 protos=540 fproto_sim=NA
[peft] adapter saved to checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stack/stage2
[loss] ep 2 it 20 total=8.6496 mle=1.9629 pcon=5.2169 forget=1.4698 favg=0.0000 nr=26 nf=26 protos=540 fproto_sim=NA
[loss] ep 2 it 70 total=8.3297 mle=1.6986 pcon=5.2124 forget=1.4187 favg=0.0000 nr=32 nf=32 protos=540 fproto_sim=NA
[loss] ep 2 it 120 total=8.7301 mle=2.0820 pcon=5.2082 forget=1.4400 favg=0.0000 nr=24 nf=24 protos=540 fproto_sim=NA
[loss] ep 2 it 170 total=8.3396 mle=1.7272 pcon=5.2042 forget=1.4083 favg=0.0000 nr=40 nf=40 protos=540 fproto_sim=NA
[loss] ep 2 it 220 total=8.5910 mle=1.9651 pcon=5.1998 forget=1.4260 favg=0.0000 nr=37 nf=37 protos=540 fproto_sim=NA
[loss] ep 2 it 270 total=8.6747 mle=2.0385 pcon=5.1957 forget=1.4405 favg=0.0000 nr=29 nf=29 protos=540 fproto_sim=NA
[loss] ep 2 it 320 total=8.3062 mle=1.6926 pcon=5.1915 forget=1.4220 favg=0.0000 nr=31 nf=31 protos=540 fproto_sim=NA
[loss] ep 2 it 370 total=8.6115 mle=2.0139 pcon=5.1878 forget=1.4098 favg=0.0000 nr=35 nf=35 protos=540 fproto_sim=NA
[peft] adapter saved to checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stack/stage2
[loss] ep 3 it 30 total=8.6371 mle=2.0422 pcon=5.1839 forget=1.4109 favg=0.0000 nr=36 nf=36 protos=540 fproto_sim=NA
[loss] ep 3 it 80 total=8.7356 mle=2.1656 pcon=5.1801 forget=1.3899 favg=0.0000 nr=30 nf=30 protos=540 fproto_sim=NA
[loss] ep 3 it 130 total=8.2954 mle=1.6921 pcon=5.1763 forget=1.4270 favg=0.0000 nr=34 nf=34 protos=540 fproto_sim=NA
[loss] ep 3 it 180 total=8.5920 mle=1.9566 pcon=5.1724 forget=1.4631 favg=0.0000 nr=23 nf=23 protos=540 fproto_sim=NA
[loss] ep 3 it 230 total=8.4638 mle=1.8763 pcon=5.1687 forget=1.4188 favg=0.0000 nr=32 nf=32 protos=540 fproto_sim=NA
[loss] ep 3 it 280 total=8.6193 mle=2.0394 pcon=5.1651 forget=1.4148 favg=0.0000 nr=31 nf=31 protos=540 fproto_sim=NA
[loss] ep 3 it 330 total=8.5681 mle=2.0144 pcon=5.1611 forget=1.3925 favg=0.0000 nr=39 nf=39 protos=540 fproto_sim=NA
[loss] ep 3 it 380 total=8.2768 mle=1.7360 pcon=5.1574 forget=1.3835 favg=0.0000 nr=35 nf=35 protos=540 fproto_sim=NA
[peft] adapter saved to checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stack/stage2
[loss] ep 4 it 40 total=8.6476 mle=2.0713 pcon=5.1536 forget=1.4227 favg=0.0000 nr=30 nf=30 protos=540 fproto_sim=NA
[loss] ep 4 it 90 total=8.4725 mle=1.9273 pcon=5.1501 forget=1.3951 favg=0.0000 nr=23 nf=23 protos=540 fproto_sim=NA
[loss] ep 4 it 140 total=8.4584 mle=1.8875 pcon=5.1466 forget=1.4242 favg=0.0000 nr=31 nf=31 protos=540 fproto_sim=NA
[loss] ep 4 it 190 total=8.2429 mle=1.6922 pcon=5.1430 forget=1.4077 favg=0.0000 nr=39 nf=39 protos=540 fproto_sim=NA
[loss] ep 4 it 240 total=8.7706 mle=2.2079 pcon=5.1395 forget=1.4233 favg=0.0000 nr=36 nf=36 protos=540 fproto_sim=NA
[loss] ep 4 it 290 total=8.2612 mle=1.7448 pcon=5.1362 forget=1.3802 favg=0.0000 nr=35 nf=35 protos=540 fproto_sim=NA
[loss] ep 4 it 340 total=8.6738 mle=2.0942 pcon=5.1328 forget=1.4468 favg=0.0000 nr=35 nf=35 protos=540 fproto_sim=NA
[peft] adapter saved to checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stack/stage2
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stage2-inc1: Number of model parameters: 21843904
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<03:18,  1.96it/s]  2%|▏         | 6/391 [00:00<00:31, 12.24it/s]  3%|▎         | 12/391 [00:00<00:16, 22.39it/s]  4%|▍         | 17/391 [00:00<00:13, 28.51it/s]  6%|▌         | 22/391 [00:00<00:11, 33.11it/s]  7%|▋         | 27/391 [00:01<00:09, 36.54it/s]  8%|▊         | 32/391 [00:01<00:09, 38.17it/s]  9%|▉         | 37/391 [00:01<00:08, 39.35it/s] 11%|█         | 42/391 [00:01<00:08, 39.96it/s] 12%|█▏        | 47/391 [00:01<00:08, 39.93it/s] 13%|█▎        | 52/391 [00:01<00:08, 41.21it/s] 15%|█▍        | 57/391 [00:01<00:08, 41.67it/s] 16%|█▌        | 62/391 [00:01<00:07, 42.45it/s] 17%|█▋        | 68/391 [00:02<00:07, 44.86it/s] 19%|█▊        | 73/391 [00:02<00:07, 44.94it/s] 20%|█▉        | 78/391 [00:02<00:06, 44.91it/s] 21%|██        | 83/391 [00:02<00:06, 45.34it/s] 23%|██▎       | 88/391 [00:02<00:06, 46.45it/s] 24%|██▍       | 93/391 [00:02<00:06, 45.82it/s] 25%|██▌       | 98/391 [00:02<00:06, 45.38it/s] 26%|██▋       | 103/391 [00:02<00:06, 44.63it/s] 28%|██▊       | 108/391 [00:02<00:06, 45.08it/s] 29%|██▉       | 113/391 [00:03<00:06, 43.88it/s] 30%|███       | 118/391 [00:03<00:06, 44.33it/s] 31%|███▏      | 123/391 [00:03<00:05, 45.48it/s] 33%|███▎      | 128/391 [00:03<00:05, 45.44it/s] 34%|███▍      | 133/391 [00:03<00:05, 45.66it/s] 35%|███▌      | 138/391 [00:03<00:05, 45.02it/s] 37%|███▋      | 143/391 [00:03<00:05, 45.37it/s] 38%|███▊      | 148/391 [00:03<00:05, 45.10it/s] 39%|███▉      | 153/391 [00:03<00:05, 45.46it/s] 40%|████      | 158/391 [00:03<00:05, 45.67it/s] 42%|████▏     | 163/391 [00:04<00:04, 45.85it/s] 43%|████▎     | 168/391 [00:04<00:04, 45.95it/s] 44%|████▍     | 173/391 [00:04<00:04, 46.01it/s] 46%|████▌     | 178/391 [00:04<00:04, 46.08it/s] 47%|████▋     | 183/391 [00:04<00:04, 46.73it/s] 48%|████▊     | 188/391 [00:04<00:04, 45.89it/s] 49%|████▉     | 193/391 [00:04<00:04, 45.55it/s] 51%|█████     | 198/391 [00:04<00:04, 44.64it/s] 52%|█████▏    | 203/391 [00:04<00:04, 43.58it/s] 53%|█████▎    | 208/391 [00:05<00:04, 43.10it/s] 54%|█████▍    | 213/391 [00:05<00:04, 43.02it/s] 56%|█████▌    | 218/391 [00:05<00:04, 42.96it/s] 57%|█████▋    | 223/391 [00:05<00:03, 42.21it/s] 58%|█████▊    | 228/391 [00:05<00:03, 42.05it/s] 60%|█████▉    | 233/391 [00:05<00:03, 41.85it/s] 61%|██████    | 238/391 [00:05<00:03, 42.12it/s] 62%|██████▏   | 243/391 [00:05<00:03, 42.58it/s] 63%|██████▎   | 248/391 [00:06<00:03, 43.37it/s] 65%|██████▍   | 253/391 [00:06<00:03, 44.22it/s] 66%|██████▌   | 259/391 [00:06<00:02, 46.55it/s] 68%|██████▊   | 264/391 [00:06<00:02, 46.42it/s] 69%|██████▉   | 269/391 [00:06<00:02, 46.35it/s] 70%|███████   | 274/391 [00:06<00:02, 46.31it/s] 71%|███████▏  | 279/391 [00:06<00:02, 46.00it/s] 73%|███████▎  | 284/391 [00:06<00:02, 45.93it/s] 74%|███████▍  | 289/391 [00:06<00:02, 45.40it/s] 75%|███████▌  | 294/391 [00:07<00:02, 45.11it/s] 76%|███████▋  | 299/391 [00:07<00:02, 44.91it/s] 78%|███████▊  | 304/391 [00:07<00:01, 44.50it/s] 79%|███████▉  | 309/391 [00:07<00:01, 44.00it/s] 80%|████████  | 314/391 [00:07<00:01, 44.81it/s] 82%|████████▏ | 319/391 [00:07<00:01, 44.17it/s] 83%|████████▎ | 324/391 [00:07<00:01, 43.48it/s] 84%|████████▍ | 329/391 [00:07<00:01, 43.98it/s] 85%|████████▌ | 334/391 [00:07<00:01, 44.35it/s] 87%|████████▋ | 339/391 [00:08<00:01, 44.51it/s] 88%|████████▊ | 344/391 [00:08<00:01, 45.02it/s] 89%|████████▉ | 349/391 [00:08<00:00, 45.09it/s] 91%|█████████ | 354/391 [00:08<00:00, 44.94it/s] 92%|█████████▏| 359/391 [00:08<00:00, 44.55it/s] 93%|█████████▎| 364/391 [00:08<00:00, 44.87it/s] 94%|█████████▍| 369/391 [00:08<00:00, 46.03it/s] 96%|█████████▌| 374/391 [00:08<00:00, 46.06it/s] 97%|█████████▋| 379/391 [00:08<00:00, 46.07it/s] 98%|█████████▊| 384/391 [00:09<00:00, 46.12it/s] 99%|█████████▉| 389/391 [00:09<00:00, 46.07it/s]100%|██████████| 391/391 [00:09<00:00, 42.44it/s]
50000 images processed, 9.346778392791748 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:53,  1.44it/s]  8%|▊         | 6/79 [00:00<00:07,  9.41it/s] 14%|█▍        | 11/79 [00:00<00:04, 16.59it/s] 20%|██        | 16/79 [00:01<00:02, 22.50it/s] 27%|██▋       | 21/79 [00:01<00:02, 27.33it/s] 33%|███▎      | 26/79 [00:01<00:01, 31.24it/s] 39%|███▉      | 31/79 [00:01<00:01, 34.53it/s] 46%|████▌     | 36/79 [00:01<00:01, 36.68it/s] 52%|█████▏    | 41/79 [00:01<00:00, 38.95it/s] 58%|█████▊    | 46/79 [00:01<00:00, 40.92it/s] 65%|██████▍   | 51/79 [00:01<00:00, 42.18it/s] 71%|███████   | 56/79 [00:01<00:00, 43.30it/s] 77%|███████▋  | 61/79 [00:02<00:00, 44.10it/s] 84%|████████▎ | 66/79 [00:02<00:00, 44.70it/s] 91%|█████████ | 72/79 [00:02<00:00, 46.88it/s] 97%|█████████▋| 77/79 [00:02<00:00, 46.68it/s]100%|██████████| 79/79 [00:02<00:00, 32.07it/s]
10000 images processed, 2.4843273162841797 seconds used

Saved forget OOD features to cache/resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stage2-inc1/CIFAR-100/forget
Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<02:31,  1.34it/s]  3%|▎         | 6/204 [00:00<00:22,  8.83it/s]  5%|▌         | 11/204 [00:00<00:12, 15.98it/s]  7%|▋         | 15/204 [00:01<00:09, 20.80it/s]  9%|▉         | 19/204 [00:01<00:07, 24.75it/s] 12%|█▏        | 24/204 [00:01<00:06, 29.41it/s] 14%|█▍        | 29/204 [00:01<00:05, 32.81it/s] 17%|█▋        | 34/204 [00:01<00:04, 35.02it/s] 19%|█▊        | 38/204 [00:01<00:04, 36.27it/s] 21%|██        | 43/204 [00:01<00:04, 38.39it/s] 24%|██▎       | 48/204 [00:01<00:03, 39.23it/s] 26%|██▌       | 53/204 [00:02<00:03, 38.95it/s] 28%|██▊       | 58/204 [00:02<00:03, 39.13it/s] 31%|███       | 63/204 [00:02<00:03, 39.75it/s] 33%|███▎      | 68/204 [00:02<00:03, 40.47it/s] 36%|███▌      | 73/204 [00:02<00:03, 40.64it/s] 38%|███▊      | 78/204 [00:02<00:03, 40.10it/s] 41%|████      | 83/204 [00:02<00:03, 40.16it/s] 43%|████▎     | 88/204 [00:02<00:02, 40.02it/s] 46%|████▌     | 93/204 [00:03<00:02, 40.97it/s] 48%|████▊     | 98/204 [00:03<00:02, 41.19it/s] 50%|█████     | 103/204 [00:03<00:02, 41.11it/s] 53%|█████▎    | 108/204 [00:03<00:02, 40.56it/s] 55%|█████▌    | 113/204 [00:03<00:02, 40.65it/s] 58%|█████▊    | 118/204 [00:03<00:02, 40.65it/s] 60%|██████    | 123/204 [00:03<00:01, 40.98it/s] 63%|██████▎   | 128/204 [00:03<00:01, 40.74it/s] 65%|██████▌   | 133/204 [00:03<00:01, 39.99it/s] 68%|██████▊   | 138/204 [00:04<00:01, 39.90it/s] 70%|███████   | 143/204 [00:04<00:01, 41.21it/s] 73%|███████▎  | 148/204 [00:04<00:01, 41.14it/s] 75%|███████▌  | 153/204 [00:04<00:01, 40.09it/s] 77%|███████▋  | 158/204 [00:04<00:01, 40.10it/s] 80%|███████▉  | 163/204 [00:04<00:01, 40.40it/s] 82%|████████▏ | 168/204 [00:04<00:00, 41.14it/s] 85%|████████▍ | 173/204 [00:04<00:00, 40.89it/s] 87%|████████▋ | 178/204 [00:05<00:00, 41.12it/s] 90%|████████▉ | 183/204 [00:05<00:00, 41.28it/s] 92%|█████████▏| 188/204 [00:05<00:00, 41.45it/s] 95%|█████████▍| 193/204 [00:05<00:00, 43.41it/s] 97%|█████████▋| 198/204 [00:05<00:00, 42.54it/s]100%|█████████▉| 203/204 [00:05<00:00, 41.72it/s]100%|██████████| 204/204 [00:05<00:00, 35.79it/s]
26032 images processed, 5.7449421882629395 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<01:13,  1.07it/s]  6%|▋         | 5/79 [00:01<00:11,  6.22it/s] 13%|█▎        | 10/79 [00:01<00:05, 12.73it/s] 19%|█▉        | 15/79 [00:01<00:03, 18.64it/s] 25%|██▌       | 20/79 [00:01<00:02, 23.92it/s] 32%|███▏      | 25/79 [00:01<00:01, 28.29it/s] 38%|███▊      | 30/79 [00:01<00:01, 31.78it/s] 44%|████▍     | 35/79 [00:01<00:01, 34.31it/s] 51%|█████     | 40/79 [00:01<00:01, 37.68it/s] 57%|█████▋    | 45/79 [00:01<00:00, 38.46it/s] 63%|██████▎   | 50/79 [00:02<00:00, 39.40it/s] 70%|██████▉   | 55/79 [00:02<00:00, 40.09it/s] 76%|███████▌  | 60/79 [00:02<00:00, 40.59it/s] 82%|████████▏ | 65/79 [00:02<00:00, 41.08it/s] 89%|████████▊ | 70/79 [00:02<00:00, 41.28it/s] 95%|█████████▍| 75/79 [00:02<00:00, 41.43it/s]100%|██████████| 79/79 [00:02<00:00, 28.33it/s]
10000 images processed, 2.8334269523620605 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:44,  1.77it/s]  8%|▊         | 6/79 [00:00<00:06, 11.04it/s] 14%|█▍        | 11/79 [00:00<00:03, 18.61it/s] 20%|██        | 16/79 [00:00<00:02, 24.65it/s] 27%|██▋       | 21/79 [00:01<00:01, 29.30it/s] 33%|███▎      | 26/79 [00:01<00:01, 32.91it/s] 38%|███▊      | 30/79 [00:01<00:01, 34.49it/s] 44%|████▍     | 35/79 [00:01<00:01, 36.48it/s] 49%|████▉     | 39/79 [00:01<00:01, 37.40it/s] 56%|█████▌    | 44/79 [00:01<00:00, 38.53it/s] 63%|██████▎   | 50/79 [00:01<00:00, 41.68it/s] 70%|██████▉   | 55/79 [00:01<00:00, 41.66it/s] 76%|███████▌  | 60/79 [00:01<00:00, 41.71it/s] 82%|████████▏ | 65/79 [00:02<00:00, 41.71it/s] 89%|████████▊ | 70/79 [00:02<00:00, 41.73it/s] 95%|█████████▍| 75/79 [00:02<00:00, 41.79it/s]100%|██████████| 79/79 [00:02<00:00, 32.72it/s]
10000 images processed, 2.4400887489318848 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:45,  1.51it/s]  9%|▊         | 6/70 [00:00<00:06,  9.73it/s] 16%|█▌        | 11/70 [00:00<00:03, 17.10it/s] 23%|██▎       | 16/70 [00:01<00:02, 23.16it/s] 30%|███       | 21/70 [00:01<00:01, 27.86it/s] 37%|███▋      | 26/70 [00:01<00:01, 31.31it/s] 44%|████▍     | 31/70 [00:01<00:01, 33.87it/s] 51%|█████▏    | 36/70 [00:01<00:00, 35.85it/s] 57%|█████▋    | 40/70 [00:01<00:00, 36.86it/s] 64%|██████▍   | 45/70 [00:01<00:00, 38.35it/s] 71%|███████▏  | 50/70 [00:01<00:00, 39.37it/s] 79%|███████▊  | 55/70 [00:01<00:00, 40.07it/s] 86%|████████▌ | 60/70 [00:02<00:00, 40.56it/s] 94%|█████████▍| 66/70 [00:02<00:00, 43.16it/s]100%|██████████| 70/70 [00:02<00:00, 30.34it/s]
8925 images processed, 2.3443684577941895 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:01<00:58,  1.32s/it]  4%|▍         | 2/45 [00:01<00:27,  1.59it/s] 16%|█▌        | 7/45 [00:01<00:05,  7.11it/s] 27%|██▋       | 12/45 [00:01<00:02, 12.79it/s] 36%|███▌      | 16/45 [00:01<00:01, 17.18it/s] 44%|████▍     | 20/45 [00:02<00:01, 17.26it/s] 51%|█████     | 23/45 [00:02<00:01, 17.64it/s] 62%|██████▏   | 28/45 [00:02<00:00, 22.83it/s] 73%|███████▎  | 33/45 [00:02<00:00, 20.49it/s] 80%|████████  | 36/45 [00:02<00:00, 19.92it/s] 91%|█████████ | 41/45 [00:02<00:00, 24.54it/s]100%|██████████| 45/45 [00:02<00:00, 15.08it/s]
5640 images processed, 3.0137646198272705 seconds used

30.08821940422058
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/umap/umap_.py:1952: UserWarning: n_jobs value 1 overridden to 1 by setting random_state. Use no seed for parallelism.
  warn(
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/umap/umap_.py:1952: UserWarning: n_jobs value 1 overridden to 1 by setting random_state. Use no seed for parallelism.
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.74  99.29
places365     74.73  79.11
LSUN          20.51  95.38
iSUN          78.34  79.48
dtd           43.60  90.14
AVG           43.98  88.68
Retain-Acc: 0.7087
Forget-as-OOD (retain known vs forget novel):
  FPR: 77.80 AUROC: 84.40 AUIN: 99.01
11.531397581100464
[umap] saved to figs/umap_CIFAR-100_resnet34_top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stage2-inc1_domain.png
[umap] saved to figs/umap_CIFAR-100_resnet34_top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stage2-inc1_rf.png
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stage2-inc2: Number of model parameters: 21843904
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<03:06,  2.09it/s]  2%|▏         | 6/391 [00:00<00:30, 12.71it/s]  3%|▎         | 11/391 [00:00<00:17, 21.28it/s]  4%|▍         | 16/391 [00:00<00:13, 27.94it/s]  5%|▌         | 21/391 [00:00<00:11, 33.44it/s]  7%|▋         | 26/391 [00:01<00:09, 37.22it/s]  8%|▊         | 31/391 [00:01<00:09, 39.81it/s]  9%|▉         | 36/391 [00:01<00:08, 41.67it/s] 10%|█         | 41/391 [00:01<00:08, 42.19it/s] 12%|█▏        | 46/391 [00:01<00:07, 43.13it/s] 13%|█▎        | 51/391 [00:01<00:07, 44.01it/s] 14%|█▍        | 56/391 [00:01<00:07, 44.68it/s] 16%|█▌        | 61/391 [00:01<00:07, 45.13it/s] 17%|█▋        | 66/391 [00:01<00:07, 45.44it/s] 18%|█▊        | 71/391 [00:02<00:07, 45.68it/s] 19%|█▉        | 76/391 [00:02<00:06, 45.83it/s] 21%|██        | 81/391 [00:02<00:06, 44.85it/s] 22%|██▏       | 87/391 [00:02<00:06, 46.37it/s] 24%|██▎       | 92/391 [00:02<00:06, 46.01it/s] 25%|██▍       | 97/391 [00:02<00:06, 45.50it/s] 26%|██▌       | 102/391 [00:02<00:06, 45.70it/s] 27%|██▋       | 107/391 [00:02<00:06, 45.01it/s] 29%|██▊       | 112/391 [00:02<00:06, 45.35it/s] 30%|██▉       | 117/391 [00:03<00:06, 45.60it/s] 31%|███       | 122/391 [00:03<00:05, 45.80it/s] 32%|███▏      | 127/391 [00:03<00:05, 45.16it/s] 34%|███▍      | 132/391 [00:03<00:05, 45.46it/s] 35%|███▌      | 137/391 [00:03<00:05, 45.45it/s] 36%|███▋      | 142/391 [00:03<00:05, 45.67it/s] 38%|███▊      | 148/391 [00:03<00:05, 48.13it/s] 39%|███▉      | 153/391 [00:03<00:05, 46.22it/s] 40%|████      | 158/391 [00:03<00:05, 46.17it/s] 42%|████▏     | 163/391 [00:04<00:04, 45.95it/s] 43%|████▎     | 168/391 [00:04<00:04, 46.01it/s] 44%|████▍     | 173/391 [00:04<00:04, 45.65it/s] 46%|████▌     | 178/391 [00:04<00:04, 45.19it/s] 47%|████▋     | 183/391 [00:04<00:04, 45.44it/s] 48%|████▊     | 188/391 [00:04<00:04, 45.66it/s] 49%|████▉     | 193/391 [00:04<00:04, 44.99it/s] 51%|█████     | 199/391 [00:04<00:04, 46.89it/s] 52%|█████▏    | 204/391 [00:04<00:04, 46.67it/s] 53%|█████▎    | 209/391 [00:05<00:03, 46.49it/s] 55%|█████▍    | 214/391 [00:05<00:03, 46.42it/s] 56%|█████▌    | 219/391 [00:05<00:03, 44.70it/s] 57%|█████▋    | 224/391 [00:05<00:03, 44.40it/s] 59%|█████▊    | 229/391 [00:05<00:03, 43.46it/s] 60%|█████▉    | 234/391 [00:05<00:03, 44.15it/s] 61%|██████    | 239/391 [00:05<00:03, 44.70it/s] 62%|██████▏   | 244/391 [00:05<00:03, 44.38it/s] 64%|██████▎   | 249/391 [00:05<00:03, 44.88it/s] 65%|██████▍   | 254/391 [00:06<00:03, 43.73it/s] 66%|██████▌   | 259/391 [00:06<00:02, 45.38it/s] 68%|██████▊   | 264/391 [00:06<00:02, 45.59it/s] 69%|██████▉   | 269/391 [00:06<00:02, 45.77it/s] 70%|███████   | 274/391 [00:06<00:02, 45.92it/s] 71%|███████▏  | 279/391 [00:06<00:02, 45.69it/s] 73%|███████▎  | 284/391 [00:06<00:02, 45.10it/s] 74%|███████▍  | 289/391 [00:06<00:02, 45.46it/s] 75%|███████▌  | 294/391 [00:06<00:02, 45.43it/s] 76%|███████▋  | 299/391 [00:07<00:02, 45.67it/s] 78%|███████▊  | 304/391 [00:07<00:01, 45.81it/s] 79%|███████▉  | 309/391 [00:07<00:01, 45.67it/s] 80%|████████  | 314/391 [00:07<00:01, 45.81it/s] 82%|████████▏ | 320/391 [00:07<00:01, 47.94it/s] 83%|████████▎ | 325/391 [00:07<00:01, 47.43it/s] 84%|████████▍ | 330/391 [00:07<00:01, 47.05it/s] 86%|████████▌ | 335/391 [00:07<00:01, 45.19it/s] 87%|████████▋ | 340/391 [00:07<00:01, 45.44it/s] 88%|████████▊ | 345/391 [00:08<00:01, 45.76it/s] 90%|████████▉ | 350/391 [00:08<00:00, 45.89it/s] 91%|█████████ | 355/391 [00:08<00:00, 45.95it/s] 92%|█████████▏| 360/391 [00:08<00:00, 45.76it/s] 93%|█████████▎| 365/391 [00:08<00:00, 45.83it/s] 95%|█████████▍| 370/391 [00:08<00:00, 45.92it/s] 96%|█████████▌| 376/391 [00:08<00:00, 47.11it/s] 97%|█████████▋| 381/391 [00:08<00:00, 46.83it/s] 99%|█████████▊| 386/391 [00:08<00:00, 46.81it/s]100%|██████████| 391/391 [00:09<00:00, 46.05it/s]100%|██████████| 391/391 [00:09<00:00, 43.44it/s]
50000 images processed, 9.12247610092163 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:56,  1.39it/s]  8%|▊         | 6/79 [00:00<00:07,  9.18it/s] 14%|█▍        | 11/79 [00:00<00:04, 16.77it/s] 20%|██        | 16/79 [00:01<00:02, 22.95it/s] 27%|██▋       | 21/79 [00:01<00:02, 28.22it/s] 33%|███▎      | 26/79 [00:01<00:01, 32.47it/s] 39%|███▉      | 31/79 [00:01<00:01, 35.48it/s] 46%|████▌     | 36/79 [00:01<00:01, 38.46it/s] 52%|█████▏    | 41/79 [00:01<00:00, 39.86it/s] 58%|█████▊    | 46/79 [00:01<00:00, 41.21it/s] 65%|██████▍   | 51/79 [00:01<00:00, 42.60it/s] 71%|███████   | 56/79 [00:01<00:00, 43.63it/s] 77%|███████▋  | 61/79 [00:02<00:00, 45.10it/s] 84%|████████▎ | 66/79 [00:02<00:00, 45.29it/s] 90%|████████▉ | 71/79 [00:02<00:00, 45.30it/s] 96%|█████████▌| 76/79 [00:02<00:00, 44.73it/s]100%|██████████| 79/79 [00:03<00:00, 22.51it/s]
10000 images processed, 3.53328537940979 seconds used

Saved forget OOD features to cache/resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stage2-inc2/CIFAR-100/forget
Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<02:18,  1.46it/s]  3%|▎         | 6/204 [00:00<00:20,  9.48it/s]  5%|▌         | 11/204 [00:00<00:11, 16.55it/s]  8%|▊         | 16/204 [00:01<00:08, 22.42it/s] 10%|█         | 21/204 [00:01<00:06, 27.29it/s] 13%|█▎        | 26/204 [00:01<00:05, 31.94it/s] 15%|█▌        | 31/204 [00:01<00:04, 34.96it/s] 18%|█▊        | 36/204 [00:01<00:04, 36.93it/s] 20%|██        | 41/204 [00:01<00:04, 38.32it/s] 23%|██▎       | 46/204 [00:01<00:04, 39.23it/s] 25%|██▌       | 51/204 [00:01<00:03, 39.59it/s] 27%|██▋       | 56/204 [00:02<00:03, 40.23it/s] 30%|██▉       | 61/204 [00:02<00:03, 41.82it/s] 32%|███▏      | 66/204 [00:02<00:03, 41.58it/s] 35%|███▍      | 71/204 [00:02<00:03, 41.41it/s] 37%|███▋      | 76/204 [00:02<00:03, 41.51it/s] 40%|███▉      | 81/204 [00:02<00:02, 41.57it/s] 42%|████▏     | 86/204 [00:02<00:02, 41.68it/s] 45%|████▍     | 91/204 [00:02<00:02, 41.50it/s] 47%|████▋     | 96/204 [00:02<00:02, 41.13it/s] 50%|████▉     | 101/204 [00:03<00:02, 41.06it/s] 52%|█████▏    | 106/204 [00:03<00:02, 40.85it/s] 54%|█████▍    | 111/204 [00:03<00:02, 42.70it/s] 57%|█████▋    | 116/204 [00:03<00:02, 41.96it/s] 59%|█████▉    | 121/204 [00:03<00:01, 41.88it/s] 62%|██████▏   | 126/204 [00:03<00:01, 41.18it/s] 64%|██████▍   | 131/204 [00:03<00:01, 41.32it/s] 67%|██████▋   | 136/204 [00:03<00:01, 41.17it/s] 69%|██████▉   | 141/204 [00:04<00:01, 41.16it/s] 72%|███████▏  | 146/204 [00:04<00:01, 41.15it/s] 74%|███████▍  | 151/204 [00:04<00:01, 41.35it/s] 76%|███████▋  | 156/204 [00:04<00:01, 41.48it/s] 79%|███████▉  | 161/204 [00:04<00:01, 41.60it/s] 81%|████████▏ | 166/204 [00:04<00:00, 43.38it/s] 84%|████████▍ | 171/204 [00:04<00:00, 42.41it/s] 86%|████████▋ | 176/204 [00:04<00:00, 42.23it/s] 89%|████████▊ | 181/204 [00:04<00:00, 42.04it/s] 91%|█████████ | 186/204 [00:05<00:00, 41.94it/s] 94%|█████████▎| 191/204 [00:05<00:00, 42.01it/s] 96%|█████████▌| 196/204 [00:05<00:00, 41.87it/s] 99%|█████████▊| 201/204 [00:05<00:00, 41.86it/s]100%|██████████| 204/204 [00:05<00:00, 36.87it/s]
26032 images processed, 5.583646297454834 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:59,  1.31it/s]  8%|▊         | 6/79 [00:00<00:08,  8.60it/s] 14%|█▍        | 11/79 [00:01<00:04, 15.35it/s] 20%|██        | 16/79 [00:01<00:02, 21.33it/s] 27%|██▋       | 21/79 [00:01<00:02, 26.78it/s] 33%|███▎      | 26/79 [00:01<00:01, 30.71it/s] 38%|███▊      | 30/79 [00:01<00:01, 32.91it/s] 44%|████▍     | 35/79 [00:01<00:01, 35.26it/s] 51%|█████     | 40/79 [00:01<00:01, 37.15it/s] 57%|█████▋    | 45/79 [00:01<00:00, 38.62it/s] 63%|██████▎   | 50/79 [00:01<00:00, 39.56it/s] 70%|██████▉   | 55/79 [00:02<00:00, 40.23it/s] 76%|███████▌  | 60/79 [00:02<00:00, 40.67it/s] 82%|████████▏ | 65/79 [00:02<00:00, 42.86it/s] 89%|████████▊ | 70/79 [00:02<00:00, 42.52it/s] 95%|█████████▍| 75/79 [00:02<00:00, 42.31it/s]100%|██████████| 79/79 [00:02<00:00, 30.34it/s]
10000 images processed, 2.640843152999878 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<01:04,  1.22it/s]  8%|▊         | 6/79 [00:00<00:08,  8.34it/s] 14%|█▍        | 11/79 [00:01<00:04, 15.11it/s] 20%|██        | 16/79 [00:01<00:02, 21.06it/s] 27%|██▋       | 21/79 [00:01<00:02, 26.08it/s] 33%|███▎      | 26/79 [00:01<00:01, 30.11it/s] 39%|███▉      | 31/79 [00:01<00:01, 33.24it/s] 46%|████▌     | 36/79 [00:01<00:01, 35.68it/s] 52%|█████▏    | 41/79 [00:01<00:01, 37.41it/s] 58%|█████▊    | 46/79 [00:01<00:00, 38.67it/s] 65%|██████▍   | 51/79 [00:02<00:00, 39.59it/s] 71%|███████   | 56/79 [00:02<00:00, 40.23it/s] 77%|███████▋  | 61/79 [00:02<00:00, 42.04it/s] 84%|████████▎ | 66/79 [00:02<00:00, 41.97it/s] 90%|████████▉ | 71/79 [00:02<00:00, 41.92it/s] 96%|█████████▌| 76/79 [00:02<00:00, 41.87it/s]100%|██████████| 79/79 [00:02<00:00, 29.90it/s]
10000 images processed, 2.666062593460083 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:40,  1.68it/s]  6%|▌         | 4/70 [00:00<00:09,  7.13it/s] 13%|█▎        | 9/70 [00:00<00:03, 15.70it/s] 19%|█▊        | 13/70 [00:00<00:02, 21.24it/s] 26%|██▌       | 18/70 [00:01<00:01, 26.73it/s] 33%|███▎      | 23/70 [00:01<00:01, 31.54it/s] 40%|████      | 28/70 [00:01<00:01, 34.51it/s] 47%|████▋     | 33/70 [00:01<00:01, 36.65it/s] 54%|█████▍    | 38/70 [00:01<00:00, 37.58it/s] 61%|██████▏   | 43/70 [00:01<00:00, 38.81it/s] 69%|██████▊   | 48/70 [00:01<00:00, 39.79it/s] 76%|███████▌  | 53/70 [00:01<00:00, 40.37it/s] 83%|████████▎ | 58/70 [00:01<00:00, 40.79it/s] 90%|█████████ | 63/70 [00:02<00:00, 41.08it/s] 97%|█████████▋| 68/70 [00:02<00:00, 41.27it/s]100%|██████████| 70/70 [00:02<00:00, 30.66it/s]
8925 images processed, 2.314544200897217 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:01<00:53,  1.21s/it]  7%|▋         | 3/45 [00:01<00:14,  2.83it/s] 18%|█▊        | 8/45 [00:01<00:04,  8.69it/s] 29%|██▉       | 13/45 [00:01<00:02, 14.43it/s] 38%|███▊      | 17/45 [00:01<00:01, 17.36it/s] 44%|████▍     | 20/45 [00:01<00:01, 16.01it/s] 53%|█████▎    | 24/45 [00:02<00:01, 20.17it/s] 62%|██████▏   | 28/45 [00:02<00:00, 24.05it/s] 71%|███████   | 32/45 [00:02<00:00, 26.22it/s] 80%|████████  | 36/45 [00:02<00:00, 18.93it/s] 91%|█████████ | 41/45 [00:02<00:00, 23.57it/s]100%|██████████| 45/45 [00:02<00:00, 15.98it/s]
5640 images processed, 2.8425445556640625 seconds used

30.49302053451538
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/umap/umap_.py:1952: UserWarning: n_jobs value 1 overridden to 1 by setting random_state. Use no seed for parallelism.
  warn(
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/umap/umap_.py:1952: UserWarning: n_jobs value 1 overridden to 1 by setting random_state. Use no seed for parallelism.
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.64  99.31
places365     73.15  79.36
LSUN          19.62  95.60
iSUN          77.04  79.75
dtd           42.39  90.36
AVG           42.97  88.88
Retain-Acc: 0.7087
Forget-as-OOD (retain known vs forget novel):
  FPR: 69.20 AUROC: 87.58 AUIN: 99.28
15.641448974609375
[umap] saved to figs/umap_CIFAR-100_resnet34_top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stage2-inc2_domain.png
[umap] saved to figs/umap_CIFAR-100_resnet34_top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stage2-inc2_rf.png
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stage2-seen: Number of model parameters: 21843904
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:02<14:49,  2.28s/it]  1%|▏         | 5/391 [00:02<02:19,  2.76it/s]  2%|▏         | 9/391 [00:02<01:08,  5.56it/s]  4%|▍         | 15/391 [00:02<00:35, 10.68it/s]  5%|▌         | 20/391 [00:02<00:24, 15.23it/s]  6%|▋         | 25/391 [00:02<00:18, 20.04it/s]  8%|▊         | 30/391 [00:02<00:14, 24.79it/s]  9%|▉         | 35/391 [00:03<00:12, 29.21it/s] 10%|█         | 40/391 [00:03<00:10, 32.93it/s] 12%|█▏        | 45/391 [00:03<00:09, 35.98it/s] 13%|█▎        | 51/391 [00:03<00:08, 39.74it/s] 14%|█▍        | 56/391 [00:03<00:08, 41.41it/s] 16%|█▌        | 61/391 [00:03<00:07, 42.22it/s] 17%|█▋        | 66/391 [00:03<00:07, 42.83it/s] 18%|█▊        | 71/391 [00:03<00:07, 43.76it/s] 19%|█▉        | 76/391 [00:03<00:07, 43.91it/s] 21%|██        | 81/391 [00:04<00:06, 44.44it/s] 22%|██▏       | 86/391 [00:04<00:06, 44.47it/s] 23%|██▎       | 91/391 [00:04<00:06, 44.45it/s] 25%|██▍       | 96/391 [00:04<00:06, 44.91it/s] 26%|██▌       | 101/391 [00:04<00:06, 44.26it/s] 27%|██▋       | 106/391 [00:04<00:06, 44.80it/s] 29%|██▊       | 112/391 [00:04<00:05, 46.82it/s] 30%|██▉       | 117/391 [00:04<00:05, 46.63it/s] 31%|███       | 122/391 [00:04<00:05, 45.92it/s] 32%|███▏      | 127/391 [00:05<00:05, 45.99it/s] 34%|███▍      | 132/391 [00:05<00:05, 46.06it/s] 35%|███▌      | 137/391 [00:05<00:05, 45.27it/s] 36%|███▋      | 142/391 [00:05<00:05, 45.47it/s] 38%|███▊      | 147/391 [00:05<00:05, 45.65it/s] 39%|███▉      | 152/391 [00:05<00:05, 45.78it/s] 40%|████      | 157/391 [00:05<00:05, 45.92it/s] 41%|████▏     | 162/391 [00:05<00:04, 46.00it/s] 43%|████▎     | 167/391 [00:05<00:04, 46.06it/s] 44%|████▍     | 172/391 [00:06<00:04, 46.44it/s] 45%|████▌     | 177/391 [00:06<00:04, 46.38it/s] 47%|████▋     | 182/391 [00:06<00:04, 46.31it/s] 48%|████▊     | 187/391 [00:06<00:04, 46.25it/s] 49%|████▉     | 192/391 [00:06<00:04, 45.69it/s] 50%|█████     | 197/391 [00:06<00:04, 45.84it/s] 52%|█████▏    | 202/391 [00:06<00:04, 44.95it/s] 53%|█████▎    | 207/391 [00:06<00:04, 45.02it/s] 54%|█████▍    | 212/391 [00:06<00:04, 44.58it/s] 55%|█████▌    | 217/391 [00:07<00:03, 44.80it/s] 57%|█████▋    | 222/391 [00:07<00:03, 44.45it/s] 58%|█████▊    | 227/391 [00:07<00:03, 44.90it/s] 59%|█████▉    | 232/391 [00:07<00:03, 45.28it/s] 61%|██████    | 237/391 [00:07<00:03, 45.25it/s] 62%|██████▏   | 242/391 [00:07<00:03, 45.50it/s] 63%|██████▎   | 247/391 [00:07<00:03, 45.18it/s] 64%|██████▍   | 252/391 [00:07<00:03, 45.47it/s] 66%|██████▌   | 257/391 [00:07<00:02, 45.68it/s] 67%|██████▋   | 262/391 [00:08<00:02, 44.76it/s] 68%|██████▊   | 267/391 [00:08<00:02, 45.19it/s] 70%|██████▉   | 272/391 [00:08<00:02, 45.18it/s] 71%|███████   | 277/391 [00:08<00:02, 45.46it/s] 72%|███████▏  | 282/391 [00:08<00:02, 44.88it/s] 73%|███████▎  | 287/391 [00:08<00:02, 45.24it/s] 75%|███████▍  | 292/391 [00:08<00:02, 46.53it/s] 76%|███████▌  | 297/391 [00:08<00:02, 45.72it/s] 77%|███████▋  | 302/391 [00:08<00:01, 45.58it/s] 79%|███████▊  | 307/391 [00:09<00:01, 45.19it/s] 80%|███████▉  | 312/391 [00:09<00:01, 45.48it/s] 81%|████████  | 317/391 [00:09<00:01, 45.66it/s] 82%|████████▏ | 322/391 [00:09<00:01, 45.82it/s] 84%|████████▎ | 327/391 [00:09<00:01, 45.44it/s] 85%|████████▍ | 332/391 [00:09<00:01, 45.11it/s] 86%|████████▌ | 337/391 [00:09<00:01, 45.44it/s] 87%|████████▋ | 342/391 [00:09<00:01, 44.90it/s] 89%|████████▊ | 347/391 [00:09<00:00, 45.25it/s] 90%|█████████ | 352/391 [00:10<00:00, 45.53it/s] 92%|█████████▏| 358/391 [00:10<00:00, 47.50it/s] 93%|█████████▎| 363/391 [00:10<00:00, 46.53it/s] 94%|█████████▍| 368/391 [00:10<00:00, 46.43it/s] 95%|█████████▌| 373/391 [00:10<00:00, 46.37it/s] 97%|█████████▋| 378/391 [00:10<00:00, 46.38it/s] 98%|█████████▊| 383/391 [00:10<00:00, 46.29it/s] 99%|█████████▉| 388/391 [00:10<00:00, 46.27it/s]100%|██████████| 391/391 [00:10<00:00, 35.99it/s]
50000 images processed, 11.027877807617188 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:46,  1.69it/s]  8%|▊         | 6/79 [00:00<00:06, 10.74it/s] 14%|█▍        | 11/79 [00:00<00:03, 18.72it/s] 20%|██        | 16/79 [00:00<00:02, 25.18it/s] 27%|██▋       | 21/79 [00:01<00:01, 30.42it/s] 33%|███▎      | 26/79 [00:01<00:01, 34.64it/s] 39%|███▉      | 31/79 [00:01<00:01, 37.01it/s] 46%|████▌     | 36/79 [00:01<00:01, 39.57it/s] 52%|█████▏    | 41/79 [00:01<00:00, 41.46it/s] 58%|█████▊    | 46/79 [00:01<00:00, 41.66it/s] 65%|██████▍   | 51/79 [00:01<00:00, 42.96it/s] 72%|███████▏  | 57/79 [00:01<00:00, 45.11it/s] 78%|███████▊  | 62/79 [00:01<00:00, 45.42it/s] 85%|████████▍ | 67/79 [00:02<00:00, 45.63it/s] 91%|█████████ | 72/79 [00:02<00:00, 45.82it/s] 97%|█████████▋| 77/79 [00:02<00:00, 45.90it/s]100%|██████████| 79/79 [00:03<00:00, 24.40it/s]
10000 images processed, 3.300506353378296 seconds used

Saved forget OOD features to cache/resnet34-top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stage2-seen/CIFAR-100/forget
Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<02:16,  1.49it/s]  3%|▎         | 6/204 [00:00<00:20,  9.61it/s]  5%|▌         | 11/204 [00:00<00:11, 16.79it/s]  7%|▋         | 15/204 [00:01<00:08, 21.58it/s] 10%|▉         | 20/204 [00:01<00:06, 26.77it/s] 12%|█▏        | 25/204 [00:01<00:05, 31.85it/s] 15%|█▍        | 30/204 [00:01<00:05, 34.68it/s] 17%|█▋        | 35/204 [00:01<00:04, 36.56it/s] 20%|█▉        | 40/204 [00:01<00:04, 37.85it/s] 22%|██▏       | 45/204 [00:01<00:04, 39.01it/s] 25%|██▍       | 50/204 [00:01<00:03, 39.48it/s] 27%|██▋       | 55/204 [00:01<00:03, 39.13it/s] 29%|██▉       | 60/204 [00:02<00:03, 39.02it/s] 32%|███▏      | 65/204 [00:02<00:03, 39.77it/s] 34%|███▍      | 70/204 [00:02<00:03, 40.36it/s] 37%|███▋      | 75/204 [00:02<00:03, 42.41it/s] 39%|███▉      | 80/204 [00:02<00:02, 41.63it/s] 42%|████▏     | 85/204 [00:02<00:02, 41.60it/s] 44%|████▍     | 90/204 [00:02<00:02, 42.37it/s] 47%|████▋     | 95/204 [00:02<00:02, 41.86it/s] 49%|████▉     | 100/204 [00:03<00:02, 41.82it/s] 51%|█████▏    | 105/204 [00:03<00:02, 41.35it/s] 54%|█████▍    | 110/204 [00:03<00:02, 41.21it/s] 56%|█████▋    | 115/204 [00:03<00:02, 41.38it/s] 59%|█████▉    | 120/204 [00:03<00:02, 41.10it/s] 61%|██████▏   | 125/204 [00:03<00:01, 41.10it/s] 64%|██████▎   | 130/204 [00:03<00:01, 41.30it/s] 66%|██████▌   | 135/204 [00:03<00:01, 41.40it/s] 69%|██████▊   | 140/204 [00:04<00:01, 41.10it/s] 71%|███████   | 145/204 [00:04<00:01, 42.20it/s] 74%|███████▎  | 150/204 [00:04<00:01, 42.06it/s] 76%|███████▌  | 155/204 [00:04<00:01, 41.97it/s] 78%|███████▊  | 160/204 [00:04<00:01, 41.89it/s] 81%|████████  | 165/204 [00:04<00:00, 41.65it/s] 83%|████████▎ | 170/204 [00:04<00:00, 41.59it/s] 86%|████████▌ | 175/204 [00:04<00:00, 40.99it/s] 88%|████████▊ | 180/204 [00:04<00:00, 41.19it/s] 91%|█████████ | 185/204 [00:05<00:00, 41.34it/s] 93%|█████████▎| 190/204 [00:05<00:00, 41.43it/s] 96%|█████████▌| 195/204 [00:05<00:00, 42.97it/s] 98%|█████████▊| 200/204 [00:05<00:00, 42.24it/s]100%|██████████| 204/204 [00:05<00:00, 36.76it/s]
26032 images processed, 5.600672483444214 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<01:09,  1.12it/s]  8%|▊         | 6/79 [00:01<00:09,  7.66it/s] 14%|█▍        | 11/79 [00:01<00:04, 14.03it/s] 20%|██        | 16/79 [00:01<00:03, 19.85it/s] 27%|██▋       | 21/79 [00:01<00:02, 24.93it/s] 33%|███▎      | 26/79 [00:01<00:01, 29.10it/s] 39%|███▉      | 31/79 [00:01<00:01, 32.70it/s] 46%|████▌     | 36/79 [00:01<00:01, 35.19it/s] 52%|█████▏    | 41/79 [00:01<00:01, 36.67it/s] 58%|█████▊    | 46/79 [00:01<00:00, 38.06it/s] 65%|██████▍   | 51/79 [00:02<00:00, 39.14it/s] 71%|███████   | 56/79 [00:02<00:00, 39.99it/s] 77%|███████▋  | 61/79 [00:02<00:00, 40.51it/s] 84%|████████▎ | 66/79 [00:02<00:00, 40.86it/s] 90%|████████▉ | 71/79 [00:02<00:00, 41.12it/s] 96%|█████████▌| 76/79 [00:02<00:00, 41.30it/s]100%|██████████| 79/79 [00:02<00:00, 28.81it/s]
10000 images processed, 2.7651333808898926 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:58,  1.34it/s]  8%|▊         | 6/79 [00:00<00:08,  8.83it/s] 14%|█▍        | 11/79 [00:00<00:04, 15.70it/s] 20%|██        | 16/79 [00:01<00:02, 21.69it/s] 27%|██▋       | 21/79 [00:01<00:02, 26.65it/s] 33%|███▎      | 26/79 [00:01<00:01, 30.47it/s] 39%|███▉      | 31/79 [00:01<00:01, 33.39it/s] 46%|████▌     | 36/79 [00:01<00:01, 36.84it/s] 52%|█████▏    | 41/79 [00:01<00:00, 38.27it/s] 58%|█████▊    | 46/79 [00:01<00:00, 39.31it/s] 65%|██████▍   | 51/79 [00:01<00:00, 40.15it/s] 71%|███████   | 56/79 [00:02<00:00, 40.61it/s] 77%|███████▋  | 61/79 [00:02<00:00, 40.94it/s] 84%|████████▎ | 66/79 [00:02<00:00, 41.20it/s] 90%|████████▉ | 71/79 [00:02<00:00, 41.98it/s] 96%|█████████▌| 76/79 [00:02<00:00, 41.77it/s]100%|██████████| 79/79 [00:02<00:00, 30.54it/s]
10000 images processed, 2.615711212158203 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:48,  1.43it/s]  7%|▋         | 5/70 [00:00<00:08,  7.93it/s] 14%|█▍        | 10/70 [00:00<00:03, 15.50it/s] 21%|██▏       | 15/70 [00:01<00:02, 21.86it/s] 29%|██▊       | 20/70 [00:01<00:01, 26.86it/s] 36%|███▌      | 25/70 [00:01<00:01, 30.85it/s] 43%|████▎     | 30/70 [00:01<00:01, 34.21it/s] 50%|█████     | 35/70 [00:01<00:00, 36.19it/s] 57%|█████▋    | 40/70 [00:01<00:00, 37.77it/s] 64%|██████▍   | 45/70 [00:01<00:00, 38.69it/s] 71%|███████▏  | 50/70 [00:01<00:00, 39.62it/s] 79%|███████▊  | 55/70 [00:02<00:00, 40.35it/s] 86%|████████▌ | 60/70 [00:02<00:00, 40.76it/s] 93%|█████████▎| 65/70 [00:02<00:00, 41.07it/s]100%|██████████| 70/70 [00:02<00:00, 41.19it/s]100%|██████████| 70/70 [00:02<00:00, 29.64it/s]
8925 images processed, 2.40334153175354 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:01<00:50,  1.14s/it]  4%|▍         | 2/45 [00:01<00:23,  1.84it/s] 13%|█▎        | 6/45 [00:01<00:05,  6.92it/s] 24%|██▍       | 11/45 [00:01<00:02, 13.34it/s] 36%|███▌      | 16/45 [00:01<00:01, 19.25it/s] 44%|████▍     | 20/45 [00:01<00:01, 21.24it/s] 53%|█████▎    | 24/45 [00:01<00:01, 20.35it/s] 64%|██████▍   | 29/45 [00:02<00:00, 24.63it/s] 73%|███████▎  | 33/45 [00:02<00:00, 21.72it/s] 84%|████████▍ | 38/45 [00:02<00:00, 25.90it/s] 96%|█████████▌| 43/45 [00:02<00:00, 29.64it/s]100%|██████████| 45/45 [00:02<00:00, 17.13it/s]
5640 images processed, 2.650660991668701 seconds used

32.108763694763184
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/umap/umap_.py:1952: UserWarning: n_jobs value 1 overridden to 1 by setting random_state. Use no seed for parallelism.
  warn(
/home/shaokun/anaconda3/envs/PPALM/lib/python3.10/site-packages/umap/umap_.py:1952: UserWarning: n_jobs value 1 overridden to 1 by setting random_state. Use no seed for parallelism.
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN           2.57  99.36
places365     68.08  81.18
LSUN          17.82  96.07
iSUN          72.36  81.80
dtd           38.48  91.38
AVG           39.86  89.96
Retain-Acc: 0.7481
Forget-as-OOD (retain known vs forget novel):
  FPR: 54.60 AUROC: 89.30 AUIN: 98.64
18.03344225883484
[umap] saved to figs/umap_CIFAR-100_resnet34_top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stage2-seen_domain.png
[umap] saved to figs/umap_CIFAR-100_resnet34_top5-palm-cache6-ema0.999-b128-e5-lr0.001-wd1e-4-ltboth-bfmbalanced-fl0.2-lora_r8a32d0.05-temp0.08-stage2-seen_rf.png
