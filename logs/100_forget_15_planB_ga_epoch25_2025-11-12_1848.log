nohup: ignoring input
/home/shaokun/anaconda3/envs/CILPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/CILPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
/home/shaokun/PALM/main.py:61: FutureWarning: `torch.cuda.amp.GradScaler(args...)` is deprecated. Please use `torch.amp.GradScaler('cuda', args...)` instead.
  scaler = torch.cuda.amp.GradScaler()
Namespace(in_dataset='CIFAR-100', out_datasets=['inat', 'sun50', 'places50', 'dtd'], backbone='resnet34', method='top5-palm-cache6-ema0.999', seed=1, gpu='0', epochs=25, batch_size=128, lr=0.001, weight_decay=0.0001, print_every=50, fine_tune=False, temp=0.08, cosine=True, warm=False, lr_decay_epochs='700,800,900', lr_decay_rate=0.1, layers=100, depth=40, width=4, growth=12, droprate=0.0, save_path='checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-baseline-ga-b128-e25-lr0.001-wd1e-4-fl1-CIFAR-100forget15.pt', load_path='checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt', reduce=0.5, score='mahalanobis', threshold=1.0, k=5, momentum=0.9, proto_m=0.999, cache_size=6, nviews=2, lambda_pcon=0.0, epsilon=0.05, palm_enable=True, palm_mle_mode='all', palm_retain_only=False, pcon_inc=None, incremental=False, use_lora=False, lora_impl='native', lora_r=8, lora_alpha=32, lora_dropout=0.05, lora_target='head', adapter_save_path=None, adapter_load_path=None, lora_stack=False, lora_orth_enable=False, lora_orth_lambda=0.1, lora_orth_ref_paths=None, forget_classes='0,8,11,40,51,66,67,88,94,57,59,58,44,93,10', forget_list_path=None, forget_classes_inc=None, forget_classes_seen=None, retain_exclude_csv=None, forget_csv=None, forget_lambda=1.0, forget_margin=100.0, forget_strategy='ga', centers_path=None, precision_path=None, batch_forget_mode='balanced', forget_proto_enable=False, forget_attr_w=1.0, forget_proto_rep_w=1.0, forget_avgproto_enable=False, forget_avgproto_w=1.0, umap_enable=False, umap_by='domain', umap_max_points=20000, umap_neighbors=15, umap_min_dist=0.05, umap_metric='cosine', umap_save_path=None, umap_rf_only=False, keep_cache=False, argument=True)
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-with-prototypes.pt
resnet34-top5-palm-cache6-ema0.999: Number of model parameters: 21605312
[debug] trainable_count = 112
[debug] trainable: encoder.conv1.weight
[debug] trainable: encoder.bn1.weight
[debug] trainable: encoder.bn1.bias
[debug] trainable: encoder.layer1.0.conv1.weight
[debug] trainable: encoder.layer1.0.bn1.weight
[debug] trainable: encoder.layer1.0.bn1.bias
[debug] trainable: encoder.layer1.0.conv2.weight
[debug] trainable: encoder.layer1.0.bn2.weight
[debug] trainable: encoder.layer1.0.bn2.bias
[debug] trainable: encoder.layer1.1.conv1.weight
[debug] trainable: encoder.layer1.1.bn1.weight
[debug] trainable: encoder.layer1.1.bn1.bias
[debug] trainable: encoder.layer1.1.conv2.weight
[debug] trainable: encoder.layer1.1.bn2.weight
[debug] trainable: encoder.layer1.1.bn2.bias
[debug] trainable: encoder.layer1.2.conv1.weight
[debug] trainable: encoder.layer1.2.bn1.weight
[debug] trainable: encoder.layer1.2.bn1.bias
[debug] trainable: encoder.layer1.2.conv2.weight
[debug] trainable: encoder.layer1.2.bn2.weight
[debug] trainable: encoder.layer1.2.bn2.bias
[debug] trainable: encoder.layer2.0.conv1.weight
[debug] trainable: encoder.layer2.0.bn1.weight
[debug] trainable: encoder.layer2.0.bn1.bias
[debug] trainable: encoder.layer2.0.conv2.weight
[debug] trainable: encoder.layer2.0.bn2.weight
[debug] trainable: encoder.layer2.0.bn2.bias
[debug] trainable: encoder.layer2.0.shortcut.0.weight
[debug] trainable: encoder.layer2.0.shortcut.1.weight
[debug] trainable: encoder.layer2.0.shortcut.1.bias
[debug] trainable: encoder.layer2.1.conv1.weight
[debug] trainable: encoder.layer2.1.bn1.weight
[debug] trainable: encoder.layer2.1.bn1.bias
[debug] trainable: encoder.layer2.1.conv2.weight
[debug] trainable: encoder.layer2.1.bn2.weight
[debug] trainable: encoder.layer2.1.bn2.bias
[debug] trainable: encoder.layer2.2.conv1.weight
[debug] trainable: encoder.layer2.2.bn1.weight
[debug] trainable: encoder.layer2.2.bn1.bias
[debug] trainable: encoder.layer2.2.conv2.weight
[debug] trainable: encoder.layer2.2.bn2.weight
[debug] trainable: encoder.layer2.2.bn2.bias
[debug] trainable: encoder.layer2.3.conv1.weight
[debug] trainable: encoder.layer2.3.bn1.weight
[debug] trainable: encoder.layer2.3.bn1.bias
[debug] trainable: encoder.layer2.3.conv2.weight
[debug] trainable: encoder.layer2.3.bn2.weight
[debug] trainable: encoder.layer2.3.bn2.bias
[debug] trainable: encoder.layer3.0.conv1.weight
[debug] trainable: encoder.layer3.0.bn1.weight
[debug][warn] non-LoRA trainables detected: ['encoder.conv1.weight', 'encoder.bn1.weight', 'encoder.bn1.bias', 'encoder.layer1.0.conv1.weight', 'encoder.layer1.0.bn1.weight', 'encoder.layer1.0.bn1.bias', 'encoder.layer1.0.conv2.weight', 'encoder.layer1.0.bn2.weight', 'encoder.layer1.0.bn2.bias', 'encoder.layer1.1.conv1.weight']
[trainable] param_count=21605312 tensors=112
  0%|          | 0/25 [00:00<?, ?it/s]/home/shaokun/PALM/trainer.py:550: FutureWarning: `torch.cuda.amp.autocast(args...)` is deprecated. Please use `torch.amp.autocast('cuda', args...)` instead.
  with torch.cuda.amp.autocast(enabled=bool(scaler is not None)):
/home/shaokun/PALM/trainer.py:638: UserWarning: Converting a tensor with requires_grad=True to a scalar may lead to unexpected behavior.
Consider using tensor.detach() first. (Triggered internally at /pytorch/torch/csrc/autograd/generated/python_variable_methods.cpp:835.)
  print(f"[loss-{args.forget_strategy}] ep {epoch} it {it} total={loss.item():.4f} ce_r={float(loss_retain):.4f} ce_f={float(loss_forget):.4f}")
  4%|▍         | 1/25 [00:32<12:54, 32.29s/it]  8%|▊         | 2/25 [00:48<08:40, 22.64s/it] 12%|█▏        | 3/25 [01:04<07:17, 19.88s/it] 16%|█▌        | 4/25 [01:20<06:22, 18.19s/it] 20%|██        | 5/25 [01:35<05:44, 17.23s/it] 24%|██▍       | 6/25 [01:52<05:21, 16.91s/it] 28%|██▊       | 7/25 [02:08<04:59, 16.65s/it] 32%|███▏      | 8/25 [02:24<04:39, 16.44s/it] 36%|███▌      | 9/25 [02:40<04:21, 16.37s/it] 40%|████      | 10/25 [02:55<04:00, 16.05s/it] 44%|████▍     | 11/25 [03:11<03:43, 15.99s/it] 48%|████▊     | 12/25 [03:28<03:29, 16.11s/it] 52%|█████▏    | 13/25 [03:44<03:13, 16.12s/it] 56%|█████▌    | 14/25 [04:00<02:57, 16.18s/it] 60%|██████    | 15/25 [04:16<02:41, 16.18s/it] 64%|██████▍   | 16/25 [04:32<02:24, 16.11s/it] 68%|██████▊   | 17/25 [04:49<02:11, 16.41s/it][loss-ga] ep 0 it 0 total=-0.0085 ce_r=0.0170 ce_f=0.0255
[loss-ga] ep 0 it 50 total=-0.0152 ce_r=0.0278 ce_f=0.0430
[loss-ga] ep 0 it 100 total=-0.0044 ce_r=0.0121 ce_f=0.0165
[loss-ga] ep 0 it 150 total=-0.0404 ce_r=0.0508 ce_f=0.0912
[loss-ga] ep 0 it 200 total=-0.0052 ce_r=0.0231 ce_f=0.0283
[loss-ga] ep 0 it 250 total=-0.0273 ce_r=0.0382 ce_f=0.0655
[loss-ga] ep 0 it 300 total=0.0130 ce_r=0.0245 ce_f=0.0115
[loss-ga] ep 0 it 350 total=-0.0360 ce_r=0.0669 ce_f=0.1029
[loss-ga] ep 1 it 10 total=-0.0184 ce_r=0.0425 ce_f=0.0608
[loss-ga] ep 1 it 60 total=-0.0112 ce_r=0.0464 ce_f=0.0576
[loss-ga] ep 1 it 110 total=-0.0142 ce_r=0.0245 ce_f=0.0387
[loss-ga] ep 1 it 160 total=-0.0090 ce_r=0.0319 ce_f=0.0408
[loss-ga] ep 1 it 210 total=-0.0575 ce_r=0.0702 ce_f=0.1277
[loss-ga] ep 1 it 260 total=-0.2746 ce_r=0.2846 ce_f=0.5592
[loss-ga] ep 1 it 310 total=-0.2627 ce_r=0.2760 ce_f=0.5387
[loss-ga] ep 1 it 360 total=-0.2782 ce_r=0.3035 ce_f=0.5816
[loss-ga] ep 2 it 20 total=-0.3392 ce_r=0.4335 ce_f=0.7727
[loss-ga] ep 2 it 70 total=-0.4299 ce_r=0.4361 ce_f=0.8660
[loss-ga] ep 2 it 120 total=-1.0064 ce_r=1.0228 ce_f=2.0292
[loss-ga] ep 2 it 170 total=-0.5145 ce_r=0.5253 ce_f=1.0398
[loss-ga] ep 2 it 220 total=-0.3950 ce_r=0.4044 ce_f=0.7994
[loss-ga] ep 2 it 270 total=-0.5249 ce_r=0.6439 ce_f=1.1688
[loss-ga] ep 2 it 320 total=-0.6642 ce_r=0.7723 ce_f=1.4365
[loss-ga] ep 2 it 370 total=-0.9211 ce_r=1.0548 ce_f=1.9759
[loss-ga] ep 3 it 30 total=-1.2063 ce_r=1.2252 ce_f=2.4315
[loss-ga] ep 3 it 80 total=-1.4812 ce_r=1.5050 ce_f=2.9862
[loss-ga] ep 3 it 130 total=-1.2026 ce_r=1.2163 ce_f=2.4189
[loss-ga] ep 3 it 180 total=-1.8710 ce_r=2.0643 ce_f=3.9354
[loss-ga] ep 3 it 230 total=-2.1419 ce_r=2.2735 ce_f=4.4155
[loss-ga] ep 3 it 280 total=-3.2206 ce_r=3.3507 ce_f=6.5713
[loss-ga] ep 3 it 330 total=-2.5149 ce_r=2.6146 ce_f=5.1295
[loss-ga] ep 3 it 380 total=-3.6192 ce_r=3.8840 ce_f=7.5032
[loss-ga] ep 4 it 40 total=-4.1617 ce_r=4.3132 ce_f=8.4749
[loss-ga] ep 4 it 90 total=-3.9060 ce_r=4.4186 ce_f=8.3246
[loss-ga] ep 4 it 140 total=-4.7656 ce_r=5.1677 ce_f=9.9334
[loss-ga] ep 4 it 190 total=-4.6269 ce_r=4.9164 ce_f=9.5433
[loss-ga] ep 4 it 240 total=-5.5048 ce_r=5.8713 ce_f=11.3761
[loss-ga] ep 4 it 290 total=-5.0276 ce_r=5.8128 ce_f=10.8404
[loss-ga] ep 4 it 340 total=-5.3093 ce_r=5.4453 ce_f=10.7546
[loss-ga] ep 5 it 0 total=-5.7250 ce_r=5.9237 ce_f=11.6486
[loss-ga] ep 5 it 50 total=-5.8133 ce_r=6.0419 ce_f=11.8552
[loss-ga] ep 5 it 100 total=-5.9481 ce_r=6.0582 ce_f=12.0062
[loss-ga] ep 5 it 150 total=-6.0264 ce_r=6.0465 ce_f=12.0729
[loss-ga] ep 5 it 200 total=-6.0598 ce_r=6.3429 ce_f=12.4027
[loss-ga] ep 5 it 250 total=-5.7867 ce_r=6.2314 ce_f=12.0182
[loss-ga] ep 5 it 300 total=-5.9868 ce_r=6.1956 ce_f=12.1824
[loss-ga] ep 5 it 350 total=-6.3677 ce_r=6.4678 ce_f=12.8354
[loss-ga] ep 6 it 10 total=-6.3778 ce_r=6.7434 ce_f=13.1212
[loss-ga] ep 6 it 60 total=-6.5269 ce_r=6.6189 ce_f=13.1457
[loss-ga] ep 6 it 110 total=-6.4114 ce_r=6.7100 ce_f=13.1214
[loss-ga] ep 6 it 160 total=-6.3781 ce_r=6.5367 ce_f=12.9147
[loss-ga] ep 6 it 210 total=-6.7845 ce_r=6.8185 ce_f=13.6030
[loss-ga] ep 6 it 260 total=-6.5623 ce_r=6.6544 ce_f=13.2166
[loss-ga] ep 6 it 310 total=-6.5873 ce_r=6.7251 ce_f=13.3124
[loss-ga] ep 6 it 360 total=-6.9652 ce_r=7.0707 ce_f=14.0359
[loss-ga] ep 7 it 20 total=-6.8541 ce_r=6.9493 ce_f=13.8035
[loss-ga] ep 7 it 70 total=-7.0281 ce_r=7.1098 ce_f=14.1378
[loss-ga] ep 7 it 120 total=-7.0302 ce_r=7.2424 ce_f=14.2726
[loss-ga] ep 7 it 170 total=-6.9337 ce_r=7.1052 ce_f=14.0389
[loss-ga] ep 7 it 220 total=-6.8252 ce_r=6.8601 ce_f=13.6853
[loss-ga] ep 7 it 270 total=-7.1264 ce_r=7.2082 ce_f=14.3347
[loss-ga] ep 7 it 320 total=-7.1807 ce_r=7.3307 ce_f=14.5114
[loss-ga] ep 7 it 370 total=-7.1492 ce_r=7.1925 ce_f=14.3417
[loss-ga] ep 8 it 30 total=-7.1356 ce_r=7.3184 ce_f=14.4540
[loss-ga] ep 8 it 80 total=-6.9998 ce_r=7.2801 ce_f=14.2798
[loss-ga] ep 8 it 130 total=-7.3685 ce_r=7.4757 ce_f=14.8442
[loss-ga] ep 8 it 180 total=-7.4169 ce_r=7.5335 ce_f=14.9504
[loss-ga] ep 8 it 230 total=-7.2344 ce_r=7.3201 ce_f=14.5545
[loss-ga] ep 8 it 280 total=-7.4146 ce_r=7.5151 ce_f=14.9297
[loss-ga] ep 8 it 330 total=-7.3240 ce_r=7.4113 ce_f=14.7353
[loss-ga] ep 8 it 380 total=-7.1111 ce_r=7.4260 ce_f=14.5371
[loss-ga] ep 9 it 40 total=-7.5387 ce_r=7.6617 ce_f=15.2004
[loss-ga] ep 9 it 90 total=-7.5899 ce_r=7.6887 ce_f=15.2786
[loss-ga] ep 9 it 140 total=-7.3558 ce_r=7.5419 ce_f=14.8977
[loss-ga] ep 9 it 190 total=-7.4810 ce_r=7.5565 ce_f=15.0374
[loss-ga] ep 9 it 240 total=-7.5015 ce_r=7.5550 ce_f=15.0566
[loss-ga] ep 9 it 290 total=-7.4003 ce_r=7.4705 ce_f=14.8708
[loss-ga] ep 9 it 340 total=-7.7504 ce_r=7.7753 ce_f=15.5257
[loss-ga] ep 10 it 0 total=-7.6013 ce_r=7.6779 ce_f=15.2791
[loss-ga] ep 10 it 50 total=-7.5526 ce_r=7.5645 ce_f=15.1171
[loss-ga] ep 10 it 100 total=-7.6780 ce_r=7.7728 ce_f=15.4508
[loss-ga] ep 10 it 150 total=-7.6906 ce_r=7.8110 ce_f=15.5017
[loss-ga] ep 10 it 200 total=-7.5586 ce_r=7.6770 ce_f=15.2356
[loss-ga] ep 10 it 250 total=-7.5027 ce_r=7.5979 ce_f=15.1007
[loss-ga] ep 10 it 300 total=-7.4750 ce_r=7.5380 ce_f=15.0130
[loss-ga] ep 10 it 350 total=-7.5998 ce_r=7.8480 ce_f=15.4478
[loss-ga] ep 11 it 10 total=-7.8362 ce_r=7.8680 ce_f=15.7042
[loss-ga] ep 11 it 60 total=-7.5703 ce_r=7.7943 ce_f=15.3646
[loss-ga] ep 11 it 110 total=-7.6670 ce_r=7.8162 ce_f=15.4832
[loss-ga] ep 11 it 160 total=-7.7471 ce_r=7.9387 ce_f=15.6859
[loss-ga] ep 11 it 210 total=-7.6730 ce_r=7.7972 ce_f=15.4703
[loss-ga] ep 11 it 260 total=-7.7298 ce_r=7.7773 ce_f=15.5071
[loss-ga] ep 11 it 310 total=-7.9604 ce_r=7.9840 ce_f=15.9444
[loss-ga] ep 11 it 360 total=-7.8062 ce_r=7.8854 ce_f=15.6916
[loss-ga] ep 12 it 20 total=-7.6374 ce_r=7.6645 ce_f=15.3019
[loss-ga] ep 12 it 70 total=-7.7769 ce_r=7.8052 ce_f=15.5822
[loss-ga] ep 12 it 120 total=-7.8569 ce_r=7.9953 ce_f=15.8522
[loss-ga] ep 12 it 170 total=-7.8610 ce_r=7.8777 ce_f=15.7388
[loss-ga] ep 12 it 220 total=-7.8275 ce_r=7.8559 ce_f=15.6834
[loss-ga] ep 12 it 270 total=-7.7129 ce_r=7.7700 ce_f=15.4830
[loss-ga] ep 12 it 320 total=-7.6332 ce_r=7.7382 ce_f=15.3714
[loss-ga] ep 12 it 370 total=-7.8174 ce_r=7.8383 ce_f=15.6556
[loss-ga] ep 13 it 30 total=-7.5712 ce_r=7.7074 ce_f=15.2786
[loss-ga] ep 13 it 80 total=-7.7178 ce_r=7.7471 ce_f=15.4649
[loss-ga] ep 13 it 130 total=-7.6744 ce_r=7.6990 ce_f=15.3733
[loss-ga] ep 13 it 180 total=-7.7931 ce_r=7.9080 ce_f=15.7011
[loss-ga] ep 13 it 230 total=-7.6862 ce_r=7.7545 ce_f=15.4407
[loss-ga] ep 13 it 280 total=-7.7539 ce_r=7.7976 ce_f=15.5515
[loss-ga] ep 13 it 330 total=-7.8924 ce_r=8.0293 ce_f=15.9216
[loss-ga] ep 13 it 380 total=-7.8765 ce_r=7.9225 ce_f=15.7990
[loss-ga] ep 14 it 40 total=-7.8447 ce_r=7.8765 ce_f=15.7212
[loss-ga] ep 14 it 90 total=-7.8370 ce_r=7.9032 ce_f=15.7402
[loss-ga] ep 14 it 140 total=-7.6199 ce_r=7.6496 ce_f=15.2695
[loss-ga] ep 14 it 190 total=-7.7235 ce_r=7.8219 ce_f=15.5455
[loss-ga] ep 14 it 240 total=-7.9855 ce_r=8.0234 ce_f=16.0089
[loss-ga] ep 14 it 290 total=-7.9551 ce_r=8.1316 ce_f=16.0867
[loss-ga] ep 14 it 340 total=-7.9133 ce_r=7.9415 ce_f=15.8548
[loss-ga] ep 15 it 0 total=-7.6959 ce_r=7.8544 ce_f=15.5503
[loss-ga] ep 15 it 50 total=-7.8664 ce_r=7.9886 ce_f=15.8550
[loss-ga] ep 15 it 100 total=-7.8916 ce_r=7.9145 ce_f=15.8060
[loss-ga] ep 15 it 150 total=-7.7777 ce_r=7.8289 ce_f=15.6066
[loss-ga] ep 15 it 200 total=-7.9561 ce_r=7.9998 ce_f=15.9558
[loss-ga] ep 15 it 250 total=-7.8836 ce_r=8.0541 ce_f=15.9376
[loss-ga] ep 15 it 300 total=-8.0669 ce_r=8.0889 ce_f=16.1557
[loss-ga] ep 15 it 350 total=-8.0187 ce_r=8.0800 ce_f=16.0987
[loss-ga] ep 16 it 10 total=-7.9654 ce_r=7.9959 ce_f=15.9613
[loss-ga] ep 16 it 60 total=-7.8355 ce_r=7.9937 ce_f=15.8292
[loss-ga] ep 16 it 110 total=-7.8355 ce_r=8.0445 ce_f=15.8800
[loss-ga] ep 16 it 160 total=-8.0284 ce_r=8.1347 ce_f=16.1631
[loss-ga] ep 16 it 210 total=-7.9690 ce_r=8.0270 ce_f=15.9960
[loss-ga] ep 16 it 260 total=-8.0126 ce_r=8.0544 ce_f=16.0670
[loss-ga] ep 16 it 310 total=-8.0555 ce_r=8.0734 ce_f=16.1289
[loss-ga] ep 16 it 360 total=-7.6078 ce_r=7.6317 ce_f=15.2395
[loss-ga] ep 17 it 20 total=-7.7856 ce_r=7.8793 ce_f=15.6649
 72%|███████▏  | 18/25 [05:06<01:54, 16.42s/it] 76%|███████▌  | 19/25 [05:23<01:39, 16.54s/it] 80%|████████  | 20/25 [05:39<01:22, 16.53s/it] 84%|████████▍ | 21/25 [05:55<01:05, 16.49s/it] 88%|████████▊ | 22/25 [06:11<00:48, 16.26s/it] 92%|█████████▏| 23/25 [06:27<00:32, 16.26s/it] 96%|█████████▌| 24/25 [06:43<00:16, 16.17s/it]100%|██████████| 25/25 [06:59<00:00, 16.01s/it]100%|██████████| 25/25 [06:59<00:00, 16.78s/it]
[loss-ga] ep 17 it 70 total=-7.7497 ce_r=7.7844 ce_f=15.5341
[loss-ga] ep 17 it 120 total=-7.8651 ce_r=7.9795 ce_f=15.8446
[loss-ga] ep 17 it 170 total=-7.8634 ce_r=8.0579 ce_f=15.9214
[loss-ga] ep 17 it 220 total=-7.8870 ce_r=7.9693 ce_f=15.8563
[loss-ga] ep 17 it 270 total=-8.0528 ce_r=8.1280 ce_f=16.1808
[loss-ga] ep 17 it 320 total=-7.8629 ce_r=7.8904 ce_f=15.7534
[loss-ga] ep 17 it 370 total=-8.0366 ce_r=8.0611 ce_f=16.0977
[loss-ga] ep 18 it 30 total=-8.0205 ce_r=8.0455 ce_f=16.0660
[loss-ga] ep 18 it 80 total=-7.7886 ce_r=7.8272 ce_f=15.6159
[loss-ga] ep 18 it 130 total=-8.0806 ce_r=8.0954 ce_f=16.1760
[loss-ga] ep 18 it 180 total=-7.9464 ce_r=7.9739 ce_f=15.9203
[loss-ga] ep 18 it 230 total=-7.9111 ce_r=7.9553 ce_f=15.8664
[loss-ga] ep 18 it 280 total=-7.7698 ce_r=7.9034 ce_f=15.6732
[loss-ga] ep 18 it 330 total=-7.9292 ce_r=7.9638 ce_f=15.8930
[loss-ga] ep 18 it 380 total=-7.9000 ce_r=7.9921 ce_f=15.8922
[loss-ga] ep 19 it 40 total=-7.9028 ce_r=8.0035 ce_f=15.9064
[loss-ga] ep 19 it 90 total=-8.0484 ce_r=8.0734 ce_f=16.1218
[loss-ga] ep 19 it 140 total=-8.0740 ce_r=8.0868 ce_f=16.1608
[loss-ga] ep 19 it 190 total=-7.9783 ce_r=8.0037 ce_f=15.9820
[loss-ga] ep 19 it 240 total=-7.7891 ce_r=7.8704 ce_f=15.6596
[loss-ga] ep 19 it 290 total=-7.9384 ce_r=8.1716 ce_f=16.1100
[loss-ga] ep 19 it 340 total=-7.8176 ce_r=7.9989 ce_f=15.8165
[loss-ga] ep 20 it 0 total=-8.0711 ce_r=8.2923 ce_f=16.3634
[loss-ga] ep 20 it 50 total=-8.1217 ce_r=8.1586 ce_f=16.2803
[loss-ga] ep 20 it 100 total=-7.9397 ce_r=7.9740 ce_f=15.9137
[loss-ga] ep 20 it 150 total=-8.0108 ce_r=8.0814 ce_f=16.0922
[loss-ga] ep 20 it 200 total=-8.2307 ce_r=8.2476 ce_f=16.4783
[loss-ga] ep 20 it 250 total=-7.9800 ce_r=7.9983 ce_f=15.9784
[loss-ga] ep 20 it 300 total=-7.9660 ce_r=8.0872 ce_f=16.0532
[loss-ga] ep 20 it 350 total=-7.6276 ce_r=7.7224 ce_f=15.3500
[loss-ga] ep 21 it 10 total=-7.8880 ce_r=8.0045 ce_f=15.8926
[loss-ga] ep 21 it 60 total=-7.8500 ce_r=8.0140 ce_f=15.8640
[loss-ga] ep 21 it 110 total=-7.9521 ce_r=8.0924 ce_f=16.0445
[loss-ga] ep 21 it 160 total=-8.0683 ce_r=8.1047 ce_f=16.1730
[loss-ga] ep 21 it 210 total=-8.0044 ce_r=8.0854 ce_f=16.0898
[loss-ga] ep 21 it 260 total=-8.0815 ce_r=8.1393 ce_f=16.2208
[loss-ga] ep 21 it 310 total=-8.0236 ce_r=8.0380 ce_f=16.0616
[loss-ga] ep 21 it 360 total=-7.9851 ce_r=8.0299 ce_f=16.0150
[loss-ga] ep 22 it 20 total=-8.1021 ce_r=8.1327 ce_f=16.2348
[loss-ga] ep 22 it 70 total=-7.9937 ce_r=8.0744 ce_f=16.0681
[loss-ga] ep 22 it 120 total=-7.9152 ce_r=8.0225 ce_f=15.9377
[loss-ga] ep 22 it 170 total=-7.8823 ce_r=7.9774 ce_f=15.8597
[loss-ga] ep 22 it 220 total=-8.0813 ce_r=8.1124 ce_f=16.1938
[loss-ga] ep 22 it 270 total=-8.0234 ce_r=8.0409 ce_f=16.0643
[loss-ga] ep 22 it 320 total=-8.0018 ce_r=8.1271 ce_f=16.1289
[loss-ga] ep 22 it 370 total=-7.9446 ce_r=8.0424 ce_f=15.9870
[loss-ga] ep 23 it 30 total=-7.9119 ce_r=7.9808 ce_f=15.8927
[loss-ga] ep 23 it 80 total=-7.8954 ce_r=8.0555 ce_f=15.9509
[loss-ga] ep 23 it 130 total=-8.1034 ce_r=8.1606 ce_f=16.2641
[loss-ga] ep 23 it 180 total=-7.9310 ce_r=8.1315 ce_f=16.0626
[loss-ga] ep 23 it 230 total=-8.1751 ce_r=8.2976 ce_f=16.4728
[loss-ga] ep 23 it 280 total=-8.0973 ce_r=8.2438 ce_f=16.3411
[loss-ga] ep 23 it 330 total=-8.0203 ce_r=8.0547 ce_f=16.0750
[loss-ga] ep 23 it 380 total=-7.9888 ce_r=8.0082 ce_f=15.9970
[loss-ga] ep 24 it 40 total=-8.1344 ce_r=8.3403 ce_f=16.4746
[loss-ga] ep 24 it 90 total=-7.9234 ce_r=8.0281 ce_f=15.9515
[loss-ga] ep 24 it 140 total=-7.9407 ce_r=7.9917 ce_f=15.9324
[loss-ga] ep 24 it 190 total=-8.1034 ce_r=8.1423 ce_f=16.2457
[loss-ga] ep 24 it 240 total=-8.1324 ce_r=8.2183 ce_f=16.3507
[loss-ga] ep 24 it 290 total=-8.0559 ce_r=8.1671 ce_f=16.2231
[loss-ga] ep 24 it 340 total=-8.0476 ce_r=8.0790 ce_f=16.1266
/home/shaokun/anaconda3/envs/CILPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/CILPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Files already downloaded and verified
Files already downloaded and verified
ckpt loaded from checkpoints/CIFAR-100-resnet34-top5-palm-cache6-ema0.999-baseline-ga-b128-e25-lr0.001-wd1e-4-fl1-CIFAR-100forget15.pt
resnet34-top5-palm-cache6-ema0.999-baseline-ga-b128-e25-lr0.001-wd1e-4-fl1-CIFAR-100forget15: Number of model parameters: 21605312
Processing in-distribution CIFAR-100 images
  0%|          | 0/391 [00:00<?, ?it/s]  0%|          | 1/391 [00:00<03:10,  2.05it/s]  2%|▏         | 8/391 [00:00<00:22, 17.38it/s]  4%|▍         | 16/391 [00:00<00:11, 32.59it/s]  7%|▋         | 26/391 [00:00<00:07, 49.24it/s]  9%|▉         | 36/391 [00:00<00:05, 61.95it/s] 12%|█▏        | 46/391 [00:01<00:04, 71.66it/s] 15%|█▍        | 57/391 [00:01<00:04, 80.36it/s] 17%|█▋        | 67/391 [00:01<00:03, 85.64it/s] 20%|█▉        | 77/391 [00:01<00:03, 89.69it/s] 22%|██▏       | 87/391 [00:01<00:03, 91.60it/s] 25%|██▌       | 98/391 [00:01<00:03, 94.43it/s] 28%|██▊       | 108/391 [00:01<00:02, 95.35it/s] 30%|███       | 118/391 [00:01<00:02, 96.59it/s] 33%|███▎      | 128/391 [00:01<00:02, 97.45it/s] 36%|███▌      | 139/391 [00:01<00:02, 98.56it/s] 38%|███▊      | 150/391 [00:02<00:02, 99.13it/s] 41%|████      | 160/391 [00:02<00:02, 99.11it/s] 44%|████▎     | 171/391 [00:02<00:02, 99.66it/s] 47%|████▋     | 182/391 [00:02<00:02, 99.87it/s] 49%|████▉     | 193/391 [00:02<00:01, 100.02it/s] 52%|█████▏    | 204/391 [00:02<00:01, 99.99it/s]  55%|█████▍    | 215/391 [00:02<00:01, 98.18it/s] 58%|█████▊    | 225/391 [00:02<00:01, 98.03it/s] 60%|██████    | 236/391 [00:02<00:01, 98.74it/s] 63%|██████▎   | 246/391 [00:03<00:01, 83.85it/s] 66%|██████▌   | 257/391 [00:03<00:01, 88.44it/s] 68%|██████▊   | 267/391 [00:03<00:01, 85.37it/s] 71%|███████   | 276/391 [00:03<00:01, 77.79it/s] 73%|███████▎  | 286/391 [00:03<00:01, 82.23it/s] 75%|███████▌  | 295/391 [00:03<00:01, 73.90it/s] 77%|███████▋  | 303/391 [00:03<00:01, 72.71it/s] 80%|████████  | 313/391 [00:03<00:00, 78.70it/s] 83%|████████▎ | 324/391 [00:04<00:00, 84.83it/s] 85%|████████▌ | 334/391 [00:04<00:00, 88.05it/s] 88%|████████▊ | 343/391 [00:04<00:00, 85.14it/s] 90%|█████████ | 352/391 [00:04<00:00, 74.86it/s] 92%|█████████▏| 360/391 [00:04<00:00, 72.86it/s] 95%|█████████▍| 371/391 [00:04<00:00, 80.85it/s] 98%|█████████▊| 382/391 [00:04<00:00, 86.87it/s]100%|██████████| 391/391 [00:04<00:00, 80.58it/s]
50000 images processed, 4.968337059020996 seconds used

Processing in-distribution CIFAR-100 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:27,  2.82it/s] 13%|█▎        | 10/79 [00:00<00:02, 27.05it/s] 25%|██▌       | 20/79 [00:00<00:01, 46.88it/s] 38%|███▊      | 30/79 [00:00<00:00, 61.37it/s] 51%|█████     | 40/79 [00:00<00:00, 71.75it/s] 63%|██████▎   | 50/79 [00:00<00:00, 78.73it/s] 76%|███████▌  | 60/79 [00:00<00:00, 84.46it/s] 89%|████████▊ | 70/79 [00:01<00:00, 88.65it/s]100%|██████████| 79/79 [00:02<00:00, 32.63it/s]
10000 images processed, 2.4605493545532227 seconds used

Saved forget OOD features to cache/resnet34-top5-palm-cache6-ema0.999-baseline-ga-b128-e25-lr0.001-wd1e-4-fl1-CIFAR-100forget15/CIFAR-100/forget
Processing out-of-distribution SVHN images
  0%|          | 0/204 [00:00<?, ?it/s]  0%|          | 1/204 [00:00<01:36,  2.11it/s]  3%|▎         | 7/204 [00:00<00:12, 15.32it/s]  8%|▊         | 17/204 [00:00<00:05, 36.12it/s] 13%|█▎        | 27/204 [00:00<00:03, 52.24it/s] 18%|█▊        | 37/204 [00:00<00:02, 64.80it/s] 23%|██▎       | 47/204 [00:00<00:02, 73.73it/s] 28%|██▊       | 57/204 [00:01<00:01, 80.79it/s] 33%|███▎      | 67/204 [00:01<00:01, 84.43it/s] 38%|███▊      | 77/204 [00:01<00:01, 87.72it/s] 43%|████▎     | 87/204 [00:01<00:01, 90.33it/s] 48%|████▊     | 97/204 [00:01<00:01, 92.82it/s] 52%|█████▏    | 107/204 [00:01<00:01, 90.87it/s] 57%|█████▋    | 117/204 [00:01<00:00, 93.01it/s] 62%|██████▏   | 127/204 [00:01<00:00, 94.65it/s] 67%|██████▋   | 137/204 [00:01<00:00, 95.72it/s] 72%|███████▏  | 147/204 [00:02<00:00, 94.43it/s] 77%|███████▋  | 157/204 [00:02<00:00, 94.57it/s] 82%|████████▏ | 167/204 [00:02<00:00, 93.20it/s] 87%|████████▋ | 177/204 [00:02<00:00, 94.55it/s] 92%|█████████▏| 188/204 [00:02<00:00, 96.83it/s] 98%|█████████▊| 199/204 [00:02<00:00, 98.29it/s]100%|██████████| 204/204 [00:02<00:00, 77.82it/s]
26032 images processed, 2.6620612144470215 seconds used

Processing out-of-distribution places365 images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:45,  1.73it/s] 13%|█▎        | 10/79 [00:00<00:03, 18.83it/s] 24%|██▍       | 19/79 [00:00<00:01, 33.82it/s] 35%|███▌      | 28/79 [00:00<00:01, 46.66it/s] 46%|████▌     | 36/79 [00:01<00:00, 52.45it/s] 57%|█████▋    | 45/79 [00:01<00:00, 60.52it/s] 67%|██████▋   | 53/79 [00:01<00:00, 65.12it/s] 81%|████████  | 64/79 [00:01<00:00, 75.33it/s] 95%|█████████▍| 75/79 [00:01<00:00, 82.83it/s]100%|██████████| 79/79 [00:01<00:00, 53.32it/s]
10000 images processed, 1.5101404190063477 seconds used

Processing out-of-distribution LSUN images
  0%|          | 0/79 [00:00<?, ?it/s]  1%|▏         | 1/79 [00:00<00:35,  2.19it/s] 14%|█▍        | 11/79 [00:00<00:02, 25.27it/s] 27%|██▋       | 21/79 [00:00<00:01, 43.30it/s] 39%|███▉      | 31/79 [00:00<00:00, 58.06it/s] 52%|█████▏    | 41/79 [00:00<00:00, 68.67it/s] 65%|██████▍   | 51/79 [00:00<00:00, 76.52it/s] 78%|███████▊  | 62/79 [00:01<00:00, 83.92it/s] 92%|█████████▏| 73/79 [00:01<00:00, 89.10it/s]100%|██████████| 79/79 [00:01<00:00, 63.40it/s]
10000 images processed, 1.2659633159637451 seconds used

Processing out-of-distribution iSUN images
  0%|          | 0/70 [00:00<?, ?it/s]  1%|▏         | 1/70 [00:00<00:31,  2.21it/s] 16%|█▌        | 11/70 [00:00<00:02, 25.63it/s] 30%|███       | 21/70 [00:00<00:01, 44.09it/s] 44%|████▍     | 31/70 [00:00<00:00, 58.57it/s] 60%|██████    | 42/70 [00:00<00:00, 70.73it/s] 76%|███████▌  | 53/70 [00:00<00:00, 79.68it/s] 91%|█████████▏| 64/70 [00:01<00:00, 85.83it/s]100%|██████████| 70/70 [00:01<00:00, 60.89it/s]
8925 images processed, 1.1827850341796875 seconds used

Processing out-of-distribution dtd images
  0%|          | 0/45 [00:00<?, ?it/s]  2%|▏         | 1/45 [00:01<00:49,  1.14s/it]  4%|▍         | 2/45 [00:01<00:23,  1.86it/s] 27%|██▋       | 12/45 [00:01<00:02, 15.02it/s] 38%|███▊      | 17/45 [00:01<00:01, 16.71it/s] 47%|████▋     | 21/45 [00:01<00:01, 17.59it/s] 64%|██████▍   | 29/45 [00:01<00:00, 27.51it/s] 76%|███████▌  | 34/45 [00:02<00:00, 20.05it/s] 98%|█████████▊| 44/45 [00:02<00:00, 31.59it/s]100%|██████████| 45/45 [00:02<00:00, 15.39it/s]
5640 images processed, 2.9600298404693604 seconds used

18.670500993728638
/home/shaokun/anaconda3/envs/CILPALM/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/shaokun/anaconda3/envs/CILPALM/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
/home/shaokun/anaconda3/envs/CILPALM/lib/python3.10/site-packages/umap/umap_.py:1952: UserWarning: n_jobs value 1 overridden to 1 by setting random_state. Use no seed for parallelism.
  warn(
/home/shaokun/anaconda3/envs/CILPALM/lib/python3.10/site-packages/umap/umap_.py:1952: UserWarning: n_jobs value 1 overridden to 1 by setting random_state. Use no seed for parallelism.
  warn(
Evaluating SVHN
Evaluating places365
Evaluating LSUN
Evaluating iSUN
Evaluating dtd
 OOD detection method: SSD+
              FPR    AUROC  AUIN  
SVHN          17.91  96.47  91.57
places365     75.48  78.30  74.72
LSUN          53.71  88.98  89.28
iSUN          69.14  83.54  85.16
dtd           55.62  87.37  91.56
AVG           54.37  86.93  86.46
Retain-Acc: 0.7371
Forget-as-OOD (retain known vs forget novel):
  FPR: 81.80 AUROC: 73.57 AUIN: 94.09
8.201331377029419
[umap] saved to figs/umap_CIFAR-100_resnet34_top5-palm-cache6-ema0.999-baseline-ga-b128-e25-lr0.001-wd1e-4-fl1-CIFAR-100forget15_domain.png
[umap] saved to figs/umap_CIFAR-100_resnet34_top5-palm-cache6-ema0.999-baseline-ga-b128-e25-lr0.001-wd1e-4-fl1-CIFAR-100forget15_rf.png
